var K="undefined"!=typeof exports?exports:"undefined"!=typeof window?window:"undefined"!=typeof self?self:this;
(function(Nf){function gb(a,b){this.pe=!1;null==a&&null==b?this.pe=!1:null!=a&&(this.head=a,this.md=null==b?gb.Zb:b,this.pe=!0)}function Pe(){}function Qe(){this.Kh=new Nd;this.Tj=new Nd;this.nA=new Nd}function Re(a,b){null==b&&(b="");this.name=a;this.value=b}function ge(a){$c.call(this,a)}function $c(a){this.uri=a;this.contentType="application/x-www-form-urlencoded";this.formData=new ea;this.headers=[];this.method="GET";this.timeout=3E4;this.Pz=new Se;this.Pz.Wn(this)}function Te(){}function Gg(){}
function zc(a,b,c,d){null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.x=a;this.y=b;this.width=c;this.height=d}function rd(a,b,c,d,e,f){null==f&&(f=0);null==e&&(e=0);null==d&&(d=1);null==c&&(c=0);null==b&&(b=0);null==a&&(a=1);this.$=a;this.m=b;this.Hq=c;this.d=d;this.Bc=e;this.Cc=f}function Ue(a,b){this.$I=a;null==b?this.rect=a.YA():(0>b.x&&(b.x=0),0>b.y&&(b.y=0),b.x+b.width>a.width&&(b.width=a.width-b.x),b.y+b.height>a.height&&(b.height=a.height-b.y),0>b.width&&(b.width=0),0>b.height&&
(b.height=0),this.rect=b);this.Do=a.buffer.aB();this.x=Math.ceil(this.rect.x);this.y=Math.ceil(this.rect.y);this.width=Math.floor(this.rect.width);this.height=Math.floor(this.rect.height);this.offset=this.Do*(this.y+a.offsetY)+4*(this.x+a.offsetX)}function Of(){}function xa(){}function Pf(){}function Qf(){}function pc(a,b,c,d,e){null==c&&(c=0);null==b&&(b=0);this.data=a;this.width=b;this.height=c;this.format=null==e?0:e;this.UK=!1;this.wD=!0}function da(a,b,c,d,e,f,g){null==e&&(e=-1);null==d&&(d=
-1);null==c&&(c=0);null==b&&(b=0);this.offsetX=b;this.offsetY=c;this.width=d;this.height=e;this.version=0;if(null==g)if(null!=ad.current&&null!=ad.current.RE[0]){switch(ad.current.RE[0].context[1]){case 1:case 2:b=ra.kg;break;case 3:b=ra.To;break;default:b=ra.lk}this.type=b}else this.type=ra.lk;else this.type=g;if(null==a){if(0<d&&0<e)switch(this.type[1]){case 0:this.buffer=new pc(null,d,e);xa.Wo(this,d,e);null!=f&&this.fillRect(new zc(0,0,d,e),f);break;case 1:a=d*e*4;var h;null!=a?h=new hb(a):h=
null;this.buffer=new pc(h,d,e);null!=f&&this.fillRect(new zc(0,0,d,e),f)}}else this.PE(a)}function Hg(){}function Rf(){}function Nd(){this.Uz=!1;this.mk=[];this.Wl=[];this.mp=[]}function cc(){this.ic=new Ve}function lb(){}function Ve(a,b){null==b&&(b=!1);if(null!=a)if(b){var c=new cc;c.ic=this;lb.Sv({Gl:c,MM:a})}else try{this.value=a(),this.Yn=!0}catch(d){d instanceof ja&&(d=d.Lo),this.error=d,this.Zn=!0}}function ad(){}function sd(){}function rg(){}function Se(){}function tc(){}function Bb(){}function rb(a){if(a instanceof
Array&&null==a.jb)this.$=a,this.byteLength=a.length;else{this.$=[];for(var b=0;b<a;)this.$[b++]=0;this.byteLength=a}}function ja(a){this.Lo=a;this.message=String(a);Error.captureStackTrace&&Error.captureStackTrace(this,ja)}function td(a){switch(a){case ".":case "..":this.dir=a;this.file="";return}var b=a.lastIndexOf("/"),c=a.lastIndexOf("\\");b<c?(this.dir=Z.substr(a,0,c),a=Z.substr(a,c+1,null)):c<b?(this.dir=Z.substr(a,0,b),a=Z.substr(a,b+1,null)):this.dir=null;b=a.lastIndexOf(".");-1!=b?(this.ext=
Z.substr(a,b+1,null),this.file=Z.substr(a,0,b)):(this.ext=null,this.file=a)}function he(){}function Sf(){}function ea(){this.i={}}function ie(a,b){this.map=a;this.keys=b;this.index=0;this.count=b.length}function ib(){this.i={QE:{}}}function Wa(){this.i={}}function We(a){for(var b=a.length,c=1;b>1<<c;)++c;if(8<c||b!=1<<c)throw new ja("BaseCode : base length must be a power of two.");this.pH=a;this.XJ=c}function cb(a){this.length=a.byteLength;this.m=new hb(a);this.m.zH=a;a.XI=this;a.CH=this.m}function Xe(){this.ts=
""}function dc(a){var b=this;this.id=setInterval(function(){b.cw()},a)}function ud(){}function mb(){}function Tf(){}function Ye(a,b,c){this.height=this.width=0;this.width=b;this.height=c;this.data=null!=a?a:new hb(b*c*4)}function vd(){}function Uf(){this.qg=new ea}function Ze(a,b){this.Sz=a;this.zv=b}function U(){this.tg=[]}function $e(a,b){null==b&&(b=!1);this.zv=a;this.iD=b}function af(){this.Qk=!1;this.dn=255;this.cn=519;this.qq=1;this.lz=255;this.mz=this.oz=7680;this.nz=7681;this.Wp=this.Bk=this.xm=
this.ym=!0}function bf(){this.yb=[];this.aF=new ea;this.hI=50;this.gI=1E3}function Od(a,b,c,d){var e=this;ga.call(this,a,"vrDistortionCorrection",["LensCenter","Scale","ScaleIn","HmdWarpParam"],null,d.Pv,b,2,null,!1);this.WF=c;this.Hp=d.dI;this.Ky=d.Pv;this.vy=d.uJ;this.Qi.add(function(){e.xj=.5*e.width/e.height;e.az=new W(2,2/e.xj);e.$y=new W(1/e.Ky*.5,1/e.Ky*.5*e.xj);e.uy=new W(e.WF?.5-.5*e.vy:.5+.5*e.vy,.5)});this.Le.add(function(a){var b=e.uy.x,c=e.uy.y;if(a.Jb("LensCenter",b,c)){var d=a.c,l=
a.u.get("LensCenter");d.b.uniform2f(l,b,c)}b=e.$y.x;c=e.$y.y;a.Jb("Scale",b,c)&&(d=a.c,l=a.u.get("Scale"),d.b.uniform2f(l,b,c));b=e.az.x;c=e.az.y;a.Jb("ScaleIn",b,c)&&(d=a.c,l=a.u.get("ScaleIn"),d.b.uniform2f(l,b,c));b=e.Hp[0];c=e.Hp[1];d=e.Hp[2];l=e.Hp[3];a.Oa("HmdWarpParam",b,c,d,l)&&a.c.Tb(a.u.get("HmdWarpParam"),b,c,d,l)})}function je(a,b,c,d,e,f){null==f&&(f=!1);var g=this;ga.call(this,a,"stereoscopicInterlace",["stepSize"],["camASampler"],1,b[1],d,e,f,c?"#define IS_STEREOSCOPIC_HORIZ 1":"");
this.Um=b[0].Ff;this.rj=new W(1/this.width,1/this.height);this.Qi.add(function(){g.rj=new W(1/g.width,1/g.height)});this.Le.add(function(a){var b=g.Um,c=a.c,d=a.Rd.indexOf("camASampler");0<b.nb.length&&(b=b.nb.data[b.Zg].data,0<=d&&(d=33984+d,c.J!=d-33984&&(c.b.activeTexture(d),c.J=d-33984),c.P[c.J]!=b&&(c.b.bindTexture(3553,b),c.P[c.J]=b)));c=g.rj.x;d=g.rj.y;a.Jb("stepSize",c,d)&&(b=a.c,a=a.u.get("stepSize"),b.b.uniform2f(a,c,d))})}function wd(a,b,c,d,e,f,g,h){null==h&&(h=!1);null==f&&(f=2);var k=
this;this.direction=b;this.nu=c;ga.call(this,a,"glowBlurPostProcess",["screenSize","direction","blurWidth"],null,d,e,f,g,h);this.Le.add(function(a){var b=k.width,c=k.height;if(a.Jb("screenSize",b,c)){var d=a.c,e=a.u.get("screenSize");d.b.uniform2f(e,b,c)}b=k.direction;a.Jb("direction",b.x,b.y)&&(c=a.c,d=a.u.get("direction"),c.b.uniform2f(d,b.x,b.y));b=k.nu;c=a.Qa.get("blurWidth");if(null==c||c[0]!=b)a.Qa.set("blurWidth",[b]),c=a.c,a=a.u.get("blurWidth"),c.b.uniform1f(a,b)})}function Pd(a,b,c){this.Wf=
a;this.j=b;this.hs=c}function xd(a,b){this.ja=a;this.ld=b;this.qe=uc.Ag(a[0].Wf,a[1].Wf,a[2].Wf)}function uc(a,b){this.j=a;this.o=b}function Ac(a){this.Oe=[];this.qe=this.Ie=this.back=null;null!=a&&this.Gq(a)}function A(){}function fa(){}function sb(a,b){this.width=a;this.height=b}function yd(a,b){this.position=null!=a?a:new p(0,0,0);this.j=null!=b?b:new p(0,1,0)}function sg(){}function ke(){}function Gc(){this.url=""}function Sc(){this.Yi=this.ci=0;Lc.call(this);this.ba="DIFFUSE AMBIENT OPACITY OPACITYRGB REFLECTION EMISSIVE SPECULAR BUMP PARALLAX PARALLAXOCCLUSION SPECULAROVERALPHA CLIPPLANE ALPHATEST ALPHAFROMDIFFUSE POINTSIZE FOG SPECULARTERM DIFFUSEFRESNEL OPACITYFRESNEL REFLECTIONFRESNEL REFRACTIONFRESNEL EMISSIVEFRESNEL FRESNEL NORMAL UV1 UV2 VERTEXCOLOR VERTEXALPHA INSTANCES GLOSSINESS ROUGHNESS EMISSIVEASILLUMINATION LINKEMISSIVEWITHDIFFUSE REFLECTIONFRESNELFROMSPECULAR LIGHTMAP USELIGHTMAPASSHADOWMAP REFLECTIONMAP_3D REFLECTIONMAP_SPHERICAL REFLECTIONMAP_PLANAR REFLECTIONMAP_CUBIC REFLECTIONMAP_PROJECTION REFLECTIONMAP_SKYBOX REFLECTIONMAP_EXPLICIT REFLECTIONMAP_EQUIRECTANGULAR REFLECTIONMAP_EQUIRECTANGULAR_FIXED INVERTCUBICMAP LOGARITHMICDEPTH REFRACTION REFRACTIONMAP_3D REFLECTIONOVERALPHA INVERTNORMALMAPX INVERTNORMALMAPY SHADOWFULLFLOAT SHADOWS CAMERACOLORCURVES CAMERACOLORGRADING".split(" ").slice(0);
this.zc=Array(this.ba.length);for(var a=0,b=this.ba.length;a<b;)this.zc[a++]=!1;this.ci=this.Yi=0}function ic(){}function Lc(){this.Ic="";this.xJ=[];this.wJ=[];this.rE=!1;this.Ph=[];this.Rh=[];this.Qh=[];this.Wi=[];this.Ei=[];this.wi=[];this.Ri=[];this.jc=[]}function Aa(){this.FG=this.IG=this.GG=0;this.HG=30;this.By=this.Ey=this.Cy=0;this.Dy=30;this.jy=this.my=this.ky=0;this.ly=30;this.ey=this.hy=this.fy=0;this.gy=30;this.Hm=new ca(0,0,0,0);this.Vm=new ca(0,0,0,0);this.hz=new ca(0,0,0,0);this.jj=
new ca(0,0,0,0);this.iy=new ca(0,0,0,0);this.Qp=new ca(0,0,0,0);this.Sk=new ca(0,0,0,0);this.Rx=!0}function cf(){}function Tc(a,b,c,d,e,f){null==f&&(f=!1);null==e&&(e=!1);this.c=a;this.qh=c;this.qg=b;this.Ut=d;e||this.create();this.ge=f}function z(){}function db(){this.Qi=new U;this.TB=new U;this.XB=new U;this.cK=new U;this.WB=new U;this.YB=new U;this.Nb=new U;this.eJ=this.isEnabled=this.FK=!0;this.uk=new Wa;this.SF=db.IM++;this.ph=!1;this.aq=0;this.vc=new Wa;this.he={width:0,height:0};this.ua=new ea}
function df(){}function Ig(){}function zd(){}function Qd(){}function vc(){}function Vf(){}function le(a,b,c){this.name=a;this.from=b;this.Pl=c}function Wf(){this.ur=!1}function ef(){}function Bc(a,b,c,d){this.type=a;this.event=b;this.pw=!1;new W(c,d)}function Ad(a,b){this.type=a;this.event=b}function Cb(){}function ff(){}function me(a,b){var c=wb.pb;(null!=t["videoios10fix.fragment"]?c.Gd("videoios10fix.fragment"):c.i.hasOwnProperty("videoios10fix.fragment"))||(c=wb.pb,null!=t["videoios10fix.fragment"]?
c.C("videoios10fix.fragment","#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Samplers\r\nvarying vec2 vUV;\r\nuniform sampler2D textureSampler;\r\n\r\nvoid main(void)\r\n{\r\n\tgl_FragColor = texture2D(textureSampler, vUV).bgra;\r\n}"):c.i["videoios10fix.fragment"]="#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\n// Samplers\r\nvarying vec2 vUV;\r\nuniform sampler2D textureSampler;\r\n\r\nvoid main(void)\r\n{\r\n\tgl_FragColor = texture2D(textureSampler, vUV).bgra;\r\n}");ga.call(this,
a,"videoios10fix",null,null,1,b)}function ne(a,b,c,d,e,f){null==f&&(f=!1);var g=this,h=wb.pb;(null!=t["stereoscopic.fragment"]?h.Gd("stereoscopic.fragment"):h.i.hasOwnProperty("stereoscopic.fragment"))||(h=wb.pb,null!=t["stereoscopic.fragment"]?h.C("stereoscopic.fragment","precision highp float;\r\n\r\nconst vec3 TWO = vec3(2.0, 2.0, 2.0);\r\n\r\nvarying vec2 vUV;\r\nuniform sampler2D camASampler;\r\nuniform sampler2D textureSampler;\r\nuniform vec2 stepSize;\r\n\r\nvoid main(void)\r\n{\r\n    bool useCamB;\r\n    vec2 texCoord1;\r\n    vec2 texCoord2;\r\n\r\n    vec3 frag1;\r\n    vec3 frag2;\r\n\r\n#ifdef IS_STEREOSCOPIC_HORIZ\r\n\t    useCamB = vUV.x > 0.5;\r\n\t    texCoord1 = vec2(useCamB ? (vUV.x - 0.25) : vUV.x + 0.25, vUV.y);\r\n\t    texCoord2 = vec2(texCoord1.x + stepSize.x, vUV.y);\r\n#else\r\n\t    useCamB = vUV.y > 0.5;\r\n\t    texCoord1 = vec2(vUV.x, useCamB ? vUV.y - 0.25 : vUV.y + 0.25);\r\n\t    texCoord2 = vec2(vUV.x, texCoord1.y + stepSize.y);\r\n#endif\r\n\r\n    // cannot assign a sampler to a variable, so must duplicate texture accesses\r\n    if (useCamB){\r\n        frag1 = texture2D(textureSampler, texCoord1).rgb;\r\n        frag2 = texture2D(textureSampler, texCoord2).rgb;\r\n    }else{\r\n        frag1 = texture2D(camASampler   , texCoord1).rgb;\r\n        frag2 = texture2D(camASampler   , texCoord2).rgb;\r\n    }\r\n\r\n    gl_FragColor = vec4((frag1 + frag2) / TWO, 1.0);\r\n}"):
h.i["stereoscopic.fragment"]="precision highp float;\r\n\r\nconst vec3 TWO = vec3(2.0, 2.0, 2.0);\r\n\r\nvarying vec2 vUV;\r\nuniform sampler2D camASampler;\r\nuniform sampler2D textureSampler;\r\nuniform vec2 stepSize;\r\n\r\nvoid main(void)\r\n{\r\n    bool useCamB;\r\n    vec2 texCoord1;\r\n    vec2 texCoord2;\r\n\r\n    vec3 frag1;\r\n    vec3 frag2;\r\n\r\n#ifdef IS_STEREOSCOPIC_HORIZ\r\n\t    useCamB = vUV.x > 0.5;\r\n\t    texCoord1 = vec2(useCamB ? (vUV.x - 0.25) : vUV.x + 0.25, vUV.y);\r\n\t    texCoord2 = vec2(texCoord1.x + stepSize.x, vUV.y);\r\n#else\r\n\t    useCamB = vUV.y > 0.5;\r\n\t    texCoord1 = vec2(vUV.x, useCamB ? vUV.y - 0.25 : vUV.y + 0.25);\r\n\t    texCoord2 = vec2(vUV.x, texCoord1.y + stepSize.y);\r\n#endif\r\n\r\n    // cannot assign a sampler to a variable, so must duplicate texture accesses\r\n    if (useCamB){\r\n        frag1 = texture2D(textureSampler, texCoord1).rgb;\r\n        frag2 = texture2D(textureSampler, texCoord2).rgb;\r\n    }else{\r\n        frag1 = texture2D(camASampler   , texCoord1).rgb;\r\n        frag2 = texture2D(camASampler   , texCoord2).rgb;\r\n    }\r\n\r\n    gl_FragColor = vec4((frag1 + frag2) / TWO, 1.0);\r\n}");
ga.call(this,a,"stereoscopic",["stepSize"],["camASampler"],1,b[1],d,e,f,c?"#define IS_STEREOSCOPIC_HORIZ 1":"");this.Um=b[0].Ff;this.rj=new W(1/this.width,1/this.height);this.Qi.add(function(){g.rj=new W(1/g.width,1/g.height)});this.Le.add(function(a){var b=g.Um,c=a.c,d=a.Rd.indexOf("camASampler");0<b.nb.length&&(b=b.nb.data[b.Zg].data,0<=d&&(d=33984+d,c.J!=d-33984&&(c.b.activeTexture(d),c.J=d-33984),c.P[c.J]!=b&&(c.b.bindTexture(3553,b),c.P[c.J]=b)));c=g.rj.x;d=g.rj.y;a.Jb("stepSize",c,d)&&(b=a.c,
a=a.u.get("stepSize"),b.b.uniform2f(a,c,d))})}function Bd(){}function jc(a,b,c){xb.call(this,a,b,c)}function gf(a,b){null==a&&(a=new xb(0,0,0));null==b&&(b=new xb(1,0,0));this.GK=a;this.HK=b}function Xf(){}function oe(a,b,c,d,e){null==e&&(e=3);null==d&&(d=!1);var f=this;ka.call(this,null,b,!0,d);this.name=a;this.zg=c.video;this.zg.oncanplaythrough=function(){var a;a=f.zg.videoWidth;for(var c=1;c*=2,c<a;);if(c==a){a=f.zg.videoHeight;for(c=1;c*=2,c<a;);a=c==a}else a=!1;a?(f.hg=1,f.ig=1):(f.hg=0,f.ig=
0);f.ga=b.c.OH(f.zg.videoWidth,f.zg.videoHeight,!1,e);f.ga.pa=!0;f.f.Vv(F(f,f.update));f.zg.oncanplaythrough=null};this.Yp=1E3*((new Date).getTime()/1E3-ha.ae)|0}function Rd(a,b,c,d){Ua.call(this,a,d);this.Pd=b;this.set_inputFormat(c)}function Yf(){}function Mc(){}function Fa(){}function kc(){}function pe(a,b,c,d,e,f,g,h){null==h&&(h="spherical");null==g&&(g="erect");nb.call(this,a,b,c,d,e,f,g,h)}function hf(a,b,c,d,e,f,g){null==g&&(g="spherical");null==f&&(f="erect");null==e&&(e=0);null==d&&(d=180);
null==c&&(c=360);this.cd=[];this.gG=a;this.f=b;this.set_panoramaHFOV(c);this.set_panoramaVFOV(d);this.set_panoramaPitch(e);this.set_inputFormat(f);this.set_outputFormat(g)}function qe(a,b,c,d,e,f,g,h,k){null==h&&(h="spherical");null==g&&(g="erect");this.alpha=1;nb.call(this,a,b,c,d,e,f,g,h);this.kd(k)}function nb(a,b,c,d,e,f,g,h){null==h&&(h="spherical");null==g&&(g="erect");this.bq=!1;this.name=a;this.f=b;this.set_panoramaHFOV(c);this.set_panoramaVFOV(d);this.set_panoramaPitch(e);this.kw(f);this.set_inputFormat(g);
this.set_outputFormat(h)}function qc(a,b,c,d,e){this.xe=new W(0,0);this.panoramaHFOV=a;this.panoramaVFOV=b;this.panoramaPitch=c;this.kC=a<2*Math.PI;this.maxHFOV=d;this.minHFOV=e;this.yaw=0;this.pitch=c;this.Dv=.5*-a;this.Dv<-Math.PI&&(this.Dv=-Math.PI);this.Bv=.5*a;this.Bv>Math.PI&&(this.Bv=Math.PI);this.Ar=.5*-b+c;this.Ar<.5*-Math.PI&&(this.Ar=.5*-Math.PI);this.yr=.5*b+c;this.yr>.5*Math.PI&&(this.yr=.5*Math.PI)}function Ib(){this.Un()}function xb(a,b,c){null==c&&(c=0);null==b&&(b=0);null==a&&(a=
0);this.x=a;this.y=b;this.z=c}function re(){this.panoramaHFOV=this.panoramaVFOV=this.panoramaPitch=this.maxHFOV=this.minHFOV=this.initialHFOV=0}function Cd(a,b,c,d){yb.call(this,a,b,c,d);this.Or=.15}function se(a,b,c,d){yb.call(this,a,b,c,d)}function yb(a,b,c,d){this.Cb=new W(0,0);this.bf=new W(0,0);this.Kk=0;this.Ec=new W(0,0);Qa.call(this,a,b,c,d)}function ya(a,b,c,d){this.Qt=-1;Qa.call(this,a,b,c,d);this.ub=new X;this.ez=new X;a=new X;b=ya.Ma;var e=.25*Math.PI;c=Math.sin(0);d=Math.cos(0);var f=
Math.sin(0),g=Math.cos(0),h=Math.sin(e),e=Math.cos(e);b.x=e*f*d+h*g*c;b.y=h*g*d-e*f*c;b.z=e*g*c-h*f*d;b.o=e*g*d+h*f*c;f=.25*-Math.PI;b=Math.sin(0);c=Math.cos(0);d=Math.sin(f);f=Math.cos(f);g=Math.sin(0);h=Math.cos(0);a.x=h*d*c+g*f*b;a.y=g*f*c-h*d*b;a.z=h*f*b-g*d*c;a.o=h*f*c+g*d*b;b=ya.Ma;c=new X(0,0,0,1);d=-a.x*b.z+a.y*b.o+a.z*b.x+a.o*b.y;f=a.x*b.y-a.y*b.x+a.z*b.o+a.o*b.z;g=-a.x*b.x-a.y*b.y-a.z*b.z+a.o*b.o;c.x=a.x*b.o+a.y*b.z-a.z*b.y+a.o*b.x;c.y=d;c.z=f;c.o=g;this.$G=c}function Qa(a,b,c,d){this.Qm=
this.Sm=this.Rm=this.Dm=this.Gm=this.ct=this.pc=this.Ka=this.Ua=0;this.xI="dfov";this.Or=.05;la.call(this,a,b,c);this.Qm=d.panoramaHFOV;this.Sm=d.panoramaVFOV;this.Rm=d.panoramaPitch;this.Dm=d.maxHFOV;this.Gm=d.minHFOV;this.ct=d.initialHFOV;this.pc=this.Sa;this.Lk=F(this,this.reset);this.speed=.3;this.hh=!0}function te(){Uc.call(this,"Attitude","rot");this.values=[1,0,0,0]}function Uc(a,b){this.values=[];this.CK=new Dd;this.name=a;this.id=b}function ia(){if(null!=ia.Po)throw new ja("Sensors is a static class");
}function Ed(){}function jf(a,b){this.En=new ea;this.Jj=new ea;this.JH=a;b&&(this.ms=b)}function kf(){}function Lb(){}function Fd(){}function Zf(){}function $f(){}function ec(){}function Ga(){}function sa(){}function jb(){}function Z(){}function Mb(a,b){this.r=new RegExp(a,b.split("u").join(""))}function Xa(){return z.Te(this,"")}function S(a,b){function c(){}c.prototype=a;var d=new c,e;for(e in b)d[e]=b[e];b.toString!==Object.prototype.toString&&(d.toString=b.toString);return d}function F(a,b){if(null==
b)return null;null==b.Bf&&(b.Bf=Rg++);var c;null==a.hv?a.hv={}:c=a.hv[b.Bf];null==c&&(c=function(){return c.method.apply(c.scope,arguments)},c.scope=a,c.method=b,a.hv[b.Bf]=c);return c}K.BABYLON=K.BABYLON||{};K.CAPTURA=K.CAPTURA||{};K.CAPTURA.Viewer=K.CAPTURA.Viewer||{};K.CAPTURA.Extension=K.CAPTURA.Extension||{};K.CAPTURA.Extension.Signal=K.CAPTURA.Extension.Signal||{};K.CAPTURA.Extension.Video=K.CAPTURA.Extension.Video||{};K.CAPTURA.Extension.Babylon=K.CAPTURA.Extension.Babylon||{};var n={};n.EReg=
Mb;Mb.h=["EReg"];Mb.prototype={match:function(a){this.r.global&&(this.r.lastIndex=0);this.r.a=this.r.exec(a);this.r.vP=a;return null!=this.r.a},Jg:function(a){if(null!=this.r.a&&0<=a&&a<this.r.a.length)return this.r.a[a];throw new ja("EReg::matched");},l:Mb};n.HxOverrides=Z;Z.h=["HxOverrides"];Z.kN=function(a){switch(a.length){case 8:a=a.split(":");var b=new Date;b.setTime(0);b.setUTCHours(a[0]);b.setUTCMinutes(a[1]);b.setUTCSeconds(a[2]);return b;case 10:return a=a.split("-"),new Date(a[0],a[1]-
1,a[2],0,0,0);case 19:return b=a.split(" "),a=b[0].split("-"),b=b[1].split(":"),new Date(a[0],a[1]-1,a[2],b[0],b[1],b[2]);default:throw new ja("Invalid date format : "+a);}};Z.Uo=function(a,b){var c=a.charCodeAt(b);return c!=c?void 0:c};Z.substr=function(a,b,c){if(null==c)c=a.length;else if(0>c)if(0==b)c=a.length+c;else return"";return a.substr(b,c)};Z.remove=function(a,b){var c=a.indexOf(b);if(-1==c)return!1;a.splice(c,1);return!0};Z.XD=function(a){return{bA:0,Kz:a,Ca:function(){return this.bA<this.Kz.length},
next:function(){return this.Kz[this.bA++]}}};Math.h=["Math"];n.Reflect=jb;jb.h=["Reflect"];jb.pJ=function(a){try{return a.stage}catch(b){return null}};jb.Dg=function(a){var b=[];if(null!=a){var c=Object.prototype.hasOwnProperty,d;for(d in a)"__id__"!=d&&"hx__closures__"!=d&&c.call(a,d)&&b.push(d)}return b};jb.kp=function(a){return"function"==typeof a?!(a.h||a.Zi):!1};jb.Sj=function(a,b){return a==b?!0:jb.kp(a)&&jb.kp(b)?a.scope==b.scope&&a.method==b.method?null!=a.method:!1:!1};jb.eE=function(a){if(null==
a)return!1;var b=typeof a;return"string"==b||"object"==b&&null==a.jb?!0:"function"==b?null!=(a.h||a.Zi):!1};n.Std=sa;sa.h=["Std"];sa.Ib=function(a){return z.Te(a,"")};sa.$a=function(a){var b=parseInt(a,10);0!=b||120!=Z.Uo(a,1)&&88!=Z.Uo(a,1)||(b=parseInt(a));return isNaN(b)?null:b};n.StringTools=Ga;Ga.h=["StringTools"];Ga.aM=function(a){return 10<=a.length?"from_image"==Z.substr(a,0,10):!1};Ga.VD=function(a,b){var c=Z.Uo(a,b);return 8<c&&14>c?!0:32==c};Ga.oE=function(a){for(var b=a.length,c=0;c<b&&
Ga.VD(a,c);)++c;return 0<c?Z.substr(a,c,b-c):a};Ga.vE=function(a){for(var b=a.length,c=0;c<b&&Ga.VD(a,b-c-1);)++c;return 0<c?Z.substr(a,0,b-c):a};Ga.Cl=function(a){return Ga.oE(Ga.vE(a))};Ga.replace=function(a,b,c){return a.split(b).join(c)};n.Type=ec;ec.h=["Type"];ec.ND=function(a){a=a.h;return null==a?null:a.join(".")};ec.tE=function(a){a=n[a];return null!=a&&a.h?a:null};ec.al=function(a,b){switch(b.length){case 0:return new a;case 1:return new a(b[0]);case 2:return new a(b[0],b[1]);case 3:return new a(b[0],
b[1],b[2]);case 4:return new a(b[0],b[1],b[2],b[3]);case 5:return new a(b[0],b[1],b[2],b[3],b[4]);case 6:return new a(b[0],b[1],b[2],b[3],b[4],b[5]);case 7:return new a(b[0],b[1],b[2],b[3],b[4],b[5],b[6]);case 8:return new a(b[0],b[1],b[2],b[3],b[4],b[5],b[6],b[7]);case 9:return new a(b[0],b[1],b[2],b[3],b[4],b[5],b[6],b[7],b[8]);case 10:return new a(b[0],b[1],b[2],b[3],b[4],b[5],b[6],b[7],b[8],b[9]);case 11:return new a(b[0],b[1],b[2],b[3],b[4],b[5],b[6],b[7],b[8],b[9],b[10]);case 12:return new a(b[0],
b[1],b[2],b[3],b[4],b[5],b[6],b[7],b[8],b[9],b[10],b[11]);case 13:return new a(b[0],b[1],b[2],b[3],b[4],b[5],b[6],b[7],b[8],b[9],b[10],b[11],b[12]);case 14:return new a(b[0],b[1],b[2],b[3],b[4],b[5],b[6],b[7],b[8],b[9],b[10],b[11],b[12],b[13]);default:throw new ja("Too many arguments");}};ec.yC=function(a){function b(){}b.prototype=a.prototype;return new b};var lf={};n["_UInt.UInt_Impl_"]=lf;lf.h=["_UInt","UInt_Impl_"];lf.vD=function(a){return 0>a?4294967296+a:a+0};var Vc=K.CAPTURA.Extension.Babylon.App=
function(a){this.Mt=this.py=!1;null==a?(this.lb=window.document.createElement("canvas"),this.lb.width=window.innerWidth,this.lb.height=window.innerHeight,window.document.body.appendChild(this.lb),this.py=!0):z.D(a,HTMLCanvasElement)?this.lb=a:"string"==typeof a&&(this.lb=window.document.getElementById(a));a=ha.ns();"pointer"!=a&&"ontouchstart"in window&&(this.lb.addEventListener("touchstart",F(this,this.hC)),this.lb.addEventListener("touchend",F(this,this.fC)),this.lb.addEventListener("touchmove",
F(this,this.gC)));this.lb.addEventListener(a+"down",F(this,this.Uj));this.lb.addEventListener(a+"up",F(this,this.Wj));this.lb.addEventListener(a+"move",F(this,this.Vj));this.lb.addEventListener("mousewheel",F(this,this.Xj));this.lb.addEventListener("DOMMouseScroll",F(this,this.Xj),!1);ha.os([{name:"keydown",Qc:F(this,this.lo)},{name:"keyup",Qc:F(this,this.mo)}]);this.engine=this.PH();this.scene=this.Au();this.scene.cC.add(F(this,this.sK));this.scene.$B.add(F(this,this.hK));this.TC(-16777216)};n["cc.core.babylon.html5.BabylonApp"]=
Vc;Vc.h=["cc","core","babylon","html5","BabylonApp"];Vc.prototype={TC:function(a){this.backgroundColor=a;this.mM();return this.backgroundColor},dispose:function(){if(null!=this.lb){var a=ha.ns();"pointer"!=a&&"ontouchstart"in window&&(this.lb.removeEventListener("touchstart",F(this,this.hC)),this.lb.removeEventListener("touchend",F(this,this.fC)),this.lb.removeEventListener("touchmove",F(this,this.gC)));this.lb.removeEventListener(a+"down",F(this,this.Uj));this.lb.removeEventListener(a+"up",F(this,
this.Wj));this.lb.removeEventListener(a+"move",F(this,this.Vj));this.lb.removeEventListener("mousewheel",F(this,this.Xj));this.lb.removeEventListener("DOMMouseScroll",F(this,this.Xj),!1);ha.ps([{name:"keydown",Qc:F(this,this.lo)},{name:"keyup",Qc:F(this,this.mo)}]);this.py&&window.document.body.removeChild(this.lb);this.lb=null}null!=this.scene&&(this.scene.dispose(),this.scene=null);null!=this.engine&&(this.engine.dispose(),this.engine=null)},lo:function(a){for(var b=0,c=this.engine.$n;b<c.length;){var d=
c[b];++b;d(this.Xz(a.keyCode))}},mo:function(a){for(var b=0,c=this.engine.ao;b<c.length;){var d=c[b];++b;d(this.Xz(a.keyCode))}},hC:function(a){var b=0;for(a=a.changedTouches;b<a.length;){var c=a[b];++b;for(var d=0,e=this.engine.ek;d<e.length;){var f=e[d];++d;f(c.clientX,c.clientY,c.identifier)}}},gC:function(a){var b=0;for(a=a.changedTouches;b<a.length;){var c=a[b];++b;for(var d=0,e=this.engine.fk;d<e.length;){var f=e[d];++d;f(c.clientX,c.clientY,c.identifier)}}},fC:function(a){var b=0;for(a=a.changedTouches;b<
a.length;){var c=a[b];++b;for(var d=0,e=this.engine.gk;d<e.length;){var f=e[d];++d;f(c.clientX,c.clientY,c.identifier)}}},Uj:function(a){for(var b=0,c=this.engine.fo;b<c.length;){var d=c[b];++b;d(a.clientX,a.clientY,0)}},Vj:function(a){for(var b=0,c=this.engine.ho;b<c.length;){var d=c[b];++b;d(a.clientX,a.clientY)}},Wj:function(a){for(var b=0,c=this.engine.io;b<c.length;){var d=c[b];++b;d(a.clientX,a.clientY,0)}},Xj:function(a){for(var b=0,c=this.engine.Ev;b<c.length;){var d=c[b];++b;d(a.wheelDelta)}},
sK:function(){var a=this;this.Mt||(this.Mt=!0,dc.da(function(){var b=a.engine,c=F(a,a.CC);-1==b.di.indexOf(c)&&(b.di.push(c),b.Lt||(b.Lt=!0,window.requestAnimationFrame(F(b,b.Vy))))},0))},hK:function(){0==this.scene.kf.length&&(this.Mt=!1,this.engine.mD(F(this,this.CC)))},mM:function(){var a=lf.vD(this.backgroundColor>>>24&255)/lf.vD(255),b=this.backgroundColor,b=new Q((b>>16&255)/255,(b>>8&255)/255,(b&255)/255);0==a?this.scene.Cq=!1:(this.scene.Cq=!0,this.scene.clearColor=.1>a?new ca(0,0,0,a):1>
a?new ca(b.r,b.v,b.m,a):b)},PH:function(){return new q(this.lb,!1)},Au:function(){return new Ma(this.engine)},CC:function(){this.lb.clientWidth==this.engine.width&&this.lb.clientHeight==this.engine.height&&this.lb.clientWidth==this.lb.width&&this.lb.clientHeight==this.lb.height||this.engine.resize();this.scene.gb()},Xz:function(a){if(65<=a&&90>=a)return a+32;switch(a){case 16:return 1073742049;case 17:return 1073742048;case 18:return 1073742050;case 20:return 1073741881;case 33:return 1073741899;
case 34:return 1073741902;case 35:return 1073741901;case 36:return 1073741898;case 37:return 1073741904;case 38:return 1073741906;case 39:return 1073741903;case 40:return 1073741905;case 45:return 1073741897;case 46:return 127;case 112:return 1073741882;case 113:return 1073741883;case 114:return 1073741884;case 115:return 1073741885;case 116:return 1073741886;case 117:return 1073741887;case 118:return 1073741888;case 119:return 1073741889;case 120:return 1073741890;case 121:return 1073741891;case 122:return 1073741892;
case 123:return 1073741893;case 124:return 1073741928;case 125:return 1073741929;case 126:return 1073741930;case 144:return 1073741907;case 186:return 59;case 187:return 61;case 188:return 44;case 189:return 45;case 190:return 46;case 191:return 47;case 192:return 96;case 219:return 91;case 220:return 92;case 221:return 93;case 222:return 39}return a},l:Vc,F:{TC:"set_backgroundColor"}};n["cc.core.lime.graphics.image.ImageExtender"]=$f;$f.h="cc core lime graphics image ImageExtender".split(" ");$f.Hc=
function(a,b,c,d){null==d&&(d=!1);xa.Bg(a);xa.Rw(a,!0);a=a.buffer;var e=a.oc;d||(a.oc.IB=!1,a.oc.JB=!1,a.oc.jB=!1);c=null!=c?c:new rd;xa.Rw(b,!1);e.globalAlpha=1;e.setTransform(c.$,c.m,c.Hq,c.d,c.Bc|0,c.Cc|0);e.drawImage(b.Sn(),0,0);d||(a.oc.IB=!0,a.oc.JB=!0,a.oc.jB=!0);a.oc.setTransform(1,0,0,1,0,0);a.de=null;a.data=null};n["cc.core.native.js.BrowserUtils"]=Zf;Zf.h=["cc","core","native","js","BrowserUtils"];Zf.gE=function(){return(new Mb("Safari","")).match(window.navigator.userAgent)?(new Mb("Apple Computer",
"")).match(window.navigator.platform):!1};n["cc.core.native.js.DeviceUtils"]=Fd;Fd.h=["cc","core","native","js","DeviceUtils"];Fd.UD=function(){return(new Mb("iP(hone|od|ad)","")).match(window.navigator.platform)};Fd.iM=function(){if(!Fd.UD())return null;var a=new Mb("OS (\\d+)_(\\d+)_?(\\d+)?","");return a.match(window.navigator.appVersion)?[sa.$a(a.Jg(1)),sa.$a(a.Jg(2)),sa.$a(a.Jg(3))|0]:null};n["cc.core.native.js.MediaUtils"]=Lb;Lb.h=["cc","core","native","js","MediaUtils"];Lb.RM=function(a){null==
a&&(a=window.document.createElement("video"));var b=window.MediaSource||window.WebKitMediaSource;return null==b||b.isTypeSupported?null!=b?b.isTypeSupported('video/mp4; codecs="avc1.4d401e"'):!1:""!=a.canPlayType('video/mp4; codecs="avc1.4d401e"')};Lb.ZD=function(a){return Lb.RM(a)};Lb.QM=function(a){null==a&&(a=window.document.createElement("video"));return null!=a&&null!=F(a,a.canPlayType)?""!=a.canPlayType('video/mp4; codecs="avc1.4d401e, mp4a.40.2"'):!1};Lb.aE=function(a){null==a&&(a=window.document.createElement("video"));
return null!=a&&null!=F(a,a.canPlayType)?""!=a.canPlayType('video/webm; codecs="vp8.0, vorbis"'):!1};Lb.$D=function(a){null==a&&(a=window.document.createElement("video"));return null!=a&&null!=F(a,a.canPlayType)?""!=a.canPlayType('video/ogg; codecs="theora, vorbis"'):!1};n["cc.core.native.js.ScriptUtils"]=kf;kf.h=["cc","core","native","js","ScriptUtils"];kf.Ow=function(a,b,c){var d=window.document.head,e=window.document.createElement("script");e.type="text/javascript";e.src=a;e.onload=b;null!=c&&
(e.onerror=c);d.appendChild(e)};n["cc.core.validation.Validator"]=jf;jf.h=["cc","core","validation","Validator"];jf.prototype={Gh:function(a){if(this.kv)return!0;if(null==a){a=this.Jj;for(a=new ie(a,a.ku());a.Ca();)return a.next(),!0;return!1}var b=this.Jj;return null!=t[a]?b.Gd(a):b.i.hasOwnProperty(a)},ne:function(a){if(!this.ms||null!=jb.pJ(this.ms)){var b=this.Gh(),c=!1;if(this.xl)for(var d=this.En,d=new ie(d,d.ku());d.Ca();){d.next();c=!0;break}null==a||"all"==a?this.xl?(a=this.En,null!=t.all?
a.C("all",!0):a.i.all=!0):this.kv=!0:this.xl?(d=this.En,null!=t[a]?d.C(a,!0):d.i[a]=!0):("all"!=a?(d=this.Jj,d=!(null!=t[a]?d.Gd(a):d.i.hasOwnProperty(a))):d=!1,d&&(d=this.Jj,null!=t[a]?d.C(a,!0):d.i[a]=!0));this.xl?c||dc.da(F(this,this.Sl),0):b||dc.da(F(this,this.Sl),0)}},Sl:function(){if(!this.xl&&this.Gh()&&(!this.ms||Object.prototype.hasOwnProperty.call(this.ms,"stage"))){this.xl=!0;this.JH();for(var a=this.Jj.keys();a.Ca();){var b=a.next();this.Jj.remove(b)}this.kv=!1;for(a=this.En.keys();a.Ca();){b=
a.next();if("all"==b)this.kv=!0;else{var c=this.Jj;null!=t[b]?c.C(b,!0):c.i[b]=!0}this.En.remove(b)}this.xl=!1}},l:jf};n["cc.sensors.Sensors"]=Ed;Ed.h=["cc","sensors","Sensors"];Ed.Ru=function(){return ia.jp().Ru()};Ed.Tu=function(){return ia.jp().Tu()};Ed.nv=function(){return ia.jp().nv()};n["cc.sensors.impl.SensorsHTML5"]=ia;ia.h=["cc","sensors","impl","SensorsHTML5"];ia.cE=function(){var a=!1,b=navigator.userAgent||navigator.vendor||window.opera;if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(b)||
/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(b.substr(0,
4)))a=!0;return a};ia.jp=function(){null==ia.Po&&(ia.Po=new ia);return ia.Po};ia.prototype={nv:function(){return window.DeviceOrientationEvent?ia.cE():!1},Tu:function(){return window.orientation},LI:function(){ia.mC||(ia.Pj=[],this.addEventListener("deviceorientation",F(this,this.mK)),ia.mC=!0);return ia.Pj},Ru:function(){ia.QB||(ia.jg=[],ia.QB=!0);if(ia.Oo){var a=this.LI(),b=a[0],c=a[1],d=a[2],a=Math.cos(b/2),e=Math.cos(c/2),f=Math.cos(d/2),b=Math.sin(b/2),c=Math.sin(c/2),d=Math.sin(d/2);ia.jg[0]=
a*e*f-b*c*d;ia.jg[1]=b*e*f-a*c*d;ia.jg[2]=a*c*f+b*e*d;ia.jg[3]=a*e*d+b*c*f;ia.Oo=!1}return ia.jg},addEventListener:function(a,b){window.addEventListener(a,b)},mK:function(a){ia.Pj[0]=a.beta*ia.cs;ia.Pj[1]=a.gamma*ia.cs;ia.Pj[2]=a.alpha*ia.cs;ia.Oo=!0},l:ia};n["cc.sensors.models.Sensor"]=Uc;Uc.h=["cc","sensors","models","Sensor"];Uc.prototype={update:function(){this.CK.mf(this.values)},l:Uc};n["cc.sensors.models.Attitude"]=te;te.h=["cc","sensors","models","Attitude"];te.V=Uc;te.prototype=S(Uc.prototype,
{update:function(){this.values=Ed.Ru();Uc.prototype.update.call(this)},l:te});var Wc=K.CAPTURA.Viewer=function(a){Vc.call(this,a)};n["cc.viewer.CapturaViewer"]=Wc;Wc.h=["cc","viewer","CapturaViewer"];Wc.Ib=function(){console.log("CapturaViewer v"+Wc.Bb)};Wc.V=Vc;Wc.prototype=S(Vc.prototype,{Au:function(){var a=Vc.prototype.Au.call(this);a.Xr=!1;a.lC=!1;a.Iz=!1;a.uu=!1;a.nf=!1;a.ow=!1;a.lD=!1;a.xB=!1;V.pb=!1;V.$a=!1;V.Ta=!1;V.ib=!1;V.Ib=!1;V.ec=!1;V.nc=!1;V.Dc=!1;V.Uc=!1;return a},get:function(a){var b,
c;this.F?c=b=this.F["get_"+a]:c=!1;return c?this[b]():this[a]},set:function(a,b){var c,d;this.F?d=c=this.F["set_"+a]:d=!1;if(d)this[c](b);else this[a]=b;var e;this.F?c=e=this.F["get_"+a]:c=!1;return c?this[e]():this[a]},l:Wc});var Nb=K.BABYLON.ISmartArrayCompatible=function(){};n["com.babylonhx.ISmartArrayCompatible"]=Nb;Nb.h=["com","babylonhx","ISmartArrayCompatible"];Nb.prototype={l:Nb};var oa=K.BABYLON.Node=function(a,b){this.yb=[];this.sd=this.Tm=-1;this.Vp=this.Mc=!0;this.Ef=new ea;this.Ya=[];
this.zr=null;this.state="";this.id=this.name=a;this.f=b;this.bh()};n["com.babylonhx.Node"]=oa;oa.h=["com","babylonhx","Node"];oa.xb=[Nb];oa.da=function(a,b){if(null!=b.Ti)for(var c=0,d=b.Ti.length;c<d;){var e=b.Ti[c++];a.NH(e.name,e.from,e.Pl)}};oa.prototype={bk:function(a){if(this.ca==a)return a;if(null!=this.ca){var b=this.ca.bj.indexOf(this);-1!=b&&this.ca.bj.splice(b,1)}this.ca=a;null!=this.ca&&(null==this.ca.bj&&(this.ca.bj=[]),this.ca.bj.push(this));return a},va:function(){var a=new r;a.a[0]=
1;a.a[1]=0;a.a[2]=0;a.a[3]=0;a.a[4]=0;a.a[5]=1;a.a[6]=0;a.a[7]=0;a.a[8]=0;a.a[9]=0;a.a[10]=1;a.a[11]=0;a.a[12]=0;a.a[13]=0;a.a[14]=0;a.a[15]=1;return a},bh:function(){this.L=new ff;this.L.parent=null},xw:function(a){null==a&&(a=!1);if(a||!this.qB(null))this.L.parent=this.ca,this.uj()},uj:function(){},zm:function(){return!0},ov:function(){return null==this.ca?!0:this.Tm!=this.ca.sd?!1:this.ca.qB(null)},qB:function(a){null==a&&(a=!1);var b=this.gB(),b=(b=b?!0:!this.ov())?!0:!this.zm();a&&this.xw(!0);
return!b},gB:function(a){null==a&&(a=!1);if(this.L.parent==this.ca)return!1;a&&(this.L.parent=this.ca);return!0},pa:function(){return this.Mc},isEnabled:function(){return this.Vp?null!=this.ca?this.ca.isEnabled():!0:!1},Zs:function(a,b,c){null==b&&(b=!1);if(null!=this.bj)for(var d=0,e=this.bj.length;d<e;){var f=this.bj[d++];(null==c||c(f))&&a.push(f);b||f.Zs(a,!1,c)}},FI:function(a,b){null==a&&(a=!1);var c=[];this.Zs(c,a,function(a){return null==b||b(a)?z.D(a,qa):!1});return c},lq:function(a){a!=
this.Mc&&(a?(this.Mc=!0,null!=this.Kv&&this.Kv(this)):this.Mc=!1)},NH:function(a,b,c){var d=this.Ef;if(null==(null!=t[a]?d.I(a):d.i[a])){var d=new le(a,b,c),e=this.Ef;null!=t[a]?e.C(a,d):e.i[a]=d;d=0;for(e=this.Ya.length;d<e;){var f=d++;null!=this.Ya[f]&&this.Ya[f].createRange(a,b,c)}}},CL:function(){for(var a=[],b=this.Ef.keys();b.Ca();){var c=b.next(),d={};d.name=c;var e=this.Ef;d.from=(null!=t[c]?e.I(c):e.i[c]).from;e=this.Ef;d.Pl=(null!=t[c]?e.I(c):e.i[c]).Pl;a.push(d)}return a},dispose:function(){this.bk(null)},
l:oa,F:{bk:"set_parent"}};var lc=K.BABYLON.IAnimatable=function(){};n["com.babylonhx.animations.IAnimatable"]=lc;lc.h=["com","babylonhx","animations","IAnimatable"];lc.prototype={l:lc};var Ba=K.BABYLON.Camera=function(a,b,c){this.Fd="mouse";this.gj=[];this.bt=new p(0,0,0);this.Ug=new Ja(256);var d=new r;d.a[0]=1;d.a[1]=0;d.a[2]=0;d.a[3]=0;d.a[4]=0;d.a[5]=1;d.a[6]=0;d.a[7]=0;d.a[8]=0;d.a[9]=0;d.a[10]=1;d.a[11]=0;d.a[12]=0;d.a[13]=0;d.a[14]=0;d.a[15]=1;d=new r;d.a[0]=0;d.a[1]=0;d.a[2]=0;d.a[3]=0;d.a[4]=
0;d.a[5]=0;d.a[6]=0;d.a[7]=0;d.a[8]=0;d.a[9]=0;d.a[10]=0;d.a[11]=0;d.a[12]=0;d.a[13]=0;d.a[14]=0;d.a[15]=0;this.sb=d;this.bc=[];this.AF=!1;this.Va=new r;d=new r;d.a[0]=1;d.a[1]=0;d.a[2]=0;d.a[3]=0;d.a[4]=0;d.a[5]=1;d.a[6]=0;d.a[7]=0;d.a[8]=0;d.a[9]=0;d.a[10]=1;d.a[11]=0;d.a[12]=0;d.a[13]=0;d.a[14]=0;d.a[15]=1;this.$e=d;this.ma=[];this.Xc=this.Qb=0;this.tb=-1;this.nD=[];this.viewport=new bd(0,0,1,1);this.mv=!1;this.mode=0;this.tf=.9;this.Fb=1E4;this.Sb=1;this.Sa=.8;this.Lg=this.Mg=this.Kg=this.Ng=
null;this.zf=new p(0,1,0);this.position=new p(0,0,0);oa.call(this,a,c);c.dH(this);null==c.M&&(c.M=this);this.Mf=F(this,this.KI);this.by=F(this,this.at);this.Fd=ha.ns();this.position=b};n["com.babylonhx.cameras.Camera"]=Ba;Ba.h=["com","babylonhx","cameras","Camera"];Ba.xb=[lc];Ba.ab=function(a,b){var c=null,d=a.position,e=new p(d[0],d[1],d[2]),d=null!=a.sv?b.HI(a.sv):null;if("AnaglyphArcRotateCamera"==a.type||"ArcRotateCamera"==a.type){var e=a.alpha,f=a.beta,g=a.R;"AnaglyphArcRotateCamera"==a.type?
(c=a.jv,c=new Hc(a.name,e,f,g,d,c,b)):c=new tb(a.name,e,f,g,d,b)}else"AnaglyphFreeCamera"==a.type?(c=a.jv,c=new ue(a.name,e,c,b)):"DeviceOrientationCamera"!=a.type&&("FollowCamera"==a.type?(c=new Sd(a.name,e,b),c.fv=a.fv,c.R=a.R,c.aw=a.aw,null!=d&&(z.g(c,Sd).target=d)):"GamepadCamera"!=a.type&&("TouchCamera"==a.type?c=new ve(a.name,e,b):"VirtualJoysticksCamera"!=a.type&&(c="WebVRFreeCamera"==a.type?new we(a.name,e,b):"VRDeviceOrientationFreeCamera"==a.type?new xe(a.name,e,b):new ta(a.name,e,b))));
null!=a.Qb&&c.Jl(a.Qb,null!=a.jv?{Fh:a.jv}:{});null!=d&&z.D(c,ta)&&(z.g(c,ta).hd=d);c.id=a.id;Ca.Md(c,a.Nl);null!=a.Dl&&(c.zz=a.Dl);a.target?Object.prototype.hasOwnProperty.call(c,"setTarget")?(d=a.target,c.Kl(new p(d[0],d[1],d[2]))):(d=a.target,c.target=new p(d[0],d[1],d[2])):(d=a.rotation,c.rotation=new p(d[0],d[1],d[2]));c.Sa=a.Sa;c.Sb=a.Sb;c.Fb=a.Fb;c.speed=a.speed;c.tf=a.tf;c.vh=a.vh;c.ju=a.ju;null!=a.xi&&(d=a.xi,c.xi=new p(d[0],d[1],d[2]));if(null!=a.Ya){d=0;for(e=a.Ya.length;d<e;)f=d++,c.Ya.push(fc.ab(a.Ya[f]));
oa.da(c,a)}1==a.lu&&b.Eq(c,a.Mz,a.Oz,a.Nz,1);c.tb=null==a.tb||isNaN(a.tb)?268435455:Math.abs(sa.$a(a.tb));return c};Ba.V=oa;Ba.prototype=S(oa.prototype,{Ch:function(){return this.bt},mO:function(){return this.Ug},MO:function(a){var b=this.Ug;a=b.data.indexOf(a);return-1!=(a>=b.length?-1:a)},bh:function(){oa.prototype.bh.call(this);this.L.position=new p(Infinity,Infinity,Infinity);this.L.zf=new p(Infinity,Infinity,Infinity);this.L.mode=null;this.L.Sb=null;this.L.Fb=null;this.L.Sa=null;this.L.Xc=null;
this.L.xj=null;this.L.Lg=null;this.L.Mg=null;this.L.Kg=null;this.L.Ng=null;this.L.FC=null;this.L.BC=null},uj:function(a){null==a&&(a=!1);a||oa.prototype.uj.call(this);a=this.f.c;var b=this.L.position,c=this.position;b.x=c.x;b.y=c.y;b.z=c.z;b=this.L.zf;c=this.zf;b.x=c.x;b.y=c.y;b.z=c.z;this.L.mode=this.mode;this.L.Sb=this.Sb;this.L.Fb=this.Fb;this.L.Sa=this.Sa;this.L.Xc=this.Xc;this.L.xj=a.kl(this);this.L.Lg=this.Lg;this.L.Mg=this.Mg;this.L.Kg=this.Kg;this.L.Ng=this.Ng;this.L.FC=a.Vb();this.L.BC=a.Lb()},
sz:function(){this.xw();this.dd()},zm:function(){return this.ij()?this.sy():!1},ij:function(){if(!oa.prototype.zm.call(this))return!1;var a;a=this.L.position;var b=this.position;null!=b&&a.x==b.x&&a.y==b.y&&a.z==b.z?(a=this.L.zf,b=this.zf,a=null!=b&&a.x==b.x&&a.y==b.y?a.z==b.z:!1):a=!1;return a?this.ov():!1},sy:function(){var a=this.L.mode==this.mode&&this.L.Sb==this.Sb&&this.L.Fb==this.Fb;if(!a)return!1;a=this.f.c;return a=0==this.mode?this.L.Sa==this.Sa&&this.L.Xc==this.Xc?this.L.xj==a.kl(this):
!1:this.L.Lg==this.Lg&&this.L.Mg==this.Mg&&this.L.Kg==this.Kg&&this.L.Ng==this.Ng&&this.L.FC==a.Vb()?this.L.BC==a.Lb():!1},attachControl:function(){},le:function(){},dd:function(){0!=this.Qb&&this.vj();this.fe()},fe:function(){},Cp:function(){0<this.bc.length&&this.bc[0].yv();for(var a=0,b=this.ma.length;a<b;){var c=this.ma[a++],d=c.Ff;null!=d&&(z.D(d,Nc)&&(c.mv=0==this.bc.length),c.bc=this.bc.slice(0).concat([d]),d.yv())}},Lz:function(a,b){if(!a.jq&&-1<this.bc.indexOf(a))return console.log("You're trying to reuse a post process not defined as reusable."),
0;null==b||0>b?this.bc.push(a):this.bc.splice(b,0,a);this.Cp();return this.bc.indexOf(a)},$H:function(a,b){var c=[];if(null==b){var d=this.bc.indexOf(a);-1!=d&&this.bc.splice(d,1)}else for(b instanceof Array&&null==b.jb||(b=[b]),d=b.length-1;0<=d;)this.bc[b[d]]!=a?c.push(d):(this.bc.splice(d,1),--d);this.Cp();return c},va:function(){if(null==this.Ea){var a=new r;a.a[0]=1;a.a[1]=0;a.a[2]=0;a.a[3]=0;a.a[4]=0;a.a[5]=1;a.a[6]=0;a.a[7]=0;a.a[8]=0;a.a[9]=0;a.a[10]=1;a.a[11]=0;a.a[12]=0;a.a[13]=0;a.a[14]=
0;a.a[15]=1;this.Ea=a}var b=this.pf(),a=this.Ea,c=b.a[0],d=b.a[1],e=b.a[2],f=b.a[3],g=b.a[4],h=b.a[5],k=b.a[6],l=b.a[7],m=b.a[8],u=b.a[9],x=b.a[10],v=b.a[11],G=b.a[12],p=b.a[13],w=b.a[14],Ya=b.a[15],b=x*Ya-v*w,ua=u*Ya-v*p,gc=u*w-x*p,y=m*Ya-v*G,q=m*w-x*G,n=m*p-u*G,t=h*b-k*ua+l*gc,M=-(g*b-k*y+l*q),R=g*ua-h*y+l*n,I=-(g*gc-h*q+k*n),C=1/(c*t+d*M+e*R+f*I),ba=k*Ya-l*w,N=h*Ya-l*p,L=h*w-k*p,Ya=g*Ya-l*G,w=g*w-k*G,G=g*p-h*G,p=k*v-l*x,Na=h*v-l*u,z=h*x-k*u,l=g*v-l*m,k=g*x-k*m,g=g*u-h*m;a.a[0]=t*C;a.a[4]=M*C;a.a[8]=
R*C;a.a[12]=I*C;a.a[1]=-(d*b-e*ua+f*gc)*C;a.a[5]=(c*b-e*y+f*q)*C;a.a[9]=-(c*ua-d*y+f*n)*C;a.a[13]=(c*gc-d*q+e*n)*C;a.a[2]=(d*ba-e*N+f*L)*C;a.a[6]=-(c*ba-e*Ya+f*w)*C;a.a[10]=(c*N-d*Ya+f*G)*C;a.a[14]=-(c*L-d*w+e*G)*C;a.a[3]=-(d*p-e*Na+f*z)*C;a.a[7]=(c*p-e*l+f*k)*C;a.a[11]=-(c*Na-d*l+f*g)*C;a.a[15]=(c*z-d*k+e*g)*C;return this.Ea},at:function(){var a=new r;a.a[0]=1;a.a[1]=0;a.a[2]=0;a.a[3]=0;a.a[4]=0;a.a[5]=1;a.a[6]=0;a.a[7]=0;a.a[8]=0;a.a[9]=0;a.a[10]=1;a.a[11]=0;a.a[12]=0;a.a[13]=0;a.a[14]=0;a.a[15]=
1;return a},pf:function(a){null==a&&(a=!1);this.$e=this.nF(a);if(!a&&this.ij())return this.$e;if(null==this.ca||null==this.ca.va()){a=this.bt;var b=this.position;a.x=b.x;a.y=b.y;a.z=b.z}else{null==this.Ea&&(a=new r,a.a[0]=1,a.a[1]=0,a.a[2]=0,a.a[3]=0,a.a[4]=0,a.a[5]=1,a.a[6]=0,a.a[7]=0,a.a[8]=0,a.a[9]=0,a.a[10]=1,a.a[11]=0,a.a[12]=0,a.a[13]=0,a.a[14]=0,a.a[15]=1,this.Ea=a);var c=this.$e;a=this.Ea;var b=c.a[0],d=c.a[1],e=c.a[2],f=c.a[3],g=c.a[4],h=c.a[5],k=c.a[6],l=c.a[7],m=c.a[8],u=c.a[9],x=c.a[10],
v=c.a[11],G=c.a[12],p=c.a[13],w=c.a[14],Ya=c.a[15],c=x*Ya-v*w,ua=u*Ya-v*p,q=u*w-x*p,y=m*Ya-v*G,n=m*w-x*G,B=m*p-u*G,t=h*c-k*ua+l*q,M=-(g*c-k*y+l*n),R=g*ua-h*y+l*B,I=-(g*q-h*n+k*B),C=1/(b*t+d*M+e*R+f*I),ba=k*Ya-l*w,N=h*Ya-l*p,L=h*w-k*p,Ya=g*Ya-l*G,w=g*w-k*G,G=g*p-h*G,p=k*v-l*x,Na=h*v-l*u,z=h*x-k*u,l=g*v-l*m,k=g*x-k*m,g=g*u-h*m;a.a[0]=t*C;a.a[4]=M*C;a.a[8]=R*C;a.a[12]=I*C;a.a[1]=-(d*c-e*ua+f*q)*C;a.a[5]=(b*c-e*y+f*n)*C;a.a[9]=-(b*ua-d*y+f*B)*C;a.a[13]=(b*q-d*n+e*B)*C;a.a[2]=(d*ba-e*N+f*L)*C;a.a[6]=-(b*
ba-e*Ya+f*w)*C;a.a[10]=(b*N-d*Ya+f*G)*C;a.a[14]=-(b*L-d*w+e*G)*C;a.a[3]=-(d*p-e*Na+f*z)*C;a.a[7]=(b*p-e*l+f*k)*C;a.a[11]=-(b*Na-d*l+f*g)*C;a.a[15]=(b*z-d*k+e*g)*C;this.Ea.qa(this.ca.va(),this.$e.a,0);a=this.bt;b=this.$e.a[13];d=this.$e.a[14];a.x=this.$e.a[12];a.y=b;a.z=d;a=this.$e;b=a.a[0];d=a.a[1];e=a.a[2];f=a.a[3];C=a.a[4];ba=a.a[5];x=a.a[6];v=a.a[7];N=a.a[8];L=a.a[9];Ya=a.a[10];w=a.a[11];G=a.a[12];p=a.a[13];l=a.a[14];k=a.a[15];g=Ya*k-w*l;h=L*k-w*p;m=L*l-Ya*p;u=N*k-w*G;c=N*l-Ya*G;ua=N*p-L*G;q=ba*
g-x*h+v*m;y=-(C*g-x*u+v*c);n=C*h-ba*u+v*ua;B=-(C*m-ba*c+x*ua);t=1/(b*q+d*y+e*n+f*B);M=x*k-v*l;R=ba*k-v*p;I=ba*l-x*p;k=C*k-v*G;l=C*l-x*G;G=C*p-ba*G;p=x*w-v*Ya;Na=ba*w-v*L;z=ba*Ya-x*L;v=C*w-v*N;x=C*Ya-x*N;C=C*L-ba*N;a.a[0]=q*t;a.a[4]=y*t;a.a[8]=n*t;a.a[12]=B*t;a.a[1]=-(d*g-e*h+f*m)*t;a.a[5]=(b*g-e*u+f*c)*t;a.a[9]=-(b*h-d*u+f*ua)*t;a.a[13]=(b*m-d*c+e*ua)*t;a.a[2]=(d*M-e*R+f*I)*t;a.a[6]=-(b*M-e*k+f*l)*t;a.a[10]=(b*R-d*k+f*G)*t;a.a[14]=-(b*I-d*l+e*G)*t;a.a[3]=-(d*p-e*Na+f*z)*t;a.a[7]=(b*p-e*v+f*x)*t;a.a[11]=
-(b*Na-d*v+f*C)*t;a.a[15]=(b*z-d*x+e*C)*t;this.Tm=this.ca.sd}this.sd=this.f.Pa;return this.$e},nF:function(a){null==a&&(a=!1);if(!a&&this.ij())return this.$e;this.$e=this.by();this.sd=this.f.Pa;return this.$e},KI:function(a){null==a&&(a=!1);if(this.AF||!a&&this.sy())return this.Va;var b=this.f.c;a=this.f;if(0==this.mode)return 0>=this.Sb&&(this.Sb=.1),a.Hw?r.sB(this.Sa,b.kl(this),this.Sb,this.Fb,this.Va,0==this.Xc):r.lg(this.Sa,b.kl(this),this.Sb,this.Fb,this.Va,0==this.Xc),this.Va;var c=b.Vb()/2,
b=b.Lb()/2;a.Hw?r.AA(null!=this.Lg?this.Lg:-c,null!=this.Mg?this.Mg:c,null!=this.Kg?this.Kg:-b,null!=this.Ng?this.Ng:b,this.Sb,this.Fb,this.Va):r.Kj(null!=this.Lg?this.Lg:-c,null!=this.Mg?this.Mg:c,null!=this.Kg?this.Kg:-b,null!=this.Ng?this.Ng:b,this.Sb,this.Fb,this.Va);return this.Va},dispose:function(){this.f.Ml(this);for(this.f.hL(this);0<this.ma.length;)this.ma.pop().dispose();for(var a=this.bc.length;0<=--a;)this.bc[a].dispose(this);oa.prototype.dispose.call(this)},Jl:function(a,b){for(;0<this.ma.length;)this.ma.pop().dispose();
null==b&&(b={});this.Qb=a;this.Ia={};this.Ia.Fh=null!=b.Fh?b.Fh:.0637;this.Ia.Rg=this.Ia.Fh/.0637*Math.PI/180;0!=this.Qb&&(this.ma.push(this.wh(this.name+"_L",0)),this.ma.push(this.wh(this.name+"_R",1)));switch(this.Qb){case 10:this.ma[0].Ff=new Nc(this.name+"_passthru",1,this.ma[0]);this.ma[1].Ff=new Gd(this.name+"_anaglyph",1,this.ma);break;case 11:case 12:case 13:var c=11==this.Qb||12==this.Qb;this.ma[0].Ff=new Nc(this.name+"_passthru",1,this.ma[0]);this.ma[1].Ff=new je(this.name+"_stereoInterlace",
this.ma,c);break;case 20:c=null!=b.Kw?b.Kw:Xc.js(),this.ma[0].Ia.Lw=c,this.ma[0].viewport=new bd(0,0,.5,1),this.ma[0].Ia.Mo=new r,this.ma[0].Ia.RD=c.RA(),this.ma[0].Ia.SD=c.SA(),this.ma[0].Mf=(hc=this.ma[0],F(hc,hc.ay)),this.ma[1].Ia.Lw=c,this.ma[1].viewport=new bd(.5,0,.5,1),this.ma[1].Ia.Mo=new r,this.ma[1].Ia.RD=c.ZA(),this.ma[1].Ia.SD=c.$A(),this.ma[1].Mf=(hc=this.ma[1],F(hc,hc.ay)),c.vu&&(this.ma[0].Ff=new Od("VR_Distort_Compensation_Left",this.ma[0],!1,c),this.ma[1].Ff=new Od("VR_Distort_Compensation_Right",
this.ma[1],!0,c))}this.Cp();this.dd()},ay:function(){r.lg(this.Ia.Lw.mH(),this.Ia.Lw.xj(),this.Sb,this.Fb,this.Ia.Mo);z.g(this.Ia.Mo,r).qa(this.Ia.RD,this.Va.a,0);return this.Va},zP:function(a,b){null==this.Ia&&(this.Ia={});var c=this.Ia,d,e;c.F?e=d=c.F["set_"+a]:e=!1;if(e)c[d](b);else c[a]=b;"interaxialDistance"==a&&(this.Ia.Rg=b/.0637*Math.PI/180)},wh:function(){return null},vj:function(){for(var a=0,b=this.ma.length;a<b;){var c=a++;this.ma[c].Sb=this.Sb;this.ma[c].Fb=this.Fb;this.ma[c].Sa=this.Sa}10==
this.Qb&&(this.ma[0].viewport=this.ma[1].viewport=this.viewport)},nO:function(a){var b=new p(0,0,0);this.GI(a,b);return b},GI:function(a,b){var c=this.va();b.x=a.x*c.a[0]+a.y*c.a[4]+a.z*c.a[8];b.y=a.x*c.a[1]+a.y*c.a[5]+a.z*c.a[9];b.z=a.x*c.a[2]+a.y*c.a[6]+a.z*c.a[10]},T:function(){var a={};a.name=this.name;a.Nl=Ca.wE(this);a.id=this.id;var b=this.position,c=[];c[0]=b.x;c[1]=b.y;c[2]=b.z;a.position=c;null!=this.ca&&(a.Dl=this.ca.id);a.Sa=this.Sa;a.Sb=this.Sb;a.Fb=this.Fb;a.tf=this.tf;fc.Ba(this,a);
a.Ti=this.CL();a.tb=this.tb;return a},l:Ba,F:S(oa.prototype.F,{Ch:"get_globalPosition"})});var p=K.BABYLON.Vector3=function(a,b,c){null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.x=a;this.y=b;this.z=c};n["com.babylonhx.math.Vector3"]=p;p.h=["com","babylonhx","math","Vector3"];p.lg=function(a,b,c,d){a=a.x*c.x+a.y*c.y+a.z*c.z-d;return a/(a-(b.x*c.x+b.y*c.y+b.z*c.z-d))};p.Zb=function(a,b){null==b&&(b=0);return new p(a[b],a[b+1],a[b+2])};p.ce=function(a,b){null==b&&(b=0);return new p(a[b],a[b+1],a[b+
2])};p.ap=function(a,b,c){c.x=a[b];c.y=a[b+1];c.z=a[b+2]};p.Te=function(a,b,c){c.x=a[b];c.y=a[b+1];c.z=a[b+2]};p.Ue=function(a,b,c,d){d.x=a;d.y=b;d.z=c};p.jp=function(){return new p(0,0,0)};p.yh=function(){return new p(1,1,1)};p.Up=function(){return new p(0,1,0)};p.Down=function(){return new p(0,-1,0)};p.be=function(){return new p(0,0,1)};p.Back=function(){return new p(0,0,-1)};p.Right=function(){return new p(1,0,0)};p.Left=function(){return new p(-1,0,0)};p.cs=function(a,b){var c=new p(0,0,0),d=
a.x,e=a.y,f=a.z,g=b.a,h=d*g[1]+e*g[5]+f*g[9]+g[13],k=d*g[2]+e*g[6]+f*g[10]+g[14],l=d*g[3]+e*g[7]+f*g[11]+g[15];c.x=(d*g[0]+e*g[4]+f*g[8]+g[12])/l;c.y=h/l;c.z=k/l;return c};p.ns=function(a,b,c){var d=a.x,e=a.y;a=a.z;b=b.a;var f=d*b[1]+e*b[5]+a*b[9]+b[13],g=d*b[2]+e*b[6]+a*b[10]+b[14],h=d*b[3]+e*b[7]+a*b[11]+b[15];c.x=(d*b[0]+e*b[4]+a*b[8]+b[12])/h;c.y=f/h;c.z=g/h};p.js=function(a,b,c,d,e){var f=a*d.a[1]+b*d.a[5]+c*d.a[9]+d.a[13],g=a*d.a[2]+b*d.a[6]+c*d.a[10]+d.a[14],h=a*d.a[3]+b*d.a[7]+c*d.a[11]+d.a[15];
e.x=(a*d.a[0]+b*d.a[4]+c*d.a[8]+d.a[12])/h;e.y=f/h;e.z=g/h};p.os=function(a,b){var c=new p(0,0,0);c.x=a.x*b.a[0]+a.y*b.a[4]+a.z*b.a[8];c.y=a.x*b.a[1]+a.y*b.a[5]+a.z*b.a[9];c.z=a.x*b.a[2]+a.y*b.a[6]+a.z*b.a[10];return c};p.qs=function(a,b,c){c.x=a.x*b.a[0]+a.y*b.a[4]+a.z*b.a[8];c.y=a.x*b.a[1]+a.y*b.a[5]+a.z*b.a[9];c.z=a.x*b.a[2]+a.y*b.a[6]+a.z*b.a[10]};p.ps=function(a,b,c,d,e){e.x=a*d.a[0]+b*d.a[4]+c*d.a[8];e.y=a*d.a[1]+b*d.a[5]+c*d.a[9];e.z=a*d.a[2]+b*d.a[6]+c*d.a[10]};p.Vo=function(a,b,c,d,e){var f=
e*e,g=e*f;return new p(.5*(2*b.x+(-a.x+c.x)*e+(2*a.x-5*b.x+4*c.x-d.x)*f+(-a.x+3*b.x-3*c.x+d.x)*g),.5*(2*b.y+(-a.y+c.y)*e+(2*a.y-5*b.y+4*c.y-d.y)*f+(-a.y+3*b.y-3*c.y+d.y)*g),.5*(2*b.z+(-a.z+c.z)*e+(2*a.z-5*b.z+4*c.z-d.z)*f+(-a.z+3*b.z-3*c.z+d.z)*g))};p.Xo=function(a,b,c){var d=a.x;d>c.x&&(d=c.x);d<b.x&&(d=b.x);var e=a.y;e>c.y&&(e=c.y);e<b.y&&(e=b.y);a=a.z;a>c.z&&(a=c.z);a<b.z&&(a=b.z);return new p(d,e,a)};p.ep=function(a,b,c,d,e){var f=e*e,g=e*f,h=2*g-3*f+1,k=-2*g+3*f;e=g-2*f+e;f=g-f;return new p(a.x*
h+c.x*k+b.x*e+d.x*f,a.y*h+c.y*k+b.y*e+d.y*f,a.z*h+c.z*k+b.z*e+d.z*f)};p.D=function(a,b,c){var d=new p(0,0,0);d.x=a.x+(b.x-a.x)*c;d.y=a.y+(b.y-a.y)*c;d.z=a.z+(b.z-a.z)*c;return d};p.fp=function(a,b,c,d){d.x=a.x+(b.x-a.x)*c;d.y=a.y+(b.y-a.y)*c;d.z=a.z+(b.z-a.z)*c};p.$o=function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z};p.Zc=function(a,b){var c=new p(0,0,0);c.x=a.y*b.z-a.z*b.y;c.y=a.z*b.x-a.x*b.z;c.z=a.x*b.y-a.y*b.x;return c};p.Md=function(a,b,c){c.x=a.y*b.z-a.z*b.y;c.y=a.z*b.x-a.x*b.z;c.z=a.x*b.y-a.y*b.x};
p.ip=function(a){var b=new p(0,0,0);b.x=a.x;b.y=a.y;b.z=a.z;b.normalize();return b};p.uh=function(a,b){b.x=a.x;b.y=a.y;b.z=a.z;b.normalize()};p.Fi=function(a,b,c,d){var e=d.width,f=d.height,g=fa.Ra[0];r.da(e/2,0,0,0,-f/2,0,0,0,1,d.x+e/2,f/2+d.y,0,g);d=fa.Ra[1];b.qa(c,d.a,0);d.qa(g,d.a,0);b=new p(0,0,0);c=a.x;g=a.y;a=a.z;d=d.a;var e=c*d[1]+g*d[5]+a*d[9]+d[13],f=c*d[2]+g*d[6]+a*d[10]+d[14],h=c*d[3]+g*d[7]+a*d[11]+d[15];b.x=(c*d[0]+g*d[4]+a*d[8]+d[12])/h;b.y=e/h;b.z=f/h;return b};p.Po=function(a,b,c,
d,e){var f=fa.Ra[1];d.qa(e,f.a,0);d=f.a[0];e=f.a[1];var g=f.a[2],h=f.a[3],k=f.a[4],l=f.a[5],m=f.a[6],u=f.a[7],x=f.a[8],v=f.a[9],G=f.a[10],D=f.a[11],w=f.a[12],Ya=f.a[13],ua=f.a[14],r=f.a[15],y=G*r-D*ua,q=v*r-D*Ya,n=v*ua-G*Ya,t=x*r-D*w,M=x*ua-G*w,R=x*Ya-v*w,I=l*y-m*q+u*n,C=-(k*y-m*t+u*M),ba=k*q-l*t+u*R,N=-(k*n-l*M+m*R),L=1/(d*I+e*C+g*ba+h*N),Na=m*r-u*ua,z=l*r-u*Ya,T=l*ua-m*Ya,r=k*r-u*w,ua=k*ua-m*w,w=k*Ya-l*w,Ya=m*D-u*G,A=l*D-u*v,F=l*G-m*v,u=k*D-u*x,m=k*G-m*x,k=k*v-l*x;f.a[0]=I*L;f.a[4]=C*L;f.a[8]=ba*
L;f.a[12]=N*L;f.a[1]=-(e*y-g*q+h*n)*L;f.a[5]=(d*y-g*t+h*M)*L;f.a[9]=-(d*q-e*t+h*R)*L;f.a[13]=(d*n-e*M+g*R)*L;f.a[2]=(e*Na-g*z+h*T)*L;f.a[6]=-(d*Na-g*r+h*ua)*L;f.a[10]=(d*z-e*r+h*w)*L;f.a[14]=-(d*T-e*ua+g*w)*L;f.a[3]=-(e*Ya-g*A+h*F)*L;f.a[7]=(d*Ya-g*u+h*m)*L;f.a[11]=-(d*A-e*u+h*k)*L;f.a[15]=(d*F-e*m+g*k)*L;a.x=a.x/b*2-1;a.y=-(a.y/c*2-1);b=new p(0,0,0);c=a.x;d=a.y;e=a.z;g=f.a;h=c*g[1]+d*g[5]+e*g[9]+g[13];y=c*g[2]+d*g[6]+e*g[10]+g[14];q=c*g[3]+d*g[7]+e*g[11]+g[15];b.x=(c*g[0]+d*g[4]+e*g[8]+g[12])/q;
b.y=h/q;b.z=y/q;c=b;a=a.x*f.a[3]+a.y*f.a[7]+a.z*f.a[11]+f.a[15];f=a-1;-1.401298E-45<=f&&1.401298E-45>=f&&(a=1/a,c=new p(b.x*a,b.y*a,b.z*a));return c};p.$a=function(a,b,c,d,e,f){var g=fa.Ra[1];d.qa(e,g.a,0);g.qa(f,g.a,0);d=g.a[0];e=g.a[1];f=g.a[2];var h=g.a[3],k=g.a[4],l=g.a[5],m=g.a[6],u=g.a[7],x=g.a[8],v=g.a[9],G=g.a[10],D=g.a[11],w=g.a[12],r=g.a[13],ua=g.a[14],q=g.a[15],y=G*q-D*ua,n=v*q-D*r,t=v*ua-G*r,E=x*q-D*w,M=x*ua-G*w,R=x*r-v*w,I=l*y-m*n+u*t,C=-(k*y-m*E+u*M),ba=k*n-l*E+u*R,N=-(k*t-l*M+m*R),
L=1/(d*I+e*C+f*ba+h*N),Na=m*q-u*ua,z=l*q-u*r,T=l*ua-m*r,q=k*q-u*w,ua=k*ua-m*w,w=k*r-l*w,r=m*D-u*G,A=l*D-u*v,F=l*G-m*v,u=k*D-u*x,m=k*G-m*x,k=k*v-l*x;g.a[0]=I*L;g.a[4]=C*L;g.a[8]=ba*L;g.a[12]=N*L;g.a[1]=-(e*y-f*n+h*t)*L;g.a[5]=(d*y-f*E+h*M)*L;g.a[9]=-(d*n-e*E+h*R)*L;g.a[13]=(d*t-e*M+f*R)*L;g.a[2]=(e*Na-f*z+h*T)*L;g.a[6]=-(d*Na-f*q+h*ua)*L;g.a[10]=(d*z-e*q+h*w)*L;g.a[14]=-(d*T-e*ua+f*w)*L;g.a[3]=-(e*r-f*A+h*F)*L;g.a[7]=(d*r-f*u+h*m)*L;g.a[11]=-(d*A-e*u+h*k)*L;g.a[15]=(d*F-e*m+f*k)*L;b=a.x/b*2-1;c=-(a.y/
c*2-1);d=a.z;a=new p(0,0,0);e=g.a;f=b*e[1]+c*e[5]+d*e[9]+e[13];h=b*e[2]+c*e[6]+d*e[10]+e[14];y=b*e[3]+c*e[7]+d*e[11]+e[15];a.x=(b*e[0]+c*e[4]+d*e[8]+e[12])/y;a.y=f/y;a.z=h/y;e=a;g=b*g.a[3]+c*g.a[7]+d*g.a[11]+g.a[15];c=g-1;-1.401298E-45<=c&&1.401298E-45>=c&&(g=1/g,e=new p(a.x*g,a.y*g,a.z*g));return e};p.hp=function(a,b){var c=new p(a.x,a.y,a.z);b.x<c.x&&(c.x=b.x);b.y<c.y&&(c.y=b.y);b.z<c.z&&(c.z=b.z);return c};p.gp=function(a,b){var c=new p(a.x,a.y,a.z);b.x>c.x&&(c.x=b.x);b.y>c.y&&(c.y=b.y);b.z>c.z&&
(c.z=b.z);return c};p.Yo=function(a,b){var c=a.x-b.x,d=a.y-b.y,e=a.z-b.z;return Math.sqrt(c*c+d*d+e*e)};p.Zo=function(a,b){var c=a.x-b.x,d=a.y-b.y,e=a.z-b.z;return c*c+d*d+e*e};p.Wo=function(a,b){var c=new p(a.x+b.x,a.y+b.y,a.z+b.z);c.x*=.5;c.y*=.5;c.z*=.5;return c};p.po=function(a,b,c){b=new p(0,0,0);p.Bb(a,c,b);return b};p.Bb=function(a,b,c){var d=fa.nc[0],e=fa.nc[1];d.x=a.x;d.y=a.y;d.z=a.z;d.normalize();e.x=b.x;e.y=b.y;e.z=b.z;e.normalize();p.g[0]=0;p.g[1]=0;p.g[2]=0;var f=-1;a=0;p.g[3]=0;b=fa.nc[3];
var g=e.z;-.001<=g&&.001>=g?p.g[1]=1:(g=e.x,-.001<=g&&.001>=g?p.g[0]=1:(p.g[2]=e.z/e.x,p.g[0]=-p.g[2]*Math.sqrt(1/(1+p.g[2]*p.g[2])),p.g[1]=Math.sqrt(1/(1+p.g[2]*p.g[2]))));g=p.g[1];b.x=p.g[0];b.y=0;b.z=g;b.normalize();g=new p(0,0,0);g.x=e.y*b.z-e.z*b.y;g.y=e.z*b.x-e.x*b.z;g.z=e.x*b.y-e.y*b.x;g.normalize();var h=new p(0,0,0);h.x=d.y*b.z-d.z*b.y;h.y=d.z*b.x-d.x*b.z;h.z=d.x*b.y-d.y*b.x;h.normalize();0>e.x*h.x+e.y*h.y+e.z*h.z&&(f=1);p.g[4]=d.x*b.x+d.y*b.y+d.z*b.z;p.g[4]=Math.min(1,Math.max(-1,p.g[4]));
c.z=Math.acos(p.g[4])*f;f=Db.X;0>b.x*f.x+b.y*f.y+b.z*f.z&&(c.z=Math.PI+c.z,b.x*=-1,b.y*=-1,b.z*=-1,g.x*=-1,g.y*=-1,g.z*=-1,a=1);d=fa.nc[5];p.g[0]=0;p.g[1]=0;f=-1;g=e.z;-.001<=g&&.001>=g?p.g[0]=1:(p.g[2]=b.z/b.x,p.g[0]=-p.g[2]*Math.sqrt(1/(1+p.g[2]*p.g[2])),p.g[1]=Math.sqrt(1/(1+p.g[2]*p.g[2])));g=p.g[1];d.x=p.g[0];d.y=0;d.z=g;d.normalize();g=new p(0,0,0);g.x=d.y*b.z-d.z*b.y;g.y=d.z*b.x-d.x*b.z;g.z=d.x*b.y-d.y*b.x;g.normalize();h=new p(0,0,0);h.x=e.y*d.z-e.z*d.y;h.y=e.z*d.x-e.x*d.z;h.z=e.x*d.y-e.y*
d.x;h.normalize();0>b.x*h.x+b.y*h.y+b.z*h.z&&(f=1);p.g[4]=e.x*d.x+e.y*d.y+e.z*d.z;p.g[4]=Math.min(1,Math.max(-1,p.g[4]));c.x=Math.acos(p.g[4])*f;f=Db.Y;0>g.x*f.x+g.y*f.y+g.z*f.z&&(c.x=Math.PI+c.x,g.x*=-1,g.y*=-1,g.z*=-1,d.x*=-1,d.y*=-1,d.z*=-1,++a);f=-1;d=Db.X;e=new p(0,0,0);e.x=d.y*b.z-d.z*b.y;e.y=d.z*b.x-d.x*b.z;e.z=d.x*b.y-d.y*b.x;e.normalize();d=Db.Y;0>e.x*d.x+e.y*d.y+e.z*d.z&&(f=1);e=Db.X;p.g[4]=b.x*e.x+b.y*e.y+b.z*e.z;p.g[4]=Math.min(1,Math.max(-1,p.g[4]));c.y=-Math.acos(p.g[4])*f;0>p.g[4]&&
2>a&&(c.y=Math.PI+c.y)};p.prototype={normalize:function(){var a=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);if(0==a||1==a)return this;a=1/a;this.x*=a;this.y*=a;this.z*=a;return this},l:p};var la=K.BABYLON.TargetCamera=function(a,b,c){var d=new r;d.a[0]=0;d.a[1]=0;d.a[2]=0;d.a[3]=0;d.a[4]=0;d.a[5]=0;d.a[6]=0;d.a[7]=0;d.a[8]=0;d.a[9]=0;d.a[10]=0;d.a[11]=0;d.a[12]=0;d.a[13]=0;d.a[14]=0;d.a[15]=0;d=new r;d.a[0]=0;d.a[1]=0;d.a[2]=0;d.a[3]=0;d.a[4]=0;d.a[5]=0;d.a[6]=0;d.a[7]=0;d.a[8]=0;d.a[9]=
0;d.a[10]=0;d.a[11]=0;d.a[12]=0;d.a[13]=0;d.a[14]=0;d.a[15]=0;this.tq=new p(0,0,0);this.Ox=new p(0,1,0);this.Ry=new p(0,0,1);d=new r;d.a[0]=0;d.a[1]=0;d.a[2]=0;d.a[3]=0;d.a[4]=0;d.a[5]=0;d.a[6]=0;d.a[7]=0;d.a[8]=0;d.a[9]=0;d.a[10]=0;d.a[11]=0;d.a[12]=0;d.a[13]=0;d.a[14]=0;d.a[15]=0;this.ei=d;d=new r;d.a[0]=0;d.a[1]=0;d.a[2]=0;d.a[3]=0;d.a[4]=0;d.a[5]=0;d.a[6]=0;d.a[7]=0;d.a[8]=0;d.a[9]=0;d.a[10]=0;d.a[11]=0;d.a[12]=0;d.a[13]=0;d.a[14]=0;d.a[15]=0;this.Ap=d;d=new r;d.a[0]=0;d.a[1]=0;d.a[2]=0;d.a[3]=
0;d.a[4]=0;d.a[5]=0;d.a[6]=0;d.a[7]=0;d.a[8]=0;d.a[9]=0;d.a[10]=0;d.a[11]=0;d.a[12]=0;d.a[13]=0;d.a[14]=0;d.a[15]=0;this.zp=d;d=new r;d.a[0]=0;d.a[1]=0;d.a[2]=0;d.a[3]=0;d.a[4]=0;d.a[5]=0;d.a[6]=0;d.a[7]=0;d.a[8]=0;d.a[9]=0;d.a[10]=0;d.a[11]=0;d.a[12]=0;d.a[13]=0;d.a[14]=0;d.a[15]=0;this.za=d;this.we=new p(0,0,0);this.hd=null;this.ZJ=!1;this.speed=2;this.rotation=new p(0,0,0);this.Ub=new W(0,0);this.Fc=new p(0,0,0);Ba.call(this,a,b,c)};n["com.babylonhx.cameras.TargetCamera"]=la;la.h=["com","babylonhx",
"cameras","TargetCamera"];la.V=Ba;la.prototype=S(Ba.prototype,{oO:function(a){var b=this.we,c=this.position,b=new p(b.x-c.x,b.y-c.y,b.z-c.z);b.normalize();b.x*=a;b.y*=a;b.z*=a;a=this.Ch();return new p(a.x+b.x,a.y+b.y,a.z+b.z)},$s:function(){return null==this.hd?null:null!=this.hd.aH?this.hd.aH:this.hd},bh:function(){Ba.prototype.bh.call(this);this.L.hd=new p(Infinity,Infinity,Infinity);this.L.rotation=new p(Infinity,Infinity,Infinity);this.L.ub=new X(Infinity,Infinity,Infinity)},uj:function(a){null==
a&&(a=!1);a||Ba.prototype.uj.call(this);a=this.$s();if(null==a)this.L.hd=null;else if(null==this.L.hd)this.L.hd=new p(a.x,a.y,a.z);else{var b=this.L.hd;b.x=a.x;b.y=a.y;b.z=a.z}a=this.L.rotation;b=this.rotation;a.x=b.x;a.y=b.y;a.z=b.z;null!=this.ub&&(a=this.L.ub,b=this.ub,a.x=b.x,a.y=b.y,a.z=b.z,a.o=b.o)},ij:function(){if(!Ba.prototype.ij.call(this))return!1;var a=this.$s();if(null!=this.L.hd)var b=this.L.hd,a=null!=a&&b.x==a.x&&b.y==a.y?b.z==a.z:!1;else a=null==a;if(a){if(null!=this.ub)return a=this.ub,
b=this.L.ub,null!=b&&a.x==b.x&&a.y==b.y&&a.z==b.z?a.o==b.o:!1;a=this.L.rotation;b=this.rotation;return null!=b&&a.x==b.x&&a.y==b.y?a.z==b.z:!1}return!1},yN:function(){var a=this.f.c;return this.speed*Math.sqrt(a.dl/(100*a.Xq))},Kl:function(a){this.zf.normalize();r.Uc(this.position,a,this.Ox,this.zp);var b=this.zp,c=b.a[0],d=b.a[1],e=b.a[2],f=b.a[3],g=b.a[4],h=b.a[5],k=b.a[6],l=b.a[7],m=b.a[8],u=b.a[9],x=b.a[10],v=b.a[11],G=b.a[12],D=b.a[13],w=b.a[14],q=b.a[15],ua=x*q-v*w,n=u*q-v*D,y=u*w-x*D,t=m*q-
v*G,B=m*w-x*G,E=m*D-u*G,M=h*ua-k*n+l*y,R=-(g*ua-k*t+l*B),I=g*n-h*t+l*E,C=-(g*y-h*B+k*E),ba=1/(c*M+d*R+e*I+f*C),N=k*q-l*w,L=h*q-l*D,Na=h*w-k*D,q=g*q-l*G,w=g*w-k*G,G=g*D-h*G,D=k*v-l*x,z=h*v-l*u,T=h*x-k*u,l=g*v-l*m,k=g*x-k*m,g=g*u-h*m;b.a[0]=M*ba;b.a[4]=R*ba;b.a[8]=I*ba;b.a[12]=C*ba;b.a[1]=-(d*ua-e*n+f*y)*ba;b.a[5]=(c*ua-e*t+f*B)*ba;b.a[9]=-(c*n-d*t+f*E)*ba;b.a[13]=(c*y-d*B+e*E)*ba;b.a[2]=(d*N-e*L+f*Na)*ba;b.a[6]=-(c*N-e*q+f*w)*ba;b.a[10]=(c*L-d*q+f*G)*ba;b.a[14]=-(c*Na-d*w+e*G)*ba;b.a[3]=-(d*D-e*z+
f*T)*ba;b.a[7]=(c*D-e*l+f*k)*ba;b.a[11]=-(c*z-d*l+f*g)*ba;b.a[15]=(c*T-d*k+e*g)*ba;this.rotation.x=Math.atan(this.zp.a[6]/this.zp.a[10]);b=this.position;la.da=new p(a.x-b.x,a.y-b.y,a.z-b.z);this.rotation.y=0<=la.da.x?-Math.atan(la.da.z/la.da.x)+Math.PI/2:-Math.atan(la.da.z/la.da.x)-Math.PI/2;this.rotation.z=0;null!=this.ub&&(a=this.ub,d=.5*this.rotation.z,f=.5*this.rotation.x,c=.5*this.rotation.y,b=Math.sin(d),d=Math.cos(d),e=Math.sin(f),f=Math.cos(f),ua=Math.sin(c),c=Math.cos(c),a.x=c*e*d+ua*f*b,
a.y=ua*f*d-c*e*b,a.z=c*f*b-ua*e*d,a.o=c*f*d+ua*e*b)},sO:function(){return this.we},Ls:function(){return 0<Math.abs(this.Fc.x)||0<Math.abs(this.Fc.y)?!0:0<Math.abs(this.Fc.z)},uz:function(){var a=this.position,b=this.Fc;a.x+=b.x;a.y+=b.y;a.z+=b.z},fe:function(){var a=this.Ls(),b=0<Math.abs(this.Ub.x)||0<Math.abs(this.Ub.y);a&&this.uz();if(b&&(this.rotation.x+=this.Ub.x,this.rotation.y+=this.Ub.y,!this.ZJ)){var c=Math.PI/2*.95;this.rotation.x>c&&(this.rotation.x=c);this.rotation.x<-c&&(this.rotation.x=
-c)}a&&(.001>Math.abs(this.Fc.x)&&(this.Fc.x=0),.001>Math.abs(this.Fc.y)&&(this.Fc.y=0),.001>Math.abs(this.Fc.z)&&(this.Fc.z=0),a=this.Fc,c=this.tf,a.x*=c,a.y*=c,a.z*=c);b&&(.001>Math.abs(this.Ub.x)&&(this.Ub.x=0),.001>Math.abs(this.Ub.y)&&(this.Ub.y=0),b=this.Ub,a=this.tf,b.x*=a,b.y*=a);Ba.prototype.fe.call(this)},qz:function(){if(null!=this.ub){this.ub.yf(this.ei);var a=this.Ox,b=this.ei,c=this.zf;c.x=a.x*b.a[0]+a.y*b.a[4]+a.z*b.a[8];c.y=a.x*b.a[1]+a.y*b.a[5]+a.z*b.a[9];c.z=a.x*b.a[2]+a.y*b.a[6]+
a.z*b.a[10]}else{var a=r.Ma,d=.5*this.rotation.z,e=.5*this.rotation.x,c=.5*this.rotation.y,b=Math.sin(d),d=Math.cos(d),f=Math.sin(e),e=Math.cos(e),g=Math.sin(c),c=Math.cos(c);a.x=c*f*d+g*e*b;a.y=g*e*d-c*f*b;a.z=c*e*b-g*f*d;a.o=c*e*d+g*f*b;r.Ma.yf(this.ei)}},at:function(){if(null==this.hd){this.qz();var a=this.Ry,b=this.tq,c=a.x,d=a.y,a=a.z,e=this.ei.a,f=c*e[1]+d*e[5]+a*e[9]+e[13],g=c*e[2]+d*e[6]+a*e[10]+e[14],h=c*e[3]+d*e[7]+a*e[11]+e[15];b.x=(c*e[0]+d*e[4]+a*e[8]+e[12])/h;b.y=f/h;b.z=g/h;b=this.position;
c=this.tq;d=this.we;d.x=b.x+c.x;d.y=b.y+c.y;d.z=b.z+c.z}else b=this.we,c=this.$s(),b.x=c.x,b.y=c.y,b.z=c.z;r.Uc(this.position,this.we,this.zf,this.za);return this.za},OF:function(){this.qz();var a=this.Ry,b=this.tq,c=a.x,d=a.y,a=a.z,e=this.ei.a,f=c*e[1]+d*e[5]+a*e[9]+e[13],g=c*e[2]+d*e[6]+a*e[10]+e[14],h=c*e[3]+d*e[7]+a*e[11]+e[15];b.x=(c*e[0]+d*e[4]+a*e[8]+e[12])/h;b.y=f/h;b.z=g/h;b=this.zf;c=this.ei;d=this.Ia.QD;d.x=b.x*c.a[0]+b.y*c.a[4]+b.z*c.a[8];d.y=b.x*c.a[1]+b.y*c.a[5]+b.z*c.a[9];d.z=b.x*c.a[2]+
b.y*c.a[6]+b.z*c.a[10];b=this.position;c=this.tq;d=this.we;d.x=b.x+c.x;d.y=b.y+c.y;d.z=b.z+c.z;r.Uc(this.position,this.we,this.Ia.QD,this.Ia.Mo);z.g(this.Ia.Mo,r).qa(this.Ia.SD,this.za.a,0);return this.za},wh:function(a){if(0!=this.Qb){var b=this.position;a=new la(a,new p(b.x,b.y,b.z),this.f);20==this.Qb&&(null==this.ub&&(this.ub=new X),a.Ia={},a.Ia.QD=new p(0,0,0),a.by=F(a,a.OF),a.ub=new X);return a}return null},vj:function(){var a=this.ma[0],b=this.ma[1];switch(this.Qb){case 10:case 11:case 12:case 13:var c=
12==this.Qb?-1:1;this.Zx(this.Ia.Rg*(12==this.Qb?1:-1),a.position);this.Zx(this.Ia.Rg*c,b.position);a.Kl(this.we);b.Kl(this.we);break;case 20:var c=a.ub,d=this.ub;c.x=d.x;c.y=d.y;c.z=d.z;c.o=d.o;c=b.ub;d=this.ub;c.x=d.x;c.y=d.y;c.z=d.z;c.o=d.o;a=a.position;c=this.position;a.x=c.x;a.y=c.y;a.z=c.z;b=b.position;a=this.position;b.x=a.x;b.y=a.y;b.z=a.z}Ba.prototype.vj.call(this)},Zx:function(a,b){null==this.Ym&&(this.Ym=new r);var c=this.we,d=-c.x,e=-c.y,f=-c.z,g=new r;g.a[0]=1;g.a[1]=0;g.a[2]=0;g.a[3]=
0;g.a[4]=0;g.a[5]=1;g.a[6]=0;g.a[7]=0;g.a[8]=0;g.a[9]=0;g.a[10]=1;g.a[11]=0;g.a[12]=0;g.a[13]=0;g.a[14]=0;g.a[15]=1;r.da(1,0,0,0,1,0,0,0,1,d,e,f,g);d=new r;e=Math.sin(a);f=Math.cos(a);d.a[5]=1;d.a[15]=1;d.a[0]=f;d.a[2]=-e;d.a[8]=e;d.a[10]=f;d.a[1]=0;d.a[3]=0;d.a[4]=0;d.a[6]=0;d.a[7]=0;d.a[9]=0;d.a[11]=0;d.a[12]=0;d.a[13]=0;d.a[14]=0;g.qa(d,this.Ym.a,0);g=this.Ym;d=c.x;e=c.y;f=c.z;c=new r;c.a[0]=1;c.a[1]=0;c.a[2]=0;c.a[3]=0;c.a[4]=0;c.a[5]=1;c.a[6]=0;c.a[7]=0;c.a[8]=0;c.a[9]=0;c.a[10]=1;c.a[11]=0;
c.a[12]=0;c.a[13]=0;c.a[14]=0;c.a[15]=1;r.da(1,0,0,0,1,0,0,0,1,d,e,f,c);d=new r;g.qa(c,d.a,0);this.Ym=d;var d=this.position,c=d.x,g=d.y,d=d.z,e=this.Ym.a,f=c*e[1]+g*e[5]+d*e[9]+e[13],h=c*e[2]+g*e[6]+d*e[10]+e[14],k=c*e[3]+g*e[7]+d*e[11]+e[15];b.x=(c*e[0]+g*e[4]+d*e[8]+e[12])/k;b.y=f/k;b.z=h/k},T:function(){var a=Ba.prototype.T.call(this);a.speed=this.speed;if(null!=this.rotation){var b=this.rotation,c=[];c[0]=b.x;c[1]=b.y;c[2]=b.z;a.rotation=c}null!=this.hd&&null!=this.hd.id&&(a.sv=this.hd.id);return a},
l:la});n["cc.viewer.panorama.cameras.PanoramaCamera"]=Qa;Qa.h=["cc","viewer","panorama","cameras","PanoramaCamera"];Qa.V=la;Qa.prototype=S(la.prototype,{set_yaw:function(a){this.rotation.y!=a&&(this.rotation.y=a);return this.rotation.y},get_yaw:function(){return this.rotation.y},set_pitch:function(a){this.rotation.x!=a&&(this.rotation.x=a);return this.rotation.x},get_pitch:function(){return this.rotation.x},set_hfov:function(a){return this.pc=0==this.Xc?2*Math.atan(this.Ua*Math.tan(.5*a)/this.Ka):
a},get_hfov:function(){return 0==this.Xc?2*Math.atan(this.Ka*Math.tan(.5*this.Sa)/this.Ua):this.Sa},LL:function(a){return this.pc=0==this.Xc?a:2*Math.atan(this.Ka*Math.tan(.5*a)/this.Ua)},fB:function(){return 0==this.Xc?this.Sa:2*Math.atan(this.Ua*Math.tan(.5*this.Sa)/this.Ka)},set_panoramaHFOV:function(a){this.Qm!=a&&(this.Qm=a,this.hh=!0);return a},VA:function(){return this.Qm},set_panoramaVFOV:function(a){this.Sm!=a&&(this.Sm=a,this.hh=!0);return a},XA:function(){return this.Sm},set_panoramaPitch:function(a){this.Rm!=
a&&(this.Rm=a,this.hh=!0);return a},WA:function(){return this.Rm},set_maxHFOV:function(a){this.Dm!=a&&(this.Dm=a,this.hh=!0);return a},TA:function(){return this.Dm},set_minHFOV:function(a){this.Gm!=a&&(this.Gm=a,this.hh=!0);return a},UA:function(){return this.Gm},dispose:function(a){null==a&&(a=!1);this.le();la.prototype.dispose.call(this,a)},Ls:function(){return!1},Jl:function(a,b){if(11==a||12==a||13==a){for(;0<this.ma.length;)this.ma.pop().dispose();null==b&&(b={});this.Qb=a;this.Ia={};this.Ia.Fh=
null!=b.Fh?b.Fh:.0637;this.Ia.Rg=this.Ia.Fh/.0637*Math.PI/180;this.ma.push(this.wh(this.name+"_L",0));this.ma.push(this.wh(this.name+"_R",1));var c=11==this.Qb||12==this.Qb;this.ma[0].Ff=new Nc(this.name+"_passthru",1,this.ma[0]);this.ma[1].Ff=new ne(this.name+"_stereo",this.ma,c);this.Cp();this.dd()}else la.prototype.Jl.call(this,a,b)},dd:function(){this.hh&&(this.jk(),this.hh=!1);if(this.Ka!=this.f.c.Vb()||this.Ua!=this.f.c.Lb()){var a=this.f.c.Vb(),b=this.f.c.Lb();if(0!=this.Ka&&0!=this.Ua)switch(this.xI){case "dfov":var c,
d;0==this.Xc?(c=this.Ua,d=b):(c=this.Ka,d=a);this.pc=2*Math.atan(d*Math.tan(1*Math.atan(Math.sqrt(this.Ka*this.Ka+this.Ua*this.Ua)*Math.tan(.5*this.Sa)/c))/Math.sqrt(a*a+b*b));break;case "hfov":0==this.Xc&&(this.pc=2*Math.atan(b*Math.tan(.5*this.get_hfov())/a));break;case "mfov":this.pc=2*Math.atan((1.3333333333333333<this.Ka/this.Ua?this.Ka:4*this.Ua/3)*Math.tan(.5*this.Sa)/(1.3333333333333333<a/b?a:4*b/3));break;case "vfov":1==this.Xc&&(this.pc=2*Math.atan(a*Math.tan(.5*this.fB())/b))}else null!=
a&&null!=b&&(this.pc=0==this.Xc?2*Math.atan(b*Math.tan(.5*this.ct)/a):this.ct);null!=a&&null!=b&&(this.Ka=a,this.Ua=b,this.ks(),this.Sa=this.pc)}this.pc!=this.Sa&&(this.Sa+=(this.pc-this.Sa)*this.Or,Math.abs(this.pc-this.Sa)<q.pb&&(this.Sa=this.pc));la.prototype.dd.call(this)},reset:function(){this.Fc=new p(0,0,0);this.Ub=new W(0,0)},jk:function(){},ks:function(){},MD:function(){},l:Qa,F:S(la.prototype.F,{set_minHFOV:"set_minHFOV",UA:"get_minHFOV",set_maxHFOV:"set_maxHFOV",TA:"get_maxHFOV",set_panoramaPitch:"set_panoramaPitch",
WA:"get_panoramaPitch",set_panoramaVFOV:"set_panoramaVFOV",XA:"get_panoramaVFOV",set_panoramaHFOV:"set_panoramaHFOV",VA:"get_panoramaHFOV",LL:"set_vfov",fB:"get_vfov",set_hfov:"set_hfov",get_hfov:"get_hfov",set_pitch:"set_pitch",get_pitch:"get_pitch",set_yaw:"set_yaw",get_yaw:"get_yaw"})});var X=K.BABYLON.Quaternion=function(a,b,c,d){null==d&&(d=1);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.x=a;this.y=b;this.z=c;this.o=d};n["com.babylonhx.math.Quaternion"]=X;X.h=["com","babylonhx","math","Quaternion"];
X.Te=function(a){var b=new X;X.ec(a,b);return b};X.ec=function(a,b){var c=a.a,d=c[0],e=c[4],f=c[8],g=c[1],h=c[5],k=c[9],l=c[2],m=c[6],c=c[10],u=d+h+c;0<u?(d=.5/Math.sqrt(u+1),b.o=.25/d,b.x=(m-k)*d,b.y=(f-l)*d,b.z=(g-e)*d):d>h&&d>c?(d=2*Math.sqrt(1+d-h-c),b.o=(m-k)/d,b.x=.25*d,b.y=(e+g)/d,b.z=(f+l)/d):h>c?(d=2*Math.sqrt(1+h-d-c),b.o=(f-l)/d,b.x=(e+g)/d,b.y=.25*d,b.z=(k+m)/d):(d=2*Math.sqrt(1+c-d-h),b.o=(g-e)/d,b.x=(f+l)/d,b.y=(k+m)/d,b.z=.25*d)};X.lg=function(a){return new X(-a.x,-a.y,-a.z,a.o)};X.yh=
function(){return new X(0,0,0,1)};X.zi=function(a,b){var c=new X,d=Math.sin(b/2);a.normalize();c.o=Math.cos(b/2);c.x=a.x*d;c.y=a.y*d;c.z=a.z*d;return c};X.Di=function(a,b,c){var d=Math.sin(b/2);a.normalize();c.o=Math.cos(b/2);c.x=a.x*d;c.y=a.y*d;c.z=a.z*d;return c};X.ae=function(a,b){null==b&&(b=0);return new X(a[b],a[b+1],a[b+2],a[b+3])};X.Fi=function(a,b,c){var d=new X;c*=.5;var e=.5*b;b=.5*a;a=Math.sin(c);c=Math.cos(c);var f=Math.sin(e),e=Math.cos(e),g=Math.sin(b);b=Math.cos(b);d.x=b*f*c+g*e*a;
d.y=g*e*c-b*f*a;d.z=b*e*a-g*f*c;d.o=b*e*c+g*f*a;return d};X.Mi=function(a,b,c,d){c*=.5;var e=.5*b;b=.5*a;a=Math.sin(c);c=Math.cos(c);var f=Math.sin(e),e=Math.cos(e),g=Math.sin(b);b=Math.cos(b);d.x=b*f*c+g*e*a;d.y=g*e*c-b*f*a;d.z=b*e*a-g*f*c;d.o=b*e*c+g*f*a};X.Ib=function(a,b,c){var d=new X(0,0,0,1);X.Nd(a,b,c,d);return d};X.Nd=function(a,b,c,d){var e=0,f;f=a.x*b.x+a.y*b.y+a.z*b.z+a.o*b.o;var g=!1;0>f&&(g=!0,f=-f);if(.999999<f)f=1-c,g?e=-c:e=c;else{var e=Math.acos(f),h=1/Math.sin(e);f=Math.sin((1-
c)*e)*h;e=g?-Math.sin(c*e)*h:Math.sin(c*e)*h}d.x=f*a.x+e*b.x;d.y=f*a.y+e*b.y;d.z=f*a.z+e*b.z;d.o=f*a.o+e*b.o};X.prototype={fM:function(a){var b=this.z,c=this.x,d=this.y,e=this.o,f=e*e,g=b*b,h=c*c,k=d*d,l=d*b-c*e;-.4999999>l?(a.y=2*Math.atan2(d,e),a.x=Math.PI/2,a.z=0):.4999999<l?(a.y=2*Math.atan2(d,e),a.x=-Math.PI/2,a.z=0):(a.z=Math.atan2(2*(c*d+b*e),-g-h+k+f),a.x=Math.asin(-2*(b*d-c*e)),a.y=Math.atan2(2*(b*c+d*e),g-h-k+f));return this},yf:function(a){var b=this.x*this.x,c=this.y*this.y,d=this.z*this.z,
e=this.x*this.y,f=this.z*this.o,g=this.z*this.x,h=this.y*this.o,k=this.y*this.z,l=this.x*this.o;a.a[0]=1-2*(c+d);a.a[1]=2*(e+f);a.a[2]=2*(g-h);a.a[3]=0;a.a[4]=2*(e-f);a.a[5]=1-2*(d+b);a.a[6]=2*(k+l);a.a[7]=0;a.a[8]=2*(g+h);a.a[9]=2*(k-l);a.a[10]=1-2*(c+b);a.a[11]=0;a.a[12]=0;a.a[13]=0;a.a[14]=0;a.a[15]=1},l:X};n["cc.viewer.panorama.cameras.DeviceOrientationPanoramaCamera"]=ya;ya.h=["cc","viewer","panorama","cameras","DeviceOrientationPanoramaCamera"];ya.isSupported=function(){return Ed.nv()};ya.V=
Qa;ya.prototype=S(Qa.prototype,{attachControl:function(){null==this.Vg&&(this.Vg=new te,this.f.Vv(F(this,this.Er)))},le:function(){null!=this.Vg&&(this.Vg=null,this.f.AD(F(this,this.Er)))},fe:function(){if(null!=this.Vg){var a=Ed.Tu()|0;if(this.Qt!=a){this.Qt=a;var a=this.ez,b=.5*this.Qt*Math.PI/180,c=Math.sin(b),b=Math.cos(b);a.x=0;a.y=0;a.z=c;a.o=b}var a=ya.Ma,c=this.Vg.values[2],b=-this.Vg.values[3],d=this.Vg.values[0];a.x=this.Vg.values[1];a.y=c;a.z=b;a.o=d;var a=ya.Ma,c=this.$G,b=ya.nc,d=-a.x*
c.z+a.y*c.o+a.z*c.x+a.o*c.y,e=a.x*c.y-a.y*c.x+a.z*c.o+a.o*c.z,f=-a.x*c.x-a.y*c.y-a.z*c.z+a.o*c.o;b.x=a.x*c.o+a.y*c.z-a.z*c.y+a.o*c.x;b.y=d;b.z=e;b.o=f;a=this.ez;c=ya.nc;b=this.ub;d=-a.x*c.z+a.y*c.o+a.z*c.x+a.o*c.y;e=a.x*c.y-a.y*c.x+a.z*c.o+a.o*c.z;f=-a.x*c.x-a.y*c.y-a.z*c.z+a.o*c.o;b.x=a.x*c.o+a.y*c.z-a.z*c.y+a.o*c.x;b.y=d;b.z=e;b.o=f;this.ub.o*=-1}},qO:function(a,b){var c=.5*a*Math.PI/180,d=Math.sin(c),c=Math.cos(c);b.x=0;b.y=0;b.z=d;b.o=c},tO:function(){var a=new X,b=ya.Ma,c=.25*Math.PI,d=Math.sin(0),
e=Math.cos(0),f=Math.sin(0),g=Math.cos(0),h=Math.sin(c),c=Math.cos(c);b.x=c*f*e+h*g*d;b.y=h*g*e-c*f*d;b.z=c*g*d-h*f*e;b.o=c*g*e+h*f*d;f=.25*-Math.PI;b=Math.sin(0);d=Math.cos(0);e=Math.sin(f);f=Math.cos(f);g=Math.sin(0);h=Math.cos(0);a.x=h*e*d+g*f*b;a.y=g*f*d-h*e*b;a.z=h*f*b-g*e*d;a.o=h*f*d+g*e*b;b=ya.Ma;d=new X(0,0,0,1);e=-a.x*b.z+a.y*b.o+a.z*b.x+a.o*b.y;f=a.x*b.y-a.y*b.x+a.z*b.o+a.o*b.z;g=-a.x*b.x-a.y*b.y-a.z*b.z+a.o*b.o;d.x=a.x*b.o+a.y*b.z-a.z*b.y+a.o*b.x;d.y=e;d.z=f;d.o=g;return d},dd:function(){this.hh&&
(this.jk(),this.hh=!1);Qa.prototype.dd.call(this)},Er:function(){this.Vg.update()},wh:function(a){if(0!=this.Qb){var b=new re;b.panoramaHFOV=this.Qm;b.panoramaVFOV=this.Sm;b.panoramaPitch=this.Rm;b.maxHFOV=this.Dm;b.minHFOV=this.Gm;b.initialHFOV=this.pc;var c=this.position;return new ya(a,new p(c.x,c.y,c.z),this.f,b)}return null},l:ya});n["cc.viewer.panorama.cameras.DragPanoramaCamera"]=yb;yb.h=["cc","viewer","panorama","cameras","DragPanoramaCamera"];yb.V=Qa;yb.prototype=S(Qa.prototype,{set_yaw:function(a){this.get_yaw()!=
a&&(Qa.prototype.set_yaw.call(this,a),this.Mk=!0);return this.get_yaw()},set_pitch:function(a){this.get_pitch()!=a&&(Qa.prototype.set_pitch.call(this,a),this.Mk=!0);return this.get_pitch()},set_hfov:function(a){this.get_hfov()!=a&&(Qa.prototype.set_hfov.call(this,a),this.Mk=!0);return a},attachControl:function(){this.f.c.$n.push(F(this,this.lo));this.f.c.ao.push(F(this,this.mo));this.f.c.ek.push(F(this,this.Uj));this.f.c.gk.push(F(this,this.Wj));this.f.c.fk.push(F(this,this.Vj));this.f.c.fo.push(F(this,
this.Uj));this.f.c.io.push(F(this,this.Wj));this.f.c.ho.push(F(this,this.Vj));this.f.c.Ev.push(F(this,this.Xj))},le:function(){Z.remove(this.f.c.$n,F(this,this.lo));Z.remove(this.f.c.ao,F(this,this.mo));Z.remove(this.f.c.ek,F(this,this.Uj));Z.remove(this.f.c.gk,F(this,this.Wj));Z.remove(this.f.c.fk,F(this,this.Vj));Z.remove(this.f.c.fo,F(this,this.Uj));Z.remove(this.f.c.io,F(this,this.Wj));Z.remove(this.f.c.ho,F(this,this.Vj));Z.remove(this.f.c.Ev,F(this,this.Xj))},reset:function(){Qa.prototype.reset.call(this);
this.fq=this.Ip=!1;this.bf.x=this.bf.y=0},fe:function(){this.Ip?this.yw():this.fq&&(this.Cb.x=this.Ec.x*this.speed*this.Sa,this.Cb.y=this.Ec.y*this.speed*this.Sa,0!=this.Kk&&(this.pc+=this.Kk,this.ks()));if(0!=this.Cb.x||0!=this.Cb.y)this.Ub.y+=this.Cb.x*this.Or,this.Ub.x+=this.Cb.y*this.Or,this.Mk=!0;var a=0<Math.abs(this.Ub.x)||0<Math.abs(this.Ub.y);Qa.prototype.fe.call(this);if(a||this.Mk)this.MD(),this.Mk=!1},wh:function(a,b){var c=Qa.prototype.wh.call(this,a,b);20==this.Qb&&(this.ub=null,c.ub=
null);return c},vj:function(){var a=this.ma[1];if(20==this.Qb){var b=this.ma[0].position,c=this.position;b.x=c.x;b.y=c.y;b.z=c.z;a=a.position;b=this.position;a.x=b.x;a.y=b.y;a.z=b.z}else Qa.prototype.vj.call(this)},yw:function(){},jk:function(){this.pi=new qc(this.VA(),this.XA(),this.WA(),this.TA(),this.UA())},ks:function(){this.pi.PC(this.pc,this.Ka,this.Ua,this.Xc);this.pc=0==this.Xc?this.pi.kk:this.pi.hfov},MD:function(){this.pi.setPosition(this.rotation.y,this.rotation.x);this.rotation.y=this.pi.yaw;
this.rotation.x=this.pi.pitch},Uj:function(a,b){this.Ip=!0;this.bf.x=this.Ec.x=a/this.Ka;this.bf.y=this.Ec.y=b/this.Ua},Wj:function(){this.Ip=!1;this.Ec.x=this.Ec.y=0;this.Cb.x=this.Cb.y=0},Vj:function(a,b){this.Ip&&(this.bf.x=a/this.Ka,this.bf.y=b/this.Ua)},Xj:function(a){this.pc-=Math.min(Math.max(-6,a),6)*(this.pi.maxHFOV-this.pi.minHFOV)*.02;this.ks();this.Mk=!0},lo:function(a){switch(a){case 100:case 1073741903:this.Ec.x=.1;break;case 115:case 1073741905:this.Ec.y=.1;break;case 119:case 1073741906:this.Ec.y=
-.1;break;case 120:this.Kk=-.1;break;case 122:this.Kk=.1;break;case 97:case 1073741904:this.Ec.x=-.1;break;default:return}this.fq=!0},mo:function(a){switch(a){case 97:case 100:case 1073741903:case 1073741904:this.Ec.x=0;break;case 115:case 119:case 1073741905:case 1073741906:this.Ec.y=0;break;case 120:case 122:this.Kk=0}this.fq=0!=this.Ec.x||0!=this.Ec.y||0!=this.Kk;this.fq||(this.Cb.x=this.Cb.y=0)},l:yb});n["cc.viewer.panorama.cameras.DragAccelPanoramaCamera"]=se;se.h=["cc","viewer","panorama","cameras",
"DragAccelPanoramaCamera"];se.V=yb;se.prototype=S(yb.prototype,{yw:function(){this.Cb.x=(this.bf.x-this.Ec.x)*this.speed*this.Sa;this.Cb.y=(this.bf.y-this.Ec.y)*this.speed*this.Sa},l:se});n["cc.viewer.panorama.cameras.DragRotationPanoramaCamera"]=Cd;Cd.h=["cc","viewer","panorama","cameras","DragRotationPanoramaCamera"];Cd.V=yb;Cd.prototype=S(yb.prototype,{yw:function(){this.Cb.x=(this.Ec.x-this.bf.x)*this.Sa;this.Cb.y=(this.Ec.y-this.bf.y)*this.Sa;this.Ec.x=this.bf.x;this.Ec.y=this.bf.y},l:Cd});n["cc.viewer.panorama.cameras.PanoramaCameraOptions"]=
re;re.h=["cc","viewer","panorama","cameras","PanoramaCameraOptions"];re.prototype={l:re};n["cc.viewer.panorama.math.Point"]=xb;xb.h=["cc","viewer","panorama","math","Point"];xb.prototype={l:xb};n["cc.viewer.panorama.math.Transformation"]=Ib;Ib.h=["cc","viewer","panorama","math","Transformation"];Ib.prototype={Un:function(){this.m11=1;this.m21=this.m13=this.m12=0;this.m22=1;this.m32=this.m31=this.m23=0;this.m33=1;this.tz=this.Cc=this.Bc=0},wu:function(a){this.m11=a.m11;this.m12=a.m12;this.m13=a.m13;
this.m21=a.m21;this.m22=a.m22;this.m23=a.m23;this.m31=a.m31;this.m32=a.m32;this.m33=a.m33;this.Bc=a.Bc;this.Cc=a.Cc;this.tz=a.tz},concat:function(a){var b=Ib.yE;b.wu(this);this.m11=b.m11*a.m11+b.m12*a.m21+b.m13*a.m31;this.m12=b.m11*a.m12+b.m12*a.m22+b.m13*a.m32;this.m13=b.m11*a.m13+b.m12*a.m23+b.m13*a.m33;this.m21=b.m21*a.m11+b.m22*a.m21+b.m23*a.m31;this.m22=b.m21*a.m12+b.m22*a.m22+b.m23*a.m32;this.m23=b.m21*a.m13+b.m22*a.m23+b.m23*a.m33;this.m31=b.m31*a.m11+b.m32*a.m21+b.m33*a.m31;this.m32=b.m31*
a.m12+b.m32*a.m22+b.m33*a.m32;this.m33=b.m31*a.m13+b.m32*a.m23+b.m33*a.m33;this.Bc=b.Bc*a.m11+b.Cc*a.m21+b.tz*a.m31+a.Bc;this.Cc=b.Bc*a.m12+b.Cc*a.m22+b.tz*a.m32+a.Cc;this.tz=b.Bc*a.m13+b.Cc*a.m23+b.tz*a.m33+a.tz},$v:function(a){var b=Ib.Vz;b.Un();var c=Math.sin(a);a=Math.cos(a);b.m22=a;b.m23=c;b.m32=-c;b.m33=a;this.concat(b)},KC:function(a){var b=Ib.Vz;b.Un();var c=Math.sin(a);a=Math.cos(a);b.m11=a;b.m13=-c;b.m31=c;b.m33=a;this.concat(b)},l:Ib};n["cc.viewer.panorama.cameras.PanoramaPositionManager"]=
qc;qc.h=["cc","viewer","panorama","cameras","PanoramaPositionManager"];qc.prototype={PC:function(a,b,c,d){null==d&&(d=0);this.Ka=b;this.Ua=c;0==d?(this.kk=a,this.hfov=2*Math.atan(b*Math.tan(.5*a)/c)):(this.hfov=a,this.kk=2*Math.atan(c*Math.tan(.5*a)/b));this.hfov>this.maxHFOV?(this.hfov=this.maxHFOV,this.kk=2*Math.atan(c*Math.tan(.5*this.hfov)/b)):this.hfov<this.minHFOV&&(this.hfov=this.minHFOV,this.kk=2*Math.atan(c*Math.tan(.5*this.hfov)/b));this.kk>this.panoramaVFOV&&(this.kk=this.panoramaVFOV,
this.hfov=2*Math.atan(b*Math.tan(.5*this.kk)/c),this.pitch=this.panoramaPitch);this.xe.x=Math.sin(.5*this.hfov)/Math.cos(.5*this.hfov);this.xe.y=this.xe.x*c/b},setPosition:function(a,b){for(var c=0;a>Math.PI;)a-=2*Math.PI;for(;a<-Math.PI;)a+=2*Math.PI;b>.5*Math.PI?(b=.5*Math.PI,c=4):b<.5*-Math.PI&&(b=.5*-Math.PI,c=8);var d=qc.ib,e=qc.da;e.Un();e.$v(-b);d.x=0;d.y=this.xe.y;d.z=1;var f=d.x*e.m12+d.y*e.m22+d.z*e.m32+e.Cc,g=d.x*e.m13+d.y*e.m23+d.z*e.m33+e.tz;d.x=d.x*e.m11+d.y*e.m21+d.z*e.m31+e.Bc;d.y=
f;d.z=g;f=(0==d.y&&0==d.z?0:Math.atan2(d.y,d.z))-this.yr;d.x=0;d.y=-this.xe.y;d.z=1;var g=d.x*e.m12+d.y*e.m22+d.z*e.m32+e.Cc,h=d.x*e.m13+d.y*e.m23+d.z*e.m33+e.tz;d.x=d.x*e.m11+d.y*e.m21+d.z*e.m31+e.Bc;d.y=g;d.z=h;e=this.Ar-(0==d.y&&0==d.z?0:Math.atan2(d.y,d.z));this.kC||(this.yr==.5*Math.PI&&(f=b-.5*Math.PI),this.Ar==.5*-Math.PI&&(e=-(b+.5*Math.PI)));0<f?(b-=f,c|=4):0<e&&(b+=e,c|=8);this.kC&&(e=qc.da,e.Un(),e.$v(-b),e.KC(-a),0<b?(d.x=this.xe.x,d.y=this.xe.y):(d.x=this.xe.x,d.y=-this.xe.y),d.z=1,f=
d.x*e.m12+d.y*e.m22+d.z*e.m32+e.Cc,g=d.x*e.m13+d.y*e.m23+d.z*e.m33+e.tz,d.x=d.x*e.m11+d.y*e.m21+d.z*e.m31+e.Bc,d.y=f,d.z=g,g=0==d.x&&0==d.z?0:-Math.atan2(d.x,d.z),g>a&&(g-=2*Math.PI),f=this.Dv-g,0<b?(d.x=-this.xe.x,d.y=this.xe.y):(d.x=-this.xe.x,d.y=-this.xe.y),d.z=1,g=d.x*e.m12+d.y*e.m22+d.z*e.m32+e.Cc,h=d.x*e.m13+d.y*e.m23+d.z*e.m33+e.tz,d.x=d.x*e.m11+d.y*e.m21+d.z*e.m31+e.Bc,d.y=g,d.z=h,g=0==d.x&&0==d.z?0:-Math.atan2(d.x,d.z),g<a&&(g+=2*Math.PI),d=g-this.Bv,0<d&&0<f?(a=0,this.PC(this.hfov-(d+f),
this.Ka,this.Ua,1),c|=3):0<d?(a-=d,c|=2):0<f&&(a+=f,c|=1));this.yaw=a;this.pitch=b;return c},l:qc};var Oc=K.CAPTURA.Extension.Video.VideoStream=function(a){this.Gf=-1;this.state="undefined";this.onStateChange=new Dd;this.onTimeUpdate=new ye;this.wm=Fd.UD();this.iw(window.document.createElement("video"));this.set_autoSwitchQuality(!0);this.set_autoplay(!0);this.set_muted(!1);this.set_loop(!1);this.set_volume(1);this.wg=[];this.representations=[];this.set_source(a)};n["extension.video.backend.html5.VideoStream"]=
Oc;Oc.h=["extension","video","backend","html5","VideoStream"];Oc.prototype={set_autoplay:function(a){return this.autoplay=this.video.autoplay=a},get_autoplay:function(){return this.set_autoplay(this.video.autoplay)},set_autoSwitchQuality:function(a){this.autoSwitchQuality!=a&&(this.autoSwitchQuality=a,null!=this.bd?this.bd.setAutoSwitchQuality(a):null!=this.td&&(this.td.loadLevel=-1));return this.autoSwitchQuality},set_currentTime:function(a){this.video.currentTime!=a&&this.seek(a);return this.video.currentTime},
get_currentTime:function(){return this.video.currentTime},get_duration:function(){return this.video.duration},set_loop:function(a){return this.loop=this.video.loop=a},get_loop:function(){return this.set_loop(this.video.loop)},set_muted:function(a){return this.muted=this.video.muted=a},get_muted:function(){return this.set_muted(this.video.muted)},set_volume:function(a){this.get_muted()&&this.set_muted(!1);return this.volume=this.video.volume=0>a?0:1<a?1:a},get_volume:function(){return this.set_volume(this.video.volume)},
get_selectedRepresentationIndex:function(){null!=this.bd?this.Gf=this.bd.getQualityFor("video"):null!=this.td&&(this.Gf=this.td.loadLevel);return this.Gf},set_selectedRepresentationIndex:function(a){this.Gf!=a&&a<this.representations.length&&0<=a&&(this.Gf=a,this.Aw());return this.Gf},set_source:function(a){this.source!=a&&(this.source=a,this.wM());return this.source},dispose:function(){"undefined"!=this.state&&(this.stop(),this.set_source(null),this.state="undefined")},play:function(){"playing"!=
this.state&&"undefined"!=this.state&&this.video.play()},pause:function(){"playing"==this.state&&"undefined"!=this.state&&this.video.pause()},stop:function(){"stopped"!=this.state&&"undefined"!=this.state&&("paused"!=this.state?this.video.pause():this.xo("stopped"),this.video.currentTime=0)},seek:function(a){"undefined"!=this.state&&(this.video.currentTime=a)},gH:function(){this.video.addEventListener("loadedmetadata",F(this,this.bC));this.video.addEventListener("timeupdate",F(this,this.eC));this.video.addEventListener("play",
F(this,this.Bl));this.video.addEventListener("pause",F(this,this.Bl));this.video.addEventListener("ended",F(this,this.Bl))},mL:function(){this.video.removeEventListener("loadedmetadata",F(this,this.bC));this.video.removeEventListener("timeupdate",F(this,this.eC));this.video.removeEventListener("play",F(this,this.Bl));this.video.removeEventListener("pause",F(this,this.Bl));this.video.removeEventListener("ended",F(this,this.Bl))},tA:function(a){switch(td.pb(a).toLowerCase()){case "m3u8":return"application/x-mpegurl";
case "mp4":return"video/mp4";case "mpd":return"application/dash+xml";case "ogg":case "ogv":return"video/ogv";case "web,":return"video/webm";default:return null}},zJ:function(a){var b=a.type.toLowerCase();"application/dash+xml"==b?this.qv(a):"application/x-mpegurl"==b&&this.rv(a)},qv:function(a){var b=this;if("undefined"==typeof dashjs)kf.Ow(null!=this.dashScriptUrl?this.dashScriptUrl:"//cdn.dashjs.org/latest/dash.all.min.js",function(){b.qv(a)},function(){if(null!=b.dashScriptUrl)b.dashScriptUrl=
null,b.qv(a);else throw new ja("dash.js couldn't be loaded");});else{var c=function(){b.bd.off(dashjs.MediaPlayer.events.STREAM_INITIALIZED,c);var d=b.bd.getTracksFor("video");if(0<d.length)for(var d=d[0],e=0,f=d.bitrateList.length;e<f;){var g=e++,g=d.bitrateList[g];b.representations.push({type:"application/dash+xml",url:a.url,width:g.width,height:g.height,framerate:0,bitrate:g.bandwidth})}else b.EB()};this.bd=dashjs.MediaPlayer().create();this.bd.enableBufferOccupancyABR(!0);this.bd.getDebug().setLogToBrowserConsole(!1);
this.bd.initialize(this.video,a.url,this.get_autoplay());this.bd.setAutoSwitchQuality(this.autoSwitchQuality);this.bd.on(dashjs.MediaPlayer.events.STREAM_INITIALIZED,c)}},rv:function(a){var b=this;if(this.wm||Zf.gE())this.Gf=0,this.representations=[a],this.Aw();else if("undefined"!=typeof Hls||this.wm){var c=function(){b.td.off(Hls.Events.MANIFEST_PARSED,c);var d=b.td.levels;if(0<d.length)for(var e=0,f=d.length;e<f;){var g=e++,g=d[g];b.representations.push({type:"application/x-mpegurl",url:0<g.url.length?
g.url[0]:a.url,width:g.width,height:g.height,framerate:0,bitrate:g.bitrate})}};this.td=new Hls;this.autoSwitchQuality&&(this.td.startLevel=-1);this.td.loadSource(a.url);this.td.attachMedia(this.video);this.td.on(Hls.Events.MANIFEST_PARSED,c)}else kf.Ow(null!=this.hlsScriptUrl?this.hlsScriptUrl:"//cdn.jsdelivr.net/hls.js/latest/hls.min.js",function(){b.rv(a)},function(){if(null!=b.hlsScriptUrl)b.hlsScriptUrl=null,b.rv(a);else throw new ja("hls.js couldn't be loaded");})},EB:function(){for(var a=new ea,
b=["video/mp4","video/webm","video/ogv"],c=0,d=this.wg;c<d.length;){var e=d[c];++c;var f=e.type.toLowerCase();if(-1!=b.indexOf(f)){var g=(null!=t[f]?a.Gd(f):a.i.hasOwnProperty(f))?null!=t[f]?a.I(f):a.i[f]:[];g.push(e);null!=t[f]?a.C(f,g):a.i[f]=g}}b=null;(null!=t["video/mp4"]?a.Gd("video/mp4"):a.i.hasOwnProperty("video/mp4"))&&0<(null!=t["video/mp4"]?a.I("video/mp4"):a.i["video/mp4"]).length&&Lb.QM(this.video)?b=null!=t["video/mp4"]?a.I("video/mp4"):a.i["video/mp4"]:(null!=t["video/webm"]?a.Gd("video/webm"):
a.i.hasOwnProperty("video/webm"))&&0<(null!=t["video/webm"]?a.I("video/webm"):a.i["video/webm"]).length&&Lb.aE(this.video)?b=null!=t["video/webm"]?a.I("video/webm"):a.i["video/webm"]:(null!=t["video/ogv"]?a.Gd("video/ogv"):a.i.hasOwnProperty("video/ogv"))&&0<(null!=t["video/ogv"]?a.I("video/ogv"):a.i["video/ogv"]).length&&Lb.$D(this.video)&&(b=null!=t["video/ogv"]?a.I("video/ogv"):a.i["video/ogv"]);if(null!=b)this.Gf=0,this.representations=b,this.Aw();else throw new ja("VideoStream source not supported");
},xo:function(a){if(this.state!=a){var b=this.state;this.state=a;this.onStateChange.mf({oldState:b,newState:this.state})}},iw:function(a){null!=this.video&&this.mL();this.video=a;null!=this.video&&(this.gH(),this.wm&&(this.video.setAttribute("playsinline","true"),this.video.setAttribute("webkit-playsinline","true")));return this.video},HC:function(){if(null==this.video)this.iw(this.video);else for(var a=0,b=this.video.childNodes;a<b.length;){var c=b[a];++a;this.video.removeChild(c)}},Aw:function(){if(!this.hasAdaptative||
null==this.bd&&null==this.td){this.HC();var a=z.g(window.document.createElement("source"),HTMLSourceElement);a.src=this.representations[this.Gf].url;this.video.appendChild(a)}else null!=this.bd?this.bd.setQualityFor("video",this.Gf):null!=this.td&&(this.td.loadLevel=this.Gf)},wM:function(){this.wg.splice(0,this.wg.length);this.representations.splice(0,this.representations.length);this.HC();this.height=this.width=0;this.hasAdaptative=!1;if(null==this.source)null!=this.bd&&(this.bd.reset(),this.bd=
null),null!=this.td&&(this.td.destroy(),this.td=null);else{if(this.source instanceof Array&&null==this.source.jb)for(var a=this.source,b=0;b<a.length;){var c=a[b];++b;"string"==typeof c?this.wg.push({type:this.tA(c),url:c,width:0,height:0,framerate:0}):this.wg.push(c)}else if("string"==typeof this.source)this.wg.push({type:this.tA(this.source),url:this.source,width:0,height:0,framerate:0});else if(z.D(this.source,HTMLVideoElement))for(this.iw(z.g(this.source,HTMLVideoElement)),a=0,b=this.video.childNodes.length;a<
b;)c=a++,c=this.video.childNodes.item(c),z.D(c,HTMLSourceElement)&&this.wg.push({type:c.type,url:c.src,width:0,height:0,framerate:0});else this.wg.push(this.source);if(0<this.wg.length){a=null;if((b=Lb.ZD(this.video))||this.wm)for(var c=0,d=this.wg;c<d.length;){var e=d[c];++c;if("application/dash+xml"==e.type.toLowerCase()&&b||"application/x-mpegurl"==e.type.toLowerCase()&&(this.wm||b)){a=e;this.hasAdaptative=!0;break}}else this.hasAdaptative=!1;this.hasAdaptative?this.zJ(a):this.EB()}}},bC:function(){this.width=
this.video.videoWidth;this.height=this.video.videoHeight;"undefined"==this.state&&this.xo("ready")},Bl:function(a){switch(a.type){case "pause":this.xo(0==this.get_currentTime()?"stopped":"paused");break;case "play":this.xo("playing");break;case "ended":case "ready":this.xo("stopped")}},eC:function(){this.onTimeUpdate.mf()},l:Oc,F:{set_currentTime:"set_currentTime",get_currentTime:"get_currentTime",get_duration:"get_duration",set_volume:"set_volume",get_volume:"get_volume",set_loop:"set_loop",get_loop:"get_loop",
set_muted:"set_muted",get_muted:"get_muted",set_autoplay:"set_autoplay",get_autoplay:"get_autoplay",set_autoSwitchQuality:"set_autoSwitchQuality",set_selectedRepresentationIndex:"set_selectedRepresentationIndex",get_selectedRepresentationIndex:"get_selectedRepresentationIndex",set_source:"set_source"}};var Pc=K.CAPTURA.Viewer.VideoStream=function(a){this.dashScriptUrl=Pc.DASH_SCRIPT_URL;this.hlsScriptUrl=Pc.HLS_SCRIPT_URL;Oc.call(this,a)};n["cc.viewer.panorama.core.VideoStream"]=Pc;Pc.h=["cc","viewer",
"panorama","core","VideoStream"];Pc.V=Oc;Pc.prototype=S(Oc.prototype,{get:function(a){var b,c;this.F?c=b=this.F["get_"+a]:c=!1;return c?this[b]():this[a]},set:function(a,b){var c,d;this.F?d=c=this.F["set_"+a]:d=!1;if(d)this[c](b);else this[a]=b;var e;this.F?c=e=this.F["get_"+a]:c=!1;return c?this[e]():this[a]},l:Pc});n["cc.viewer.panorama.layers.PanoramaLayerBase"]=nb;nb.h=["cc","viewer","panorama","layers","PanoramaLayerBase"];nb.prototype={set_panoramaHFOV:function(a){this.panoramaHFOV!=a&&(this.panoramaHFOV=
a,this.vl());return a},set_panoramaVFOV:function(a){this.panoramaVFOV!=a&&(this.panoramaVFOV=a,this.vl());return a},set_panoramaPitch:function(a){this.panoramaPitch!=a&&(this.panoramaPitch=a,this.vl());return a},kw:function(a){this.R!=a&&(this.R=a,this.vl());return a},set_inputFormat:function(a){this.inputFormat!=a&&(this.inputFormat=a);return a},set_outputFormat:function(a){this.outputFormat!=a&&(this.outputFormat=a);return a},vl:function(){this.bq||(this.bq=!0,dc.da(F(this,this.HM),0))},HM:function(){this.bq&&
(this.Cn(),this.bq=!1)},Cn:function(){this.lA()},lA:function(){null!=this.ta&&(this.ta.dispose(),this.ta=null)},dispose:function(){this.lA()},l:nb,F:{set_outputFormat:"set_outputFormat",set_inputFormat:"set_inputFormat",kw:"set_radius",set_panoramaPitch:"set_panoramaPitch",set_panoramaVFOV:"set_panoramaVFOV",set_panoramaHFOV:"set_panoramaHFOV"}};n["cc.viewer.panorama.layers.PanoramaLayer"]=qe;qe.h=["cc","viewer","panorama","layers","PanoramaLayer"];qe.V=nb;qe.prototype=S(nb.prototype,{Qg:function(a){if(this.alpha!=
a){this.alpha=a;if(null!=this.cf)for(var b=0,c=this.cf.re;b<c.length;){var d=c[b];++b;d.alpha=this.alpha}null!=this.ta&&(this.ta.gd=0<this.alpha)}return a},kd:function(a){this.Pd!=a&&(this.Pd=a,null!=this.cf&&(this.cf.dispose(),this.cf=null),null!=this.Pd&&(this.cf=new Rd(""+this.name+"_material",this.Pd,this.inputFormat,this.f),this.cf.alpha=this.alpha),this.vl());return a},set_inputFormat:function(a){this.inputFormat!=a&&(this.inputFormat=a,null!=this.cf&&this.cf.set_inputFormat(a));return a},Cn:function(){nb.prototype.Cn.call(this);
if(!(null==this.cf||isNaN(this.panoramaHFOV)||isNaN(this.panoramaVFOV)||isNaN(this.panoramaPitch)||isNaN(this.R))){if("spherical"==this.outputFormat)this.ta=Bd.MC(""+this.name+"_mesh",this.f,this.panoramaHFOV,this.panoramaVFOV,this.panoramaPitch,this.cf.so,this.cf.$k,this.R,!0);else throw new ja("Output format "+this.outputFormat+" is not implemented yet");this.ta.kd(this.cf);this.ta.gd=0<this.alpha}},dispose:function(){this.kd(null);nb.prototype.dispose.call(this)},l:qe,F:S(nb.prototype.F,{kd:"set_material",
Qg:"set_alpha"})});n["cc.viewer.panorama.layers.PanoramaLayerSet"]=hf;hf.h=["cc","viewer","panorama","layers","PanoramaLayerSet"];hf.prototype={set_panoramaHFOV:function(a){if(this.panoramaHFOV!=a){this.panoramaHFOV=a;for(var b=0,c=this.cd;b<c.length;){var d=c[b];++b;d.set_panoramaHFOV(a)}}return a},set_panoramaVFOV:function(a){if(this.panoramaVFOV!=a){this.panoramaVFOV=a;for(var b=0,c=this.cd;b<c.length;){var d=c[b];++b;d.set_panoramaVFOV(a)}}return a},set_panoramaPitch:function(a){if(this.panoramaPitch!=
a){this.panoramaPitch=a;for(var b=0,c=this.cd;b<c.length;){var d=c[b];++b;d.set_panoramaPitch(a)}}return a},set_inputFormat:function(a){if(this.inputFormat!=a){this.inputFormat=a;for(var b=0,c=this.cd;b<c.length;){var d=c[b];++b;d.set_inputFormat(a)}}return a},set_outputFormat:function(a){if(this.outputFormat!=a){this.outputFormat=a;for(var b=0,c=this.cd;b<c.length;){var d=c[b];++b;d.set_outputFormat(a)}}return a},sl:function(){return this.cd.length},eu:function(a){a=new qe(""+this.gG+"_"+this.cd.length,
this.f,this.panoramaHFOV,this.panoramaVFOV,this.panoramaPitch,100-this.cd.length,this.inputFormat,this.outputFormat,a);a.Qg(1);this.cd.push(a)},dispose:function(){this.fL()},fL:function(){for(var a=this.cd.length-1;0<=a;)this.kL(a),--a},ml:function(a){return 0<=a&&a<this.cd.length?this.cd[a]:null},kL:function(a){0<=a&&a<this.cd.length&&(this.cd.splice(a,1)[0].dispose(),this.cd.splice(a,1),this.sM())},sM:function(){for(var a=0,b=this.cd.length;a<b;){var c=a++;this.cd[c].kw(100-c)}},l:hf,F:{sl:"get_length",
set_outputFormat:"set_outputFormat",set_inputFormat:"set_inputFormat",set_panoramaPitch:"set_panoramaPitch",set_panoramaVFOV:"set_panoramaVFOV",set_panoramaHFOV:"set_panoramaHFOV"}};n["cc.viewer.panorama.layers.VideoPanoramaLayer"]=pe;pe.h=["cc","viewer","panorama","layers","VideoPanoramaLayer"];pe.V=nb;pe.prototype=S(nb.prototype,{bD:function(a){this.video=a;null!=this.video&&this.vl();return this.video},set_inputFormat:function(a){this.inputFormat!=a&&(this.inputFormat=a);return a},Cn:function(){nb.prototype.Cn.call(this);
if(!(isNaN(this.panoramaHFOV)||isNaN(this.panoramaVFOV)||isNaN(this.panoramaPitch)||isNaN(this.R))){if("spherical"==this.outputFormat)this.ta=Bd.MC(""+this.name+"_mesh",this.f,this.panoramaHFOV,this.panoramaVFOV,this.panoramaPitch,1,1,this.R,!1);else throw new ja("Output format "+this.outputFormat+" is not implemented yet");null!=this.Ae&&this.Ae.dispose();this.uq=new oe(""+this.name+"_texture",this.f,this.video,!0,3);this.Ae=new V(""+this.name+"_material",this.f);this.Ae.Dd=this.uq;this.Ae.Hn=new Q(0,
0,0);this.Ae.Co=new Q(0,0,0);this.Ae.In=!0;this.Ae.freeze();this.ta.kd(this.Ae)}},dispose:function(){nb.prototype.dispose.call(this);null!=this.Ae&&(this.Ae.dispose(),this.Ae=null);null!=this.uq&&(this.uq.dispose(),this.uq=null)},l:pe,F:S(nb.prototype.F,{bD:"set_video"})});n["cc.viewer.panorama.layers.controllers.PanoramaLayersController"]=kc;kc.h="cc viewer panorama layers controllers PanoramaLayersController".split(" ");kc.prototype={vn:function(){},l:kc};n["cc.viewer.panorama.layers.controllers.HDRPanoramaLayersController"]=
Fa;Fa.h="cc viewer panorama layers controllers HDRPanoramaLayersController".split(" ");Fa.V=kc;Fa.prototype=S(kc.prototype,{set_luminanceLowerLimit:function(a){this.jt=Math.min(1,Math.max(0,a));this.it=Math.max(this.jr(),this.ir());return this.jt},jr:function(){return this.jt},set_luminanceHigherLimit:function(a){this.it=Math.min(1,Math.max(0,a));this.jt=Math.min(this.jr(),this.ir());return this.it},ir:function(){return this.it},set_luminanceChangeTime:function(a){return this.luminanceChangeTime=
Math.max(100,Math.min(5E3,a))},set_maxLuminanceChangeSpeed:function(a){return this.maxLuminanceChangeSpeed=Math.max(0,a)},vn:function(a,b,c,d,e){if(null!=this.Ou&&1<this.Ou.length){this.Pu.cD(d);this.Pu.WC(e);this.Pu.set_hfov(c);d=this.JI(a,b,this.Pu);c=this.Ou.length;var f=this.position*(c-1),g=z.g(Math.max(0,Math.min(c-2,Math.floor(f))),tg);e=g+1;for(var f=1-(f-g),h=1-f,k=0;k<c;){var l=k++,m=this.mb.ml(l);null!=m&&(l==g?m.Qg(1>h?1:0):l==e?m.Qg(h):m.Qg(0))}l=Math.round((new Date).getTime()/1E3*1E3);
k=0!=this.tB?l-this.tB:16;this.tB=l;l=a-this.sJ;m=b-this.rJ;this.sJ=a;this.rJ=b;1E3*Math.sqrt(l*l+m*m)*Fa.yL/k<=this.maxLuminanceChangeSpeed&&(a=this.CA(g,d),b=this.CA(e,d),d=f*a+h*b,c=Math.min(1/c,1*k/this.luminanceChangeTime),d<this.jr()?this.position=b>d?this.position+c:this.position-c:d>this.ir()&&(this.position=a<d?this.position-c:this.position+c),this.position=Math.min(1,Math.max(0,this.position)))}},JI:function(a,b,c){var d=new Ib;d.$v(-b);d.KC(-a);a=[];b=0;for(var e=Fa.Hl.length;b<e;){var f=
b++,f=c.lM(new xb(Fa.Hl[f][0]*c.width,Fa.Hl[f][1]*c.height,0)),f=jc.Ib(f.GK,f.HK),g=f.x*d.m12+f.y*d.m22+f.z*d.m32+d.Cc,h=f.x*d.m13+f.y*d.m23+f.z*d.m33+d.tz;f.x=f.x*d.m11+f.y*d.m21+f.z*d.m31+d.Bc;f.y=g;f.z=h;a.push([0==f.x&&0==f.z?0:-Math.atan2(f.x,f.z),0==f.y&&0==f.z?0:Math.atan2(f.y,f.z)])}return a},CA:function(a,b){for(var c=this.Ou[a],d=0,e=0,f=Fa.Hl.length;e<f;)var g=e++,d=d+Fa.qE[g]*c.getData(b[g][0],b[g][1],this.mb.panoramaHFOV,this.mb.panoramaVFOV,this.mb.panoramaPitch);return d},l:Fa,F:{set_maxLuminanceChangeSpeed:"set_maxLuminanceChangeSpeed",
set_luminanceChangeTime:"set_luminanceChangeTime",set_luminanceHigherLimit:"set_luminanceHigherLimit",ir:"get_luminanceHigherLimit",set_luminanceLowerLimit:"set_luminanceLowerLimit",jr:"get_luminanceLowerLimit"}});n["cc.viewer.panorama.layers.controllers.LivePanoramaLayersController"]=Mc;Mc.h="cc viewer panorama layers controllers LivePanoramaLayersController".split(" ");Mc.V=kc;Mc.prototype=S(kc.prototype,{vn:function(){if(this.Wz){var a=Math.min(1,(Math.round((new Date).getTime()/1E3*1E3)-this.mu)/
(this.mI-this.mu));1==a?this.iK():this.yl>this.Dn?this.mb.ml(this.yl).Qg(a):this.mb.ml(this.Dn).Qg(1-a)}},jK:function(){this.yl=(this.Dn+1)%this.mb.sl();var a=this.mb.ml(this.yl);null!=a&&(this.mu=Math.round((new Date).getTime()/1E3*1E3),this.mI=this.mu+this.changingTime,this.yl<this.Dn&&a.Qg(1),this.Wz=!0)},iK:function(){this.Wz=!1;this.mb.ml(this.Dn).Qg(0);this.mb.ml(this.yl).Qg(1);this.Dn=this.yl;dc.da(F(this,this.jK),this.displayingTime)},l:Mc});n["cc.viewer.panorama.layers.controllers.LuminanceData"]=
Yf;Yf.h="cc viewer panorama layers controllers LuminanceData".split(" ");Yf.prototype={getData:function(a,b,c,d,e){for(;a>Math.PI;)a-=2*Math.PI;for(;a<-Math.PI;)a+=2*Math.PI;a=Math.round((a+Math.PI)*this.width/c);b=Math.round((.5*d+e-b)*this.height/d);return 0<=a&&a<this.width&&0<=b&&b<this.height?this.data[b*this.width+a]:0},l:Yf};var va=K.BABYLON.Material=function(a,b,c){null==c&&(c=!1);this.yb=[];this.Ws=0;this.Az=!1;this.WD=0;this.nC=1;this.nf=!0;this.fl=!1;this.Fz=2;this.iC=new U;this.ZB=new U;
this.Nb=new U;this.aa=1;this.un=!0;this.alpha=1;this.ru=this.Yk=!1;this.name=this.id=a;this.f=b;c||b.vf.push(this);Object.defineProperty(this,"wireframe",{get:this.vO,set:this.nw});Object.defineProperty(this,"fillMode",{get:this.Yu,set:this.BP});Object.defineProperty(this,"pointsCloud",{get:this.lr,set:this.DP})};n["com.babylonhx.materials.Material"]=va;va.h=["com","babylonhx","materials","Material"];va.xb=[Nb];va.zi=function(a,b){var c=new Ua(a.name,b);c.id=a.id;Ca.Md(c,a.Nl);for(var d=0,e=a.vf.length;d<
e;){var f=a.vf[d++];null!=f?c.re.push(b.EA(f)):c.re.push(null)}return c};va.ab=function(a,b,c){if(null==a.Cu)return V.ab(a,b,c);var d=ec.tE(a.Cu);return null!=d?ec.yC(d).ab(a,b,c):null};va.prototype={nw:function(a){this.Ws=a?1:0;return a},lr:function(){return 2==this.Ws},Yu:function(){return this.Ws},av:function(){return this.Yk},freeze:function(){this.Yk=!0},pa:function(){return!0},Ni:function(){return 1>this.alpha},Vf:function(){return!1},br:function(){return null},At:function(){var a=this.f.c,
b=this.s,c=b.xd;a.uc!=c&&(a.b.useProgram(c),a.uc=c);a.Cf=b;null!=b.Sc&&b.Sc(b);var b=this.un,c=this.WD,d=0==this.aa,d=a.Cg?d?1028:1029:d?1029:1028;if(a.H.Pf()!=b||a.H.Eg()!=d)b?(a.H.jw(d),a.H.cg(!0)):a.H.cg(!1);a.H.Oh(c)},bind:function(a,b){this.f.Ye=this;this.ZB.la(b);if(this.fl){var c=this.f.c;this.cF=c.H.gr();c.H.vb(!1)}},wn:function(){},Io:function(){this.iC.la(this);this.fl&&this.f.c.H.vb(this.cF)},dispose:function(a){null==a&&(a=!1);this.f.Ml(this);var b=this.f.vf.indexOf(this);0<=b&&this.f.vf.splice(b,
1);a&&null!=this.s&&(this.f.c.sG(this.s),this.s=null);a=0;for(b=this.f.Xb.length;a<b;){var c=this.f.Xb[a++];c.Fg()==this&&c.kd(null)}this.Nb.la(this);this.Nb.clear();this.ZB.clear();this.iC.clear()},l:va,F:{av:"get_isFrozen",Yu:"get_fillMode",lr:"get_pointsCloud",nw:"set_wireframe"}};var Ua=K.BABYLON.MultiMaterial=function(a,b){this.re=[];va.call(this,a,b,!0);b.KB.push(this)};n["com.babylonhx.materials.MultiMaterial"]=Ua;Ua.h=["com","babylonhx","materials","MultiMaterial"];Ua.ab=function(a,b){for(var c=
new Ua(a.name,b),d=a.vf,e=0;e<d.length;){var f=d[e];++e;f=b.EA(f);null!=f?c.re.push(f):null!=f&&c.re.push(f)}return c};Ua.V=va;Ua.prototype=S(va.prototype,{IA:function(a){return 0>a||a>=this.re.length?this.f.Qq:this.re[a]},pa:function(a){for(var b=0,c=this.re.length;b<c;){var d=b++;if(null!=this.re[d]&&!this.re[d].pa(a))return!1}return!0},l:Ua});n["cc.viewer.panorama.materials.ERectMultiMaterial"]=Rd;Rd.h=["cc","viewer","panorama","materials","ERectMultiMaterial"];Rd.V=Ua;Rd.prototype=S(Ua.prototype,
{set_inputFormat:function(a){this.inputFormat!=a&&(this.inputFormat=a,this.kA(),this.RH());return a},Lf:function(a,b){return this.IA(a*this.$k+b)},dispose:function(a,b){null==b&&(b=!0);null==a&&(a=!1);Ua.prototype.dispose.call(this,a,b);b&&this.kA();this.Pd=null},kA:function(){this.re.splice(0,this.re.length);this.so=this.$k=0},RH:function(){if(null!=this.Pd){var a=new rd,b=new rd,c;switch(this.inputFormat){case "erect_sbs":c=new zc(.5*this.Pd.width,0,.5*this.Pd.width,this.Pd.height);break;case "erect_uo":c=
new zc(0,.5*this.Pd.height,this.Pd.width,.5*this.Pd.height);break;default:c=new zc(0,0,this.Pd.width,this.Pd.height)}this.so=Math.ceil(c.height/512);this.$k=Math.ceil(c.width/512);a.scale(512*this.$k/c.width,512*this.so/c.height);b.Bc+=-c.x;b.Cc+=-c.y;b.scale(512*this.$k/c.width,512*this.so/c.height);b=0;for(c=this.so;b<c;)for(var d=b++,e=0,f=this.$k;e<f;){var g=e++;"erect"==this.inputFormat?this.re.push(this.SH(a,d,g)):this.re.push(null)}this.freeze()}},SH:function(a,b,c){var d=new V(""+this.name+
"_"+b+"_"+c,this.f);d.Dd=this.Oq(a,b,c);d.Hn=new Q(0,0,0);d.Co=new Q(0,0,0);d.In=!0;d.freeze();return d},VN:function(){return null},Oq:function(a,b,c){a=new rd(a.$,a.m,a.Hq,a.d,a.Bc,a.Cc);var d=new da(null,0,0,512,512);a.Bc+=512*-c;a.Cc+=512*-b;$f.Hc(d,this.Pd,a,!0);return Hd.D(d.MA(),d.width,d.height,this.f)},l:Rd,F:S(Ua.prototype.F,{set_inputFormat:"set_inputFormat"})});var Ub=K.BABYLON.BaseTexture=function(a){this.yb=[];this.Nb=new U;this.Bq=4;this.hg=this.ig=1;this.If=this.Cd=0;this.Ya=[];this.rc=
this.Li=!1;this.level=1;this.Hj=this.Qu=!1;this.La=0;this.f=a;this.f.Ol.push(this)};n["com.babylonhx.materials.textures.BaseTexture"]=Ub;Ub.h=["com","babylonhx","materials","textures","BaseTexture"];Ub.xb=[Nb,lc];Ub.prototype={Je:function(){return null},nl:function(){return null},pa:function(){return 4==this.La?!0:null!=this.ga?this.ga.pa:!1},Vu:function(){return-1!=this.ga.Ka&&0!=this.ga.Ka?{width:this.ga.Ka,height:this.ga.Ua}:null!=this.ga.Db?{width:this.ga.Db,height:this.ga.Db}:{width:0,height:0}},
EI:function(){return this.pa()&&null!=this.ga?null!=this.ga.Db?{width:this.ga.Db,height:this.ga.Db}:{width:this.ga.pk,height:this.ga.nk}:{width:0,height:0}},Pp:function(a,b,c){for(var d=this.f.c.rg,e=0,f=d.length;e<f;){var g=d[e++];if(g.url==a&&g.Cr==b&&(null==c||c==g.jd))return g.ia++,g}return null},Rq:function(){},AC:function(){if(null!=this.ga){var a=this.f.c.rg;this.ga.ia--;0==this.ga.ia&&(Z.remove(a,this.ga),this.f.c.It(this.ga),this.ga=null)}},dispose:function(){this.f.Ml(this);var a=this.f.Ol.indexOf(this);
0<=a&&this.f.Ol.splice(a,1);null!=this.ga&&(this.AC(),this.Nb.la(this),this.Nb.clear())},l:Ub};var ka=K.BABYLON.Texture=function(a,b,c,d,e,f,g,h,k){null==k&&(k=!1);null==e&&(e=3);null==d&&(d=!0);null==c&&(c=!1);this.Ho=this.Ko=this.No=0;this.Vh=this.bi=1;this.hk=this.ik=0;Ub.call(this,b);this.url=this.name=a;this.Im=c;this.gt=d;this.kq=e;this.S=h;this.xF=k;null!=a&&""!=Ga.Cl(a)&&(this.ga=this.Pp(a,c,e),null==this.ga&&(Ga.aM(a)&&null!=ka.g?(this.ga=b.c.VH(ka.g,c,b,this.kq),ka.g=null):b.GD?this.La=
4:-1!=a.indexOf(".")&&(this.ga=b.c.createTexture(a,c,d,b,this.kq,f,g,this.S),k&&(this.S=null))))};n["com.babylonhx.materials.textures.Texture"]=ka;ka.h=["com","babylonhx","materials","textures","Texture"];ka.D=function(a,b,c){var d;null==d&&(d=3);return new ka("data:"+b,c,void 0,void 0,d,void 0,void 0,a)};ka.ab=function(a,b,c){if(a.Cu)return ec.yC(a.Cu).ab(a,b,c);if(a.rc)return Yc.ab(a,b,c);if(null==a.name&&!a.Li)return null;a.eo?(b=new Id(a.name,a.sL,b),z.g(b,Id).qn=a.mc,c=a.eo,z.g(b,Id).eo=new cd(c[0],
c[1],c[2],c[3])):a.Li?(b=new mc(a.name,a.sL,b),z.g(b,mc).qn=a.mc):b=a.qH?ka.D(a.qH,a.name,b):new ka(c+sa.Ib(a.name),b);b.name=a.name;b.Hj=a.Hj;b.Qu=a.Qu;b.level=a.level;b.If=a.If;b.Cd=a.Cd;b.hk=a.hk;b.ik=a.ik;b.Vh=a.Vh;b.bi=a.bi;b.Ho=a.Ho;b.Ko=a.Ko;b.No=a.No;b.hg=a.hg;b.ig=a.ig;if(null!=a.Ya){c=0;for(var d=a.Ya.length;c<d;)b.Ya.push(fc.ab(a.Ya[c++]))}return b};ka.V=Ub;ka.prototype=S(Ub.prototype,{Rq:function(){4==this.La&&(this.La=1,this.ga=this.Pp(this.url,this.Im,this.kq),null==this.ga&&(this.ga=
this.f.c.createTexture(this.url,this.Im,this.gt,this.f,this.kq,null,null,this.S),this.xF&&(this.S=null)))},CD:function(a){if(null!=this.ga){var b=this.f.c,c=this.ga;a=q.Ba(a,c.qc);c.rc?(c=c.data,b.P[b.J]!=c&&(b.b.bindTexture(34067,c),b.P[b.J]=c),b.b.texParameteri(34067,10240,a.Ih),b.b.texParameteri(34067,10241,a.min),null!=b.P[b.J]&&(b.b.bindTexture(34067,null),b.P[b.J]=null)):(c=c.data,b.P[b.J]!=c&&(b.b.bindTexture(3553,c),b.P[b.J]=c),b.b.texParameteri(3553,10240,a.Ih),b.b.texParameteri(3553,10241,
a.min),null!=b.P[b.J]&&(b.b.bindTexture(3553,null),b.P[b.J]=null))}},Ct:function(a,b,c,d){a*=this.Vh;b*=this.bi;a-=.5*this.Vh;b-=.5*this.bi;c-=.5;var e=this.Yy,f=a*e.a[1]+b*e.a[5]+c*e.a[9]+e.a[13],g=a*e.a[2]+b*e.a[6]+c*e.a[10]+e.a[14],h=a*e.a[3]+b*e.a[7]+c*e.a[11]+e.a[15];d.x=(a*e.a[0]+b*e.a[4]+c*e.a[8]+e.a[12])/h;d.y=f/h;d.z=g/h;d.x+=.5*this.Vh+this.hk;d.y+=.5*this.bi+this.ik;d.z+=.5},Je:function(){if(this.hk==this.px&&this.ik==this.rx&&this.Vh==this.qx&&this.bi==this.sx&&this.Ho==this.dF&&this.Ko==
this.eF&&this.No==this.fF)return this.$b;this.px=this.hk;this.rx=this.ik;this.qx=this.Vh;this.sx=this.bi;this.dF=this.Ho;this.eF=this.Ko;this.fF=this.No;if(null==this.$b){var a=new r;a.a[0]=0;a.a[1]=0;a.a[2]=0;a.a[3]=0;a.a[4]=0;a.a[5]=0;a.a[6]=0;a.a[7]=0;a.a[8]=0;a.a[9]=0;a.a[10]=0;a.a[11]=0;a.a[12]=0;a.a[13]=0;a.a[14]=0;a.a[15]=0;this.$b=a;this.Yy=new r;this.Rk=new p(0,0,0);this.fn=new p(0,0,0);this.gn=new p(0,0,0)}var a=r.Ma,b=.5*this.No,c=.5*this.Ho,d=.5*this.Ko,e=Math.sin(b),b=Math.cos(b),f=Math.sin(c),
c=Math.cos(c),g=Math.sin(d),d=Math.cos(d);a.x=d*f*b+g*c*e;a.y=g*c*b-d*f*e;a.z=d*c*e-g*f*b;a.o=d*c*b+g*f*e;r.Ma.yf(this.Yy);this.Ct(0,0,0,this.Rk);this.Ct(1,0,0,this.fn);this.Ct(0,1,0,this.gn);a=this.fn;e=this.Rk;a.x-=e.x;a.y-=e.y;a.z-=e.z;a=this.gn;e=this.Rk;a.x-=e.x;a.y-=e.y;a.z-=e.z;r.da(1,0,0,0,1,0,0,0,1,0,0,0,this.$b);this.$b.a[0]=this.fn.x;this.$b.a[1]=this.fn.y;this.$b.a[2]=this.fn.z;this.$b.a[4]=this.gn.x;this.$b.a[5]=this.gn.y;this.$b.a[6]=this.gn.z;this.$b.a[8]=this.Rk.x;this.$b.a[9]=this.Rk.y;
this.$b.a[10]=this.Rk.z;return this.$b},nl:function(){if(this.hk==this.px&&this.ik==this.rx&&this.Vh==this.qx&&this.bi==this.sx&&this.Cd==this.yp)return this.$b;if(null==this.$b){var a=new r;a.a[0]=0;a.a[1]=0;a.a[2]=0;a.a[3]=0;a.a[4]=0;a.a[5]=0;a.a[6]=0;a.a[7]=0;a.a[8]=0;a.a[9]=0;a.a[10]=0;a.a[11]=0;a.a[12]=0;a.a[13]=0;a.a[14]=0;a.a[15]=0;this.$b=a;a=new r;a.a[0]=0;a.a[1]=0;a.a[2]=0;a.a[3]=0;a.a[4]=0;a.a[5]=0;a.a[6]=0;a.a[7]=0;a.a[8]=0;a.a[9]=0;a.a[10]=0;a.a[11]=0;a.a[12]=0;a.a[13]=0;a.a[14]=0;a.a[15]=
0;this.nh=a}this.yp=this.Cd;switch(this.Cd){case 2:r.da(1,0,0,0,1,0,0,0,1,0,0,0,this.$b);this.$b.a[0]=this.Vh;this.$b.a[5]=this.bi;this.$b.a[12]=this.hk;this.$b.a[13]=this.ik;break;case 4:r.da(1,0,0,0,1,0,0,0,1,0,0,0,this.nh);this.nh.a[0]=.5;this.nh.a[5]=-.5;this.nh.a[10]=0;this.nh.a[12]=.5;this.nh.a[13]=.5;this.nh.a[14]=1;this.nh.a[15]=1;this.f.Va.qa(this.nh,this.$b.a,0);break;default:r.da(1,0,0,0,1,0,0,0,1,0,0,0,this.$b)}return this.$b},l:ka});n["cc.viewer.panorama.materials.textures.VideoTexture"]=
oe;oe.h="cc viewer panorama materials textures VideoTexture".split(" ");oe.V=ka;oe.prototype=S(ka.prototype,{dispose:function(){this.f.AD(F(this,this.update));ka.prototype.dispose.call(this)},update:function(){this.Yp!=this.zg.currentTime&&4==this.zg.readyState&&(this.Yp=this.zg.currentTime,this.f.c.ED(this.ga,this.zg,this.gt))},l:oe});n["cc.viewer.panorama.math.Frustum"]=Xf;Xf.h=["cc","viewer","panorama","math","Frustum"];Xf.prototype={cD:function(a){this.width!=a&&(this.width=a,this.Jq=!0);return a},
WC:function(a){this.height!=a&&(this.height=a,this.Jq=!0);return a},set_hfov:function(a){this.hfov!=a&&(this.hfov=a,this.Jq=!0);return a},lM:function(a){this.vM();return new gf(new xb(0,0,0),new xb(.5*this.width-a.x,.5*this.height-a.y,this.WK))},vM:function(){this.Jq&&(this.WK=.5*this.width/Math.tan(.5*this.hfov),this.Jq=!1)},l:Xf,F:{set_hfov:"set_hfov",WC:"set_height",cD:"set_width"}};n["cc.viewer.panorama.math.Line"]=gf;gf.h=["cc","viewer","panorama","math","Line"];gf.prototype={l:gf};n["cc.viewer.panorama.math.Vector3D"]=
jc;jc.h=["cc","viewer","panorama","math","Vector3D"];jc.Ib=function(a,b){return new jc(b.x-a.x,b.y-a.y,b.z-a.z)};jc.V=xb;jc.prototype=S(xb.prototype,{l:jc});n["cc.viewer.panorama.mesh.SphereBuilder"]=Bd;Bd.h=["cc","viewer","panorama","mesh","SphereBuilder"];Bd.MC=function(a,b,c,d,e,f,g,h,k){null==k&&(k=!0);var l=new O;l.ob=[];l.fb=[];l.Na=[];l.zb=[];var m=.5*c,u=.5*d,x=c/g,v=d/f;c=Math.ceil(100*c/(2*Math.PI*g));d=Math.ceil(50*d/(Math.PI*f));for(var G=0;G<f;)for(var p=G++,w=0;w<g;)Bd.rI(l,-m+w++*x,
u+e-p*v,x,v,h,c,d);a=new aa(a,b);l.cc(a);if(k)for(k=a.Nf(),l=0,c=c*d*6,a.Ga=[],d=0;d<f;)for(b=d++,e=0;e<g;)a.Ga.push(new ub(b*g+e++,0,k,l,c,a)),l+=c;return a};Bd.rI=function(a,b,c,d,e,f,g,h){null==h&&(h=12);null==g&&(g=16);null==f&&(f=50);var k=a.Na,l=a.fb,m=a.ob;a=a.zb;for(var u=k.length/3|0,x=0,v=h+1;x<v;)for(var G=x++,p=c-e*G/h,w=f*Math.cos(p),p=f*Math.sin(p),r=G/h,q=0,n=g+1;q<n;){var y=q++,t=b+d*y/g,B=w*Math.sin(t),t=w*Math.cos(t),E=1/Math.sqrt(B*B+p*p+t*t);k.push(B);k.push(p);k.push(t);l.push(B*
E);l.push(p*E);l.push(t*E);a.push(y/g);a.push(r);0<y&&0<G&&(B=u+(g+1)*G+y,t=u+(g+1)*(G-1)+y-1,m.push(B),m.push(t),m.push(u+(g+1)*G+y-1),m.push(B),m.push(u+(g+1)*(G-1)+y),m.push(t))}};var ga=K.BABYLON.PostProcess=function(a,b,c,d,e,f,g,h,k,l,m){null==m&&(m=0);null==l&&(l="");null==k&&(k=!1);null==g&&(g=1);this.Kc=new U;this.sc=new U;this.Le=new U;this.Qi=new U;this.SB=new U;this.Nt=new W(1,1);this.Zg=0;this.nb=new Ja(2);this.kI=this.jq=!1;this.width=this.height=-1;null!=f?(this.Xa=f,this.f=f.f,f.Lz(this),
this.c=this.f.c):this.c=h;this.name=a;this.ri=e;this.DC=g;this.jq=k;this.PG=m;this.Rd=null!=d?d:[];this.Rd.push("textureSampler");this.KF=b;this.Jy=null!=c?c:[];this.Jy.push("scale");this.pM(l)};n["com.babylonhx.postprocess.PostProcess"]=ga;ga.h=["com","babylonhx","postprocess","PostProcess"];ga.prototype={pM:function(a){null==a&&(a="");this.s=this.c.Aj({vertex:"postprocess",fragment:this.KF},["position"],this.Jy,this.Rd,a)},yv:function(){this.width=-1},bu:function(a,b){null==a&&(a=this.Xa);var c=
a.f,d=a.f.c.U.co,e=(null!=b?b.Ka:this.c.Vb())*this.ri,f=(null!=b?b.Ua:this.c.Lb())*this.ri,g=null!=this.ri.width?this.ri.width:e,h=null!=this.ri.height?this.ri.height:f;if(1!=this.DC){if(null==this.ri.width){for(var k=1;k*=2,k<g;);k>d&&(k=d);g=k}if(null==this.ri.height){for(k=1;k*=2,k<h;);k>d&&(k=d);h=k}}if(this.width!=g||this.height!=h){if(0<this.nb.length){d=0;for(k=this.nb.length;d<k;)this.c.It(this.nb.data[d++]);d=this.nb;d.length=0;d.Ja++}this.width=g;this.height=h;var d={width:this.width,height:this.height},
k={qc:!1,il:0==a.bc.indexOf(this),jl:0==a.bc.indexOf(this)&&this.c.QA(),jd:this.DC,type:this.PG},l=this.nb,m=this.c.zu(d,k);l.data[l.length++]=m;m.yb[l.cb]=l.Ja;this.jq&&(l=this.nb,d=this.c.zu(d,k),l.data[l.length++]=d,d.yb[l.cb]=l.Ja);this.Qi.la(this.s)}this.kI?(d=this.Nt,d.x=e/g,d.y=f/h,this.c.bindFramebuffer(this.nb.data[this.Zg],0,e,f)):(e=this.Nt,e.x=1,e.y=1,this.c.bindFramebuffer(this.nb.data[this.Zg]));this.SB.la(a);null!=this.clearColor?(c=this.c,e=this.clearColor,c.H.apply(c.b),c.rb.apply(c.b),
c.K.apply(c.b),z.D(e,ca)?c.b.clearColor(e.r,e.v,e.m,e.$):c.b.clearColor(e.r,e.v,e.m,1),c.b.clearDepth(1),c.b.clearStencil(0),c.b.clear(17664)):(e=this.c,f=c.clearColor,c=c.Cq||c.Nu,e.H.apply(e.b),e.rb.apply(e.b),e.K.apply(e.b),g=0,c&&(z.D(f,ca)?e.b.clearColor(f.r,f.v,f.m,f.$):e.b.clearColor(f.r,f.v,f.m,1),g=16384),e.b.clearDepth(1),g|=256,e.b.clearStencil(0),e.b.clear(g|1024));this.jq&&(this.Zg=(this.Zg+1)%2)},Qf:function(){return this.s.Qf()},apply:function(){if(!this.s.Mc)return null;var a=this.c,
b=this.s,c=b.xd;a.uc!=c&&(a.b.useProgram(c),a.uc=c);a.Cf=b;null!=b.Sc&&b.Sc(b);a=this.c;0==a.H.Pf()&&a.H.Eg()==(a.Cg?1029:1028)||a.H.cg(!1);a.H.Oh(0);a=this.c;0!=a.bb&&(a.K.ya(!1),a.H.vb(!0),a.bb=0);this.c.H.Pe(!1);this.c.H.vb(!1);0<this.nb.length&&(b=this.s,a=b.c,c=b.Rd.indexOf("textureSampler"),b=this.nb.data[this.Zg].data,0<=c&&(c=33984+c,a.J!=c-33984&&(a.b.activeTexture(c),a.J=c-33984),a.P[a.J]!=b&&(a.b.bindTexture(3553,b),a.P[a.J]=b)));c=this.s;a=this.Nt;c.Jb("scale",a.x,a.y)&&(b=c.c,c=c.u.get("scale"),
b.b.uniform2f(c,a.x,a.y));this.Le.la(this.s);return this.s},dispose:function(a){null==a&&(a=this.Xa);if(0<this.nb.length){for(var b=0,c=this.nb.length;b<c;)this.c.It(this.nb.data[b++]);b=this.nb;b.length=0;b.Ja++}null!=a&&(a.$H(this),0==a.bc.indexOf(this)&&0<a.bc.length&&this.Xa.bc[0].yv(),this.SB.clear(),this.Kc.clear(),this.Le.clear(),this.sc.clear(),this.Qi.clear())},l:ga,F:{Qf:"get_isSupported"}};n["cc.viewer.panorama.postprocess.StereoscopicPostProcess"]=ne;ne.h=["cc","viewer","panorama","postprocess",
"StereoscopicPostProcess"];ne.V=ga;ne.prototype=S(ga.prototype,{l:ne});n["cc.viewer.panorama.postprocess.VideoIOS10FixPostProcess"]=me;me.h=["cc","viewer","panorama","postprocess","VideoIOS10FixPostProcess"];me.V=ga;me.prototype=S(ga.prototype,{l:me});var Y=K.CAPTURA.Viewer.PanoramaViewBase=function(a,b,c,d){null==d&&(d="normal");null==c&&(c="spherical");null==b&&(b="erect");this.wj=this.mj=0;this.hj=90;this.attachControl=!0;this.controlMode="drag_acceleration";this.minHFOV=30;this.maxHFOV=120;this.panoramaPitch=
0;this.panoramaVFOV=180;this.panoramaHFOV=360;this.xc=new jf(F(this,this.Sl));this.scene=a;this.set_inputFormat(b);this.set_outputFormat(c);this.set_cameraMode(d);this.xc.ne()};n["cc.viewer.panorama.view.PanoramaViewBase"]=Y;Y.h=["cc","viewer","panorama","view","PanoramaViewBase"];Y.prototype={set_inputFormat:function(a){this.inputFormat!=a&&(this.inputFormat=a,this.xc.ne("input"));return this.inputFormat},set_outputFormat:function(a){this.outputFormat!=a&&(this.outputFormat=a,this.xc.ne("cameras"));
return this.outputFormat},set_cameraMode:function(a){this.cameraMode!=a&&(this.cameraMode=a,this.xc.ne("cameras"));return this.cameraMode},set_panoramaHFOV:function(a){this.panoramaHFOV!=a&&(this.panoramaHFOV=a,this.xc.ne("cameras"));return a},set_panoramaVFOV:function(a){this.panoramaVFOV!=a&&(this.panoramaVFOV=a,this.xc.ne("cameras"));return a},set_panoramaPitch:function(a){this.panoramaPitch!=a&&(this.panoramaPitch=a,this.xc.ne("cameras"));return a},set_maxHFOV:function(a){this.maxHFOV!=a&&(this.maxHFOV=
a,this.xc.ne("cameras"));return a},set_minHFOV:function(a){this.minHFOV!=a&&(this.minHFOV=a,this.xc.ne("cameras"));return a},set_hfov:function(a){isNaN(a)||this.hj==a||(this.hj=a,null==this.Xa||this.xc.Gh("cameras")||this.Xa.set_hfov(this.hj*Y.D));return a},get_hfov:function(){return null!=this.Xa?this.hj=this.Xa.get_hfov()*Y.da:this.hj},set_yaw:function(a){this.wj!=a&&(this.wj=a,null==this.Xa||this.xc.Gh("cameras")||this.Xa.set_yaw(this.wj*Y.D));return a},get_yaw:function(){return null!=this.Xa?
this.wj=this.Xa.get_yaw()*Y.da:this.wj},set_pitch:function(a){this.mj!=a&&(this.mj=a,null==this.Xa||this.xc.Gh("cameras")||this.Xa.set_pitch(this.mj*Y.D));return a},get_pitch:function(){return null!=this.Xa?this.mj=this.Xa.get_pitch()*Y.da:this.mj},set_controlMode:function(a){this.controlMode!=a&&(this.controlMode=a,this.xc.ne("cameras"));return this.controlMode},KL:function(a){this.attachControl!=a&&(this.attachControl=a,null!=this.Xa&&(this.attachControl?this.Xa.attachControl(this):this.Xa.le(this)));
return this.attachControl},dispose:function(){},xu:function(a){var b=new re;b.panoramaHFOV=this.panoramaHFOV*Y.D;b.panoramaVFOV=this.panoramaVFOV*Y.D;b.panoramaPitch=this.panoramaPitch*Y.D;b.maxHFOV=this.maxHFOV*Y.D;b.minHFOV=this.minHFOV*Y.D;b.initialHFOV=this.hj*Y.D;this.Xa=ec.al(a,["cameras",new p(0,0,0),this.scene,b]);this.attachControl&&this.Xa.attachControl(this)},Jo:function(){this.set_maxHFOV(this.LD(this.maxHFOV));this.set_minHFOV(this.maxHFOV<this.minHFOV?this.maxHFOV:this.minHFOV);this.set_hfov(this.LD(this.hj));
var a=null;switch(this.controlMode){case "device_orientation":a=ya.isSupported()?ya:Cd;break;case "drag_acceleration":a=se;break;case "drag_rotation":a=Cd}var b;null!=this.Xa?(b=this.Xa,b=(null==b?null:z.yh(b))!=a):b=!0;b&&(null!=this.Xa&&(this.wj=this.Xa.get_yaw()*Y.da,this.mj=this.Xa.get_pitch()*Y.da,this.Xa.dispose()),this.xu(a));this.Xa.set_yaw(this.wj*Y.D);this.Xa.set_pitch(this.mj*Y.D);a=0;switch(this.cameraMode){case "anaglyph":a=10;break;case "over_under":a=13;break;case "side_by_side_crosseyed":a=
12;break;case "side_by_side_parallel":a=11;break;case "vr":a=20}this.Xa.Jl(a,{})},zw:function(){},jk:function(){},LD:function(a){2*Math.atan(this.scene.c.Lb()*Math.tan(a*Y.D*.5)/this.scene.c.Vb())*Y.da>this.panoramaVFOV&&(a=2*Math.atan(this.scene.c.Vb()*Math.tan(this.panoramaVFOV*Y.D*.5)/this.scene.c.Lb())*Y.da);return a},Sl:function(){var a=this.xc.Gh("cameras"),b=this.xc.Gh("data"),c=this.xc.Gh("input");b&&this.jk();c&&this.zw();a&&this.Jo()},get:function(a){var b,c;this.F?c=b=this.F["get_"+a]:
c=!1;return c?this[b]():this[a]},set:function(a,b){var c,d;this.F?d=c=this.F["set_"+a]:d=!1;if(d)this[c](b);else this[a]=b;var e;this.F?c=e=this.F["get_"+a]:c=!1;return c?this[e]():this[a]},l:Y,F:{KL:"set_attachControl",set_controlMode:"set_controlMode",set_pitch:"set_pitch",get_pitch:"get_pitch",set_yaw:"set_yaw",get_yaw:"get_yaw",set_hfov:"set_hfov",get_hfov:"get_hfov",set_minHFOV:"set_minHFOV",set_maxHFOV:"set_maxHFOV",set_panoramaPitch:"set_panoramaPitch",set_panoramaVFOV:"set_panoramaVFOV",set_panoramaHFOV:"set_panoramaHFOV",
set_cameraMode:"set_cameraMode",set_outputFormat:"set_outputFormat",set_inputFormat:"set_inputFormat"}};var ze=K.CAPTURA.Viewer.PanoramaView=function(a,b,c,d){null==d&&(d="normal");null==c&&(c="spherical");null==b&&(b="erect");this.maxLuminanceChangeSpeed=1;this.luminanceChangeTime=5E3;this.luminanceHigherLimit=.45;this.luminanceLowerLimit=.2;this.changingTime=2E3;this.displayingTime=5E3;this.panoramaMode="hdr";Y.call(this,a,b,c,d);a.Vv(F(this,this.Er))};n["cc.viewer.panorama.view.PanoramaView"]=
ze;ze.h=["cc","viewer","panorama","view","PanoramaView"];ze.V=Y;ze.prototype=S(Y.prototype,{set_source:function(a){this.source!=a&&(this.source=a,this.xc.ne("data"));return a},set_panoramaMode:function(a){this.panoramaMode!=a&&(this.panoramaMode=a,this.xc.ne("layersController"));return a},set_displayingTime:function(a){this.displayingTime=a;z.D(this.ud,Mc)&&(z.g(this.ud,Mc).displayingTime=this.displayingTime);return a},set_changingTime:function(a){this.changingTime=a;z.D(this.ud,Mc)&&(z.g(this.ud,
Mc).changingTime=this.changingTime);return a},set_luminanceLowerLimit:function(a){this.luminanceLowerLimit=a;z.D(this.ud,Fa)&&z.g(this.ud,Fa).set_luminanceLowerLimit(this.luminanceLowerLimit);return a},set_luminanceHigherLimit:function(a){this.luminanceHigherLimit=a;z.D(this.ud,Fa)&&z.g(this.ud,Fa).set_luminanceHigherLimit(this.luminanceHigherLimit);return a},set_luminanceChangeTime:function(a){this.luminanceChangeTime=a;z.D(this.ud,Fa)&&z.g(this.ud,Fa).set_luminanceChangeTime(this.luminanceChangeTime);
return a},set_maxLuminanceChangeSpeed:function(a){this.maxLuminanceChangeSpeed=a;z.D(this.ud,Fa)&&z.g(this.ud,Fa).set_maxLuminanceChangeSpeed(this.maxLuminanceChangeSpeed);return a},dispose:function(){this.mb.dispose();Y.prototype.dispose.call(this)},Er:function(a){null!=this.ud&&null!=this.Xa&&this.ud.vn(this.Xa.get_yaw(),this.Xa.get_pitch(),this.Xa.get_hfov(),a.c.Vb(),a.c.Lb())},Sl:function(){var a=this.xc.Gh("layersController");Y.prototype.Sl.call(this);a&&this.rM()},jk:function(){var a=this;null!=
this.mb&&this.mb.dispose();null!=this.source&&(null==this.mb&&(this.mb=new hf("layers",this.scene,this.panoramaHFOV*Y.D,this.panoramaVFOV*Y.D,this.panoramaPitch*Y.D,this.inputFormat,this.outputFormat)),this.$z(this.source).Tj(function(){a.xc.ne("layersController")}))},$z:function(a){var b=this,c=new cc;if(Object.prototype.hasOwnProperty.call(this.source,"resource")){var d=this.source;a=d.resource;null!=d.inputFormat&&this.set_inputFormat(d.inputFormat);null!=d.outputFormat&&this.set_outputFormat(d.outputFormat);
null!=d.maxHFOV&&this.set_maxHFOV(d.maxHFOV);null!=d.minHFOV&&this.set_minHFOV(d.minHFOV);null!=d.initialHFOV&&this.set_hfov(d.initialHFOV);null!=d.panoramaHFOV&&this.set_panoramaHFOV(d.panoramaHFOV);null!=d.panoramaVFOV&&this.set_panoramaVFOV(d.panoramaVFOV);null!=d.panoramaPitch&&this.set_panoramaPitch(d.panoramaPitch)}if("string"==typeof a)if(d=z.g(a,String),-1!=d.indexOf("http://")||-1!=d.indexOf("https://"))(new ge).load(d).Tj(function(a){da.ar(a,function(a){b.mb.eu(a);c.complete(b.mb)})});else{var e=
new Image;e.onload=function(){b.mb.eu(da.Bb(e));c.complete(b.mb)};e.src=a}else if(z.D(a,da))this.mb.eu(z.g(a,da)),c.complete(this.mb);else if(a instanceof Array&&null==a.jb)this.DB(a,c,0);else throw new ja("Source not soported");return c.ic},DB:function(a,b,c){var d=this;c<a.length?this.$z(a[c]).Tj(function(){d.DB(a,b,c+1)}):b.complete(this.mb)},Jo:function(){Y.prototype.Jo.call(this);null!=this.mb&&(this.mb.set_panoramaHFOV(this.panoramaHFOV*Y.D),this.mb.set_panoramaVFOV(this.panoramaVFOV*Y.D),this.mb.set_panoramaPitch(this.panoramaPitch*
Y.D))},zw:function(){null!=this.mb&&this.mb.set_inputFormat(this.inputFormat)},rM:function(){if(null!=this.mb&&0!=this.mb.sl()){var a=null,b;switch(this.panoramaMode){case "hdr":a=Fa;b=[this.mb,this.luminanceLowerLimit,this.luminanceHigherLimit,this.luminanceChangeTime,this.maxLuminanceChangeSpeed];break;case "live":a=Mc,b=[this.mb,this.displayingTime,this.changingTime]}var c;null!=this.ud?(c=this.ud,c=(null==c?null:z.yh(c))!=a):c=!0;c&&(this.ud=ec.al(a,b))}},l:ze,F:S(Y.prototype.F,{set_maxLuminanceChangeSpeed:"set_maxLuminanceChangeSpeed",
set_luminanceChangeTime:"set_luminanceChangeTime",set_luminanceHigherLimit:"set_luminanceHigherLimit",set_luminanceLowerLimit:"set_luminanceLowerLimit",set_changingTime:"set_changingTime",set_displayingTime:"set_displayingTime",set_panoramaMode:"set_panoramaMode",set_source:"set_source"})});var Td=K.CAPTURA.Viewer.VideoPanoramaView=function(a,b,c,d){null==d&&(d="normal");null==c&&(c="spherical");null==b&&(b="erect");Y.call(this,a,b,c,d);this.video=new Pc};n["cc.viewer.panorama.view.VideoPanoramaView"]=
Td;Td.h=["cc","viewer","panorama","view","VideoPanoramaView"];Td.V=Y;Td.prototype=S(Y.prototype,{set_source:function(a){this.source!=a&&(this.source=a,this.xc.ne("data"));return a},dispose:function(){null!=this.ze&&(this.ze.dispose(),this.ze=null);this.video.dispose();Y.prototype.dispose.call(this)},jk:function(){null!=this.ze&&(this.ze.dispose(),this.ze=null);if(Object.prototype.hasOwnProperty.call(this.source,"resource")){var a=this.source;null!=a.inputFormat&&this.set_inputFormat(a.inputFormat);
null!=a.outputFormat&&this.set_outputFormat(a.outputFormat);null!=a.maxHFOV&&this.set_maxHFOV(a.maxHFOV);null!=a.minHFOV&&this.set_minHFOV(a.minHFOV);null!=a.initialHFOV&&this.set_hfov(a.initialHFOV);null!=a.panoramaHFOV&&this.set_panoramaHFOV(a.panoramaHFOV);null!=a.panoramaVFOV&&this.set_panoramaVFOV(a.panoramaVFOV);null!=a.panoramaPitch&&this.set_panoramaPitch(a.panoramaPitch);null!=a.autoplay&&this.video.set_autoplay(a.autoplay);null!=a.muted&&this.video.set_muted(a.muted);this.video.set_source(a.resource)}else this.video.set_source(this.source);
null!=this.source&&(this.ze=new pe("video_layer",this.scene,this.panoramaHFOV*Y.D,this.panoramaVFOV*Y.D,this.panoramaPitch*Y.D,100,this.inputFormat,this.outputFormat),this.ze.bD(this.video))},xu:function(a){Y.prototype.xu.call(this,a);a=Fd.iM();null!=a&&10==a[0]&&(a=new me("ios10fix",this.Xa),this.Xa.Lz(a))},Jo:function(){Y.prototype.Jo.call(this);null!=this.ze&&(this.ze.set_panoramaHFOV(this.panoramaHFOV*Y.D),this.ze.set_panoramaVFOV(this.panoramaVFOV*Y.D),this.ze.set_panoramaPitch(this.panoramaPitch*
Y.D))},zw:function(){null!=this.ze&&this.ze.set_inputFormat(this.inputFormat)},l:Td,F:S(Y.prototype.F,{set_source:"set_source"})});var q=K.BABYLON.Engine=function(a,b,c){null==b&&(b=!1);this.BK=[];this.$n=[];this.ao=[];this.fk=[];this.gk=[];this.ek=[];this.Ev=[];this.ho=[];this.io=[];this.fo=[];this.Bp={x:0,y:0,width:960,height:640};this.rd=[];this.$c=[];this.Jx=[];this.W=new Wa;this.Ud=!1;this.na=[];this.dj=new ea;this.Ay=16;this.rg=[];this.bb=0;this.K=new mf;this.rb=new af;this.H=new nf;this.dl=
0;this.Xq=60;this.Si=[];this.zA=60;this.di=[];this.Lt=!1;this.Kp=0;this.eK=[];this.XG=!1;this.Vi=[];this.Cg=this.oL=!0;this.wr=!1;this.fc=a;var d,e;if(null==a)e=null;else{var f;a.F?f=e=a.F.get_width:f=!1;e=f?a[e]():a.width}null!=e?null==a?d=null:(a.F?e=d=a.F.get_width:e=!1,d=e?a[d]():a.width):d=960;this.Bp.width=d;var g;null==a?g=null:(a.F?d=g=a.F.get_height:d=!1,g=d?a[g]():a.height);if(null!=g){var h;null==a?a=null:(a.F?g=h=a.F.get_height:g=!1,a=g?a[h]():a.height)}else a=640;this.Bp.height=a;null==
c&&(c={});c.antialias=b;null==c.preserveDrawingBuffer&&(c.preserveDrawingBuffer=!1);z.D(this.fc,HTMLCanvasElement)||(this.fc=window.document.getElementsByTagName("canvas")[0]);this.b=z.g(this.fc,HTMLCanvasElement).getContext("webgl",c);null==this.b&&(this.b=z.g(this.fc,HTMLCanvasElement).getContext("experimental-webgl",c));this.hF();b=this.iF();null==c.stencil&&(c.stencil=!0);this.width=this.Bp.width;this.height=this.Bp.height;this.xk=1;this.resize();this.XF=c.stencil;this.U=new of;this.U.PJ=this.b.getParameter(34930);
this.U.co=this.b.getParameter(3379);this.U.LJ=this.b.getParameter(34076);this.U.VO=this.b.getParameter(34024);this.U.GB=this.b.getParameter(34921);try{var k=this.b.getExtension("OES_standard_derivatives");this.U.qw=null!=k;this.U.ew=this.b.getExtension("WEBGL_compressed_texture_s3tc");var l=this.b.getExtension("OES_texture_float");this.U.rD=null!=l;var m=this.b.getExtension("EXT_texture_filter_anisotropic")||this.b.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this.b.getExtension("MOZ_EXT_texture_filter_anisotropic");
this.U.vw=m;this.U.KJ=null!=this.U.vw?this.b.getParameter(this.U.vw.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0;this.U.Jc=this.b.getExtension("ANGLE_instanced_arrays");var u=this.b.getExtension("OES_element_index_uint");this.U.Ql=null!=u;var x=this.b.getExtension("EXT_frag_depth");this.U.jO=null!=x;this.U.gv=!0;if(null!=(hc=this.b,F(hc,hc.getShaderPrecisionFormat))){var v=this.b.getShaderPrecisionFormat(35632,36338);this.U.gv=null!=v&&0!=v.precision}this.U.ZN=this.b.getExtension("WEBGL_draw_buffers");var p=
this.b.getExtension("OES_texture_float_linear");this.U.sD=null!=p;var D=this.b.getExtension("EXT_shader_texture_lod");this.U.dM=null!=D;this.U.dM&&(this.U.eM="GL_EXT_shader_texture_lod",this.U.bM="textureCubeLodEXT");var w=this.b.getExtension("OES_texture_half_float");this.U.KP=null!=w;this.U.cM=this.b.getExtension("OES_texture_half_float_linear");this.U.LP=b}catch(r){r instanceof ja&&(r=r.Lo),console.log(r)}this.H.Pe(!0);this.H.ak(515);this.H.vb(!0);this.wr=!1;this.P=Array(this.Ay)};n["com.babylonhx.Engine"]=
q;q.h=["com","babylonhx","Engine"];q.compileShader=function(a,b,c,d){c=a.createShader("vertex"==c?35633:35632);a.shaderSource(c,(null!=d?d+"\n":"")+b);a.compileShader(c);if(0==a.getShaderParameter(c,35713))throw new ja(a.getShaderInfoLog(c));return c};q.Uc=function(a){return 1==a?5126:2==a?q.ce:5121};q.Ba=function(a,b){var c=9728,d=9728;2==a?(c=9729,d=b?9985:9729):3==a?(c=9729,d=b?9987:9729):1==a&&(c=9728,d=b?9986:9728);return{min:d,Ih:c}};q.prototype={sC:function(a,b,c,d,e,f,g,h,k,l){null==l&&(l=
3);var m=b.c;e=m.U.co;for(var u=1;u*=2,u<c;);u>e&&(u=e);e=u;m=m.U.co;for(u=1;u*=2,u<d;);u>m&&(u=m);m=u;e==c&&m==d||console.log("Texture '"+a.url+"' is not power of two !");u=a.data;this.P[this.J]!=u&&(this.b.bindTexture(3553,u),this.P[this.J]=u);a.pk=c;a.nk=d;a.Ka=e;a.Ua=m;a.pa=!0;h(e|0,m|0);c=q.Ba(l,!f);this.b.texParameteri(3553,10240,c.Ih);this.b.texParameteri(3553,10241,c.min);f||g||this.b.generateMipmap(3553);null!=this.P[this.J]&&(this.b.bindTexture(3553,null),this.P[this.J]=null);this.Lh();
b.tG(a);if(null!=a.qK)for(b=0,a=a.qK;b<a.length;)f=a[b],++b,null!=f&&f();null!=k&&k()},QA:function(){return this.XF},Lh:function(){for(var a=0,b=this.Ay;a<b;)this.P[a++]=null},kl:function(a,b){null==b&&(b=!1);var c=a.viewport;return this.Vb(b)*c.width/(this.Lb(b)*c.height)},Vb:function(a){null==a&&(a=!1);return a||null==this.pg?this.fc.width:this.pg.Ka},Lb:function(a){null==a&&(a=!1);return a||null==this.pg?this.fc.height:this.pg.Ua},mD:function(a){null==a?this.di=[]:(a=this.di.indexOf(a),0<=a&&this.di.splice(a,
1))},Vy:function(){var a=!0;!this.oL&&this.XG&&(a=!1);if(a){this.Si.push(1E3*((new Date).getTime()/1E3-ha.ae)|0);a=this.Si.length;2<=a&&(this.dl=this.Si[a-1]-this.Si[a-2]);if(a>=this.zA){a>this.zA&&(this.Si.splice(0,1),a=this.Si.length);for(var b=0,c=0,d=a-1;c<d;)var e=c++,b=b+(this.Si[e+1]-this.Si[e]);this.Xq=1E3/(b/(a-1))}a=0;for(b=this.di.length;a<b;)this.di[a++]();a=0;for(b=this.eK;a<b.length;)c=b[a],++a,c()}0<this.di.length?window.requestAnimationFrame(F(this,this.Vy)):this.Lt=!1},resize:function(){this.width=
window.navigator.D?window.innerWidth:this.fc.clientWidth;this.height=window.navigator.D?window.innerHeight:this.fc.clientHeight;this.JL(this.width/this.xk|0,this.height/this.xk|0);for(var a=0,b=this.BK;a<b.length;){var c=b[a];++a;c()}},JL:function(a,b){this.fc.width=a;this.fc.height=b;for(var c=0,d=this.Vi.length;c<d;)for(var e=this.Vi[c++],f=0,g=e.kf.length;f<g;)e.kf[f++].sd=0},bindFramebuffer:function(a,b,c,d){null==b&&(b=0);this.pg=a;var e=a.fm;this.tc!=e&&(this.b.bindFramebuffer(36160,e),this.tc=
e);a.rc?this.b.framebufferTexture2D(36160,36064,34069+b,a.data,0):this.b.framebufferTexture2D(36160,36064,3553,a.data,0);this.b.viewport(0,0,null!=c?c:a.Ka,null!=d?d:a.Ua);this.Tl()},BA:function(a){a.qc&&(a=a.data,this.P[this.J]!=a&&(this.b.bindTexture(34067,a),this.P[this.J]=a),this.b.generateMipmap(34067),null!=this.P[this.J]&&(this.b.bindTexture(34067,null),this.P[this.J]=null))},vertexAttribPointer:function(a,b,c,d,e,f,g){var h=this.Jx[b],k=!1;null==h?(k=!0,this.Jx[b]={JO:b,size:c,type:d,OB:e,
Do:f,offset:g,buffer:a}):(h.buffer!=a&&(h.buffer=a,k=!0),h.size!=c&&(h.size=c,k=!0),h.type!=d&&(h.type=d,k=!0),h.OB!=e&&(h.OB=e,k=!0),h.Do!=f&&(h.Do=f,k=!0),h.offset!=g&&(h.offset=g,k=!0));k&&(this.W.get(34962)!=a&&(this.b.bindBuffer(34962,null==a?null:a.buffer),this.W.set(34962,null==a?null:a)),this.b.vertexAttribPointer(b,c,d,e,f,g))},kM:function(){for(var a=null,b=0,c=this.$c.length;b<c;){var d=b++,e=this.rd[d];a!=e&&(a=e,this.W.get(34962)!=e&&(this.b.bindBuffer(34962,null==e?null:e.buffer),this.W.set(34962,
null==e?null:e)));this.U.Jc.vertexAttribDivisorANGLE(this.$c[d],0)}this.rd.splice(0,this.rd.length-1);this.$c.splice(0,this.$c.length-1)},Hc:function(a,b,c,d){null==d&&(d=0);this.H.apply(this.b);this.rb.apply(this.b);this.K.apply(this.b);this.Kp++;var e=this.Ud?5125:5123,f=this.Ud?4:2;0<d?this.U.Jc.drawElementsInstancedANGLE(a?4:1,c,e,b*f,d):this.b.drawElements(a?4:1,c,e,b*f|0)},eI:function(a,b,c){null==c&&(c=-1);this.H.apply(this.b);this.rb.apply(this.b);this.K.apply(this.b);this.Kp++;-1!=c?this.U.Jc.drawArraysInstancedANGLE(0,
a,b,c):this.b.drawArrays(0,a,b)},oA:function(a,b,c,d){null==d&&(d=-1);this.H.apply(this.b);this.rb.apply(this.b);this.K.apply(this.b);this.Kp++;-1!=d?this.U.Jc.drawArraysInstancedANGLE(a?4:1,b,c,d):this.b.drawArrays(a?4:1,b,c)},sG:function(a){var b=a.ty,c=this.dj;if(null!=t[b]?c.Gd(b):c.i.hasOwnProperty(b))this.dj.remove(a.ty),null!=a.xd&&this.b.deleteProgram(a.xd)},Aj:function(a,b,c,d,e,f,g,h,k){var l=(null!=a.JM?a.JM:null!=a.vertex?a.vertex:a)+"+"+(null!=a.Yq?a.Yq:null!=a.fragment?a.fragment:a)+
"@"+e,m=this.dj;if(null!=t[l]?m.Gd(l):m.i.hasOwnProperty(l))return a=this.dj,null!=t[l]?a.I(l):a.i[l];a=new pf(a,b,c,d,this,e,f,g,h,k);a.ty=l;b=this.dj;null!=t[l]?b.C(l,a):b.i[l]=a;return a},aA:function(a,b,c){a=q.compileShader(this.b,a,"vertex",c);b=q.compileShader(this.b,b,"fragment",c);c=this.b.createProgram();this.b.attachShader(c,a);this.b.attachShader(c,b);this.b.linkProgram(c);if(0==this.b.getProgramParameter(c,35714)){var d=this.b.getProgramInfoLog(c);if(""!=d)throw new ja(d);}this.b.deleteShader(a);
this.b.deleteShader(b);return c},Tb:function(a,b,c,d,e){this.b.uniform4f(a,b,c,d,e)},Tl:function(){this.Lh();this.Cf=null;var a=this.rb;a.Qk=!1;a.dn=255;a.cn=519;a.qq=1;a.lz=255;a.oz=7680;a.mz=7680;a.nz=7681;a.ym=!0;a.xm=!0;a.Bk=!0;a.Wp=!0;this.H.reset();this.H.ak(515);this.K.reset();this.Pb=this.kb=this.qb=null},VH:function(a,b,c,d){null==d&&(d=3);var e=this,f=new nc("from_image",this.b.createTexture());c.qp(f);f.url="from_image";f.Cr=b;f.ia=1;f.jd=d;this.rg.push(f);this.sC(f,c,a.width,a.height,
!1,b,!1,function(b,c){e.b.texImage2D(3553,0,6408,b,c,0,6408,5121,a.data)},null,d);return f},createTexture:function(a,b,c,d,e,f,g,h){null==e&&(e=3);var k=this,l=new nc(a,this.b.createTexture()),m="";g=null;"data:"==Z.substr(a,0,5)&&(g=!0);null==g?m=Z.substr(a,a.length-4,4).toLowerCase():(g=a.split(":"),m=g[1].substr(g[1].length-4,4).toLowerCase());var u=this.U.ew&&".dds"==m;d.qp(l);l.url=a;l.Cr=b;l.ia=1;l.jd=e;this.rg.push(l);".tga"==m||u||(m=function(a){k.sC(l,d,a.width,a.height,c,b,!1,function(b,
c){k.b.texImage2D(3553,0,6408,b,c,0,6408,5121,a.data);null!=f&&f()},null,e)},g instanceof Array&&null==g.jb?ha.Mi(h,m):ha.Mi(a,m));return l},yM:function(a,b,c){a.Ka=b;a.Ua=c;a.Db=b*c;a.pk=b;a.nk=c},Oq:function(a,b,c,d,e,f,g,h){null==h&&(h="");f=new nc("",this.b.createTexture());f.pk=b;f.nk=c;f.Ka=b;f.Ua=c;f.qc=e;f.jd=g;f.ia=1;b=this.Xx(d);c=f.data;this.P[this.J]!=c&&(this.b.bindTexture(3553,c),this.P[this.J]=c);0!=f.Ka%4&&this.b.pixelStorei(3317,1);if(""!=h){b=this.b;c=this.U.ew;var k;null==c?h=null:
(c.F?d=k=c.F["get_"+h]:d=!1,h=d?c[k]():c[h]);b.compressedTexImage2D(3553,0,h,f.Ka,f.Ua,0,a)}else this.b.texImage2D(3553,0,b,f.Ka,f.Ua,0,b,5121,a);a=q.Ba(f.jd,f.qc);this.b.texParameteri(3553,10240,a.Ih);this.b.texParameteri(3553,10241,a.min);f.qc&&this.b.generateMipmap(3553);null!=this.P[this.J]&&(this.b.bindTexture(3553,null),this.P[this.J]=null);this.Lh();f.pa=!0;this.rg.push(f);return f},Xx:function(a){var b=6408;switch(a){case 0:b=6406;break;case 1:b=6409;break;case 2:b=6410;break;case 4:b=6407;
break;case 5:b=6408}return b},OH:function(a,b,c,d){var e=new nc("",this.b.createTexture());e.pk=a;e.nk=b;if(c){for(var f=this.U.co,g=1;g*=2,g<a;);g>f&&(g=f);a=g;f=this.U.co;for(g=1;g*=2,g<b;);g>f&&(g=f);b=g}this.Lh();e.Ka=a;e.Ua=b;e.pa=!1;e.qc=c;e.ia=1;e.jd=d;a=q.Ba(d,e.qc);e.rc?(b=e.data,this.P[this.J]!=b&&(this.b.bindTexture(34067,b),this.P[this.J]=b),this.b.texParameteri(34067,10240,a.Ih),this.b.texParameteri(34067,10241,a.min),null!=this.P[this.J]&&(this.b.bindTexture(34067,null),this.P[this.J]=
null)):(b=e.data,this.P[this.J]!=b&&(this.b.bindTexture(3553,b),this.P[this.J]=b),this.b.texParameteri(3553,10240,a.Ih),this.b.texParameteri(3553,10241,a.min),null!=this.P[this.J]&&(this.b.bindTexture(3553,null),this.P[this.J]=null));this.rg.push(e);return e},ED:function(a,b,c){if(!a.oy){var d=a.data;this.P[this.J]!=d&&(this.b.bindTexture(3553,d),this.P[this.J]=d);this.b.pixelStorei(37440,c?0:1);try{null==this.xz&&(this.b.texImage2D(3553,0,6408,6408,5121,b),this.xz=0!=this.b.getError()?!1:!0),this.xz?
this.b.texImage2D(3553,0,6408,6408,5121,z.g(b,HTMLVideoElement)):(null==a.vi&&(a.vi=z.g(window.document.createElement("canvas"),HTMLCanvasElement),a.YG=a.vi.getContext("2d"),a.vi.width=a.Ka,a.vi.height=a.Ua),a.YG.drawImage(b,0,0,b.videoWidth,b.videoHeight,0,0,a.Ka,a.Ua),this.b.texImage2D(3553,0,6408,6408,5121,a.vi)),a.qc&&this.b.generateMipmap(3553),null!=this.P[this.J]&&(this.b.bindTexture(3553,null),this.P[this.J]=null),this.Lh(),a.pa=!0}catch(e){a.oy=!0}}},zu:function(a,b){var c=!1,d=!0,e=!1,f=
0,g=3;null!=b&&(c=null!=b.qc?b.qc:b,null!=b.il?d=b.il:d=!0,e=null!=b.jl?b.jl:d,null==b.type?f=0:f=b.type,null!=b.jd&&(g=b.jd),1!=f||this.U.sD?2!=f||this.U.cM||(g=1):g=1);var h=new nc("",this.b.createTexture()),k=h.data;this.P[this.J]!=k&&(this.b.bindTexture(3553,k),this.P[this.J]=k);var k=null!=a.width?a.width:a,l=null!=a.height?a.height:a,m=q.Ba(g,c);1!=f||this.U.rD||(f=0,console.log("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type"));this.b.texParameteri(3553,
10240,m.Ih);this.b.texParameteri(3553,10241,m.min);this.b.texParameteri(3553,10242,33071);this.b.texParameteri(3553,10243,33071);this.b.texImage2D(3553,0,6408,k,l,0,6408,q.Uc(f),null);m=null;e?(m=this.b.createRenderbuffer(),this.b.bindRenderbuffer(36161,m),this.b.renderbufferStorage(36161,34041,k,l)):d&&(m=this.b.createRenderbuffer(),this.b.bindRenderbuffer(36161,m),this.b.renderbufferStorage(36161,33189,k,l));var u=this.b.createFramebuffer();this.tc!=u&&(this.b.bindFramebuffer(36160,u),this.tc=u);
e?this.b.framebufferRenderbuffer(36160,33306,36161,m):d&&this.b.framebufferRenderbuffer(36160,36096,36161,m);this.b.framebufferTexture2D(36160,36064,3553,h.data,0);c&&this.b.generateMipmap(3553);null!=this.P[this.J]&&(this.b.bindTexture(3553,null),this.P[this.J]=null);this.b.bindRenderbuffer(36161,null);null!=this.tc&&(this.b.bindFramebuffer(36160,null),this.tc=null);h.fm=u;d&&(h.Ep=m);h.pk=k;h.nk=l;h.Ka=k;h.Ua=l;h.pa=!0;h.qc=c;h.ia=1;h.jd=g;h.type=f;this.Lh();this.rg.push(h);return h},TH:function(a,
b){var c=new nc("",this.b.createTexture()),d=!0,e=!0,f=!1,g=3;null!=b&&(d=null==b.qc?b:b.qc,null==b.il?e=!0:e=b.il,f=null!=b.jl?b.jl:e,null!=b.jd&&(g=b.jd));c.rc=!0;c.qc=d;c.ia=1;c.jd=g;d=q.Ba(g,d);g=c.data;this.P[this.J]!=g&&(this.b.bindTexture(34067,g),this.P[this.J]=g);for(g=0;6>g;)this.b.texImage2D(34069+g++,0,6408,a.width,a.height,0,6408,5121,null);this.b.texParameteri(34067,10240,d.Ih);this.b.texParameteri(34067,10241,d.min);this.b.texParameteri(34067,10242,33071);this.b.texParameteri(34067,
10243,33071);d=null;f?(d=this.b.createRenderbuffer(),this.b.bindRenderbuffer(36161,d),this.b.renderbufferStorage(36161,34041,a.width,a.height)):e&&(d=this.b.createRenderbuffer(),this.b.bindRenderbuffer(36161,d),this.b.renderbufferStorage(36161,33189,a.width,a.height));g=this.b.createFramebuffer();this.tc!=g&&(this.b.bindFramebuffer(36160,g),this.tc=g);f?this.b.framebufferRenderbuffer(36160,33306,36161,d):e&&this.b.framebufferRenderbuffer(36160,36096,36161,d);c.qc&&(f=c.data,this.P[this.J]!=f&&(this.b.bindTexture(34067,
f),this.P[this.J]=f),this.b.generateMipmap(34067));null!=this.P[this.J]&&(this.b.bindTexture(34067,null),this.P[this.J]=null);this.b.bindRenderbuffer(36161,null);null!=this.tc&&(this.b.bindFramebuffer(36160,null),this.tc=null);c.fm=g;e&&(c.Ep=d);c.Ka=a.width;c.Ua=a.height;c.pa=!0;this.Lh();this.rg.push(c);return c},Zz:function(a,b,c,d){null==d&&(d=!1);var e=this,f=new nc(a,this.b.createTexture());f.rc=!0;f.url=a;f.ia=1;a=Z.substr(a,a.length-4,4).toLowerCase();if(!this.U.ew||".dds"!=a){var g=[34069,
34071,34073,34070,34072,34074],h=[],k=0,l=null,l=function(){ha.Mi(c[k],function(a){h.push(a);if((k+=1)==c.length){a=h[0].width;for(var b=e.U.LJ,x=1;x*=2,x<a;);x>b&&(x=b);a=x;b=f.data;e.P[e.J]!=b&&(e.b.bindTexture(34067,b),e.P[e.J]=b);b=0;for(x=g.length;b<x;){var v=b++,p=h[v];e.vi=p;e.b.texImage2D(g[v],0,6408,e.vi.width,e.vi.height,0,6408,5121,p.data)}d||e.b.generateMipmap(34067);e.b.texParameteri(34067,10240,9729);e.b.texParameteri(34067,10241,d?9729:9987);e.b.texParameteri(34067,10242,33071);e.b.texParameteri(34067,
10243,33071);null!=e.P[e.J]&&(e.b.bindTexture(34067,null),e.P[e.J]=null);e.Lh();f.Ka=a;f.Ua=a;f.pa=!0}else l()})};l()}return f},It:function(a){null!=a.fm&&this.b.deleteFramebuffer(a.fm);null!=a.Ep&&this.b.deleteRenderbuffer(a.Ep);this.b.deleteTexture(a.data);this.jM();a=this.rg.indexOf(a);-1!=a&&this.rg.splice(a,1)},jM:function(){for(var a=0,b=this.U.PJ;a<b;){var c=33984+a++;this.J!=c-33984&&(this.b.activeTexture(c),this.J=c-33984);null!=this.P[this.J]&&(this.b.bindTexture(3553,null),this.P[this.J]=
null);null!=this.P[this.J]&&(this.b.bindTexture(34067,null),this.P[this.J]=null)}},Hb:function(a,b,c){0>a||(this.b.uniform1i(b,a),this.DG(a,c))},DG:function(a,b){if(null!=b&&b.pa()){var c=!1;if(z.D(b,Jd)){var d=33984+a;this.J!=d-33984&&(this.b.activeTexture(d),this.J=d-33984);c=!0;z.g(b,Jd).update()}else if(4==b.La){b.Rq();return}d=b.ga;if(this.P[a]!=d.data)if(c||(c=33984+a,this.J!=c-33984&&(this.b.activeTexture(c),this.J=c-33984)),d.rc)c=d.data,this.P[this.J]!=c&&(this.b.bindTexture(34067,c),this.P[this.J]=
c),d.yp!=b.Cd&&(d.yp=b.Cd,d=3!=b.Cd&&5!=b.Cd?10497:33071,this.b.texParameteri(34067,10242,d),this.b.texParameteri(34067,10243,d)),this.gz(34067,b);else{c=d.data;this.P[this.J]!=c&&(this.b.bindTexture(3553,c),this.P[this.J]=c);if(d.ux!=b.hg)switch(d.ux=b.hg,b.hg){case 0:this.b.texParameteri(3553,10242,33071);break;case 1:this.b.texParameteri(3553,10242,10497);break;case 2:this.b.texParameteri(3553,10242,33648)}if(d.vx!=b.ig)switch(d.vx=b.ig,b.ig){case 0:this.b.texParameteri(3553,10243,33071);break;
case 1:this.b.texParameteri(3553,10243,10497);break;case 2:this.b.texParameteri(3553,10243,33648)}this.gz(3553,b)}}else null!=this.P[a]&&(d=33984+a,this.J!=d-33984&&(this.b.activeTexture(d),this.J=d-33984),null!=this.P[this.J]&&(this.b.bindTexture(3553,null),this.P[this.J]=null),null!=this.P[this.J]&&(this.b.bindTexture(34067,null),this.P[this.J]=null))},gz:function(a,b){var c=this.U.vw,d=b.Bq;1==b.ga.jd&&(d=1);null!=c&&b.bF!=d&&(this.b.texParameterf(a,c.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(b.Bq,this.U.KJ)),
b.bF=d)},dispose:function(){for(this.mD();0<this.Vi.length;)this.Vi[0].dispose(),this.Vi[0]=null,this.Vi.shift();for(var a=this.dj.keys();a.Ca();){var b=a.next(),c=this.dj;this.b.deleteProgram((null!=t[b]?c.I(b):c.i[b]).xd)}a=0;for(b=this.na.length;a<b;)c=a++,c>=this.U.GB||!this.na[c]||this.b.disableVertexAttribArray(c)},hF:function(){return this.xx(1,"OES_texture_float")},iF:function(){return this.xx(2,"OES_texture_half_float")},xx:function(a,b){function c(){d.b.deleteProgram(e);d.b.disableVertexAttribArray(f);
d.b.deleteBuffer(h);d.b.deleteFramebuffer(m);d.b.deleteTexture(k);d.b.deleteTexture(l)}var d=this;if(null==this.b.getExtension(b))return!1;var e=this.aA("attribute vec4 a_position;\nvoid main() {\n\tgl_Position = a_position;\n}","precision mediump float;\nuniform vec4 u_color;\nuniform sampler2D u_texture;\nvoid main() {\n\tgl_FragColor = texture2D(u_texture, vec2(0.5, 0.5)) * u_color;\n}",null);this.b.useProgram(e);var f=this.b.getAttribLocation(e,"a_position"),g=this.b.getUniformLocation(e,"u_color"),
h=this.b.createBuffer();this.b.bindBuffer(34962,h);this.b.bufferData(34962,new vb([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),35044);this.b.enableVertexAttribArray(f);this.b.vertexAttribPointer(f,2,5126,!1,0,0);var k=this.b.createTexture();this.b.bindTexture(3553,k);this.b.texImage2D(3553,0,6408,1,1,0,6408,5121,new hb([255,255,255,255]));var l=this.b.createTexture();this.b.bindTexture(3553,l);this.b.texImage2D(3553,0,6408,1,1,0,6408,q.Uc(a),null);this.b.texParameteri(3553,10241,9728);this.b.texParameteri(3553,
10240,9728);var m=this.b.createFramebuffer();this.b.bindFramebuffer(36160,m);this.b.framebufferTexture2D(36160,36064,3553,l,0);if(36053!=this.b.checkFramebufferStatus(36160))return console.log("GL Support: can **NOT** render to "+a+" texture"),c(),!1;this.b.bindTexture(3553,k);this.b.uniform4fv(g,new vb([0,10,20,1]));this.b.drawArrays(4,0,6);this.b.bindTexture(3553,l);this.b.bindFramebuffer(36160,null);this.b.clearColor(1,0,0,1);this.b.clear(16384);this.b.uniform4fv(g,new vb([0,.1,.05,1]));this.b.drawArrays(4,
0,6);g=new hb(4);this.b.readPixels(0,0,1,1,6408,5121,g);if(0!=g[0]||248>g[1]||248>g[2]||254>g[3])return console.log("GL Support: Was not able to actually render to "+a+" texture"),c(),!1;c();return!0},l:q,F:{QA:"get_isStencilEnable"}};var of=K.BABYLON.EngineCapabilities=function(){this.bM="textureCubeLodEXT";this.eM=""};n["com.babylonhx.EngineCapabilities"]=of;of.h=["com","babylonhx","EngineCapabilities"];of.prototype={l:of};var Ae=K.BABYLON.IDisposable=function(){};n["com.babylonhx.IDisposable"]=
Ae;Ae.h=["com","babylonhx","IDisposable"];Ae.prototype={l:Ae};n["com.babylonhx.NodeCache"]=ff;ff.h=["com","babylonhx","NodeCache"];ff.prototype={l:ff};n["com.babylonhx.PointerEventTypes"]=Cb;Cb.h=["com","babylonhx","PointerEventTypes"];n["com.babylonhx.PointerInfo"]=Ad;Ad.h=["com","babylonhx","PointerInfo"];Ad.prototype={l:Ad};n["com.babylonhx.PointerInfoPre"]=Bc;Bc.h=["com","babylonhx","PointerInfoPre"];Bc.prototype={l:Bc};n["com.babylonhx.RenderingGroupInfo"]=ef;ef.h=["com","babylonhx","RenderingGroupInfo"];
ef.prototype={l:ef};var Ma=K.BABYLON.Scene=function(a){this.Zt=0;this.Op=new Ja(16);var b=new r;b.a[0]=0;b.a[1]=0;b.a[2]=0;b.a[3]=0;b.a[4]=0;b.a[5]=0;b.a[6]=0;b.a[7]=0;b.a[8]=0;b.a[9]=0;b.a[10]=0;b.a[11]=0;b.a[12]=0;b.a[13]=0;b.a[14]=0;b.a[15]=0;this.sb=b;this.Ve=[];this.bx=0;this.mq=new Ja(32);this.dx=new Ja(32);this.Xl=new Ja(256);this.ff=new Ja(256);this.Ft=new Ja(256);this.Ug=new Ja(256);this.wt=[];this.jn=new Ja(256);this.mm=!1;this.Pa=0;this.Bs=-1;this.yg=this.op=this.cx=this.fx=0;this.jD=[];
this.gq=[];this.VK=!0;this.cq=new Ja(256);this.ax=[];this.GD=!1;this.Bu=[];this.pA=!1;this.rC=this.Mr=!0;this.Tn=new p(0,-9,0);this.Bz=!1;this.uu=!0;this.vB=[];this.xB=!0;this.Yr=[];this.ow=!0;this.rf=[];this.Ig=[];this.dg=[];this.lD=!0;this.Ne=[];this.lC=!0;this.Ol=[];this.tD=!0;this.KB=[];this.vf=[];this.wk=[];this.Xb=[];this.rn=[];this.kf=[];this.jc=[];this.Xr=this.zB=!0;this.xA=1E3;this.yA=0;this.wA=.1;this.vA=new Q(.2,.2,.3);this.Ej=Ma.g;this.nf=!0;this.bn=0;this.ti=new W(0,0);this.Pc=null;this.Pi=
new U;this.Al=new U;this.Ya=[];this.dC=new U;this.rK=new U;this.vK=new U;this.nK=new U;this.tK=new U;this.pK=new U;this.uK=new U;this.$B=new U;this.cC=new U;this.dK=new U;this.fK=new U;this.Kc=new U;this.sc=new U;this.Nb=new U;this.LH=this.Hw=!1;this.Iz=!0;this.Nu=this.Mu=this.wI=!1;this.sn=new Q(0,0,0);this.clearColor=new Q(.2,.2,.3);this.Cq=!0;this.c=a;a.Vi.push(this);this.pj=new Be(this);this.El=new qf(this);this.TK=new rf;this.Zl=new sf(this);this.tt=new tf(this);this.attachControl();new uf(this,
{UO:!0});this.gD=new vf;this.dD(!1);Object.defineProperty(this,"pointerX",{get:this.Pn});Object.defineProperty(this,"pointerY",{get:this.Qn});this.Qq=new V("default material",this)};n["com.babylonhx.Scene"]=Ma;Ma.h=["com","babylonhx","Scene"];Ma.xb=[lc];Ma.prototype={UC:function(a){null!=this.Gy&&this.sc.remove(this.Gy);this.Gy=this.sc.add(a);return a},RC:function(a){null!=this.Fy&&this.Kc.remove(this.Fy);this.Fy=this.Kc.add(a);return a},dD:function(a){this.Bz=a;null!=this.An&&this.An.destroy();this.An=
new Ce;this.An.Wn(this);return a},nr:function(){return this.Bz},Xu:function(){return this.fz},kr:function(){return this.BN},Pn:function(){return this.vd},Qn:function(){return this.wd},attachControl:function(){function a(a){return a.vr&&null!=a.ka?a.ka.Zu():!1}var b=this;this.vg=function(c,d){b.vd=c;b.wd=d;b.gf=b.vd;b.hf=b.wd;null!=b.Pc&&(b.vd-=(b.Pc.viewport.x|0)*b.c.Vb(),b.wd-=(b.Pc.viewport.y|0)*b.c.Lb());if(b.Al.Dh()){var e=Cb.iB,f=new Bc(e,{x:c,y:d,button:null},b.gf,b.hf);b.Al.la(f,e);if(f.pw)return}if(null!=
b.Pc||null!=b.M){null==b.pC&&(b.pC=function(a){return a.Bi()&&a.gd&&a.pa()?b.LH?!0:null!=a.ka?null!=a.ka:!1:!1});var g=b.gf,h=b.hf,k=b.Pc,e=b.nm(function(a){return b.Nq(g,h,a,k)},b.pC,!1);e.sf&&null!=e.hb?(b.gw(null),b.QC(e.hb)):(b.QC(null),e=b.Pc,f=b.yu(b.gf,b.hf,e),e=b.et(f,a,!1,e),e.sf&&null!=e.Yb?b.gw(e.Yb):b.gw(null));null!=b.xK&&b.xK(c,d,e);b.Pi.Dh()&&(e=Cb.iB,b.Pi.la(new Ad(e,{x:c,y:d,button:null}),e))}};this.df=function(c,d,e){b.vd=c;b.wd=d;b.gf=b.vd;b.hf=b.wd;null!=b.Pc&&(b.vd-=(b.Pc.viewport.x|
0)*b.c.Vb(),b.wd-=(b.Pc.viewport.y|0)*b.c.Lb());if(b.Al.Dh()){var f=Cb.hB,g=new Bc(f,{x:c,y:d,button:e},b.gf,b.hf);b.Al.la(g,f);if(g.pw)return}if(null!=b.Pc||null!=b.M){b.ti.x=b.vd;b.ti.y=b.wd;b.bn=1E3*((new Date).getTime()/1E3-ha.ae)|0;null==b.oC&&(b.oC=function(a){return a.Bi()&&a.gd?a.pa():!1});b.oi=null;var h=b.gf,k=b.hf,l=b.Pc,f=b.nm(function(a){return b.Nq(h,k,a,l)},b.oC,!1);if(f.sf&&null!=f.hb&&null!=f.hb.ka){b.oi=f.hb;if(f.hb.ka.Zu()){switch(e){case 0:f.hb.ka.dc(2,ma.g(f.hb));break;case 1:f.hb.ka.dc(4,
ma.g(f.hb));break;case 2:f.hb.ka.dc(3,ma.g(f.hb));break;default:f.hb.ka.dc(2,ma.g(f.hb))}null!=f.hb.ka&&f.hb.ka.dc(1,ma.g(f.hb))}null!=f.hb.ka&&f.hb.ka.ev(7)&&ha.xh(function(){var a=b.gf,c=b.hf,d=b.Pc,e=b.nm(function(e){return b.Nq(a,c,e,d)},function(a){return a.Bi()&&a.gd&&a.pa()&&null!=a.ka?a.ka.ev(7):!1},!1);e.sf&&null!=e.hb&&null!=e.hb.ka&&0!=b.bn&&500<(1E3*((new Date).getTime()/1E3-ha.ae)|0)-b.bn&&10>Math.abs(b.ti.x-b.vd)&&10>Math.abs(b.ti.y-b.wd)&&(b.bn=0,e.hb.ka.dc(7,ma.g(e.hb)))},500)}null!=
b.wK&&b.wK(c,d,e,f);b.Pi.Dh()&&(f=Cb.hB,b.Pi.la(new Ad(f,{x:c,y:d,button:e}),f));b.Ik=null;if(0<b.dg.length&&(c=b.Pc,d=b.yu(b.gf,b.hf,c),f=b.et(d,a,!1,c),f.sf&&null!=f.Yb&&null!=f.Yb.ka)){b.Ik=f.Yb;switch(e){case 0:f.Yb.ka.dc(2,ma.D(f.Yb,b));break;case 1:f.Yb.ka.dc(4,ma.D(f.Yb,b));break;case 2:f.Yb.ka.dc(3,ma.D(f.Yb,b));break;default:f.Yb.ka.dc(2,ma.D(f.Yb,b))}null!=f.Yb.ka&&f.Yb.ka.dc(1,ma.D(f.Yb,b))}}};this.ef=function(c,d,e){b.vd=c;b.wd=d;b.gf=b.vd;b.hf=b.wd;null!=b.Pc&&(b.vd-=(b.Pc.viewport.x|
0)*b.c.Vb(),b.wd-=(b.Pc.viewport.y|0)*b.c.Lb());if(b.Al.Dh()){var f=Cb.rB,g=new Bc(f,{x:c,y:d,button:e},b.gf,b.hf);b.Al.la(g,f);if(g.pw)return}if(null!=b.Pc||null!=b.M){null==b.qC&&(b.qC=function(a){return a.Bi()&&a.gd?a.pa():!1});var h=b.gf,k=b.hf,l=b.Pc,f=b.nm(function(a){return b.Nq(h,k,a,l)},b.qC,!1);f.sf&&null!=f.hb&&(null!=b.oi&&f.hb==b.oi&&(null!=b.yK&&b.yK(f),b.Pi.Dh()&&(g=Cb.DE,b.Pi.la(new Ad(g,{x:c,y:d,button:e}),g))),null!=f.hb.ka&&(f.hb.ka.dc(6,ma.g(f.hb)),null!=f.hb.ka&&10>Math.abs(b.ti.x-
b.vd)&&10>Math.abs(b.ti.y-b.wd)&&f.hb.ka.dc(1,ma.g(f.hb))));null!=b.oi&&null!=b.oi.ka&&b.oi!=f.hb&&b.oi.ka.dc(15,ma.g(b.oi));null!=b.zK&&b.zK(c,d,e,f);b.Pi.Dh()&&(f=Cb.rB,b.Pi.la(new Ad(f,{x:c,y:d,button:e}),f));b.bn=0;0<b.dg.length&&(c=b.Pc,d=b.yu(b.gf,b.hf,c),f=b.et(d,a,!1,c),f.sf&&null!=f.Yb&&null!=f.Yb.ka&&(f.Yb.ka.dc(6,ma.D(f.Yb,b)),null!=f.Yb.ka&&10>Math.abs(b.ti.x-b.vd)&&10>Math.abs(b.ti.y-b.wd)&&f.Yb.ka.dc(1,ma.D(f.Yb,b))),null!=b.Ik&&null!=b.Ik.ka&&b.Ik!=f.Yb&&b.Ik.ka.dc(15,ma.D(b.Ik,b)))}};
this.fh=function(a){null!=b.ka&&b.ka.dc(13,ma.da(b,a))};this.gh=function(a){null!=b.ka&&b.ka.dc(14,ma.da(b,a))};this.c.ek.push(this.df);this.c.gk.push(this.ef);this.c.fk.push(this.vg);this.c.fo.push(this.df);this.c.io.push(this.ef);this.c.ho.push(this.vg);this.c.$n.push(this.fh);this.c.ao.push(this.gh)},le:function(){Z.remove(this.c.ek,this.df);Z.remove(this.c.gk,this.ef);Z.remove(this.c.fk,this.vg);Z.remove(this.c.fo,this.df);Z.remove(this.c.io,this.ef);Z.remove(this.c.ho,this.vg);Z.remove(this.c.$n,
this.fh);Z.remove(this.c.ao,this.gh)},Vv:function(a){this.sc.add(a)},AD:function(a){this.sc.gL(a)},qp:function(a){this.wt.push(a)},tG:function(a){Z.remove(this.wt,a)},Eq:function(a,b,c,d,e,f,g){null==e&&(e=1);null==d&&(d=!1);this.Ml(a);null==g&&(g=new wf(this,a,b,c,d,e,f));null!=a.Ya&&g.Jz(a,a.Ya);if(null!=a.DI){a=a.DI();for(var h=0,k=a.length;h<k;)this.Eq(a[h++],b,c,d,e,f,g)}g.reset();return g},CI:function(a){for(var b=0,c=this.Ve.length;b<c;){var d=b++;if(this.Ve[d].target==a)return this.Ve[d]}return null},
Ml:function(a,b){var c=this.CI(a);null!=c&&c.stop(b)},As:function(){if(this.Iz&&0!=this.Ve.length){if(-1==this.Bs){if(0<this.wt.length)return;this.Bs=1E3*((new Date).getTime()/1E3-ha.ae)|0}for(var a=(1E3*((new Date).getTime()/1E3-ha.ae)|0)-this.Bs,b=0,c=this.Ve.length;b<c;){var d=b++;null!=this.Ve[d]&&this.Ve[d].As(a)}}},fu:function(a){a.fg=this.Zt++;this.Xb.push(a);this.vK.la(a)},Wv:function(a){var b=this.Xb.indexOf(a);-1!=b&&this.Xb.splice(b,1);this.rK.la(a);return b},lL:function(a){var b=this.jc.indexOf(a);
-1!=b&&this.jc.splice(b,1);this.pK.la(a);return b},hL:function(a){var b=this.kf.indexOf(a);-1!=b&&this.kf.splice(b,1);b=this.rn.indexOf(a);-1!=b&&this.rn.splice(b,1);this.M==a&&(0<this.kf.length?this.M=this.kf[0]:this.M=null);this.$B.la(a);return b},fH:function(a){a.fg=this.Zt++;this.jc.push(a);this.uK.la(a)},dH:function(a){a.fg=this.Zt++;this.kf.push(a);this.cC.la(a)},EA:function(a){for(var b=0,c=this.vf.length;b<c;){var d=b++;if(this.vf[d].id==a)return this.vf[d]}return null},DA:function(a){for(var b=
0,c=this.wk.length;b<c;){var d=b++;if(this.wk[d].id==a)return this.wk[d]}return null},YK:function(a,b){null==b&&(b=!1);if(!b&&null!=this.DA(a.id))return!1;this.wk.push(a);this.tK.la(a);return!0},jL:function(a){var b=this.wk.indexOf(a);return-1<b?(this.wk.splice(b,1),this.nK.la(a),!0):!1},Su:function(a){for(var b=0,c=this.Xb.length;b<c;){var d=b++;if(this.Xb[d].id==a)return this.Xb[d]}return null},HI:function(a){for(var b=this.Xb.length-1;0<=b;){if(this.Xb[b].id==a)return this.Xb[b];--b}return null},
II:function(a){for(var b=this.Yr.length-1;0<=b;){if(this.Yr[b].id==a)return this.Yr[b];--b}return null},EF:function(){var a=this.M.Ug;a.length=0;a.Ja++;a=this.Ug;a.length=0;a.Ja++;this.pj.reset();a=this.Ft;a.length=0;a.Ja++;a=this.Xl;a.length=0;a.Ja++;a=this.dx;a.length=0;a.Ja++;a=this.mq;a.length=0;a.Ja++;this.Zl.reset();a=this.Op;a.length=0;a.Ja++;if(null==this.gj){for(var b=this.sb,a=[],c=0;6>c;)c++,a.push(new cd(0,0,0,0));a[0].j.x=b.a[3]+b.a[2];a[0].j.y=b.a[7]+b.a[6];a[0].j.z=b.a[11]+b.a[10];
a[0].d=b.a[15]+b.a[14];var c=a[0],d=Math.sqrt(c.j.x*c.j.x+c.j.y*c.j.y+c.j.z*c.j.z),e=0;0!=d&&(e=1/d);c.j.x*=e;c.j.y*=e;c.j.z*=e;c.d*=e;a[1].j.x=b.a[3]-b.a[2];a[1].j.y=b.a[7]-b.a[6];a[1].j.z=b.a[11]-b.a[10];a[1].d=b.a[15]-b.a[14];c=a[1];d=Math.sqrt(c.j.x*c.j.x+c.j.y*c.j.y+c.j.z*c.j.z);e=0;0!=d&&(e=1/d);c.j.x*=e;c.j.y*=e;c.j.z*=e;c.d*=e;a[2].j.x=b.a[3]+b.a[0];a[2].j.y=b.a[7]+b.a[4];a[2].j.z=b.a[11]+b.a[8];a[2].d=b.a[15]+b.a[12];c=a[2];d=Math.sqrt(c.j.x*c.j.x+c.j.y*c.j.y+c.j.z*c.j.z);e=0;0!=d&&(e=1/
d);c.j.x*=e;c.j.y*=e;c.j.z*=e;c.d*=e;a[3].j.x=b.a[3]-b.a[0];a[3].j.y=b.a[7]-b.a[4];a[3].j.z=b.a[11]-b.a[8];a[3].d=b.a[15]-b.a[12];c=a[3];d=Math.sqrt(c.j.x*c.j.x+c.j.y*c.j.y+c.j.z*c.j.z);e=0;0!=d&&(e=1/d);c.j.x*=e;c.j.y*=e;c.j.z*=e;c.d*=e;a[4].j.x=b.a[3]-b.a[1];a[4].j.y=b.a[7]-b.a[5];a[4].j.z=b.a[11]-b.a[9];a[4].d=b.a[15]-b.a[13];c=a[4];d=Math.sqrt(c.j.x*c.j.x+c.j.y*c.j.y+c.j.z*c.j.z);e=0;0!=d&&(e=1/d);c.j.x*=e;c.j.y*=e;c.j.z*=e;c.d*=e;a[5].j.x=b.a[3]+b.a[1];a[5].j.y=b.a[7]+b.a[5];a[5].j.z=b.a[11]+
b.a[9];a[5].d=b.a[15]+b.a[13];b=a[5];c=Math.sqrt(b.j.x*b.j.x+b.j.y*b.j.y+b.j.z*b.j.z);d=0;0!=c&&(d=1/c);b.j.x*=d;b.j.y*=d;b.j.z*=d;b.d*=d;this.gj=a}else a=this.sb,b=this.gj,b[0].j.x=a.a[3]+a.a[2],b[0].j.y=a.a[7]+a.a[6],b[0].j.z=a.a[11]+a.a[10],b[0].d=a.a[15]+a.a[14],c=b[0],d=Math.sqrt(c.j.x*c.j.x+c.j.y*c.j.y+c.j.z*c.j.z),e=0,0!=d&&(e=1/d),c.j.x*=e,c.j.y*=e,c.j.z*=e,c.d*=e,b[1].j.x=a.a[3]-a.a[2],b[1].j.y=a.a[7]-a.a[6],b[1].j.z=a.a[11]-a.a[10],b[1].d=a.a[15]-a.a[14],c=b[1],d=Math.sqrt(c.j.x*c.j.x+c.j.y*
c.j.y+c.j.z*c.j.z),e=0,0!=d&&(e=1/d),c.j.x*=e,c.j.y*=e,c.j.z*=e,c.d*=e,b[2].j.x=a.a[3]+a.a[0],b[2].j.y=a.a[7]+a.a[4],b[2].j.z=a.a[11]+a.a[8],b[2].d=a.a[15]+a.a[12],c=b[2],d=Math.sqrt(c.j.x*c.j.x+c.j.y*c.j.y+c.j.z*c.j.z),e=0,0!=d&&(e=1/d),c.j.x*=e,c.j.y*=e,c.j.z*=e,c.d*=e,b[3].j.x=a.a[3]-a.a[0],b[3].j.y=a.a[7]-a.a[4],b[3].j.z=a.a[11]-a.a[8],b[3].d=a.a[15]-a.a[12],c=b[3],d=Math.sqrt(c.j.x*c.j.x+c.j.y*c.j.y+c.j.z*c.j.z),e=0,0!=d&&(e=1/d),c.j.x*=e,c.j.y*=e,c.j.z*=e,c.d*=e,b[4].j.x=a.a[3]-a.a[1],b[4].j.y=
a.a[7]-a.a[5],b[4].j.z=a.a[11]-a.a[9],b[4].d=a.a[15]-a.a[13],c=b[4],d=Math.sqrt(c.j.x*c.j.x+c.j.y*c.j.y+c.j.z*c.j.z),e=0,0!=d&&(e=1/d),c.j.x*=e,c.j.y*=e,c.j.z*=e,c.d*=e,b[5].j.x=a.a[3]+a.a[1],b[5].j.y=a.a[7]+a.a[5],b[5].j.z=a.a[11]+a.a[9],b[5].d=a.a[15]+a.a[13],a=b[5],b=Math.sqrt(a.j.x*a.j.x+a.j.y*a.j.y+a.j.z*a.j.z),c=0,0!=b&&(c=1/b),a.j.x*=c,a.j.y*=c,a.j.z*=c,a.d*=c;if(null!=this.fz){a=this.fz;b=this.gj;c=a.Sd;c.length=0;c.Ja++;c=0;for(d=a.hc.length;c<d;)a.hc[c++].select(b,a.Sd,!1);b=a.Sd;c=a.Tq;
d=0;for(e=c.length;d<e;)b.Yf(c[d++]);b=a.Sd;a=b.data;c=b.length}else c=this.Xb.length,a=this.Xb;for(b=0;b<c;)if(d=a[b++],!d.hr()&&(this.yg+=d.Nf(),d.pa()&&d.isEnabled()&&(d.Wd(),null!=d.ka&&d.ka.VI([11,12])&&this.cq.Yf(d),e=d.er(this.M),null!=e&&(d.Wm(),d.zq||d.gd&&0<d.Ci()&&0!=(d.tb&this.M.tb)&&d.Ki(this.gj))))){var f=this.Ug;f.data[f.length++]=d;d.yb[f.cb]=f.Ja;f=this.M.Ug;f.data[f.length++]=d;d.yb[f.cb]=f.Ja;d.ws(this.Pa);this.TE(d,e)}if(this.lC)for(a=0,b=this.Ne.length;a<b;)c=this.Ne[a++],c.pq&&
(null==c.Ed.position||null!=c.Ed&&c.Ed.isEnabled())&&(d=this.Xl,d.data[d.length++]=c,c.yb[d.cb]=d.Ja,c.iu())},TE:function(a,b){null!=b.fd()&&this.ow&&(this.dx.Yf(b.fd())&&b.fd().Fl(),b.lf||this.mq.Yf(b));if(a.Ao||this.wI){var c=this.Zl.mc,d=a.ed().yc;c.data[c.length++]=d;d.yb[c.cb]=c.Ja}null!=a.Np&&(c=this.Op,d=a.Np,c.data[c.length++]=d,d.yb[c.cb]=c.Ja);if(null!=b&&null!=b.Ga){var e;if(null!=b.en&&b.Gw){c=b.en;d=this.gj;e=c.Sd;e.length=0;e.Ja++;e=0;for(var f=c.hc.length;e<f;)c.hc[e++].select(d,c.Sd,
!1);d=c.Sd;e=c.Tq;for(var f=0,g=e.length;f<g;)d.Yf(e[f++]);c=c.Sd;e=c.length;c=c.data}else c=b.Ga,e=c.length;for(d=0;d<e;)if(f=c[d++],b.zq||1==b.Ga.length?g=!0:(g=this.gj,g=(f.Of()?f.ta.ed():f.ra).Ki(g)),g){Ma.D=f.Lf();if(b.Bo){var g=this.Zl.mc,h=(f.Of()?f.ta.ed():f.ra).yc;g.data[g.length++]=h;h.yb[g.cb]=g.Ja}if(null!=Ma.D){if(null!=Ma.D.GA&&(g=this.Ft,h=g.data.indexOf(Ma.D),-1==(h>=g.length?-1:h))){g=this.Ft;h=Ma.D;g.data[g.length++]=h;h.yb[g.cb]=g.Ja;for(var g=this.ff,h=Ma.D.GA(),k=0,l=h.length;k<
l;)g.Yf(h.data[k++])}this.op+=f.Tg;this.pj.mf(f)}}}},Ty:function(a){var b=this.c;this.M=a;if(null==this.M)throw new ja("Active camera not set");var c=this.M.viewport,d=b.Vb(),e=b.Lb();b.Ze=c;b.b.viewport(c.x*d|0,c.y*e|0,d*c.width|0,e*c.height|0);this.Ye=null;this.Pa++;c=this.M.pf();d=this.M.Mf(!1);this.za=c;this.Va=d;this.za.qa(this.Va,this.sb.a,0);this.fK.la(this.M);this.EF();c=0;for(d=this.mq.length;c<d;)e=this.mq.data[c++],e.jH(e.fd());e=!1;if(this.Mr&&0<this.ff.length){this.mm=!0;c=0;for(d=this.ff.length;c<
d;)e=this.ff.data[c++],e.ph()&&(this.Pa++,e.gb(null!=e.M&&e.M!=this.M));this.mm=!1;this.Pa++;e=!0}d=this.c.rb.Qk;c=!1;if(this.Mr&&null!=this.rf&&0<this.rf.length){this.mm=!0;for(var f=0,g=this.rf.length;f<g;){var h=this.rf[f++];h.fD()&&(null==h.ol()||0==h.ol().Qb&&a==h.ol()||0!=h.ol().Qb&&-1<h.ol().ma.indexOf(a))&&(c=!0,h=h.Qd,h.ph()&&(this.Pa++,h.gb(!1),e=!0))}this.mm=!1;this.Pa++}e&&(b.pg=null,null!=b.tc&&(b.b.bindFramebuffer(36160,null),b.tc=null),e=b.Ze,f=b.Vb(),g=b.Lb(),b.Ze=e,b.b.viewport(e.x*
f|0,e.y*g|0,f*e.width|0,g*e.height|0),b.Tl());this.El.Ny();if(0<this.Ig.length){b.H.Pe(!1);f=0;for(g=this.Ig.length;f<g;)e=this.Ig[f++],e.nJ&&e.gb();b.H.Pe(!0)}c&&this.c.rb.zo(!0);this.pj.gb(null,null,!0,!0);c&&this.c.rb.zo(d);this.Zl.gb();d=0;for(e=this.Op.length;d<e;)this.Op.data[d++].gb();if(this.xB)for(d=0,e=this.vB.length;d<e;)f=this.vB[d++],0!=(a.tb&f.tb)&&f.gb();if(0<this.Ig.length){b.H.Pe(!1);d=0;for(e=this.Ig.length;d<e;)f=this.Ig[d++],f.nJ||f.gb();b.H.Pe(!0)}if(c){b.H.Pe(!1);c=0;for(d=this.rf.length;c<
d;)e=c++,this.rf[e].fD()&&this.rf[e].gb();b.H.Pe(!0)}this.El.Ux(a.mv);this.M.sz();a=this.ff;a.length=0;a.Ja++;this.dK.la(this.M)},Py:function(a){if(0==a.Qb)this.Ty(a);else{for(var b=0,c=a.ma.length;b<c;)this.Ty(a.ma[b++]);this.M=a;a=this.M.pf();b=this.M.Mf(!1);this.za=a;this.Va=b;this.za.qa(this.Va,this.sb.a,0);this.M.sz()}},kF:function(){for(var a=0,b=this.cq.length;a<b;)for(var c=this.cq.data[a++],d=0,e=c.ka.jf.length;d<e;){var f=c.ka.jf[d++];if(11==f.eg||12==f.eg){var g=f.RG,h=z.D(g,qa)?g:g.Yc,
g=h.iJ(c,g.RP),k=c.dh.indexOf(h);g&&-1==k?11==f.eg?(f.Us(ma.g(c)),c.dh.push(h)):12==f.eg&&c.dh.push(h):!g&&-1<k&&12==f.eg&&(12==f.eg&&f.Us(ma.g(c)),c.ka.ev(12)&&12!=f.eg||c.dh.splice(k,1))}}},gb:function(){this.c.Kp=0;var a=this.cq;a.length=0;a.Ja++;this.Ye=null;null!=this.ka&&this.ka.dc(10,null);this.gD.dw||this.gD.zh();a=Math.max(Ma.$a,Math.min(this.c.dl,Ma.Ta));this.fx=.06*a;this.As();null!=this.ie&&this.ie.BG(a/1E3);this.sc.la(this);var a=this.c,b=this.M;if(this.Mr){for(var c=0,d=this.Bu.length;c<
d;){var e=this.Bu[c++];if(e.ph()){this.Pa++;this.M=null!=e.M?e.M:this.M;if(null==this.M)throw new ja("Active camera not set");var f=this.M.viewport,g=a.Vb(),h=a.Lb();a.Ze=f;a.b.viewport(f.x*g|0,f.y*h|0,g*f.width|0,h*f.height|0);f=this.M.pf();g=this.M.Mf(!1);this.za=f;this.Va=g;this.za.qa(this.Va,this.sb.a,0);e.gb(b!=this.M)}}this.Pa++}0<this.Bu.length&&(a.pg=null,null!=a.tc&&(a.b.bindFramebuffer(36160,null),a.tc=null),c=a.Ze,d=a.Vb(),e=a.Lb(),a.Ze=c,a.b.viewport(c.x*d|0,c.y*e|0,d*c.width|0,e*c.height|
0),a.Tl());this.M=b;if(this.VK&&0<this.gq.length)for(a=0,b=this.gq;a<b.length;)c=b[a],++a,c.ph()&&c.gb();a=this.c;b=this.clearColor;c=this.Cq||this.Nu||this.Mu;a.H.apply(a.b);a.rb.apply(a.b);a.K.apply(a.b);d=0;c&&(z.D(b,ca)?a.b.clearColor(b.r,b.v,b.m,b.$):a.b.clearColor(b.r,b.v,b.m,1),d=16384);a.b.clearDepth(1);d|=256;a.b.clearStencil(0);a.b.clear(d|1024);if(this.Xr)for(a=0,b=this.jc.length;a<b;)d=this.jc[a++],c=d.fr(),d.isEnabled()&&null!=c&&-1!=c.Nk.f.Ol.indexOf(c.Nk)&&(d=this.ff,c=c.Nk,d.data[d.length++]=
c,c.yb[d.cb]=d.Ja);null!=this.Ps&&(a=this.ff,b=this.Ps.yF,a.data[a.length++]=b,b.yb[a.cb]=a.Ja);this.TK.update();if(0<this.rn.length)for(a=0,b=this.rn.length;a<b;)c=a++,0<c&&(d=this.c,d.H.apply(d.b),d.rb.apply(d.b),d.K.apply(d.b),d.b.clearDepth(1),d.b.clearStencil(0),d.b.clear(1280)),this.Py(this.rn[c]);else{if(null==this.M)throw new ja("No camera defined");this.Py(this.M)}this.kF();this.Kc.la(this);a=0;for(b=this.jn.length;a<b;)c=a++,d=this.jn.data[c],null!=d&&d.dispose(),this.jn.data[c]=null;a=
this.jn;a.length=0;a.Ja++;this.pA&&(this.pA=!1)},dispose:function(){this.UC(null);this.RC(null);this.Yr=[];this.Zl.dispose();null!=this.Ps&&this.Ps.dispose();this.Nb.la(this);this.le();this.Nb.clear();this.sc.clear();this.Kc.clear();for(var a=0,b=this.kf.length;a<b;)this.kf[a++].le(this);for(;0<this.jc.length;)this.jc[0].dispose();for(;0<this.Xb.length;)this.Xb[0].dispose(!0);for(;0<this.kf.length;)this.kf[0].dispose();for(;0<this.vf.length;)this.vf[0].dispose();for(;0<this.Ne.length;)a=this.Ne[0],
null!=a.G&&(a.G.dispose(),a.G=null),null!=a.wa&&(b=a.wa,b.ia--,0==b.ia&&a.c.b.deleteBuffer(b.buffer),a.wa=null),null!=a.Jd&&(a.Jd.dispose(),a.Jd=null),Z.remove(a.f.Ne,a),a.Nb.la(a),a.Nb.clear();for(;0<this.dg.length;)this.dg[0].dispose();for(;0<this.Ig.length;)this.Ig[0].dispose();for(;0<this.rf.length;)this.rf[0].dispose();for(;0<this.Ol.length;)this.Ol[0].dispose();this.El.dispose();null!=this.ie&&this.bI();Z.remove(this.c.Vi,this);this.c.Tl()},Nq:function(a,b,c,d,e){null==e&&(e=!1);var f=this.c;
if(null==d){if(null==this.M)throw new ja("Active camera not set");d=this.M}var g=d.viewport,h=f.Vb(),k=f.Lb(),f=g.width*h,l=g.height*k;a=a/this.c.xk-g.x*h;b=b/this.c.xk-(this.c.Lb()-g.y*k-l);null==c&&(c=new r,c.a[0]=1,c.a[1]=0,c.a[2]=0,c.a[3]=0,c.a[4]=0,c.a[5]=1,c.a[6]=0,c.a[7]=0,c.a[8]=0,c.a[9]=0,c.a[10]=1,c.a[11]=0,c.a[12]=0,c.a[13]=0,c.a[14]=0,c.a[15]=1);e?(e=new r,e.a[0]=1,e.a[1]=0,e.a[2]=0,e.a[3]=0,e.a[4]=0,e.a[5]=1,e.a[6]=0,e.a[7]=0,e.a[8]=0,e.a[9]=0,e.a[10]=1,e.a[11]=0,e.a[12]=0,e.a[13]=0,
e.a[14]=0,e.a[15]=1):e=d.pf();return Ra.ib(a,b,f,l,c,e,d.Mf(!1))},yu:function(a,b,c){var d=this.c;if(null==c){if(null==this.M)throw new ja("Active camera not set");c=this.M}var e=c.viewport,f=d.Vb(),g=d.Lb(),d=e.x*f,h=e.y*g,f=e.width*f,e=e.height*g,g=new r;g.a[0]=1;g.a[1]=0;g.a[2]=0;g.a[3]=0;g.a[4]=0;g.a[5]=1;g.a[6]=0;g.a[7]=0;g.a[8]=0;g.a[9]=0;g.a[10]=1;g.a[11]=0;g.a[12]=0;g.a[13]=0;g.a[14]=0;g.a[15]=1;a=a/this.c.xk-d;b=b/this.c.xk-(this.c.Lb()-h-e);return Ra.ib(a,b,f,e,g,g,c.Mf(!1))},nm:function(a,
b,c){null==c&&(c=!1);for(var d=null,e=0,f=this.Xb.length;e<f;){var g=this.Xb[e++];if(null!=b){if(!b(g))continue}else if(!g.isEnabled()||!g.gd||!g.Bi())continue;g=g.Ji(a(g.va()),c);if(null!=g&&g.sf&&(c||null==d||!(g.Rb>=d.Rb))&&(d=g,c))break}return null!=d?d:new dd},et:function(a,b,c,d){null==c&&(c=!1);var e=new dd;null==d&&(d=this.M);if(0<this.dg.length)for(var f=0,g=this.dg.length;f<g;){var h=this.dg[f++];if(h.vr&&(h=h.Ji(a,d,b,c),null!=h&&h.sf&&(c||null==e||!(h.Rb>=e.Rb))&&(e=h,c)))break}return e},
NK:function(a,b,c){null==c&&(c=!1);var d=this;return this.nm(function(b){if(null==d.xt){var c=new r;c.a[0]=1;c.a[1]=0;c.a[2]=0;c.a[3]=0;c.a[4]=0;c.a[5]=1;c.a[6]=0;c.a[7]=0;c.a[8]=0;c.a[9]=0;c.a[10]=1;c.a[11]=0;c.a[12]=0;c.a[13]=0;c.a[14]=0;c.a[15]=1;d.xt=c}var c=d.xt,g=b.a[0],h=b.a[1],k=b.a[2],l=b.a[3],m=b.a[4],u=b.a[5],x=b.a[6],v=b.a[7],G=b.a[8],D=b.a[9],w=b.a[10],q=b.a[11],ua=b.a[12],n=b.a[13],y=b.a[14],t=b.a[15];b=w*t-q*y;var B=D*t-q*n,E=D*y-w*n,M=G*t-q*ua,R=G*y-w*ua,I=G*n-D*ua,C=u*b-x*B+v*E,ba=
-(m*b-x*M+v*R),N=m*B-u*M+v*I,L=-(m*E-u*R+x*I),Na=1/(g*C+h*ba+k*N+l*L),z=x*t-v*y,T=u*t-v*n,A=u*y-x*n,t=m*t-v*ua,y=m*y-x*ua,ua=m*n-u*ua,n=x*q-v*w,F=u*q-v*D,O=u*w-x*D,v=m*q-v*G,x=m*w-x*G,m=m*D-u*G;c.a[0]=C*Na;c.a[4]=ba*Na;c.a[8]=N*Na;c.a[12]=L*Na;c.a[1]=-(h*b-k*B+l*E)*Na;c.a[5]=(g*b-k*M+l*R)*Na;c.a[9]=-(g*B-h*M+l*I)*Na;c.a[13]=(g*E-h*R+k*I)*Na;c.a[2]=(h*z-k*T+l*A)*Na;c.a[6]=-(g*z-k*t+l*y)*Na;c.a[10]=(g*T-h*t+l*ua)*Na;c.a[14]=-(g*A-h*y+k*ua)*Na;c.a[3]=-(h*n-k*F+l*O)*Na;c.a[7]=(g*n-k*v+l*x)*Na;c.a[11]=
-(g*F-h*v+l*m)*Na;c.a[15]=(g*O-h*x+k*m)*Na;c=d.xt;l=a.origin;g=new p(0,0,0);h=l.x;k=l.y;l=l.z;m=c.a;u=h*m[1]+k*m[5]+l*m[9]+m[13];G=h*m[2]+k*m[6]+l*m[10]+m[14];D=h*m[3]+k*m[7]+l*m[11]+m[15];g.x=(h*m[0]+k*m[4]+l*m[8]+m[12])/D;g.y=u/D;g.z=G/D;h=a.direction;k=new p(0,0,0);k.x=h.x*c.a[0]+h.y*c.a[4]+h.z*c.a[8];k.y=h.x*c.a[1]+h.y*c.a[5]+h.z*c.a[9];k.z=h.x*c.a[2]+h.y*c.a[6]+h.z*c.a[10];return new Ra(g,k,a.length)},b,c)},QC:function(a){this.ih!=a&&(null!=this.ih&&null!=this.ih.ka&&this.ih.ka.dc(9,ma.g(this.ih)),
this.ih=a,null!=this.ih&&null!=this.ih.ka&&this.ih.ka.dc(8,ma.g(this.ih)))},gw:function(a){this.jh!=a&&(null!=this.jh&&null!=this.jh.ka&&this.jh.ka.dc(9,ma.D(this.jh,this)),this.jh=a,null!=this.jh&&null!=this.jh.ka&&this.jh.ka.dc(8,ma.D(this.jh,this)))},jI:function(a,b){if(null!=this.ie)return!0;this.ie=new xf(b);if(!this.ie.isSupported())return this.ie=null,!1;this.ie.dt(a);return!0},bI:function(){null!=this.ie&&(this.ie.dispose(),this.ie=null)},l:Ma,F:{Qn:"get_pointerY",Pn:"get_pointerX",kr:"get_meshUnderPointer",
Xu:"get_SelectionOctree",dD:"set_workerCollisions",nr:"get_workerCollisions",RC:"set_afterRender",UC:"set_beforeRender"}};var ag=K.BABYLON.Action=function(){};n["com.babylonhx.actions.Action"]=ag;ag.h=["com","babylonhx","actions","Action"];ag.prototype={Us:function(){if(null!=this.kj.oF){var a=this.kj.oF,b=this.vs.f.Pa;if(a.FF==b){if(!a.Mx)return}else a.FF=b,a.Mx=!0}this.SL()},SL:function(){null!=this.kj.Es?(null==this.kj.Es.vs&&(this.kj.Es.vs=this.vs),this.kj=this.kj.Es):this.kj=this},l:ag};var ma=
K.BABYLON.ActionEvent=function(a,b,c,d,e){this.source=a;this.TL=e};n["com.babylonhx.actions.ActionEvent"]=ma;ma.h=["com","babylonhx","actions","ActionEvent"];ma.g=function(a){var b=a.f;return new ma(a,b.Pn(),b.Qn(),b.kr(),void 0)};ma.D=function(a,b){return new ma(a,b.Pn(),b.Qn(),b.kr(),void 0,void 0)};ma.da=function(a,b){return new ma(null,a.Pn(),a.Qn(),a.kr(),b)};ma.prototype={l:ma};var bg=K.BABYLON.ActionManager=function(){this.jf=[]};n["com.babylonhx.actions.ActionManager"]=bg;bg.h=["com","babylonhx",
"actions","ActionManager"];bg.prototype={dispose:function(){var a=this.f.ax.indexOf(this);-1<a&&this.f.ax.splice(a,1)},VI:function(a){for(var b=0,c=this.jf.length;b<c;)if(-1<a.indexOf(this.jf[b++].eg))return!0;return!1},ev:function(a){for(var b=0,c=this.jf.length;b<c;)if(this.jf[b++].eg==a)return!0;return!1},Zu:function(){for(var a=0,b=this.jf.length;a<b;){var c=this.jf[a++];if(1<=c.eg&&6>=c.eg)return!0}return!1},dc:function(a,b){for(var c=0,d=this.jf.length;c<d;){var e=this.jf[c++];if(e.eg==a){if(14==
a||13==a){var f=e.RG;if(null!=f&&Tf.Dc(b.TL)!=f)continue}e.Us(b)}}},l:bg,F:{Zu:"get_hasPickTriggers"}};var cg=K.BABYLON.Condition=function(){this.Mx=!1};n["com.babylonhx.actions.Condition"]=cg;cg.h=["com","babylonhx","actions","Condition"];cg.prototype={l:cg};var wf=K.BABYLON.Animatable=function(a,b,c,d,e,f,g,h){null==f&&(f=1);null==e&&(e=!1);null==d&&(d=100);null==c&&(c=0);this.lG=!1;this.tp=[];this.Dk=this.Hk=-1;this.target=b;this.zI=c;this.gM=d;this.DJ=e;this.VL=f;this.jo=g;null!=h&&this.Jz(b,
h);this.f=a;a.Ve.push(this)};n["com.babylonhx.animations.Animatable"]=wf;wf.h=["com","babylonhx","animations","Animatable"];wf.prototype={Jz:function(a,b){for(var c=0,d=b.length;c<d;){var e=b[c++];e.rq=a;this.tp.push(e)}},reset:function(){for(var a=this.tp,b=0,c=a.length;b<c;)a[b++].reset();this.Hk=this.Dk=-1},stop:function(a){if(-1<this.f.Ve.indexOf(this)){for(var b=this.tp,c=0,d=b.length-1;0<=d;)if(null==a||b[d].name==a)b[d].reset(),b.splice(d,1),++c,--d;b.length==c&&(this.f.Ve.splice(d,1),null!=
this.jo&&this.jo())}},As:function(a){if(this.lG)return-1==this.Hk&&(this.Hk=a),!0;-1==this.Dk?this.Dk=a:-1!=this.Hk&&(this.Dk+=a-this.Hk,this.Hk=-1);for(var b=!1,c=this.tp,d=0,e=c.length;d<e;){var f=c[d++].iu(a-this.Dk,this.zI,this.gM,this.DJ,this.VL);b?b=!0:b=f}b||this.f.Ve.splice(this.f.Ve.indexOf(this),1);b||null==this.jo||(this.jo(),this.jo=null);return b},l:wf};var fc=K.BABYLON.Animation=function(a,b,c,d,e,f){null==f&&(f=!1);null==e&&(e=-1);this.Ef=new ea;this.uH=.01;this.ej=[];this.$i=0;this.sj=
!1;this.Rp=[];this.ug=[];this.name=a;this.oD=b;this.Sh=b.split(".");this.Zq=c;this.dataType=d;this.tv=-1==e?1:e;this.iI=f};n["com.babylonhx.animations.Animation"]=fc;fc.h=["com","babylonhx","animations","Animation"];fc.ab=function(a){for(var b=new fc(a.name,a.XK,a.Zq,a.dataType,a.EJ),c=a.dataType,d=[],e,f=0,g=a.keys.length;f<g;){var h=a.keys[f++];switch(c){case 0:e=h.values[0];break;case 1:e=h.values;e=new p(e[0],e[1],e[2]);break;case 2:e=h.values;e=new X(e[0],e[1],e[2],e[3]);break;case 3:e=h.values;
for(var k=new r,l=0;16>l;){var m=l++;k.a[m]=e[m]}e=k;break;case 4:e=h.values;e=new Q(e[0],e[1],e[2]);break;default:e=h.values,e=new p(e[0],e[1],e[2])}d.push({frame:h.frame,value:e})}b.FL(d);if(null!=a.Ti)for(c=0,d=a.Ti.length;c<d;)e=a.Ti[c++],b.createRange(e.name,e.from,e.Pl);return b};fc.Ba=function(a,b){if(null!=a.Ya){b.Ya=[];for(var c=0,d=a.Ya.length;c<d;)b.Ya.push(a.Ya[c++].T())}};fc.prototype={createRange:function(a,b,c){var d=this.Ef;(null!=t[a]?d.Gd(a):d.i.hasOwnProperty(a))||(b=new le(a,b,
c),c=this.Ef,null!=t[a]?c.C(a,b):c.i[a]=b)},reset:function(){this.ug=[];this.Rp=[];this.$i=0;this.Mm=null},FL:function(a){this.ba=a.slice(0);this.ug=[];this.Rp=[]},Yx:function(a){return jb.kp(a)?a():a},ft:function(a,b,c,d,e){if(2==c&&0<b&&null!=e)return null!=e.clone?e.clone():e;e=Math.max(0,Math.min(this.ba.length-1,Math.floor(this.ba.length*(a-this.ba[0].frame)/(this.ba[this.ba.length-1].frame-this.ba[0].frame))-1))|0;if(this.ba[e].frame>=a)for(;0<=e-1&&this.ba[e].frame>=a;)--e;for(var f=e,g=this.ba.length;f<
g;)if(e=f++,null!=this.ba[e+1]&&this.ba[e+1].frame>=a){var h=this.ba[e].value,k=this.ba[e+1].value;e=(a-this.ba[e].frame)/(this.ba[e+1].frame-this.ba[e].frame);null!=this.BF&&(e=this.BF.aO(e));switch(this.dataType){case 0:switch(c){case 0:return c=h,d*b+(c+(k-c)*e);case 1:case 2:return b=h,b+(k-b)*e}break;case 1:switch(c){case 0:return e=p.D(h,k,e),b=d.scale(b),new p(e.x+b.x,e.y+b.y,e.z+b.z);case 1:case 2:return p.D(h,k,e)}break;case 2:a=null;switch(c){case 0:e=X.Ib(h,k,e);b=d.scale(b);a=new X(e.x+
b.x,e.y+b.y,e.z+b.z,e.o+b.o);break;case 1:case 2:a=X.Ib(h,k,e)}return a;case 3:switch(c){case 0:return h;case 1:case 2:b=h;d=k;k=new r;k.a[0]=0;k.a[1]=0;k.a[2]=0;k.a[3]=0;k.a[4]=0;k.a[5]=0;k.a[6]=0;k.a[7]=0;k.a[8]=0;k.a[9]=0;k.a[10]=0;k.a[11]=0;k.a[12]=0;k.a[13]=0;k.a[14]=0;for(c=k.a[15]=0;16>c;)a=c++,k.a[a]=b.a[a]*(1-e)+d.a[a]*e;return k}break;case 4:switch(c){case 0:return a=h,h=k,k=a.r+(h.r-a.r)*e,c=a.v+(h.v-a.v)*e,e=a.m+(h.m-a.m)*e,b=d.scale(b),new Q(k+b.r,c+b.v,e+b.m);case 1:case 2:return b=
h,d=k,new Q(b.r+(d.r-b.r)*e,b.v+(d.v-b.v)*e,b.m+(d.m-b.m)*e)}break;case 5:switch(c){case 0:return c=h,a=k,k=c.x+(a.x-c.x)*e,e=c.y+(a.y-c.y)*e,b=d.scale(b),new W(k+b.x,e+b.y);case 1:case 2:return b=h,d=k,new W(b.x+(d.x-b.x)*e,b.y+(d.y-b.y)*e)}break;case 6:switch(c){case 0:return sb.Zc(h,k,e).add(d.scale(b));case 1:case 2:return sb.Zc(h,k,e)}}}return this.Yx(this.ba[this.ba.length-1].value)},iu:function(a,b,c,d,e){if(null==this.Sh||1>this.Sh.length)return this.sj=!0,!1;var f=!0;0!=this.ba[0].frame&&
this.ba.unshift({frame:0,value:this.ba[0].value});if(b<this.ba[0].frame||b>this.ba[this.ba.length-1].frame)b=this.ba[0].frame;if(c<this.ba[0].frame||c>this.ba[this.ba.length-1].frame)c=this.ba[this.ba.length-1].frame;b==c&&++b;var g=c-b,h=null;a=a*this.Zq*e/1E3;if(a>g&&!d)f=!1,d=this.Yx(this.ba[this.ba.length-1].value);else if(d=0,1!=this.tv){h=c+b;if(this.ug.length>h){e=this.ft(b,0,1);d=this.ft(c,0,1);switch(this.dataType){case 0:this.ug[h]=d-e;break;case 1:var k=z.g(d,p);e=z.g(e,p);this.ug[h]=new p(k.x-
e.x,k.y-e.y,k.z-e.z);break;case 2:k=z.g(d,X);e=z.g(e,X);this.ug[h]=new X(k.x-e.x,k.y-e.y,k.z-e.z,k.o-e.o);break;case 4:k=z.g(d,Q);e=z.g(e,Q);this.ug[h]=new Q(k.r-e.r,k.v-e.v,k.m-e.m);break;case 5:k=z.g(d,W);e=z.g(e,W);this.ug[h]=new W(k.x-e.x,k.y-e.y);break;case 6:this.ug[h]=z.g(d,sb).ZL(e)}this.Rp[h]=d}d=this.Rp[h];h=this.ug[h]}if(null==h)switch(this.dataType){case 0:h=0;break;case 1:h=new p(0,0,0);break;case 2:h=new X(0,0,0,0);break;case 4:h=new Q(0,0,0);break;case 5:h=new W(0,0);break;case 6:h=
sb.Te()}b=f?b+a%g:c;var g=this.ft(b,a/g|0,this.tv,h,d),l;if(1<this.Sh.length){c=this.rq;a=this.Sh[0];var m;null==c?m=null:(c.F?h=m=c.F["get_"+a]:h=!1,m=h?c[m]():c[a]);c=1;for(a=this.Sh.length-1;c<a;)h=this.Sh[c++],null==m?m=null:(m.F?d=l=m.F["get_"+h]:d=!1,m=d?m[l]():m[h]);c=this.Sh[this.Sh.length-1];l=m}else c=this.Sh[0],l=this.rq;if(this.iI&&1>=this.$i){if(null==this.Mm)if("_matrix"==c)this.Mm=l.$p.clone();else{m=c;var u;null==l?u=null:(l.F?a=u=l.F["get_"+m]:a=!1,u=a?l[u]():l[m]);this.Mm=u}if("_matrix"==
c){u=this.Mm;m=this.$i;c=new r;c.a[0]=0;c.a[1]=0;c.a[2]=0;c.a[3]=0;c.a[4]=0;c.a[5]=0;c.a[6]=0;c.a[7]=0;c.a[8]=0;c.a[9]=0;c.a[10]=0;c.a[11]=0;c.a[12]=0;c.a[13]=0;c.a[14]=0;for(a=c.a[15]=0;16>a;)h=a++,c.a[h]=u.a[h]*(1-m)+g.a[h]*m;l.$p=c}else l[c]=this.Mm*(1-this.$i)+this.$i*g;this.$i+=this.uH}else l[c]=g;null!=this.rq.HJ&&this.rq.HJ(this.oD);for(u=0;u<this.ej.length;)b>=this.ej[u].frame?(l=this.ej[u],l.ur||(l.DK&&(this.ej.splice(u,1),--u),l.ur=!0,l.action())):this.ej[u].ur&&!this.ej[u].DK&&(this.ej[u].ur=
!1),++u;f||(this.sj=!0);return f},T:function(){var a={};a.name=this.name;a.XK=this.oD;a.Zq=this.Zq;a.dataType=this.dataType;a.EJ=this.tv;var b=this.dataType;a.keys=[];for(var c=this.ba,d=0,e=c.length;d<e;){var f=c[d++],g={};g.frame=f.frame;switch(b){case 0:g.values=[f.value];break;case 1:case 2:case 3:case 4:g.values=f.value.lH()}a.keys.push(g)}a.Ti=[];for(b=this.Ef.keys();b.Ca();)c=b.next(),d={},d.name=c,e=this.Ef,d.from=(null!=t[c]?e.I(c):e.i[c]).from,e=this.Ef,d.Pl=(null!=t[c]?e.I(c):e.i[c]).Pl,
a.Ti.push(d);return a},l:fc};n["com.babylonhx.animations.AnimationEvent"]=Wf;Wf.h=["com","babylonhx","animations","AnimationEvent"];Wf.prototype={l:Wf};n["com.babylonhx.animations.AnimationRange"]=le;le.h=["com","babylonhx","animations","AnimationRange"];le.prototype={l:le};var dg=K.BABYLON.IEasingFunction=function(){};n["com.babylonhx.animations.easing.IEasingFunction"]=dg;dg.h=["com","babylonhx","animations","easing","IEasingFunction"];dg.prototype={l:dg};var Jg=K.BABYLON.Sound=function(){};n["com.babylonhx.audio.Sound"]=
Jg;Jg.h=["com","babylonhx","audio","Sound"];var uf=K.BABYLON.SoundTrack=function(a,b){this.VF=!1;this.id=-1;this.f=a;this.Da=b;vd.iE(this.VF)||(this.f.jD.push(this),this.id=this.f.jD.length-1)};n["com.babylonhx.audio.SoundTrack"]=uf;uf.h=["com","babylonhx","audio","SoundTrack"];uf.prototype={l:uf};var De=K.BABYLON.Bone=function(){this.ny=new r;this.np=new r;this.ZG=new r;this.children=[]};n["com.babylonhx.bones.Bone"]=De;De.h=["com","babylonhx","bones","Bone"];De.xb=[lc];De.V=oa;De.prototype=S(oa.prototype,
{va:function(){return this.ZG},rz:function(a){null==a&&(a=this.YE);if(null!=this.ut)a.qa(this.ut.np,this.np.a,0);else for(var b=this.np,c=0;16>c;){var d=c++;b.a[d]=a.a[d]}var e=this.np;a=this.ny;var b=e.a[0],c=e.a[1],d=e.a[2],f=e.a[3],g=e.a[4],h=e.a[5],k=e.a[6],l=e.a[7],m=e.a[8],u=e.a[9],x=e.a[10],v=e.a[11],p=e.a[12],D=e.a[13],w=e.a[14],r=e.a[15],e=x*r-v*w,q=u*r-v*D,n=u*w-x*D,y=m*r-v*p,t=m*w-x*p,B=m*D-u*p,E=h*e-k*q+l*n,M=-(g*e-k*y+l*t),R=g*q-h*y+l*B,I=-(g*n-h*t+k*B),C=1/(b*E+c*M+d*R+f*I),ba=k*r-l*
w,N=h*r-l*D,L=h*w-k*D,r=g*r-l*p,w=g*w-k*p,p=g*D-h*p,D=k*v-l*x,Na=h*v-l*u,z=h*x-k*u,l=g*v-l*m,k=g*x-k*m,g=g*u-h*m;a.a[0]=E*C;a.a[4]=M*C;a.a[8]=R*C;a.a[12]=I*C;a.a[1]=-(c*e-d*q+f*n)*C;a.a[5]=(b*e-d*y+f*t)*C;a.a[9]=-(b*q-c*y+f*B)*C;a.a[13]=(b*n-c*t+d*B)*C;a.a[2]=(c*ba-d*N+f*L)*C;a.a[6]=-(b*ba-d*r+f*w)*C;a.a[10]=(b*N-c*r+f*p)*C;a.a[14]=-(b*L-c*w+d*p)*C;a.a[3]=-(c*D-d*Na+f*z)*C;a.a[7]=(b*D-d*l+f*k)*C;a.a[11]=-(b*Na-c*l+f*g)*C;a.a[15]=(b*z-c*k+d*g)*C;a=0;for(b=this.children.length;a<b;)this.children[a++].rz()},
l:De});var yf=K.BABYLON.Skeleton=function(){this.yb=[];var a=new r;a.a[0]=1;a.a[1]=0;a.a[2]=0;a.a[3]=0;a.a[4]=0;a.a[5]=1;a.a[6]=0;a.a[7]=0;a.a[8]=0;a.a[9]=0;a.a[10]=1;a.a[11]=0;a.a[12]=0;a.a[13]=0;a.a[14]=0;a.a[15]=1;this.QF=a;this.Fm=[];this.vm=!0;this.Oi=!1};n["com.babylonhx.bones.Skeleton"]=yf;yf.h=["com","babylonhx","bones","Skeleton"];yf.xb=[Nb];yf.prototype={rG:function(a){this.Fm.push(a)},UG:function(a){a=this.Fm.indexOf(a);-1<a&&this.Fm.splice(a,1)},Hx:function(a,b){for(var c=0,d=this.Ge.length;c<
d;){var e=c++,f=this.Ge[e],g=f.ut;if(null!=g)f.$p.qa(g.va(),f.va().a,0);else if(null!=b)f.$p.qa(b,f.va().a,0);else for(var g=f.va(),h=f.$p,k=0;16>k;){var l=k++;g.a[l]=h.a[l]}f.ny.qa(f.va(),a,16*e)}c=this.QF;d=16*this.Ge.length;for(e=0;16>e;)f=e++,a[d+f]=c.a[f]},Fl:function(){if(this.vm){if(this.Oi)for(var a=0,b=this.Fm.length;a<b;){var c=this.Fm[a++];if(null==c.ee||c.ee.length!=16*(this.Ge.length+1))c.ee=new vb(16*(this.Ge.length+1));for(var d=c.yt,e=0,f=this.Ge.length;e<f;){var g=this.Ge[e++];null==
g.ut&&(g.YE.qa(d,fa.Ra[0].a,0),g.rz(fa.Ra[0]))}this.Hx(c.ee,d)}else{if(null==this.De||this.De.length!=16*(this.Ge.length+1))this.De=new vb(16*(this.Ge.length+1));this.Hx(this.De,null)}this.vm=!1;this.f.bx+=this.Ge.length}},l:yf};var tb=K.BABYLON.ArcRotateCamera=function(a,b,c,d,e,f){this.mi=new p(0,0,0);this.Cx=new p(0,0,0);this.oG=new p(0,0,0);this.cj=new Eb;this.FH=new p(.5,.5,.5);this.ry=this.UF=this.vh=!1;new p(1,1,0);this.gh=function(){};this.fh=function(){};this.ba=[];this.QK=this.yq=!0;this.Th=
new W(0,0);this.UM=1;this.Nj=[39];this.Mj=[37];this.Lj=[40];this.Oj=[38];this.Gi=this.Hi=0;this.Ov=50;this.RK=2;this.Mw=3;this.hu=this.Hz=1E3;this.wv=this.Dw=null;this.Cw=Math.PI;this.vv=.01;this.uv=this.Bw=null;this.Hd=this.Yd=this.Rf=0;la.call(this,a,new p(0,0,0),f);this.alpha=b;this.beta=c;this.R=d;this.target=null!=e?null!=e.position?e.position.clone():e.clone():new p(0,0,0);this.pf()};n["com.babylonhx.cameras.ArcRotateCamera"]=tb;tb.h=["com","babylonhx","cameras","ArcRotateCamera"];tb.V=la;tb.prototype=
S(la.prototype,{hm:function(){return null!=this.target.Ai?this.target.Ai():this.target},bh:function(){la.prototype.bh.call(this);this.L.target=new p(Infinity,Infinity,Infinity);this.L.alpha=null;this.L.beta=null;this.L.R=null;this.L.Th=null},uj:function(a){null==a&&(a=!1);a||la.prototype.uj.call(this);a=this.L.target;var b=this.hm();a.x=b.x;a.y=b.y;a.z=b.z;this.L.alpha=this.alpha;this.L.beta=this.beta;this.L.R=this.R;a=this.Th;this.L.Th=new W(a.x,a.y)},ij:function(){if(!la.prototype.ij.call(this))return!1;
var a=this.L.target,b=this.hm();return null!=b&&a.x==b.x&&a.y==b.y&&a.z==b.z&&this.L.alpha==this.alpha&&this.L.beta==this.beta&&this.L.R==this.R?(a=this.L.Th,b=this.Th,null!=b&&a.x==b.x?a.y==b.y:!1):!1},attachControl:function(a,b,c,d){null==d&&(d=!0);null==c&&(c=!0);null==b&&(b=!1);var e=this,f,g=0,h=new zf;if(null==this.vp){this.vp=a;var k=this.f.c;null==this.df&&(this.df=function(a){e.ry=2==a.button;var c={$N:"dummy"};h.add(null!=a.pointerId?a.pointerId:c,{x:a.clientX,y:a.clientY,type:a.pointerType});
f=h.item(null!=a.pointerId?a.pointerId:c);b||a.preventDefault()},this.ef=function(a){f=null;g=0;h.empty();b||a.preventDefault()},this.Hy=function(a){a.preventDefault()},this.vg=function(a){b||a.preventDefault();switch(h.count){case 1:if(0!=e.Ov&&(e.UF&&c||!c&&e.ry))e.Gi+=-(a.clientX-f.x)/e.Ov,e.Hi+=(a.clientY-f.y)/e.Ov;else{var d=a.clientY-f.y;e.Hd-=(a.clientX-f.x)/e.hu;e.Yd-=d/e.Hz}f.x=a.clientX;f.y=a.clientY;break;case 2:h.item(a.pointerId).x=a.clientX;h.item(a.pointerId).y=a.clientY;a=e.QK?1:-1;
var d=h.dr(0).x-h.dr(1).x,k=h.dr(0).y-h.dr(1).y,d=d*d+k*k;if(0==g){g=d;break}d!=g&&(e.Rf+=(d-g)/(e.RK*e.Mw*e.hu*a),g=d);break;default:null!=h.item(a.pointerId)&&(h.item(a.pointerId).x=a.clientX,h.item(a.pointerId).y=a.clientY)}},this.lj=function(a){if(k.wr){var c=a.ZO||a.aP||a.WP||a.cP||0;e.Hd-=(a.YO||a.$O||a.VP||a.bP||0)/e.hu;e.Yd-=c/e.Hz;b||a.preventDefault()}},this.vq=function(a){var c=0;null!=a.wheelDelta?c=a.wheelDelta/(40*e.Mw):null!=a.detail&&(c=-a.detail/e.Mw);0!=c&&(e.Rf+=c);null!=a.preventDefault&&
(b||a.preventDefault())},d&&(this.fh=function(a){-1==e.Oj.indexOf(a)&&-1==e.Lj.indexOf(a)&&-1==e.Mj.indexOf(a)&&-1==e.Nj.indexOf(a)||-1!=e.ba.indexOf(a)||e.ba.push(a)},this.gh=function(a){if(-1!=e.Oj.indexOf(a)||-1!=e.Lj.indexOf(a)||-1!=e.Mj.indexOf(a)||-1!=e.Nj.indexOf(a))a=e.ba.indexOf(a),0<=a&&e.ba.splice(a,1)}),this.Fk=function(){e.ba=[];h.empty();g=0;f=null},this.Lk=function(){e.ba=[];e.Hd=0;e.Yd=0;e.Rf=0;h.empty();g=0;f=null});a=this.f.c.fc;c||a.addEventListener("contextmenu",this.Hy,!1);a.addEventListener(this.Fd+
"down",this.df,!1);a.addEventListener(this.Fd+"up",this.ef,!1);a.addEventListener(this.Fd+"out",this.ef,!1);a.addEventListener(this.Fd+"move",this.vg,!1);a.addEventListener("mousemove",this.lj,!1);a.addEventListener("mousewheel",this.vq,!1);a.addEventListener("DOMMouseScroll",this.vq,!1);ha.os([{name:"keydown",Qc:this.fh},{name:"keyup",Qc:this.gh},{name:"blur",Qc:this.Fk}])}},le:function(a){this.vp==a&&(a=this.f.c.fc,a.removeEventListener("contextmenu",this.Hy,!1),a.removeEventListener(this.Fd+"down",
this.df,!1),a.removeEventListener(this.Fd+"up",this.ef,!1),a.removeEventListener(this.Fd+"out",this.ef,!1),a.removeEventListener(this.Fd+"move",this.vg,!1),a.removeEventListener("mousemove",this.lj,!1),a.removeEventListener("mousewheel",this.vq,!1),a.removeEventListener("DOMMouseScroll",this.vq,!1),ha.ps([{name:"keydown",Qc:this.fh},{name:"keyup",Qc:this.gh},{name:"blur",Qc:this.Fk}]),this.vp=null,null!=this.Lk&&this.Lk())},fe:function(){if(!this.Bx){for(var a=0,b=this.ba.length;a<b;){var c=this.ba[a++];
-1!=this.Mj.indexOf(c)?this.Hd-=.01:-1!=this.Oj.indexOf(c)?this.Yd-=.01:-1!=this.Nj.indexOf(c)?this.Hd+=.01:-1!=this.Lj.indexOf(c)&&(this.Yd+=.01)}if(0!=this.Hd||0!=this.Yd||0!=this.Rf)this.alpha+=0>=this.beta?-this.Hd:this.Hd,this.beta+=this.Yd,this.R-=this.Rf,this.Hd*=this.tf,this.Yd*=this.tf,this.Rf*=this.tf,.001>Math.abs(this.Hd)&&(this.Hd=0),.001>Math.abs(this.Yd)&&(this.Yd=0),.001>Math.abs(this.Rf)&&(this.Rf=0);if(0!=this.Gi||0!=this.Hi){null==this.sg&&(this.sg=new p(0,0,0),this.Td=new p(0,
0,0));this.Gi*=this.tf;this.Hi*=this.tf;.001>Math.abs(this.Gi)&&(this.Gi=0);.001>Math.abs(this.Hi)&&(this.Hi=0);a=this.sg;a.x=this.Gi;a.y=this.Hi;a.z=0;var d=this.za,a=this.Ap,b=d.a[0],c=d.a[1],e=d.a[2],f=d.a[3],g=d.a[4],h=d.a[5],k=d.a[6],l=d.a[7],m=d.a[8],u=d.a[9],x=d.a[10],v=d.a[11],G=d.a[12],D=d.a[13],w=d.a[14],r=d.a[15],d=x*r-v*w,q=u*r-v*D,n=u*w-x*D,y=m*r-v*G,t=m*w-x*G,B=m*D-u*G,E=h*d-k*q+l*n,M=-(g*d-k*y+l*t),R=g*q-h*y+l*B,I=-(g*n-h*t+k*B),C=1/(b*E+c*M+e*R+f*I),ba=k*r-l*w,N=h*r-l*D,L=h*w-k*D,
r=g*r-l*G,w=g*w-k*G,G=g*D-h*G,D=k*v-l*x,Na=h*v-l*u,z=h*x-k*u,l=g*v-l*m,k=g*x-k*m,g=g*u-h*m;a.a[0]=E*C;a.a[4]=M*C;a.a[8]=R*C;a.a[12]=I*C;a.a[1]=-(c*d-e*q+f*n)*C;a.a[5]=(b*d-e*y+f*t)*C;a.a[9]=-(b*q-c*y+f*B)*C;a.a[13]=(b*n-c*t+e*B)*C;a.a[2]=(c*ba-e*N+f*L)*C;a.a[6]=-(b*ba-e*r+f*w)*C;a.a[10]=(b*N-c*r+f*G)*C;a.a[14]=-(b*L-c*w+e*G)*C;a.a[3]=-(c*D-e*Na+f*z)*C;a.a[7]=(b*D-e*l+f*k)*C;a.a[11]=-(b*Na-c*l+f*g)*C;a.a[15]=(b*z-c*k+e*g)*C;a=this.sg;b=this.Ap;c=this.Td;c.x=a.x*b.a[0]+a.y*b.a[4]+a.z*b.a[8];c.y=a.x*
b.a[1]+a.y*b.a[5]+a.z*b.a[9];c.z=a.x*b.a[2]+a.y*b.a[6]+a.z*b.a[10];null!=this.target.Ai()&&this.target.Dz(this.Td)}this.Ax();la.prototype.fe.call(this)}},Ax:function(){null==this.vv?this.yq&&this.beta>Math.PI&&(this.beta-=2*Math.PI):this.beta<this.vv&&(this.beta=this.vv);null==this.Cw?this.yq&&this.beta<-Math.PI&&(this.beta+=2*Math.PI):this.beta>this.Cw&&(this.beta=this.Cw);null!=this.uv&&this.alpha<this.uv&&(this.alpha=this.uv);null!=this.Bw&&this.alpha>this.Bw&&(this.alpha=this.Bw);null!=this.wv&&
this.R<this.wv&&(this.R=this.wv);null!=this.Dw&&this.R>this.Dw&&(this.R=this.Dw)},zC:function(){var a=this.position,b=this.hm(),c=a.x-b.x,d=a.y-b.y,a=a.z-b.z;this.R=Math.sqrt(c*c+d*d+a*a);this.alpha=Math.acos(c/Math.sqrt(Math.pow(c,2)+Math.pow(a,2)));0>a&&(this.alpha=2*Math.PI-this.alpha);this.beta=Math.acos(d/this.R);this.Ax()},setPosition:function(a){var b=this.position;if(null==a||b.x!=a.x||b.y!=a.y||b.z!=a.z)this.position=a,this.zC()},Kl:function(a){this.target.fO(a)||(this.target=a,this.zC())},
at:function(){var a=Math.cos(this.alpha),b=Math.sin(this.alpha),c=Math.cos(this.beta),d=Math.sin(this.beta);0==d&&(d=1E-4);var e=this.hm(),f=this.mi;f.x=e.x+this.R*a*d;f.y=e.y+this.R*c;f.z=e.z+this.R*b*d;this.f.uu&&this.vh?(this.cj.R=this.FH,a=this.mi,b=this.position,c=this.Cx,c.x=a.x-b.x,c.y=a.y-b.y,c.z=a.z-b.z,this.Bx=!0,this.f.An.FA(this.position,this.Cx,this.cj,3,null,F(this,this.qt),this.fg)):(a=this.position,b=this.mi,a.x=b.x,a.y=b.y,a.z=b.z,a=this.zf,this.yq&&0>this.beta&&(a=new p(a.x,a.y,
a.z),a=new p(-a.x,-a.y,-a.z)),this.f.Hw?r.uA(this.position,e,a,this.za):r.Uc(this.position,e,a,this.za),this.za.a[12]+=this.Th.x,this.za.a[13]+=this.Th.y);this.we=e;return this.za},qt:function(a,b,c){this.f.nr()&&this.vh&&(a=this.cj.R,b.x*=a.x,b.y*=a.y,b.z*=a.z);null!=c?(b=this.oG,c=this.position,b.x=c.x,b.y=c.y,b.z=c.z):(this.setPosition(b),null!=this.Jv&&this.Jv(c));c=Math.cos(this.alpha);a=Math.sin(this.alpha);var d=Math.cos(this.beta),e=Math.sin(this.beta);b=this.hm();var f=this.mi;f.x=b.x+this.R*
c*e;f.y=b.y+this.R*d;f.z=b.z+this.R*a*e;c=this.position;a=this.mi;c.x=a.x;c.y=a.y;c.z=a.z;c=this.zf;this.yq&&0>this.beta&&(c=new p(c.x,c.y,c.z),c=new p(-c.x,-c.y,-c.z));r.Uc(this.position,b,c,this.za);this.za.a[12]+=this.Th.x;this.za.a[13]+=this.Th.y;this.Bx=!1},$P:function(a,b){null==b&&(b=!1);null==a&&(a=this.f.Xb);var c=aa.g(a),d=c.Gb,e=c.Mb,f=d.x-e.x,g=d.y-e.y,d=d.z-e.z,f=Math.sqrt(f*f+g*g+d*d);this.R=f*this.UM;this.uI({min:c.Gb,max:c.Mb,Rb:f},b)},uI:function(a,b){null==b&&(b=!1);var c,d;if(null==
a.Gb){c=null!=a?a:this.f.Xb;c=aa.g(c);var e=c.Gb,f=c.Mb;d=e.x-f.x;var g=e.y-f.y,e=e.z-f.z;d=Math.sqrt(d*d+g*g+e*e)}else c=a,d=a.Rb;this.target.position=aa.ec(c);b||(this.Fb=2*d)},wh:function(a,b){var c=0;switch(this.Qb){case 12:c=this.Ia.Rg*(0==b?-1:1);break;case 10:case 11:case 13:case 20:c=this.Ia.Rg*(0==b?1:-1)}c=new tb(a,this.alpha+c,this.beta,this.R,this.target,this.f);c.Ia={};return c},vj:function(){var a=this.ma[0],b=this.ma[1];a.beta=b.beta=this.beta;a.R=b.R=this.R;switch(this.Qb){case 12:a.alpha=
this.alpha+this.Ia.Rg;b.alpha=this.alpha-this.Ia.Rg;break;case 10:case 11:case 13:case 20:a.alpha=this.alpha-this.Ia.Rg,b.alpha=this.alpha+this.Ia.Rg}la.prototype.vj.call(this)},T:function(){var a=la.prototype.T.call(this);z.D(this.target,p)&&(a.target=this.target.lH());null!=this.target&&null!=this.target.id&&(a.sv=this.target.id);a.vh=this.vh;a.alpha=this.alpha;a.beta=this.beta;a.R=this.R;return a},l:tb});var Hc=K.BABYLON.AnaglyphArcRotateCamera=function(a,b,c,d,e,f,g){tb.call(this,a,b,c,d,e,g);
this.fj=f*Math.PI/180;this.ii=new tb(a+"_left",b-this.fj,c,d,e,g);this.qj=new tb(a+"_right",b+this.fj,c,d,e,g);Hc.D(this,a)};n["com.babylonhx.cameras.AnaglyphArcRotateCamera"]=Hc;Hc.h=["com","babylonhx","cameras","AnaglyphArcRotateCamera"];Hc.D=function(a,b){a.ii.mv=!0;a.nD.push(a.ii);a.nD.push(a.qj);a.bG=new Nc(b+"_leftTexture",1,a.ii);a.VE=new Gd(b+"_anaglyph",1,a.qj);a.VE.fP=function(b){var d=a.bG,e=b.c;b=b.Rd.indexOf("leftSampler");0<d.nb.length&&(d=d.nb.data[d.Zg].data,0<=b&&(b=33984+b,e.J!=
b-33984&&(e.b.activeTexture(b),e.J=b-33984),e.P[e.J]!=d&&(e.b.bindTexture(3553,d),e.P[e.J]=d)))};a.dd()};Hc.V=tb;Hc.prototype=S(tb.prototype,{dd:function(){this.ln(this.ii);this.ln(this.qj);this.ii.alpha=this.alpha-this.fj;this.qj.alpha=this.alpha+this.fj;tb.prototype.dd.call(this)},ln:function(a){a.beta=this.beta;a.R=this.R;a.Sb=this.Sb;a.Fb=this.Fb;a.Sa=this.Sa;a.target=this.target},l:Hc});var ta=K.BABYLON.FreeCamera=function(a,b,c){this.mi=new p(0,0,0);this.Rs=new p(0,0,0);this.pt=new p(0,0,0);
this.hG=!0;this.cj=new Eb;this.ba=[];this.tn=2E3;this.vh=this.ju=!1;this.Nj=[39,68];this.Mj=[37,65];this.Lj=[40,83];this.Oj=[38,87];this.xi=new p(.5,1,.5);la.call(this,a,b,c)};n["com.babylonhx.cameras.FreeCamera"]=ta;ta.h=["com","babylonhx","cameras","FreeCamera"];ta.V=la;ta.prototype=S(la.prototype,{attachControl:function(a,b,c,d){null==d&&(d=!0);null==c&&(c=!0);null==b&&(b=!1);var e=this,f=null,g=this.f.c;this.vp=a;null==this.rt&&(this.rt=function(a,b){f={x:a,y:b}},this.st=function(){f=null},this.lj=
function(a,b){if(null!=f||g.wr){var c=0,d=0;g.wr||(c=a-f.x,d=b-f.y);e.Ub.y+=c/e.tn;e.Ub.x+=d/e.tn;f={x:a,y:b}}},d&&(this.fh=function(a){a=a.keyCode;-1==e.Oj.indexOf(a)&&-1==e.Lj.indexOf(a)&&-1==e.Mj.indexOf(a)&&-1==e.Nj.indexOf(a)||-1!=e.ba.indexOf(a)||e.ba.push(a)},this.gh=function(a){a=a.keyCode;if(-1!=e.Oj.indexOf(a)||-1!=e.Lj.indexOf(a)||-1!=e.Mj.indexOf(a)||-1!=e.Nj.indexOf(a))a=e.ba.indexOf(a),0<=a&&e.ba.splice(a,1)}),this.Fk=function(){e.ba=[]},this.Lk=function(){e.ba=[];f=null;e.Fc=new p(0,
0,0);e.Ub=new W(0,0)});this.f.c.fc.addEventListener(this.Fd+"down",function(a){e.rt(a.clientX,a.clientY)},!1);this.f.c.fc.addEventListener(this.Fd+"up",function(){e.st()},!1);this.f.c.fc.addEventListener(this.Fd+"move",function(a){e.lj(a.clientX,a.clientY)},!1);this.f.c.fc.addEventListener("mousemove",function(a){e.lj(a.clientX,a.clientY)},!1);ha.os([{name:"keydown",Qc:this.fh},{name:"keyup",Qc:this.gh},{name:"blur",Qc:this.Fk}])},le:function(){this.f.c.fc.removeEventListener(this.Fd+"down",this.rt,
!1);this.f.c.fc.removeEventListener(this.Fd+"up",this.st,!1);this.f.c.fc.removeEventListener(this.Fd+"out",this.st,!1);this.f.c.fc.removeEventListener(this.Fd+"move",this.lj,!1);this.f.c.fc.removeEventListener("mousemove",this.lj,!1);ha.ps([{name:"keydown",Qc:this.fh},{name:"keyup",Qc:this.gh},{name:"blur",Qc:this.Fk}]);null!=this.Lk&&this.Lk()},Dp:function(a){var b;if(null!=this.ca){var c=this.position,d=this.ca.va();b=new p(0,0,0);var e=c.x,f=c.y,c=c.z,d=d.a,g=e*d[1]+f*d[5]+c*d[9]+d[13],h=e*d[2]+
f*d[6]+c*d[10]+d[14],k=e*d[3]+f*d[7]+c*d[11]+d[15];b.x=(e*d[0]+f*d[4]+c*d[8]+d[12])/k;b.y=g/k;b.z=h/k}else b=this.position;e=this.pt;e.x=b.x;e.y=b.y-this.xi.y;e.z=b.z;this.cj.R=this.xi;b=a;this.ju&&(b=this.f.Tn,b=new p(a.x+b.x,a.y+b.y,a.z+b.z));this.f.An.FA(this.pt,b,this.cj,3,null,F(this,this.qt),this.fg)},qt:function(a,b,c){this.f.nr()&&(a=this.cj.R,b.x*=a.x,b.y*=a.y,b.z*=a.z);a=this.mi;a.x=b.x;a.y=b.y;a.z=b.z;b=this.mi;a=this.pt;var d=this.Rs;d.x=b.x-a.x;d.y=b.y-a.y;d.z=b.z-a.z;b=this.Rs;Math.sqrt(b.x*
b.x+b.y*b.y+b.z*b.z)>q.pb&&(b=this.position,a=this.Rs,b.x+=a.x,b.y+=a.y,b.z+=a.z,null!=this.Jv&&null!=c&&this.Jv(c))},fe:function(){null==this.sg&&(this.sg=new p(0,0,0),this.Td=new p(0,0,0));for(var a=0,b=this.ba.length;a<b;){var c=this.ba[a++],d=this.f.c,d=this.speed*Math.sqrt(d.dl/(100*d.Xq));-1!=this.Mj.indexOf(c)?(c=this.sg,c.x=-d,c.y=0,c.z=0):-1!=this.Oj.indexOf(c)?(c=this.sg,c.x=0,c.y=0,c.z=d):-1!=this.Nj.indexOf(c)?(c=this.sg,c.x=d,c.y=0,c.z=0):-1!=this.Lj.indexOf(c)&&(c=this.sg,c.x=0,c.y=
0,c.z=-d);var e=this.pf(),d=this.Ap,c=e.a[0],f=e.a[1],g=e.a[2],h=e.a[3],k=e.a[4],l=e.a[5],m=e.a[6],u=e.a[7],x=e.a[8],v=e.a[9],G=e.a[10],D=e.a[11],w=e.a[12],r=e.a[13],q=e.a[14],n=e.a[15],e=G*n-D*q,y=v*n-D*r,t=v*q-G*r,B=x*n-D*w,E=x*q-G*w,M=x*r-v*w,R=l*e-m*y+u*t,I=-(k*e-m*B+u*E),C=k*y-l*B+u*M,ba=-(k*t-l*E+m*M),N=1/(c*R+f*I+g*C+h*ba),L=m*n-u*q,Na=l*n-u*r,z=l*q-m*r,n=k*n-u*w,q=k*q-m*w,w=k*r-l*w,r=m*D-u*G,T=l*D-u*v,A=l*G-m*v,u=k*D-u*x,m=k*G-m*x,k=k*v-l*x;d.a[0]=R*N;d.a[4]=I*N;d.a[8]=C*N;d.a[12]=ba*N;d.a[1]=
-(f*e-g*y+h*t)*N;d.a[5]=(c*e-g*B+h*E)*N;d.a[9]=-(c*y-f*B+h*M)*N;d.a[13]=(c*t-f*E+g*M)*N;d.a[2]=(f*L-g*Na+h*z)*N;d.a[6]=-(c*L-g*n+h*q)*N;d.a[10]=(c*Na-f*n+h*w)*N;d.a[14]=-(c*z-f*q+g*w)*N;d.a[3]=-(f*r-g*T+h*A)*N;d.a[7]=(c*r-g*u+h*m)*N;d.a[11]=-(c*T-f*u+h*k)*N;d.a[15]=(c*A-f*m+g*k)*N;d=this.sg;c=this.Ap;f=this.Td;f.x=d.x*c.a[0]+d.y*c.a[4]+d.z*c.a[8];f.y=d.x*c.a[1]+d.y*c.a[5]+d.z*c.a[9];f.z=d.x*c.a[2]+d.y*c.a[6]+d.z*c.a[10];d=this.Fc;c=this.Td;d.x+=c.x;d.y+=c.y;d.z+=c.z}la.prototype.fe.call(this)},Ls:function(){return this.hG||
0<Math.abs(this.Fc.x)||0<Math.abs(this.Fc.y)?!0:0<Math.abs(this.Fc.z)},uz:function(){if(this.vh&&this.f.uu)this.Dp(this.Fc);else{var a=this.position,b=this.Fc;a.x+=b.x;a.y+=b.y;a.z+=b.z}},l:ta});var ue=K.BABYLON.AnaglyphFreeCamera=function(a,b,c,d){ta.call(this,a,b,d);this.fj=c*Math.PI/180;this.sb=new r;this.ii=new ta(a+"_left",new p(b.x,b.y,b.z),d);this.qj=new ta(a+"_right",new p(b.x,b.y,b.z),d);Hc.D(this,a)};n["com.babylonhx.cameras.AnaglyphFreeCamera"]=ue;ue.h=["com","babylonhx","cameras","AnaglyphFreeCamera"];
ue.V=ta;ue.prototype=S(ta.prototype,{$x:function(a,b){var c=this.we,d=-c.x,e=-c.y,f=-c.z,g=new r;g.a[0]=1;g.a[1]=0;g.a[2]=0;g.a[3]=0;g.a[4]=0;g.a[5]=1;g.a[6]=0;g.a[7]=0;g.a[8]=0;g.a[9]=0;g.a[10]=1;g.a[11]=0;g.a[12]=0;g.a[13]=0;g.a[14]=0;g.a[15]=1;r.da(1,0,0,0,1,0,0,0,1,d,e,f,g);d=new r;e=Math.sin(a);f=Math.cos(a);d.a[5]=1;d.a[15]=1;d.a[0]=f;d.a[2]=-e;d.a[8]=e;d.a[10]=f;d.a[1]=0;d.a[3]=0;d.a[4]=0;d.a[6]=0;d.a[7]=0;d.a[9]=0;d.a[11]=0;d.a[12]=0;d.a[13]=0;d.a[14]=0;g.qa(d,this.sb.a,0);g=this.sb;d=c.x;
e=c.y;f=c.z;c=new r;c.a[0]=1;c.a[1]=0;c.a[2]=0;c.a[3]=0;c.a[4]=0;c.a[5]=1;c.a[6]=0;c.a[7]=0;c.a[8]=0;c.a[9]=0;c.a[10]=1;c.a[11]=0;c.a[12]=0;c.a[13]=0;c.a[14]=0;c.a[15]=1;r.da(1,0,0,0,1,0,0,0,1,d,e,f,c);d=new r;g.qa(c,d.a,0);this.sb=d;var d=this.position,c=d.x,g=d.y,d=d.z,e=this.sb.a,f=c*e[1]+g*e[5]+d*e[9]+e[13],h=c*e[2]+g*e[6]+d*e[10]+e[14],k=c*e[3]+g*e[7]+d*e[11]+e[15];b.x=(c*e[0]+g*e[4]+d*e[8]+e[12])/k;b.y=f/k;b.z=h/k},dd:function(){this.$x(-this.fj,this.ii.position);this.$x(this.fj,this.qj.position);
this.ln(this.ii);this.ln(this.qj);ta.prototype.dd.call(this)},ln:function(a){a.Sb=this.Sb;a.Fb=this.Fb;a.Sa=this.Sa;a.viewport=this.viewport;a.Kl(this.we)},l:ue});var Sd=K.BABYLON.FollowCamera=function(a,b,c){this.wf=50;this.qu=.05;this.fv=30;this.aw=0;this.R=12;la.call(this,a,b,c)};n["com.babylonhx.cameras.FollowCamera"]=Sd;Sd.h=["com","babylonhx","cameras","FollowCamera"];Sd.V=la;Sd.prototype=S(la.prototype,{iO:function(a){var b=this.aw*Math.PI/180+a.Kb.y,c=(a.position.x+Math.sin(b)*this.R-this.position.x)*
this.qu*2,d=(a.position.y+this.fv-this.position.y)*this.qu,b=(a.position.z+Math.cos(b)*this.R-this.position.z)*this.qu*2;if(c>this.wf||c<-this.wf)1>c?c=-this.wf:c=this.wf;if(d>this.wf||d<-this.wf)1>d?d=-this.wf:d=this.wf;if(b>this.wf||b<-this.wf)1>b?b=-this.wf:b=this.wf;this.position.x+=c;this.position.y+=d;this.position.z+=b;this.Kl(a.position)},l:Sd});var ve=K.BABYLON.TouchCamera=function(a,b,c){this.WJ=500;this.Jk=[];this.Jm=this.Km=-Infinity;ta.call(this,a,b,c);this.tn=2E5};n["com.babylonhx.cameras.TouchCamera"]=
ve;ve.h=["com","babylonhx","cameras","TouchCamera"];ve.V=ta;ve.prototype=S(ta.prototype,{attachControl:function(a,b,c,d){null==d&&(d=!0);null==c&&(c=!0);null==b&&(b=!1);var e=this,f=null;null==this.df&&(this.df=function(a,b,c){e.Jk.push(c);1==e.Jk.length&&(f={x:a,y:b})},this.ef=function(a,b,c){a=e.Jk.indexOf(c);-1!=a&&(e.Jk.splice(a,1),0==a&&(f=null,e.Jm=-Infinity,e.Km=-Infinity))},this.vg=function(a,b,c,d,m){null!=f&&0==e.Jk.indexOf(m)&&(e.Jm=a-f.x,e.Km=-(b-f.y))},this.Fk=function(){e.Jm=-Infinity;
e.Km=-Infinity});this.f.c.ek.push(this.df);this.f.c.gk.push(this.ef);this.f.c.fk.push(this.vg)},le:function(){Z.remove(this.f.c.ek,this.df);Z.remove(this.f.c.gk,this.ef);Z.remove(this.f.c.fk,this.vg)},fe:function(){if(-Infinity!=this.Jm)if(this.Ub.y+=this.Jm/this.tn,1<this.Jk.length)this.Ub.x+=-this.Km/this.tn;else{var a=this.f.c,a=this.speed*Math.sqrt(a.dl/(100*a.Xq))*this.Km/this.WJ,b=r.Ma,c=.5*this.rotation.x,d=.5*this.rotation.y,e=Math.sin(0),f=Math.cos(0),g=Math.sin(c),c=Math.cos(c),h=Math.sin(d),
d=Math.cos(d);b.x=d*g*f+h*c*e;b.y=h*c*f-d*g*e;b.z=d*c*e-h*g*f;b.o=d*c*f+h*g*e;r.Ma.yf(this.ei);b=this.Fc;e=new p(0,0,0);f=this.ei.a;g=0*f[1]+0*f[5]+a*f[9]+f[13];d=0*f[2]+0*f[6]+a*f[10]+f[14];c=0*f[3]+0*f[7]+a*f[11]+f[15];e.x=(0*f[0]+0*f[4]+a*f[8]+f[12])/c;e.y=g/c;e.z=d/c;b.x+=e.x;b.y+=e.y;b.z+=e.z}ta.prototype.fe.call(this)},l:ve});var Xc=K.BABYLON.VRCameraMetrics=function(){this.vu=!0};n["com.babylonhx.cameras.VRCameraMetrics"]=Xc;Xc.h=["com","babylonhx","cameras","VRCameraMetrics"];Xc.js=function(){var a=
new Xc;a.SI=1280;a.FM=800;a.or=.149759993;a.GM=.0935999975;a.SP=.0467999987;a.qI=.0410000011;a.yB=.063500002;a.lB=.064000003;a.dI=[1,.219999999,.239999995,0];a.UN=[.995999992,-.00400000019,1.01400006,0];a.Pv=1.714605507808412;a.uJ=.151976421;return a};Xc.prototype={xj:function(){return this.SI/(2*this.FM)},mH:function(){return 2*Math.atan(this.Pv*this.GM/(2*this.qI))},RA:function(){var a=4*(this.or/4-this.yB/2)/this.or,b=new r;b.a[0]=1;b.a[1]=0;b.a[2]=0;b.a[3]=0;b.a[4]=0;b.a[5]=1;b.a[6]=0;b.a[7]=
0;b.a[8]=0;b.a[9]=0;b.a[10]=1;b.a[11]=0;b.a[12]=0;b.a[13]=0;b.a[14]=0;b.a[15]=1;r.da(1,0,0,0,1,0,0,0,1,a,0,0,b);return b},ZA:function(){var a=4*(this.or/4-this.yB/2)/this.or,b=new r;b.a[0]=1;b.a[1]=0;b.a[2]=0;b.a[3]=0;b.a[4]=0;b.a[5]=1;b.a[6]=0;b.a[7]=0;b.a[8]=0;b.a[9]=0;b.a[10]=1;b.a[11]=0;b.a[12]=0;b.a[13]=0;b.a[14]=0;b.a[15]=1;r.da(1,0,0,0,1,0,0,0,1,-a,0,0,b);return b},SA:function(){var a=.5*this.lB,b=new r;b.a[0]=1;b.a[1]=0;b.a[2]=0;b.a[3]=0;b.a[4]=0;b.a[5]=1;b.a[6]=0;b.a[7]=0;b.a[8]=0;b.a[9]=
0;b.a[10]=1;b.a[11]=0;b.a[12]=0;b.a[13]=0;b.a[14]=0;b.a[15]=1;r.da(1,0,0,0,1,0,0,0,1,a,0,0,b);return b},$A:function(){var a=-.5*this.lB,b=new r;b.a[0]=1;b.a[1]=0;b.a[2]=0;b.a[3]=0;b.a[4]=0;b.a[5]=1;b.a[6]=0;b.a[7]=0;b.a[8]=0;b.a[9]=0;b.a[10]=1;b.a[11]=0;b.a[12]=0;b.a[13]=0;b.a[14]=0;b.a[15]=1;r.da(1,0,0,0,1,0,0,0,1,a,0,0,b);return b},l:Xc,F:{$A:"get_rightPreViewMatrix",SA:"get_leftPreViewMatrix",ZA:"get_rightHMatrix",RA:"get_leftHMatrix"}};var xe=K.BABYLON.VRDeviceOrientationFreeCamera=function(a,
b,c,d){null==d&&(d=!0);this.ex=this.kx=this.vk=0;ta.call(this,a,b,c);a=Xc.js();a.vu=d;this.Jl(20,{Kw:a})};n["com.babylonhx.cameras.VRDeviceOrientationFreeCamera"]=xe;xe.h=["com","babylonhx","cameras","VRDeviceOrientationFreeCamera"];xe.V=ta;xe.prototype=S(ta.prototype,{Iy:function(a){this.ex=+a.alpha|0;this.kx=+a.beta|0;this.vk=+a.gamma|0;this.vk=0>this.vk?90+this.vk:270-this.vk;this.rotation.x=this.vk/180*Math.PI;this.rotation.y=-this.ex/180*Math.PI;this.rotation.z=this.kx/180*Math.PI},attachControl:function(a,
b){null==b&&(b=!1);ta.prototype.attachControl.call(this,a,b);window.addEventListener("deviceorientation",F(this,this.Iy))},le:function(a){ta.prototype.le.call(this,a);window.removeEventListener("deviceorientation",F(this,this.Iy))},l:xe});var we=K.BABYLON.WebVRFreeCamera=function(a,b,c,d){null==d&&(d=!0);this.$t=!1;this.xp=new p(0,0,0);this.mx=new X;this.yk=this.Zm=this.$l=null;ta.call(this,a,b,c);a=Xc.js();a.vu=d;this.Jl(20,{Kw:a})};n["com.babylonhx.cameras.WebVRFreeCamera"]=we;we.h=["com","babylonhx",
"cameras","WebVRFreeCamera"];we.V=ta;we.prototype=S(ta.prototype,{cy:function(a){var b=a.length,c=0;for(this.yk=this.Zm=null;c<b&&null==this.yk;){var d=a[c];"HMDVRDevice"==ec.ND(null==d?null:z.yh(d))&&(this.yk=a[c]);++c}for(c=0;c<b&&null==this.Zm;)d=a[c],"PositionSensorVRDevice"==ec.ND(null==d?null:z.yh(d))&&(null!=this.yk?a[c].TI==this.yk.TI:1)&&(this.Zm=a[c]),++c;this.$t=null!=this.Zm&&null!=this.yk},fe:function(){if(this.$t){this.$l=this.Zm.rO();var a=this.mx;a.x=this.$l.orientation.x;a.y=this.$l.orientation.y;
a.z=this.$l.orientation.z;a.o=this.$l.orientation.o;this.mx.fM(this.xp);this.rotation.x=-this.xp.x;this.rotation.y=-this.xp.y;this.rotation.z=this.xp.z}ta.prototype.fe.call(this)},attachControl:function(a,b){null==b&&(b=!1);ta.prototype.attachControl.call(this,a,b);var c=window.navigator;null!=c.g?c.g().then(F(this,this.cy)):null!=c.da&&c.da(F(this,this.cy))},le:function(a){ta.prototype.le.call(this,a);this.$t=!1},l:we});var Eb=K.BABYLON.Collider=function(){this.Ss=new p(0,0,0);this.Ok=new p(0,0,
0);this.Fp=new p(0,0,0);this.We=new p(0,0,0);this.Vc=new p(0,0,0);this.Tk=new p(0,0,0);this.Wt=new p(0,0,0);this.Vt=new p(0,0,0);this.je=new p(0,0,0);this.eq=new p(0,0,0);this.og=new p(0,0,0);this.PB=new p(0,0,0);this.OD=new p(0,0,0);this.Dq=new p(0,0,0);this.Zv=0;this.R=new p(1,1,1)};n["com.babylonhx.collisions.Collider"]=Eb;Eb.h=["com","babylonhx","collisions","Collider"];Eb.NM=function(a,b,c,d){return a.x>c.x+d||c.x-d>b.x||a.y>c.y+d||c.y-d>b.y||a.z>c.z+d||c.z-d>b.z?!1:!0};Eb.Af=function(a,b,c,
d){var e=b*b-4*a*c;c={root:0,yi:!1};if(0>e)return c;var f=Math.sqrt(e),e=(-b-f)/(2*a);a=(-b+f)/(2*a);e>a&&(b=a,a=e,e=b);if(0<e&&e<d)return c.root=e,c.yi=!0,c;0<a&&a<d&&(c.root=a,c.yi=!0);return c};Eb.prototype={dt:function(a,b,c){this.Se=b;var d=this.PB;d.x=b.x;d.y=b.y;d.z=b.z;d.normalize();this.sh=a;var d=this.R,e=this.Dq;e.x=a.x*d.x;e.y=a.y*d.y;e.z=a.z*d.z;a=this.R;d=this.OD;d.x=b.x*a.x;d.y=b.y*a.y;d.z=b.z*a.z;b=this.OD;this.Jw=Math.sqrt(b.x*b.x+b.y*b.y+b.z*b.z);this.nI=c;this.Lq=!1},lF:function(a,
b,c,d,e){var f=this.je;f.x=b.x-a.x;f.y=b.y-a.y;f.z=b.z-a.z;b=this.Vt;b.x=c.x-a.x;b.y=c.y-a.y;b.z=c.z-a.z;c=this.je;b=this.Vt;f=this.Tk;f.x=c.y*b.z-c.z*b.y;f.y=c.z*b.x-c.x*b.z;f.z=c.x*b.y-c.y*b.x;c=this.Tk;c=c.x*e.x+c.y*e.y+c.z*e.z;if(0>c)return!1;c=this.Wt;c.x=d.x-a.x;c.y=d.y-a.y;c.z=d.z-a.z;a=this.Vt;d=this.Wt;c=this.Tk;c.x=a.y*d.z-a.z*d.y;c.y=a.z*d.x-a.x*d.z;c.z=a.x*d.y-a.y*d.x;a=this.Tk;c=a.x*e.x+a.y*e.y+a.z*e.z;if(0>c)return!1;a=this.Wt;d=this.je;c=this.Tk;c.x=a.y*d.z-a.z*d.y;c.y=a.z*d.x-a.x*
d.z;c.z=a.x*d.y-a.y*d.x;a=this.Tk;c=a.x*e.x+a.y*e.y+a.z*e.z;return 0<=c},wx:function(a,b,c,d){var e=this.Dq,f=e.x-a.x,g=e.y-a.y;a=e.z-a.z;e=Math.max(Math.max(this.R.x,this.R.y),this.R.z);return Math.sqrt(f*f+g*g+a*a)>this.Jw+e+b||!Eb.NM(c,d,this.Dq,this.Jw+e)?!1:!0},OG:function(a,b,c,d,e){var f=0,g=!1;null==b.tj&&(b.tj=[]);if(null==b.tj[a]){b.tj[a]=new cd(0,0,0,0);var h=b.tj[a],k=d.x-c.x,l=d.y-c.y,m=d.z-c.z,u=e.x-c.x,x=e.y-c.y,v=e.z-c.z,G=l*v-m*x,D=m*u-k*v,w=k*x-l*u,r=Math.sqrt(G*G+D*D+w*w),q;q=0!=
r?1/r:0;h.j.x=G*q;h.j.y=D*q;h.j.z=w*q;h.d=-(h.j.x*c.x+h.j.y*c.y+h.j.z*c.z)}var n=b.tj[a],y;if(null==b.Lf()){var t=this.PB,B=n.j;y=!(0>=B.x*t.x+B.y*t.y+B.z*t.z)}else y=!1;if(!y){var E=this.sh,M=n.j,R=E.x*M.x+E.y*M.y+E.z*M.z+n.d,I=n.j,C=this.Se,ba=I.x*C.x+I.y*C.y+I.z*C.z;if(0==ba){if(1<=Math.abs(R))return;g=!0;f=0}else{var f=(-1-R)/ba,N=(1-R)/ba;if(f>N)var L=N,N=f,f=L;if(1<f||0>N)return;0>f&&(f=0);1<f&&(f=1)}var z=this.og;z.x=0;z.y=0;z.z=0;var A=!1,T=1;if(!g){var F=this.sh,O=n.j,S=this.eq;S.x=F.x-O.x;
S.y=F.y-O.y;S.z=F.z-O.z;var Q=this.Se,aa=this.je;aa.x=Q.x*f;aa.y=Q.y*f;aa.z=Q.z*f;var W=this.eq,V=this.je;W.x+=V.x;W.y+=V.y;W.z+=V.z;if(this.lF(this.eq,c,d,e,n.j)){var A=!0,T=f,Z=this.og,X=this.eq;Z.x=X.x;Z.y=X.y;Z.z=X.z}}if(!A){var ea=this.Se,U=ea.x*ea.x+ea.y*ea.y+ea.z*ea.z,Ud=U,Ob=this.sh,J=this.je;J.x=Ob.x-c.x;J.y=Ob.y-c.y;J.z=Ob.z-c.z;var P=this.Se,ug=this.je,fa=2*(P.x*ug.x+P.y*ug.y+P.z*ug.z),ca=this.je,na=ca.x*ca.x+ca.y*ca.y+ca.z*ca.z-1,Y=Eb.Af(U,fa,na,T);if(Y.yi){var T=Y.root,A=!0,pa=this.og;
pa.x=c.x;pa.y=c.y;pa.z=c.z}var ha=this.sh,Fb=this.je;Fb.x=ha.x-d.x;Fb.y=ha.y-d.y;Fb.z=ha.z-d.z;var zb=this.Se,ja=this.je,fa=2*(zb.x*ja.x+zb.y*ja.y+zb.z*ja.z),ka=this.je,na=ka.x*ka.x+ka.y*ka.y+ka.z*ka.z-1,Y=Eb.Af(U,fa,na,T);if(Y.yi){var T=Y.root,A=!0,Vb=this.og;Vb.x=d.x;Vb.y=d.y;Vb.z=d.z}var ia=this.sh,Ha=this.je;Ha.x=ia.x-e.x;Ha.y=ia.y-e.y;Ha.z=ia.z-e.z;var qa=this.Se,da=this.je,fa=2*(qa.x*da.x+qa.y*da.y+qa.z*da.z),la=this.je,na=la.x*la.x+la.y*la.y+la.z*la.z-1,Y=Eb.Af(U,fa,na,T);if(Y.yi){var T=Y.root,
A=!0,rc=this.og;rc.x=e.x;rc.y=e.y;rc.z=e.z}var ed=this.Vc;ed.x=d.x-c.x;ed.y=d.y-c.y;ed.z=d.z-c.z;var Za=this.sh,ma=this.We;ma.x=c.x-Za.x;ma.y=c.y-Za.y;ma.z=c.z-Za.z;var Cc=this.Vc,Dc=Cc.x*Cc.x+Cc.y*Cc.y+Cc.z*Cc.z,sa=this.Vc,oa=this.Se,Oa=sa.x*oa.x+sa.y*oa.y+sa.z*oa.z,za=this.Vc,ta=this.We,ga=za.x*ta.x+za.y*ta.y+za.z*ta.z,Ud=Dc*-U+Oa*Oa,Ba=this.Se,eb=this.We,fa=2*Dc*(Ba.x*eb.x+Ba.y*eb.y+Ba.z*eb.z)-2*Oa*ga,va=this.We,na=Dc*(1-(va.x*va.x+va.y*va.y+va.z*va.z))+ga*ga,Y=Eb.Af(Ud,fa,na,T);if(Y.yi){var ra=
(Oa*Y.root-ga)/Dc;if(0<=ra&&1>=ra){var T=Y.root,A=!0,xa=this.Vc;xa.x*=ra;xa.y*=ra;xa.z*=ra;var Aa=this.Vc,Fa=this.og;Fa.x=c.x+Aa.x;Fa.y=c.y+Aa.y;Fa.z=c.z+Aa.z}}var Va=this.Vc;Va.x=e.x-d.x;Va.y=e.y-d.y;Va.z=e.z-d.z;var Ga=this.sh,Ia=this.We;Ia.x=d.x-Ga.x;Ia.y=d.y-Ga.y;Ia.z=d.z-Ga.z;var Da=this.Vc,Dc=Da.x*Da.x+Da.y*Da.y+Da.z*Da.z,Ma=this.Vc,Ca=this.Se,Oa=Ma.x*Ca.x+Ma.y*Ca.y+Ma.z*Ca.z,Ja=this.Vc,wa=this.We,ga=Ja.x*wa.x+Ja.y*wa.y+Ja.z*wa.z,Ud=Dc*-U+Oa*Oa,$d=this.Se,Ee=this.We,fa=2*Dc*($d.x*Ee.x+$d.y*
Ee.y+$d.z*Ee.z)-2*Oa*ga,Zc=this.We,na=Dc*(1-(Zc.x*Zc.x+Zc.y*Zc.y+Zc.z*Zc.z))+ga*ga,Y=Eb.Af(Ud,fa,na,T);if(Y.yi){var od=(Oa*Y.root-ga)/Dc;if(0<=od&&1>=od){var T=Y.root,A=!0,Sa=this.Vc;Sa.x*=od;Sa.y*=od;Sa.z*=od;var Ka=this.Vc,Ab=this.og;Ab.x=d.x+Ka.x;Ab.y=d.y+Ka.y;Ab.z=d.z+Ka.z}}var Qa=this.Vc;Qa.x=c.x-e.x;Qa.y=c.y-e.y;Qa.z=c.z-e.z;var La=this.sh,Ic=this.We;Ic.x=e.x-La.x;Ic.y=e.y-La.y;Ic.z=e.z-La.z;var Ta=this.Vc,Dc=Ta.x*Ta.x+Ta.y*Ta.y+Ta.z*Ta.z,ya=this.Vc,Ra=this.Se,Oa=ya.x*Ra.x+ya.y*Ra.y+ya.z*Ra.z,
Vd=this.Vc,id=this.We,ga=Vd.x*id.x+Vd.y*id.y+Vd.z*id.z,Ud=Dc*-U+Oa*Oa,fd=this.Se,jd=this.We,fa=2*Dc*(fd.x*jd.x+fd.y*jd.y+fd.z*jd.z)-2*Oa*ga,Jc=this.We,na=Dc*(1-(Jc.x*Jc.x+Jc.y*Jc.y+Jc.z*Jc.z))+ga*ga,Y=Eb.Af(Ud,fa,na,T);if(Y.yi){var Ec=(Oa*Y.root-ga)/Dc;if(0<=Ec&&1>=Ec){var T=Y.root,A=!0,ob=this.Vc;ob.x*=Ec;ob.y*=Ec;ob.z*=Ec;var Wd=this.Vc,fb=this.og;fb.x=e.x+Wd.x;fb.y=e.y+Wd.y;fb.z=e.z+Wd.z}}}if(A){var Fc=this.Se,Zd=T*Math.sqrt(Fc.x*Fc.x+Fc.y*Fc.y+Fc.z*Fc.z);if(!this.Lq||Zd<this.NB){if(null==this.ul){var gd=
this.og;this.ul=new p(gd.x,gd.y,gd.z)}else{var kd=this.ul,Qc=this.og;kd.x=Qc.x;kd.y=Qc.y;kd.z=Qc.z}this.NB=Zd;this.Lq=!0;this.tu=b.ta}}}},l:Eb};var Af=K.BABYLON.ICollisionCoordinator=function(){};n["com.babylonhx.collisions.ICollisionCoordinator"]=Af;Af.h=["com","babylonhx","collisions","ICollisionCoordinator"];Af.prototype={l:Af};var Ce=K.BABYLON.CollisionCoordinatorLegacy=function(){this.Xs=new p(0,0,0);this.Pt=new p(0,0,0);this.Ot=new p(0,0,0)};n["com.babylonhx.collisions.CollisionCoordinatorLegacy"]=
Ce;Ce.h=["com","babylonhx","collisions","CollisionCoordinatorLegacy"];Ce.xb=[Af];Ce.prototype={Wn:function(a){this.f=a},destroy:function(){},FA:function(a,b,c,d,e,f,g){var h=c.R,k=this.Ot;k.x=a.x/h.x;k.y=a.y/h.y;k.z=a.z/h.z;a=c.R;h=this.Pt;h.x=b.x/a.x;h.y=b.y/a.y;h.z=b.z/a.z;c.tu=null;c.Zv=0;c.LO=this.Pt;c.KO=this.Ot;this.Dp(this.Ot,this.Pt,c,d,this.Xs,e);b=this.Xs;d=c.R;b.x*=d.x;b.y*=d.y;b.z*=d.z;f(g,this.Xs,c.tu)},Dp:function(a,b,c,d,e,f){var g=10*q.pb;if(c.Zv>=d)e.x=a.x,e.y=a.y,e.z=a.z;else{c.dt(a,
b,g);for(var h=0,k=this.f.Xb;h<k.length;){var l=k[h];++h;l.isEnabled()&&l.pl()&&null!=l.Ga&&l!=f&&l.jF(c)}if(c.Lq){if(0!=b.x||0!=b.y||0!=b.z){h=c.Fp;h.x=a.x+b.x;h.y=a.y+b.y;h.z=a.z+b.z;h=c.NB/Math.sqrt(b.x*b.x+b.y*b.y+b.z*b.z);b.x*=h;b.y*=h;b.z*=h;h=c.sh;a.x=h.x+b.x;a.y=h.y+b.y;a.z=h.z+b.z;h=c.ul;k=c.Ok;k.x=a.x-h.x;k.y=a.y-h.y;k.z=a.z-h.z;c.Ok.normalize();h=c.Ok;k=c.nI;l=c.Ss;l.x=h.x*k;l.y=h.y*k;l.z=h.z*k;h=c.Ss;a.x+=h.x;a.y+=h.y;a.z+=h.z;h=c.ul;k=c.Ss;h.x+=k.x;h.y+=k.y;h.z+=k.z;var h=c.Ok,k=c.ul,
l=c.Ok,m=c.Fp,k=m.x*l.x+m.y*l.y+m.z*l.z+-(l.x*k.x+l.y*k.y+l.z*k.z);h.x*=k;h.y*=k;h.z*=k;h=c.Fp;k=c.Ok;h.x-=k.x;h.y-=k.y;h.z-=k.z;h=c.Fp;k=c.ul;b.x=h.x-k.x;b.y=h.y-k.y;b.z=h.z-k.z}Math.sqrt(b.x*b.x+b.y*b.y+b.z*b.z)<=g?(e.x=a.x,e.y=a.y,e.z=a.z):(c.Zv++,this.Dp(a,b,c,d,e,f))}else e.x=a.x+b.x,e.y=a.y+b.y,e.z=a.z+b.z}},l:Ce};var Fe=K.BABYLON.IntersectionInfo=function(a,b,c){this.Wq=this.Sg=0;this.ou=a;this.pu=b;this.Rb=c};n["com.babylonhx.collisions.IntersectionInfo"]=Fe;Fe.h=["com","babylonhx","collisions",
"IntersectionInfo"];Fe.prototype={l:Fe};var dd=K.BABYLON.PickingInfo=function(){this.Yb=null;this.Sg=0;this.Wq=-1;this.ou=this.pu=0;this.PK=this.hb=null;this.Rb=0;this.sf=!1};n["com.babylonhx.collisions.PickingInfo"]=dd;dd.h=["com","babylonhx","collisions","PickingInfo"];dd.prototype={l:dd};var pa=K.BABYLON.BoundingBox=function(a,b){this.yb=[];this.gg=Array(8);this.w=Array(3);this.Ab=Array(8);this.Gb=a;this.Mb=b;var c=this.Gb;this.Ab[0]=new p(c.x,c.y,c.z);c=this.Mb;this.Ab[1]=new p(c.x,c.y,c.z);c=
this.Gb;this.Ab[2]=new p(c.x,c.y,c.z);this.Ab[2].x=this.Mb.x;c=this.Gb;this.Ab[3]=new p(c.x,c.y,c.z);this.Ab[3].y=this.Mb.y;c=this.Gb;this.Ab[4]=new p(c.x,c.y,c.z);this.Ab[4].z=this.Mb.z;c=this.Mb;this.Ab[5]=new p(c.x,c.y,c.z);this.Ab[5].z=this.Gb.z;c=this.Mb;this.Ab[6]=new p(c.x,c.y,c.z);this.Ab[6].x=this.Gb.x;c=this.Mb;this.Ab[7]=new p(c.x,c.y,c.z);this.Ab[7].y=this.Gb.y;var c=this.Mb,d=this.Gb;this.oa=new p(.5*(c.x+d.x),.5*(c.y+d.y),.5*(c.z+d.z));c=this.Mb;d=this.Gb;this.N=new p(.5*(c.x-d.x),.5*
(c.y-d.y),.5*(c.z-d.z));this.w=[new p(0,0,0),new p(0,0,0),new p(0,0,0)].slice(0);c=0;for(d=this.Ab.length;c<d;)this.gg[c++]=new p(0,0,0);this.fa=new p(0,0,0);this.ea=new p(0,0,0);c=new r;c.a[0]=1;c.a[1]=0;c.a[2]=0;c.a[3]=0;c.a[4]=0;c.a[5]=1;c.a[6]=0;c.a[7]=0;c.a[8]=0;c.a[9]=0;c.a[10]=1;c.a[11]=0;c.a[12]=0;c.a[13]=0;c.a[14]=0;c.a[15]=1;d=this.fa;d.x=Infinity;d.y=Infinity;d.z=Infinity;d=this.ea;d.x=-Infinity;d.y=-Infinity;d.z=-Infinity;for(var e,f,g,d=0,h=this.Ab.length;d<h;){e=d++;pa.g=this.gg[e];
var k=this.Ab[e];e=pa.g;f=k.x;g=k.y;var k=k.z,l=c.a,m=f*l[1]+g*l[5]+k*l[9]+l[13],u=f*l[2]+g*l[6]+k*l[10]+l[14],x=f*l[3]+g*l[7]+k*l[11]+l[15];e.x=(f*l[0]+g*l[4]+k*l[8]+l[12])/x;e.y=m/x;e.z=u/x;e=pa.g.x;f=pa.g.y;g=pa.g.z;e<this.fa.x&&(this.fa.x=e);f<this.fa.y&&(this.fa.y=f);g<this.fa.z&&(this.fa.z=g);e>this.ea.x&&(this.ea.x=e);f>this.ea.y&&(this.ea.y=f);g>this.ea.z&&(this.ea.z=g)}d=this.ea;h=this.fa;e=this.oa;e.x=d.x+h.x;e.y=d.y+h.y;e.z=d.z+h.z;d=this.oa;d.x*=.5;d.y*=.5;d.z*=.5;d=c.a;h=this.w[0];h.x=
d[0];h.y=d[1];h.z=d[2];d=c.a;h=this.w[1];h.x=d[4];h.y=d[5];h.z=d[6];d=c.a;h=this.w[2];h.x=d[8];h.y=d[9];h.z=d[10];this.Ea=c};n["com.babylonhx.culling.BoundingBox"]=pa;pa.h=["com","babylonhx","culling","BoundingBox"];pa.xb=[Nb];pa.Bb=function(a,b){return a.ea.x<b.fa.x||a.fa.x>b.ea.x||a.ea.y<b.fa.y||a.fa.y>b.ea.y||a.ea.z<b.fa.z||a.fa.z>b.ea.z?!1:!0};pa.be=function(a,b){for(var c=0;6>c;){for(var d=c++,e=8,f=0;8>f;){var g=b[d],h=a[f++];if(0>g.j.x*h.x+g.j.y*h.y+g.j.z*h.z+g.d)--e;else break}if(0==e)return!1}return!0};
pa.prototype={l:pa};var Gb=K.BABYLON.BoundingInfo=function(a,b){this.Ak=!1;this.Gb=a;this.Mb=b;this.yc=new pa(a,b);this.Oc=new ae(a,b)};n["com.babylonhx.culling.BoundingInfo"]=Gb;Gb.h=["com","babylonhx","culling","BoundingInfo"];Gb.prototype={Ki:function(a){return this.Oc.Ki(a)?pa.be(this.yc.gg,a):!1},Ji:function(a,b){null==b&&(b=!1);var c,d,e,f,g,h,k,l,m,u,x,v,G,D,w,r,q,n,y,t,B,E,M,R,I,C,ba,N,L,z,A,T,F,O,S,Q,aa,W,Y,fa,U,ea,V,Z,ca;if(null==this.Oc.Gc||null==a.Oc.Gc||!ae.Bb(this.Oc,a.Oc)||!pa.Bb(this.yc,
a.yc))return!1;if(b)return!0;var J=this.yc,P=a.yc,X=J.w[0],ha=J.oa,ja=ha.x*X.x+ha.y*X.y+ha.z*X.z,na=J.w[0],ka=J.w[1],la=J.w[2],ia=Math.abs(na.x*X.x+na.y*X.y+na.z*X.z)*J.N.x+Math.abs(ka.x*X.x+ka.y*X.y+ka.z*X.z)*J.N.y+Math.abs(la.x*X.x+la.y*X.y+la.z*X.z)*J.N.z;ca=ja-ia;Z=ja+ia;var Fb=P.oa,zb=Fb.x*X.x+Fb.y*X.y+Fb.z*X.z,qa=P.w[0],da=P.w[1],Vb=P.w[2],ga=Math.abs(qa.x*X.x+qa.y*X.y+qa.z*X.z)*P.N.x+Math.abs(da.x*X.x+da.y*X.y+da.z*X.z)*P.N.y+Math.abs(Vb.x*X.x+Vb.y*X.y+Vb.z*X.z)*P.N.z;V=zb-ga;if(ca>zb+ga||
V>Z)return!1;var Ha=J.w[1],ma=J.oa,sa=ma.x*Ha.x+ma.y*Ha.y+ma.z*Ha.z,oa=J.w[0],rc=J.w[1],ed=J.w[2],Za=Math.abs(oa.x*Ha.x+oa.y*Ha.y+oa.z*Ha.z)*J.N.x+Math.abs(rc.x*Ha.x+rc.y*Ha.y+rc.z*Ha.z)*J.N.y+Math.abs(ed.x*Ha.x+ed.y*Ha.y+ed.z*Ha.z)*J.N.z;ea=sa-Za;U=sa+Za;var va=P.oa,Cc=va.x*Ha.x+va.y*Ha.y+va.z*Ha.z,Dc=P.w[0],ra=P.w[1],ta=P.w[2],Oa=Math.abs(Dc.x*Ha.x+Dc.y*Ha.y+Dc.z*Ha.z)*P.N.x+Math.abs(ra.x*Ha.x+ra.y*Ha.y+ra.z*Ha.z)*P.N.y+Math.abs(ta.x*Ha.x+ta.y*Ha.y+ta.z*Ha.z)*P.N.z;fa=Cc-Oa;if(ea>Cc+Oa||fa>U)return!1;
var za=J.w[2],xa=J.oa,Ba=xa.x*za.x+xa.y*za.y+xa.z*za.z,Aa=J.w[0],eb=J.w[1],Fa=J.w[2],Ga=Math.abs(Aa.x*za.x+Aa.y*za.y+Aa.z*za.z)*J.N.x+Math.abs(eb.x*za.x+eb.y*za.y+eb.z*za.z)*J.N.y+Math.abs(Fa.x*za.x+Fa.y*za.y+Fa.z*za.z)*J.N.z;Y=Ba-Ga;W=Ba+Ga;var Ia=P.oa,Ma=Ia.x*za.x+Ia.y*za.y+Ia.z*za.z,Ca=P.w[0],Va=P.w[1],Ja=P.w[2],wa=Math.abs(Ca.x*za.x+Ca.y*za.y+Ca.z*za.z)*P.N.x+Math.abs(Va.x*za.x+Va.y*za.y+Va.z*za.z)*P.N.y+Math.abs(Ja.x*za.x+Ja.y*za.y+Ja.z*za.z)*P.N.z;aa=Ma-wa;if(Y>Ma+wa||aa>W)return!1;var Da=P.w[0],
Qa=J.oa,ya=Qa.x*Da.x+Qa.y*Da.y+Qa.z*Da.z,Ra=J.w[0],lb=J.w[1],$d=J.w[2],Ee=Math.abs(Ra.x*Da.x+Ra.y*Da.y+Ra.z*Da.z)*J.N.x+Math.abs(lb.x*Da.x+lb.y*Da.y+lb.z*Da.z)*J.N.y+Math.abs($d.x*Da.x+$d.y*Da.y+$d.z*Da.z)*J.N.z;Q=ya-Ee;S=ya+Ee;var Zc=P.oa,od=Zc.x*Da.x+Zc.y*Da.y+Zc.z*Da.z,Sa=P.w[0],Ka=P.w[1],Ab=P.w[2],vb=Math.abs(Sa.x*Da.x+Sa.y*Da.y+Sa.z*Da.z)*P.N.x+Math.abs(Ka.x*Da.x+Ka.y*Da.y+Ka.z*Da.z)*P.N.y+Math.abs(Ab.x*Da.x+Ab.y*Da.y+Ab.z*Da.z)*P.N.z;O=od-vb;if(Q>od+vb||O>S)return!1;var La=P.w[1],Ic=J.oa,Ta=
Ic.x*La.x+Ic.y*La.y+Ic.z*La.z,Gb=J.w[0],jb=J.w[1],Vd=J.w[2],id=Math.abs(Gb.x*La.x+Gb.y*La.y+Gb.z*La.z)*J.N.x+Math.abs(jb.x*La.x+jb.y*La.y+jb.z*La.z)*J.N.y+Math.abs(Vd.x*La.x+Vd.y*La.y+Vd.z*La.z)*J.N.z;F=Ta-id;T=Ta+id;var fd=P.oa,jd=fd.x*La.x+fd.y*La.y+fd.z*La.z,Jc=P.w[0],Ec=P.w[1],ob=P.w[2],Wd=Math.abs(Jc.x*La.x+Jc.y*La.y+Jc.z*La.z)*P.N.x+Math.abs(Ec.x*La.x+Ec.y*La.y+Ec.z*La.z)*P.N.y+Math.abs(ob.x*La.x+ob.y*La.y+ob.z*La.z)*P.N.z;A=jd-Wd;if(F>jd+Wd||A>T)return!1;var fb=P.w[2],Fc=J.oa,Zd=Fc.x*fb.x+
Fc.y*fb.y+Fc.z*fb.z,gd=J.w[0],kd=J.w[1],Qc=J.w[2],gb=Math.abs(gd.x*fb.x+gd.y*fb.y+gd.z*fb.z)*J.N.x+Math.abs(kd.x*fb.x+kd.y*fb.y+kd.z*fb.z)*J.N.y+Math.abs(Qc.x*fb.x+Qc.y*fb.y+Qc.z*fb.z)*J.N.z;z=Zd-gb;L=Zd+gb;var Xd=P.oa,rb=Xd.x*fb.x+Xd.y*fb.y+Xd.z*fb.z,nb=P.w[0],vg=P.w[1],wg=P.w[2],Xa=Math.abs(nb.x*fb.x+nb.y*fb.y+nb.z*fb.z)*P.N.x+Math.abs(vg.x*fb.x+vg.y*fb.y+vg.z*fb.z)*P.N.y+Math.abs(wg.x*fb.x+wg.y*fb.y+wg.z*fb.z)*P.N.z;N=rb-Xa;if(z>rb+Xa||N>L)return!1;var Ea=J.w[0],cb=P.w[0],pb=new p(0,0,0);pb.x=
Ea.y*cb.z-Ea.z*cb.y;pb.y=Ea.z*cb.x-Ea.x*cb.z;pb.z=Ea.x*cb.y-Ea.y*cb.x;var sb=J.oa,hc=sb.x*pb.x+sb.y*pb.y+sb.z*pb.z,ub=J.w[0],Eb=J.w[1],Wb=J.w[2],ic=Math.abs(ub.x*pb.x+ub.y*pb.y+ub.z*pb.z)*J.N.x+Math.abs(Eb.x*pb.x+Eb.y*pb.y+Eb.z*pb.z)*J.N.y+Math.abs(Wb.x*pb.x+Wb.y*pb.y+Wb.z*pb.z)*J.N.z;ba=hc-ic;C=hc+ic;var Ua=P.oa,mc=Ua.x*pb.x+Ua.y*pb.y+Ua.z*pb.z,Yb=P.w[0],$b=P.w[1],ab=P.w[2],hb=Math.abs(Yb.x*pb.x+Yb.y*pb.y+Yb.z*pb.z)*P.N.x+Math.abs($b.x*pb.x+$b.y*pb.y+$b.z*pb.z)*P.N.y+Math.abs(ab.x*pb.x+ab.y*pb.y+
ab.z*pb.z)*P.N.z;I=mc-hb;if(ba>mc+hb||I>C)return!1;var Tb=J.w[0],Jb=P.w[1],Pa=new p(0,0,0);Pa.x=Tb.y*Jb.z-Tb.z*Jb.y;Pa.y=Tb.z*Jb.x-Tb.x*Jb.z;Pa.z=Tb.x*Jb.y-Tb.y*Jb.x;var xg=J.oa,Kg=xg.x*Pa.x+xg.y*Pa.y+xg.z*Pa.z,hd=J.w[0],yg=J.w[1],ld=J.w[2],Lg=Math.abs(hd.x*Pa.x+hd.y*Pa.y+hd.z*Pa.z)*J.N.x+Math.abs(yg.x*Pa.x+yg.y*Pa.y+yg.z*Pa.z)*J.N.y+Math.abs(ld.x*Pa.x+ld.y*Pa.y+ld.z*Pa.z)*J.N.z;R=Kg-Lg;M=Kg+Lg;var zg=P.oa,mb=zg.x*Pa.x+zg.y*Pa.y+zg.z*Pa.z,Cb=P.w[0],Ag=P.w[1],Bg=P.w[2],xb=Math.abs(Cb.x*Pa.x+Cb.y*Pa.y+
Cb.z*Pa.z)*P.N.x+Math.abs(Ag.x*Pa.x+Ag.y*Pa.y+Ag.z*Pa.z)*P.N.y+Math.abs(Bg.x*Pa.x+Bg.y*Pa.y+Bg.z*Pa.z)*P.N.z;E=mb-xb;if(R>mb+xb||E>M)return!1;var md=J.w[0],wc=P.w[2],$a=new p(0,0,0);$a.x=md.y*wc.z-md.z*wc.y;$a.y=md.z*wc.x-md.x*wc.z;$a.z=md.x*wc.y-md.y*wc.x;var Ib=J.oa,yb=Ib.x*$a.x+Ib.y*$a.y+Ib.z*$a.z,Cg=J.w[0],ec=J.w[1],Nb=J.w[2],tb=Math.abs(Cg.x*$a.x+Cg.y*$a.y+Cg.z*$a.z)*J.N.x+Math.abs(ec.x*$a.x+ec.y*$a.y+ec.z*$a.z)*J.N.y+Math.abs(Nb.x*$a.x+Nb.y*$a.y+Nb.z*$a.z)*J.N.z;B=yb-tb;t=yb+tb;var fc=P.oa,
Db=fc.x*$a.x+fc.y*$a.y+fc.z*$a.z,Ub=P.w[0],sc=P.w[1],Xb=P.w[2],bc=Math.abs(Ub.x*$a.x+Ub.y*$a.y+Ub.z*$a.z)*P.N.x+Math.abs(sc.x*$a.x+sc.y*$a.y+sc.z*$a.z)*P.N.y+Math.abs(Xb.x*$a.x+Xb.y*$a.y+Xb.z*$a.z)*P.N.z;y=Db-bc;if(B>Db+bc||y>t)return!1;var qb=J.w[1],ib=P.w[0],kb=new p(0,0,0);kb.x=qb.y*ib.z-qb.z*ib.y;kb.y=qb.z*ib.x-qb.x*ib.z;kb.z=qb.x*ib.y-qb.y*ib.x;var Dg=J.oa,dc=Dg.x*kb.x+Dg.y*kb.y+Dg.z*kb.z,db=J.w[0],Lb=J.w[1],Mb=J.w[2],nc=Math.abs(db.x*kb.x+db.y*kb.y+db.z*kb.z)*J.N.x+Math.abs(Lb.x*kb.x+Lb.y*kb.y+
Lb.z*kb.z)*J.N.y+Math.abs(Mb.x*kb.x+Mb.y*kb.y+Mb.z*kb.z)*J.N.z;n=dc-nc;q=dc+nc;var Zb=P.oa,Kb=Zb.x*kb.x+Zb.y*kb.y+Zb.z*kb.z,ac=P.w[0],cc=P.w[1],uc=P.w[2],Gc=Math.abs(ac.x*kb.x+ac.y*kb.y+ac.z*kb.z)*P.N.x+Math.abs(cc.x*kb.x+cc.y*kb.y+cc.z*kb.z)*P.N.y+Math.abs(uc.x*kb.x+uc.y*kb.y+uc.z*kb.z)*P.N.z;r=Kb-Gc;if(n>Kb+Gc||r>q)return!1;var wb=J.w[1],nd=P.w[1],Hb=new p(0,0,0);Hb.x=wb.y*nd.z-wb.z*nd.y;Hb.y=wb.z*nd.x-wb.x*nd.z;Hb.z=wb.x*nd.y-wb.y*nd.x;var lc=J.oa,Nc=lc.x*Hb.x+lc.y*Hb.y+lc.z*Hb.z,xc=J.w[0],zc=
J.w[1],pc=J.w[2],tc=Math.abs(xc.x*Hb.x+xc.y*Hb.y+xc.z*Hb.z)*J.N.x+Math.abs(zc.x*Hb.x+zc.y*Hb.y+zc.z*Hb.z)*J.N.y+Math.abs(pc.x*Hb.x+pc.y*Hb.y+pc.z*Hb.z)*J.N.z;w=Nc-tc;D=Nc+tc;var Bb=P.oa,Lc=Bb.x*Hb.x+Bb.y*Hb.y+Bb.z*Hb.z,Mc=P.w[0],qc=P.w[1],Oc=P.w[2],Kc=Math.abs(Mc.x*Hb.x+Mc.y*Hb.y+Mc.z*Hb.z)*P.N.x+Math.abs(qc.x*Hb.x+qc.y*Hb.y+qc.z*Hb.z)*P.N.y+Math.abs(Oc.x*Hb.x+Oc.y*Hb.y+Oc.z*Hb.z)*P.N.z;G=Lc-Kc;if(w>Lc+Kc||G>D)return!1;var bb=J.w[1],Wa=P.w[2],Pb=new p(0,0,0);Pb.x=bb.y*Wa.z-bb.z*Wa.y;Pb.y=bb.z*Wa.x-
bb.x*Wa.z;Pb.z=bb.x*Wa.y-bb.y*Wa.x;var Wc=J.oa,Hc=Wc.x*Pb.x+Wc.y*Pb.y+Wc.z*Pb.z,Xc=J.w[0],Rc=J.w[1],$c=J.w[2],rd=Math.abs(Xc.x*Pb.x+Xc.y*Pb.y+Xc.z*Pb.z)*J.N.x+Math.abs(Rc.x*Pb.x+Rc.y*Pb.y+Rc.z*Pb.z)*J.N.y+Math.abs($c.x*Pb.x+$c.y*Pb.y+$c.z*Pb.z)*J.N.z;v=Hc-rd;x=Hc+rd;var ad=P.oa,vd=ad.x*Pb.x+ad.y*Pb.y+ad.z*Pb.z,Ac=P.w[0],Sc=P.w[1],Tc=P.w[2],Ad=Math.abs(Ac.x*Pb.x+Ac.y*Pb.y+Ac.z*Pb.z)*P.N.x+Math.abs(Sc.x*Pb.x+Sc.y*Pb.y+Sc.z*Pb.z)*P.N.y+Math.abs(Tc.x*Pb.x+Tc.y*Pb.y+Tc.z*Pb.z)*P.N.z;u=vd-Ad;if(v>vd+Ad||
u>x)return!1;var jc=J.w[2],kc=P.w[0],Qb=new p(0,0,0);Qb.x=jc.y*kc.z-jc.z*kc.y;Qb.y=jc.z*kc.x-jc.x*kc.z;Qb.z=jc.x*kc.y-jc.y*kc.x;var Uc=J.oa,Ed=Uc.x*Qb.x+Uc.y*Qb.y+Uc.z*Qb.z,Vc=J.w[0],bd=J.w[1],Pc=J.w[2],Hd=Math.abs(Vc.x*Qb.x+Vc.y*Qb.y+Vc.z*Qb.z)*J.N.x+Math.abs(bd.x*Qb.x+bd.y*Qb.y+bd.z*Qb.z)*J.N.y+Math.abs(Pc.x*Qb.x+Pc.y*Qb.y+Pc.z*Qb.z)*J.N.z;m=Ed-Hd;l=Ed+Hd;var Yc=P.oa,Id=Yc.x*Qb.x+Yc.y*Qb.y+Yc.z*Qb.z,cd=P.w[0],dd=P.w[1],pd=P.w[2],Md=Math.abs(cd.x*Qb.x+cd.y*Qb.y+cd.z*Qb.z)*P.N.x+Math.abs(dd.x*Qb.x+
dd.y*Qb.y+dd.z*Qb.z)*P.N.y+Math.abs(pd.x*Qb.x+pd.y*Qb.y+pd.z*Qb.z)*P.N.z;k=Id-Md;if(m>Id+Md||k>l)return!1;var oc=J.w[2],yc=P.w[1],Rb=new p(0,0,0);Rb.x=oc.y*yc.z-oc.z*yc.y;Rb.y=oc.z*yc.x-oc.x*yc.z;Rb.z=oc.x*yc.y-oc.y*yc.x;var qd=J.oa,Nd=qd.x*Rb.x+qd.y*Rb.y+qd.z*Rb.z,sd=J.w[0],td=J.w[1],ud=J.w[2],Od=Math.abs(sd.x*Rb.x+sd.y*Rb.y+sd.z*Rb.z)*J.N.x+Math.abs(td.x*Rb.x+td.y*Rb.y+td.z*Rb.z)*J.N.y+Math.abs(ud.x*Rb.x+ud.y*Rb.y+ud.z*Rb.z)*J.N.z;h=Nd-Od;g=Nd+Od;var wd=P.oa,Pd=wd.x*Rb.x+wd.y*Rb.y+wd.z*Rb.z,xd=
P.w[0],yd=P.w[1],zd=P.w[2],Qd=Math.abs(xd.x*Rb.x+xd.y*Rb.y+xd.z*Rb.z)*P.N.x+Math.abs(yd.x*Rb.x+yd.y*Rb.y+yd.z*Rb.z)*P.N.y+Math.abs(zd.x*Rb.x+zd.y*Rb.y+zd.z*Rb.z)*P.N.z;f=Pd-Qd;if(h>Pd+Qd||f>g)return!1;var vc=J.w[2],Bc=P.w[2],Sb=new p(0,0,0);Sb.x=vc.y*Bc.z-vc.z*Bc.y;Sb.y=vc.z*Bc.x-vc.x*Bc.z;Sb.z=vc.x*Bc.y-vc.y*Bc.x;var Bd=J.oa,Rd=Bd.x*Sb.x+Bd.y*Sb.y+Bd.z*Sb.z,Cd=J.w[0],Dd=J.w[1],Fd=J.w[2],Sd=Math.abs(Cd.x*Sb.x+Cd.y*Sb.y+Cd.z*Sb.z)*J.N.x+Math.abs(Dd.x*Sb.x+Dd.y*Sb.y+Dd.z*Sb.z)*J.N.y+Math.abs(Fd.x*Sb.x+
Fd.y*Sb.y+Fd.z*Sb.z)*J.N.z;e=Rd-Sd;d=Rd+Sd;var Gd=P.oa,Td=Gd.x*Sb.x+Gd.y*Sb.y+Gd.z*Sb.z,Jd=P.w[0],Kd=P.w[1],Ld=P.w[2],Yd=Math.abs(Jd.x*Sb.x+Jd.y*Sb.y+Jd.z*Sb.z)*P.N.x+Math.abs(Kd.x*Sb.x+Kd.y*Sb.y+Kd.z*Sb.z)*P.N.y+Math.abs(Ld.x*Sb.x+Ld.y*Sb.y+Ld.z*Sb.z)*P.N.z;c=Td-Yd;return e>Td+Yd||c>d?!1:!0},l:Gb};var ae=K.BABYLON.BoundingSphere=function(a,b){this.Eb=new p(0,0,0);var c=a.x-b.x,d=a.y-b.y,e=a.z-b.z,c=Math.sqrt(c*c+d*d+e*e);this.oa=p.D(a,b,.5);this.R=.5*c;this.Gc=new p(0,0,0);c=new r;c.a[0]=1;c.a[1]=
0;c.a[2]=0;c.a[3]=0;c.a[4]=0;c.a[5]=1;c.a[6]=0;c.a[7]=0;c.a[8]=0;c.a[9]=0;c.a[10]=1;c.a[11]=0;c.a[12]=0;c.a[13]=0;c.a[14]=0;c.a[15]=1;var d=Math.max,e=Math.abs,f=this.oa,g=this.Gc,h=f.x,k=f.y,f=f.z,l=c.a,m=h*l[1]+k*l[5]+f*l[9]+l[13],u=h*l[2]+k*l[6]+f*l[10]+l[14],x=h*l[3]+k*l[7]+f*l[11]+l[15];g.x=(h*l[0]+k*l[4]+f*l[8]+l[12])/x;g.y=m/x;g.z=u/x;g=this.Eb;g.x=c.a[0]+c.a[4]+c.a[8];g.y=c.a[1]+c.a[5]+c.a[9];g.z=c.a[2]+c.a[6]+c.a[10];this.Zf=d(d(e(this.Eb.x),e(this.Eb.y)),e(this.Eb.z))*this.R};n["com.babylonhx.culling.BoundingSphere"]=
ae;ae.h=["com","babylonhx","culling","BoundingSphere"];ae.Bb=function(a,b){var c=a.Gc.x-b.Gc.x,d=a.Gc.y-b.Gc.y,e=a.Gc.z-b.Gc.z;return a.Zf+b.Zf<Math.sqrt(c*c+d*d+e*e)?!1:!0};ae.prototype={Ki:function(a){for(var b=0;6>b;){var c=a[b++],d=this.Gc;if(c.j.x*d.x+c.j.y*d.y+c.j.z*d.z+c.d<=-this.Zf)return!1}return!0},l:ae};var Ra=K.BABYLON.Ray=function(a,b,c){this.origin=a;this.direction=b;this.length=null!=c?c:Infinity};n["com.babylonhx.culling.Ray"]=Ra;Ra.h=["com","babylonhx","culling","Ray"];Ra.ib=function(a,
b,c,d,e,f,g){var h=p.$a(new p(a,b,0),c,d,e,f,g);a=p.$a(new p(a,b,1),c,d,e,f,g);a=new p(a.x-h.x,a.y-h.y,a.z-h.z);a.normalize();return new Ra(h,a)};Ra.prototype={rr:function(a,b){var c=0,d=Infinity,e,f,g;if(1E-7>Math.abs(this.direction.x)){if(this.origin.x<a.x||this.origin.x>b.x)return!1}else if(e=1/this.direction.x,f=(a.x-this.origin.x)*e,e*=b.x-this.origin.x,-Infinity==e&&(e=Infinity),f>e&&(g=f,f=e,e=g),c=Math.max(f,0),d=Math.min(e,d),c>d)return!1;if(1E-7>Math.abs(this.direction.y)){if(this.origin.y<
a.y||this.origin.y>b.y)return!1}else if(e=1/this.direction.y,f=(a.y-this.origin.y)*e,e*=b.y-this.origin.y,-Infinity==e&&(e=Infinity),f>e&&(g=f,f=e,e=g),c=Math.max(f,c),d=Math.min(e,d),c>d)return!1;if(1E-7>Math.abs(this.direction.z)){if(this.origin.z<a.z||this.origin.z>b.z)return!1}else if(e=1/this.direction.z,f=(a.z-this.origin.z)*e,e*=b.z-this.origin.z,-Infinity==e&&(e=Infinity),f>e&&(g=f,f=e,e=g),c=Math.max(f,c),d=Math.min(e,d),c>d)return!1;return!0},jJ:function(a){var b=a.oa.x-this.origin.x,c=
a.oa.y-this.origin.y,d=a.oa.z-this.origin.z,e=b*b+c*c+d*d;a=a.R*a.R;if(e<=a)return!0;b=b*this.direction.x+c*this.direction.y+d*this.direction.z;return 0>b?!1:e-b*b<=a},kJ:function(a,b,c){null==this.Lp&&(this.Lp=new p(0,0,0),this.Mp=new p(0,0,0),this.Gt=new p(0,0,0),this.Xt=new p(0,0,0),this.hq=new p(0,0,0));var d=this.Lp;d.x=b.x-a.x;d.y=b.y-a.y;d.z=b.z-a.z;b=this.Mp;b.x=c.x-a.x;b.y=c.y-a.y;b.z=c.z-a.z;c=this.direction;b=this.Mp;d=this.Gt;d.x=c.y*b.z-c.z*b.y;d.y=c.z*b.x-c.x*b.z;d.z=c.x*b.y-c.y*b.x;
c=this.Lp;b=this.Gt;c=c.x*b.x+c.y*b.y+c.z*b.z;if(0==c)return null;c=1/c;b=this.origin;d=this.Xt;d.x=b.x-a.x;d.y=b.y-a.y;d.z=b.z-a.z;a=this.Xt;b=this.Gt;a=(a.x*b.x+a.y*b.y+a.z*b.z)*c;if(0>a||1<a)return null;b=this.Xt;var d=this.Lp,e=this.hq;e.x=b.y*d.z-b.z*d.y;e.y=b.z*d.x-b.x*d.z;e.z=b.x*d.y-b.y*d.x;b=this.direction;d=this.hq;b=(b.x*d.x+b.y*d.y+b.z*d.z)*c;if(0>b||1<a+b)return null;d=this.Mp;e=this.hq;if((d.x*e.x+d.y*e.y+d.z*e.z)*c>this.length)return null;d=this.Mp;e=this.hq;return new Fe(a,b,(d.x*
e.x+d.y*e.y+d.z*e.z)*c)},hJ:function(a,b,c){var d=this.origin,e=this.direction,f=b.x-a.x,g=b.y-a.y;b=b.z-a.z;var h=this.origin,k=d.x+e.x*Ra.Ma-h.x,l=d.y+e.y*Ra.Ma-h.y,h=d.z+e.z*Ra.Ma-h.z,m=this.origin,e=a.x-m.x,d=a.y-m.y;a=a.z-m.z;var u=f*f+g*g+b*b,x=f*k+g*l+b*h,v=k*k+l*l+h*h,p=f*e+g*d+b*a,D=k*e+l*d+h*a,w=u*v-x*x,r,q=w,n=w;w<Ra.Ta?(r=0,q=1,m=D,n=v):(r=x*D-v*p,m=u*D-x*p,0>r?(r=0,m=D,n=v):r>w&&(r=w,m=D+x,n=v));0>m?(m=0,0>-p?r=0:-p>u?r=q:(r=-p,q=u)):m>n&&(m=n,0>-p+x?r=0:-p+x>u?r=q:(r=-p+x,q=u));u=Math.abs(r)<
Ra.Ta?0:r/q;m=Math.abs(m)<Ra.Ta?0:m/n;k*=m;l*=m;h*=m;f=e+f*u-k;g=d+g*u-l;b=a+b*u-h;return 0<m&&m<=this.length&&f*f+g*g+b*b<c*c?Math.sqrt(k*k+l*l+h*h):-1},l:Ra};var Ge=K.BABYLON.IOctreeContainer=function(){};n["com.babylonhx.culling.octrees.IOctreeContainer"]=Ge;Ge.h=["com","babylonhx","culling","octrees","IOctreeContainer"];Ge.prototype={l:Ge};var Kd=K.BABYLON.Octree=function(){this.Tq=[]};n["com.babylonhx.culling.octrees.Octree"]=Kd;Kd.h=["com","babylonhx","culling","octrees","Octree"];Kd.xb=[Ge];
Kd.LE=function(a,b,c,d,e,f,g,h){g.hc=[];var k=(b.x-a.x)/2,l=(b.y-a.y)/2;b=(b.z-a.z)/2;for(var m=0;2>m;)for(var u=m++,x=0;2>x;)for(var v=x++,G=0;2>G;){var D=G++,D=new He(new p(a.x+k*u,a.y+l*v,a.z+b*D),new p(a.x+k*(u+1),a.y+l*(v+1),a.z+b*(D+1)),d,e+1,f,h);D.eH(c);g.hc.push(D)}};Kd.prototype={fu:function(a){for(var b=0,c=this.hc.length;b<c;)this.hc[b++].du(a)},sr:function(a){var b=this.Sd;b.length=0;b.Ja++;for(var b=0,c=this.hc.length;b<c;)this.hc[b++].sr(a,this.Sd);a=this.Sd;for(var b=this.Tq,c=0,d=
b.length;c<d;)a.Yf(b[c++]);return this.Sd},l:Kd};var He=K.BABYLON.OctreeBlock=function(a,b,c,d,e,f){this.Od=Array(8);this.entries=[];this.aj=c;this.Qx=d;this.zy=e;this.Ix=f;this.mt=a;this.kt=b;this.Od[0]=new p(a.x,a.y,a.z);this.Od[1]=new p(b.x,b.y,b.z);this.Od[2]=new p(a.x,a.y,a.z);this.Od[2].x=b.x;this.Od[3]=new p(a.x,a.y,a.z);this.Od[3].y=b.y;this.Od[4]=new p(a.x,a.y,a.z);this.Od[4].z=b.z;this.Od[5]=new p(b.x,b.y,b.z);this.Od[5].z=a.z;this.Od[6]=new p(b.x,b.y,b.z);this.Od[6].x=a.x;this.Od[7]=new p(b.x,
b.y,b.z);this.Od[7].y=a.y};n["com.babylonhx.culling.octrees.OctreeBlock"]=He;He.h=["com","babylonhx","culling","octrees","OctreeBlock"];He.xb=[Ge];He.prototype={LA:function(){return this.aj},du:function(a){if(null!=this.hc)for(var b=0,c=this.hc.length;b<c;)this.hc[b++].du(a);else this.Ix(a,this),this.entries.length>this.LA()&&this.Qx<this.zy&&this.QH()},eH:function(a){for(var b=0,c=a.length;b<c;)this.du(a[b++])},select:function(a,b,c){null==c&&(c=!1);if(pa.be(this.Od,a))if(null!=this.hc)for(var d=
0,e=this.hc.length;d<e;)this.hc[d++].select(a,b,c);else if(c)for(a=this.entries,c=0,d=a.length;c<d;)e=a[c++],b.data[b.length++]=e;else for(a=this.entries,c=0,d=a.length;c<d;)b.Yf(a[c++])},Ji:function(a,b,c,d){null==d&&(d=!1);var e=this.mt,f=this.kt,g=a.x;g>f.x&&(g=f.x);g<e.x&&(g=e.x);var h=a.y;h>f.y&&(h=f.y);h<e.y&&(h=e.y);var k=a.z;k>f.z&&(k=f.z);k<e.z&&(k=e.z);fa.nc[0]=new p(g,h,k);g=fa.nc[0];e=a.x-g.x;f=a.y-g.y;g=a.z-g.z;if(e*e+f*f+g*g<=b*b)if(null!=this.hc)for(e=0,f=this.hc.length;e<f;)this.hc[e++].Ji(a,
b,c,d);else if(d)for(a=this.entries,b=0,d=a.length;b<d;)e=a[b++],c.data[c.length++]=e;else for(a=this.entries,b=0,d=a.length;b<d;)c.Yf(a[b++])},sr:function(a,b){if(a.rr(this.mt,this.kt))if(null!=this.hc)for(var c=0,d=this.hc.length;c<d;)this.hc[c++].sr(a,b);else for(var c=this.entries,d=0,e=c.length;d<e;)b.Yf(c[d++])},QH:function(){Kd.LE(this.mt,this.kt,this.entries,this.aj,this.Qx,this.zy,this,this.Ix)},l:He,F:{LA:"get_capacity"}};n["com.babylonhx.d2.events.EventDispatcher"]=Vf;Vf.h=["com","babylonhx",
"d2","events","EventDispatcher"];n["com.babylonhx.d2.display.DisplayObject"]=vc;vc.h=["com","babylonhx","d2","display","DisplayObject"];vc.V=Vf;vc.prototype=S(Vf.prototype,{l:vc});n["com.babylonhx.d2.display.InteractiveObject"]=Qd;Qd.h=["com","babylonhx","d2","display","InteractiveObject"];Qd.V=vc;Qd.prototype=S(vc.prototype,{l:Qd});n["com.babylonhx.d2.display.DisplayObjectContainer"]=zd;zd.h=["com","babylonhx","d2","display","DisplayObjectContainer"];zd.V=Qd;zd.prototype=S(Qd.prototype,{l:zd});n["com.babylonhx.d2.display.Graphics"]=
Ig;Ig.h=["com","babylonhx","d2","display","Graphics"];n["com.babylonhx.d2.display.Stage"]=df;df.h=["com","babylonhx","d2","display","Stage"];df.V=zd;df.prototype=S(zd.prototype,{l:df});var ca=K.BABYLON.Color4=function(a,b,c,d){null==d&&(d=1);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.r=a;this.v=b;this.m=c;this.$=d};n["com.babylonhx.math.Color4"]=ca;ca.h=["com","babylonhx","math","Color4"];ca.xh=function(a){return"#"!=a.substring(0,1)||9!=a.length?(console.log("Color4.FromHexString must be called with a string like #FFFFFFFF"),
new ca(0,0,0,0)):ca.be(sa.$a("0x"+a.substring(1,3)),sa.$a("0x"+a.substring(3,5)),sa.$a("0x"+a.substring(5,7)),sa.$a("0x"+a.substring(7,9)))};ca.Ah=function(a,b,c){var d=new ca(0,0,0,0);ca.Dc(a,b,c,d);return d};ca.Dc=function(a,b,c,d){d.r=a.r+(b.r-a.r)*c;d.v=a.v+(b.v-a.v)*c;d.m=a.m+(b.m-a.m)*c;d.$=a.$+(b.$-a.$)*c};ca.ae=function(a,b){null==b&&(b=0);return new ca(a[b],a[b+1],a[b+2],a[b+3])};ca.be=function(a,b,c,d){return new ca(a/255,b/255,c/255,d/255)};ca.Zc=function(a,b){if(a.length==3*b){for(var c=
[],d=0;d<a.length;){var e=d/3*4|0;c[e]=a[d];c[e+1]=a[d+1];c[e+2]=a[d+2];c[e+3]=1;d+=3}return c}return a};ca.prototype={Dz:function(a){this.r+=a.r;this.v+=a.v;this.m+=a.m;this.$+=a.$;return this},tw:function(a,b){b.r=this.r-a.r;b.v=this.v-a.v;b.m=this.m-a.m;b.$=this.$-a.$;return this},fw:function(a,b){b.r=this.r*a;b.v=this.v*a;b.m=this.m*a;b.$=this.$*a;return this},Fv:function(a,b){b.r=this.r*a.r;b.v=this.v*a.v;b.m=this.m*a.m;b.$=this.$*a.$;return b},clone:function(){return new ca(this.r,this.v,this.m,
this.$)},Yz:function(a){this.r=a.r;this.v=a.v;this.m=a.m;this.$=a.$;return this},l:ca};n["com.babylonhx.layer.HighlightLayer"]=db;db.h=["com","babylonhx","layer","HighlightLayer"];db.prototype={ol:function(){return this.Da.Tz},UH:function(){function a(a){var c=a.oh,d=b.f,e=d.c,f=a.Lf().un,u=e.Cg?1029:1028;if(e.H.Pf()!=f||e.H.Eg()!=u)f?(e.H.jw(u),e.H.cg(!0)):e.H.cg(!1);e.H.Oh(0);f=c.Wx(a.cb);if(!f.Br&&null==b.uk.i[c.fg]){var u=null!=e.U.Jc&&null!=f.Ld[a.cb]&&null!=f.Ld[a.cb],x=b.vc.i[c.fg],v=a.Lf(),
p=null;null!=x&&x.wO&&null!=v&&(p=v.Dd);if(b.pa(a,u,p)){var D=b.ye,w=D.xd;e.uc!=w&&(e.b.useProgram(w),e.uc=w);e.Cf=D;null!=D.Sc&&D.Sc(D);c.wp(a,b.ye,0);e=b.ye;d=d.sb;e.Wa("viewProjection",d)&&(D=e.c,e=e.u.get("viewProjection"),D.b.uniformMatrix4fv(e,!1,d.a));null!=x?(d=b.ye,e=x.color.r,D=x.color.v,x=x.color.m,d.Oa("color",e,D,x,1)&&d.c.Tb(d.u.get("color"),e,D,x,1)):(x=b.ye,d=db.Ah.r,e=db.Ah.v,D=db.Ah.m,w=db.Ah.$,x.Oa("color",d,e,D,w)&&x.c.Tb(x.u.get("color"),d,e,D,w));null!=v&&v.Vf()&&(x=v.br(),b.ye.Hb("diffuseSampler",
x),v=b.ye,x=x.Je(),v.Wa("diffuseMatrix",x)&&(d=v.c,v=v.u.get("diffuseMatrix"),d.b.uniformMatrix4fv(v,!1,x.a)));null!=p&&(b.ye.Hb("emissiveSampler",p),v=b.ye,p=p.Je(),v.Wa("emissiveMatrix",p)&&(x=v.c,v=v.u.get("emissiveMatrix"),x.b.uniformMatrix4fv(v,!1,p.a)));c.Gg()&&c.lf&&(p=b.ye,v=c.fd(),v.Oi&&null!=c.ee?v=c.ee:(null==v.De&&v.Fl(),v=v.De),p.Qa.set("mBones",null),x=p.c,p=p.u.get("mBones"),x.b.uniformMatrix4fv(p,!1,v));c.Et(a,b.ye,0,f,u,function(a,c){var d=b.ye;if(d.Wa("world",c)){var e=d.c,d=d.u.get("world");
e.b.uniformMatrix4fv(d,!1,c.a)}})}else b.Qd.GC()}}for(var b=this,c=this.he.width*this.Da.Rz|0,d=this.he.height*this.Da.Rz|0,e=this.aq,f=1;f*=2,f<c;);f>e&&(f=e);c=f;e=this.aq;for(f=1;f*=2,f<d;);f>e&&(f=e);d=f;this.Qd=new mc("HighlightLayerMainRTT",{width:this.he.width,height:this.he.height},this.f,!1,!0,0);this.Qd.M=this.Da.Tz;this.Qd.hg=0;this.Qd.ig=0;this.Qd.Bq=1;this.Qd.CD(2);this.Qd.Yv=!1;this.Qd.mc=null;this.Wg=new mc("HighlightLayerBlurRTT",{width:c,height:d},this.f,!1,!0,0);this.Wg.hg=0;this.Wg.ig=
0;this.Wg.Bq=16;this.Wg.CD(3);this.Wg.Yv=!1;this.cm=new Nc("HighlightLayerPPP",this.Da.Rz,null,2,this.f.c);this.cm.Le.add(function(a){a.Hb("textureSampler",b.Qd)});2==this.Da.gu?(this.jm=new wd("HighlightLayerHBP",new W(1,0),this.Da.vH,1,null,2,this.f.c),this.jm.Le.add(function(a){if(a.Jb("screenSize",c,d)){var b=a.c;a=a.u.get("screenSize");b.b.uniform2f(a,c,d)}}),this.pn=new wd("HighlightLayerVBP",new W(0,1),this.Da.xH,1,null,2,this.f.c),this.pn.Le.add(function(a){if(a.Jb("screenSize",c,d)){var b=
a.c;a=a.u.get("screenSize");b.b.uniform2f(a,c,d)}})):(this.jm=new Ld("HighlightLayerHBP",new W(1,0),this.Da.vH,1,null,2,this.f.c),this.jm.Le.add(function(a){if(a.Jb("screenSize",c,d)){var b=a.c;a=a.u.get("screenSize");b.b.uniform2f(a,c,d)}}),this.pn=new Ld("HighlightLayerVBP",new W(0,1),this.Da.xH,1,null,2,this.f.c),this.pn.Le.add(function(a){if(a.Jb("screenSize",c,d)){var b=a.c;a=a.u.get("screenSize");b.b.uniform2f(a,c,d)}}));this.Qd.UB.add(function(){b.WB.la(b);b.f.El.aI([b.cm,b.jm,b.pn],b.Wg.ga);
b.cK.la(b)});this.Qd.XH=function(c,d,e){b.YB.la(b);for(var f=0,m=c.length;f<m;){var u=f++;a(c.data[u])}c=0;for(f=d.length;c<f;)m=c++,a(d.data[m]);d=0;for(c=e.length;d<c;)f=d++,a(e.data[f])};this.Qd.Iv.add(function(a){var b=db.Ah;a.H.apply(a.b);a.rb.apply(a.b);a.K.apply(a.b);var c=0;z.D(b,ca)?a.b.clearColor(b.r,b.v,b.m,b.$):a.b.clearColor(b.r,b.v,b.m,1);c|=16384;a.b.clearDepth(1);c|=256;a.b.clearStencil(0);a.b.clear(c|1024)})},pa:function(a,b,c){if(!a.Lf().pa(a.ta,b))return!1;var d=[],e=["position"],
f=a.ta,g=a.Lf(),h=a=!1;null!=g&&g.Vf()&&(g=g.br(),null!=g&&(d.push("#define ALPHATEST"),f.eb("uv2")&&1==g.If?(d.push("#define DIFFUSEUV2"),h=!0):f.eb("uv")&&(d.push("#define DIFFUSEUV1"),a=!0)));null!=c&&(d.push("#define EMISSIVE"),f.eb("uv2")&&1==c.If?(d.push("#define EMISSIVEUV2"),h=!0):f.eb("uv")&&(d.push("#define EMISSIVEUV1"),a=!0));a&&(e.push("uv"),d.push("#define UV1"));h&&(e.push("uv2"),d.push("#define UV2"));f.Gg()&&f.lf?(e.push("matricesIndices"),e.push("matricesWeights"),4<f.Ke&&(e.push("matricesIndicesExtra"),
e.push("matricesWeightsExtra")),d.push("#define NUM_BONE_INFLUENCERS "+f.Ke),d.push("#define BonesPerMesh "+(f.fd().Ge.length+1))):d.push("#define NUM_BONE_INFLUENCERS 0");b&&(d.push("#define INSTANCES"),e.push("world0"),e.push("world1"),e.push("world2"),e.push("world3"));b=d.join("\n");this.Xg!=b&&(this.Xg=b,this.ye=this.f.c.Aj("glowMapGeneration",e,"world mBones viewProjection diffuseMatrix color emissiveMatrix".split(" "),["diffuseSampler","emissiveSampler"],b));return this.ye.Mc},gb:function(){var a=
this.zN;if(a.Mc&&this.Wg.pa()){var b=this.f.c;this.XB.la(this);var c=a.xd;b.uc!=c&&(b.b.useProgram(c),b.uc=c);b.Cf=a;null!=a.Sc&&a.Sc(a);0==b.H.Pf()&&b.H.Eg()==(b.Cg?1029:1028)||b.H.cg(!1);b.H.Oh(0);var c=b.rb.Qk,d=b.rb.cn,e=b.rb.dn,f=b.bb;a.Hb("textureSampler",this.Wg);var g=this.ua,h=this.wa;if(b.qb!=g||b.Pb!=a){b.qb=g;b.Pb=a;q.sa=a.ue;for(var k=0,l=q.sa.length;k<l;){var m=k++;q.g=a.sa[m];0<=q.g&&(m=q.sa[m],q.G=null!=t[m]?g.I(m):g.i[m],null==q.G?b.na[q.g]&&(b.b.disableVertexAttribArray(q.g),b.na[q.g]=
!1):(b.na[q.g]||(b.b.enableVertexAttribArray(q.g),b.na[q.g]=!0),m=q.G.S.S,b.vertexAttribPointer(m,q.g,q.G.Db,5126,!1,4*q.G.zd,4*q.G.Cb),q.G.S.ge&&(b.U.Jc.vertexAttribDivisorANGLE(q.g,1),b.$c.push(q.g),b.rd.push(m))))}}null!=h&&b.kb!=h&&(b.kb=h,b.W.get(34963)!=h&&(b.b.bindBuffer(34963,null==h?null:h.buffer),b.W.set(34963,null==h?null:h)),b.Ud=h.Rc);g=this.Da.gu;if(b.bb!=g){switch(g){case 0:b.K.ya(!1);break;case 1:b.K.Za(770,1,0,1);b.K.ya(!0);break;case 2:b.K.Za(770,771,1,1);b.K.ya(!0);break;case 3:b.K.Za(0,
769,1,1);b.K.ya(!0);break;case 4:b.K.Za(774,0,1,1);b.K.ya(!0);break;case 5:b.K.Za(770,769,1,1);b.K.ya(!0);break;case 6:b.K.Za(1,1,0,1),b.K.ya(!0)}b.H.vb(0==g);b.bb=g}b.rb.mw(0);b.rb.zo(!0);b.rb.ZC(this.SF);if(this.FK){g=a.Qa.get("offset");if(null==g||0!=g[0])a.Qa.set("offset",[0]),g=a.c,h=a.u.get("offset"),g.b.uniform1f(h,0);b.rb.Tr(517);b.Hc(!0,0,6)}if(this.eJ){g=a.Qa.get("offset");if(null==g||1!=g[0])a.Qa.set("offset",[1]),g=a.c,a=a.u.get("offset"),g.b.uniform1f(a,1);b.rb.Tr(514);b.Hc(!0,0,6)}b.rb.Tr(d);
b.rb.mw(e);if(b.bb!=f){switch(f){case 0:b.K.ya(!1);break;case 1:b.K.Za(770,1,0,1);b.K.ya(!0);break;case 2:b.K.Za(770,771,1,1);b.K.ya(!0);break;case 3:b.K.Za(0,769,1,1);b.K.ya(!0);break;case 4:b.K.Za(774,0,1,1);b.K.ya(!0);break;case 5:b.K.Za(770,769,1,1);b.K.ya(!0);break;case 6:b.K.Za(1,1,0,1),b.K.ya(!0)}b.H.vb(0==f);b.bb=f}b.rb.zo(c);this.TB.la(this);b=this.Qd.Vu();this.GL();if(b.width!=this.he.width||b.height!=this.he.height)this.Qi.la(this),this.mA(),this.UH()}},iL:function(a){var b=this.uk.i[a.fg];
null!=b&&(a.sc.remove(b.vn),a.Kc.remove(b.hH));this.uk.i[a.fg]=null},Wv:function(a){var b=this.vc.i[a.fg];null!=b&&(a.sc.remove(b.aK),a.Kc.remove(b.$J));this.vc.i[a.fg]=null;this.ph=!1;for(a=this.vc.keys();a.Ca();)if(b=a.next(),null!=this.vc.i[b]){this.ph=!0;break}},fD:function(){return this.isEnabled?this.ph:!1},GL:function(){if(null!=this.Da.FB)this.he.width=this.Da.FB,this.he.height=this.Da.FB;else{this.he.width=this.c.fc.width*this.Da.FJ|0;this.he.height=this.c.fc.height*this.Da.FJ|0;for(var a=
this.he.width,b=this.aq,c=1;c*=2,c<a;);c>b&&(c=b);this.he.width=c;a=this.he.height;b=this.aq;for(c=1;c*=2,c<a;);c>b&&(c=b);this.he.height=c}},mA:function(){this.Wg.dispose();this.Qd.dispose();this.cm.dispose();this.jm.dispose();this.pn.dispose()},dispose:function(){var a=this.ua,a=null!=t.position?a.I("position"):a.i.position;null!=a&&(a.Df&&a.S.dispose(),a=this.ua,null!=t.position?a.C("position",null):a.i.position=null);null!=this.wa&&(a=this.wa,a.ia--,0==a.ia&&this.f.c.b.deleteBuffer(a.buffer),
this.wa=null);this.mA();for(a=this.vc.keys();a.Ca();){var b=a.next(),b=this.vc.i[b];null!=b&&null!=b.Yc&&(b.Yc.sc.remove(b.aK),b.Yc.Kc.remove(b.$J))}this.vc=null;for(a=this.uk.keys();a.Ca();)b=a.next(),b=this.uk.i[b],null!=b&&(b.Yc.sc.remove(b.vn),b.Yc.Kc.remove(b.hH));this.uk=null;a=this.f.rf.indexOf(this);-1<a&&this.f.rf.splice(a,1);this.Nb.la(this);this.Nb.clear();this.YB.clear();this.WB.clear();this.XB.clear();this.TB.clear();this.Qi.clear()},l:db,F:{ol:"get_camera"}};var eg=K.BABYLON.Layer=function(){this.Kc=
new U;this.sc=new U;this.Nb=new U;this.Gz=!1;this.gu=2;this.offset=new W(0,0);this.scale=new W(1,1)};n["com.babylonhx.layer.Layer"]=eg;eg.h=["com","babylonhx","layer","Layer"];eg.prototype={gb:function(){var a=this.Gz?this.xN:this.s;if(a.Mc&&null!=this.dk&&this.dk.pa()){var b=this.f.c;this.sc.la(this);var c=a.xd;b.uc!=c&&(b.b.useProgram(c),b.uc=c);b.Cf=a;null!=a.Sc&&a.Sc(a);0==b.H.Pf()&&b.H.Eg()==(b.Cg?1029:1028)||b.H.cg(!1);b.H.Oh(0);a.Hb("textureSampler",this.dk);c=this.dk.Je();if(a.Wa("textureMatrix",
c)){var d=a.c,e=a.u.get("textureMatrix");d.b.uniformMatrix4fv(e,!1,c.a)}var c=this.color.r,d=this.color.v,e=this.color.m,f=this.color.$;a.Oa("color",c,d,e,f)&&a.c.Tb(a.u.get("color"),c,d,e,f);c=this.offset;a.Jb("offset",c.x,c.y)&&(d=a.c,e=a.u.get("offset"),d.b.uniform2f(e,c.x,c.y));c=this.scale;a.Jb("scale",c.x,c.y)&&(d=a.c,e=a.u.get("scale"),d.b.uniform2f(e,c.x,c.y));c=this.ua;d=this.wa;if(b.qb!=c||b.Pb!=a)for(b.qb=c,b.Pb=a,q.sa=a.ue,e=0,f=q.sa.length;e<f;){var g=e++;q.g=a.sa[g];0<=q.g&&(g=q.sa[g],
q.G=null!=t[g]?c.I(g):c.i[g],null==q.G?b.na[q.g]&&(b.b.disableVertexAttribArray(q.g),b.na[q.g]=!1):(b.na[q.g]||(b.b.enableVertexAttribArray(q.g),b.na[q.g]=!0),g=q.G.S.S,b.vertexAttribPointer(g,q.g,q.G.Db,5126,!1,4*q.G.zd,4*q.G.Cb),q.G.S.ge&&(b.U.Jc.vertexAttribDivisorANGLE(q.g,1),b.$c.push(q.g),b.rd.push(g))))}null!=d&&b.kb!=d&&(b.kb=d,b.W.get(34963)!=d&&(b.b.bindBuffer(34963,null==d?null:d.buffer),b.W.set(34963,null==d?null:d)),b.Ud=d.Rc);if(this.Gz){a=this.gu;if(b.bb!=a){switch(a){case 0:b.K.ya(!1);
break;case 1:b.K.Za(770,1,0,1);b.K.ya(!0);break;case 2:b.K.Za(770,771,1,1);b.K.ya(!0);break;case 3:b.K.Za(0,769,1,1);b.K.ya(!0);break;case 4:b.K.Za(774,0,1,1);b.K.ya(!0);break;case 5:b.K.Za(770,769,1,1);b.K.ya(!0);break;case 6:b.K.Za(1,1,0,1),b.K.ya(!0)}b.H.vb(0==a);b.bb=a}b.Hc(!0,0,6);0!=b.bb&&(b.K.ya(!1),b.H.vb(!0),b.bb=0)}else b.Hc(!0,0,6);this.Kc.la(this)}},dispose:function(){var a=this.ua,a=null!=t.position?a.I("position"):a.i.position;null!=a&&(a.Df&&a.S.dispose(),a=this.ua,null!=t.position?
a.C("position",null):a.i.position=null);null!=this.wa&&(a=this.wa,a.ia--,0==a.ia&&this.f.c.b.deleteBuffer(a.buffer),this.wa=null);null!=this.dk&&(this.dk.dispose(),this.dk=null);this.f.Ig.splice(this.f.Ig.indexOf(this),1);this.Nb.la(this);this.Nb.clear();this.Kc.clear();this.sc.clear()},l:eg};var fg=K.BABYLON.LensFlare=function(){};n["com.babylonhx.lensflare.LensFlare"]=fg;fg.h=["com","babylonhx","lensflare","LensFlare"];fg.prototype={l:fg};var gg=K.BABYLON.LensFlareSystem=function(){this.Vp=!0;this.ua=
new ea;this.tb=268435455;this.nd=0;this.Hf=300;this.wB=[]};n["com.babylonhx.lensflare.LensFlareSystem"]=gg;gg.h=["com","babylonhx","lensflare","LensFlareSystem"];gg.prototype={KH:function(a){var b=null!=this.gi.Ai?this.gi.Ai():this.gi.position,c=new r;c.a[0]=1;c.a[1]=0;c.a[2]=0;c.a[3]=0;c.a[4]=0;c.a[5]=1;c.a[6]=0;c.a[7]=0;c.a[8]=0;c.a[9]=0;c.a[10]=1;c.a[11]=0;c.a[12]=0;c.a[13]=0;c.a[14]=0;c.a[15]=1;var d=this.f.sb,e=a.width,f=a.height,g=fa.Ra[0];r.da(e/2,0,0,0,-f/2,0,0,0,1,a.x+e/2,f/2+a.y,0,g);e=
fa.Ra[1];c.qa(d,e.a,0);e.qa(g,e.a,0);var c=new p(0,0,0),d=b.x,g=b.y,b=b.z,e=e.a,f=d*e[1]+g*e[5]+b*e[9]+e[13],h=d*e[2]+g*e[6]+b*e[10]+e[14],k=d*e[3]+g*e[7]+b*e[11]+e[15];c.x=(d*e[0]+g*e[4]+b*e[8]+e[12])/k;c.y=f/k;c.z=h/k;this.kh=c.x;this.lh=c.y;g=null!=this.gi.Ai?this.gi.Ai():this.gi.position;b=new p(0,0,0);c=g.x;d=g.y;g=g.z;e=this.f.za.a;f=c*e[1]+d*e[5]+g*e[9]+e[13];h=c*e[2]+d*e[6]+g*e[10]+e[14];k=c*e[3]+d*e[7]+g*e[11]+e[15];b.x=(c*e[0]+d*e[4]+g*e[8]+e[12])/k;b.y=f/k;b.z=h/k;0<this.nd&&(a.x-=this.nd,
a.y-=this.nd,a.width+=2*this.nd,a.height+=2*this.nd,b.x+=this.nd,b.y+=this.nd,this.kh+=this.nd,this.lh+=this.nd);return 0<b.z?!0:!1},YF:function(){if(!this.Vp)return!1;var a=null!=this.gi.Ai?this.gi.Ai():this.gi.position,b=this.f.M.Ch(),b=new p(a.x-b.x,a.y-b.y,a.z-b.z),a=Math.sqrt(b.x*b.x+b.y*b.y+b.z*b.z);b.normalize();b=this.f.NK(new Ra(this.f.M.Ch(),b),this.XO,!0);return b.sf?b.Rb>a:!0},gb:function(){if(!this.s.Mc)return!1;var a=this.f.c,b=this.f.M.viewport,c=a.Vb(!0),d=a.Lb(!0),b=new bd(b.x*c,
b.y*d,b.width*c,b.height*d);if(!this.KH(b)||!this.YF())return!1;d=c=0;this.kh<this.Hf+b.x?c=this.Hf+b.x-this.kh:this.kh>b.x+b.width-this.Hf?c=this.kh-b.x-b.width+this.Hf:c=0;this.lh<this.Hf+b.y?d=this.Hf+b.y-this.lh:this.lh>b.y+b.height-this.Hf?d=this.lh-b.y-b.height+this.Hf:d=0;c=(c>d?c:d)-this.nd;c>this.Hf&&(c=this.Hf);c=1-c/this.Hf;if(0>c)return!1;1<c&&(c=1);0<this.nd&&(b.x+=this.nd,b.y+=this.nd,b.width-=2*this.nd,b.height-=2*this.nd,this.kh-=this.nd,this.lh-=this.nd);var d=b.x+b.width/2,e=b.y+
b.height/2,f=d-this.kh,g=e-this.lh,h=this.s,k=h.xd;a.uc!=k&&(a.b.useProgram(k),a.uc=k);a.Cf=h;null!=h.Sc&&h.Sc(h);0==a.H.Pf()&&a.H.Eg()==(a.Cg?1029:1028)||a.H.cg(!1);a.H.Oh(0);a.H.Pe(!1);6!=a.bb&&(a.K.Za(1,1,0,1),a.K.ya(!0),a.H.vb(!1),a.bb=6);var h=this.ua,k=this.wa,l=this.s;if(a.qb!=h||a.Pb!=l){a.qb=h;a.Pb=l;q.sa=l.ue;for(var m=0,u=q.sa.length;m<u;){var x=m++;q.g=l.sa[x];0<=q.g&&(x=q.sa[x],q.G=null!=t[x]?h.I(x):h.i[x],null==q.G?a.na[q.g]&&(a.b.disableVertexAttribArray(q.g),a.na[q.g]=!1):(a.na[q.g]||
(a.b.enableVertexAttribArray(q.g),a.na[q.g]=!0),x=q.G.S.S,a.vertexAttribPointer(x,q.g,q.G.Db,5126,!1,4*q.G.zd,4*q.G.Cb),q.G.S.ge&&(a.U.Jc.vertexAttribDivisorANGLE(q.g,1),a.$c.push(q.g),a.rd.push(x))))}}null!=k&&a.kb!=k&&(a.kb=k,a.W.get(34963)!=k&&(a.b.bindBuffer(34963,null==k?null:k.buffer),a.W.set(34963,null==k?null:k)),a.Ud=k.Rc);h=0;for(k=this.wB.length;h<k;){var l=this.wB[h++],u=l.size,x=l.size*a.kl(this.f.M,!0),v=(d-f*l.position)/b.width*2-1,p=1-(e-g*l.position)/b.height*2,m=new r;m.a[0]=u/2;
m.a[1]=0;m.a[2]=0;m.a[3]=0;m.a[4]=0;m.a[5]=x/2;m.a[6]=0;m.a[7]=0;m.a[8]=0;m.a[9]=0;m.a[10]=1;m.a[11]=0;m.a[12]=v;m.a[13]=p;m.a[14]=0;m.a[15]=1;x=this.s;x.Wa("viewportMatrix",m)&&(u=x.c,x=x.u.get("viewportMatrix"),u.b.uniformMatrix4fv(x,!1,m.a));this.s.Hb("textureSampler",l.dk);m=this.s;u=l.color.r*c;x=l.color.v*c;l=l.color.m*c;m.Oa("color",u,x,l,1)&&m.c.Tb(m.u.get("color"),u,x,l,1);a.Hc(!0,0,6)}a.H.Pe(!0);0!=a.bb&&(a.K.ya(!1),a.H.vb(!0),a.bb=0);return!0},l:gg};var Ia=K.BABYLON.Light=function(a,b){this.km=
[];this.dm=[];this.Jn=this.pv=0;this.Dj=[];this.Ij=[];this.Vn=0;this.Tv=Infinity;this.qr=1;this.$r=new Q(1,1,1);this.Eu=new Q(1,1,1);oa.call(this,a,b);this.kn="LIGHT";b.fH(this)};n["com.babylonhx.lights.Light"]=Ia;Ia.h=["com","babylonhx","lights","Light"];Ia.Bg=function(a,b,c){switch(a){case 0:return function(){return new Yd(b,new p(0,0,0),c)};case 1:return function(){return new be(b,new p(0,0,0),c)};case 2:return function(){return new pd(b,new p(0,0,0),new p(0,0,0),0,0,c)};case 3:return function(){return new Kc(b,
new p(0,0,0),c)}}return null};Ia.ab=function(a,b){var c=cf.ab(Ia.Bg(a.type,a.name,b),a,b);null!=a.oI&&(c.dm=a.oI);null!=a.aJ&&(c.km=a.aJ);null!=a.Dl&&(c.zz=a.Dl);if(null!=a.Ya){for(var d=0,e=a.Ya.length;d<e;)c.Ya.push(fc.ab(a.Ya[d++]));oa.da(c,a)}null!=a.lu&&1==a.lu&&(d=a.ON,b.Eq(c,a.Mz,a.Oz,a.Nz,null!=d?d:1));return c};Ia.V=oa;Ia.prototype=S(oa.prototype,{cv:function(){return this.kn},fr:function(){return this.Rt},Xi:function(){},im:function(){var a=new r;a.a[0]=1;a.a[1]=0;a.a[2]=0;a.a[3]=0;a.a[4]=
0;a.a[5]=1;a.a[6]=0;a.a[7]=0;a.a[8]=0;a.a[9]=0;a.a[10]=1;a.a[11]=0;a.a[12]=0;a.a[13]=0;a.a[14]=0;a.a[15]=1;return a},va:function(){this.sd=this.f.Pa;var a=this.im();if(null!=this.ca&&null!=this.ca.va()){if(null==this.vt){var b=new r;b.a[0]=1;b.a[1]=0;b.a[2]=0;b.a[3]=0;b.a[4]=0;b.a[5]=1;b.a[6]=0;b.a[7]=0;b.a[8]=0;b.a[9]=0;b.a[10]=1;b.a[11]=0;b.a[12]=0;b.a[13]=0;b.a[14]=0;b.a[15]=1;this.vt=b}a.qa(this.ca.va(),this.vt.a,0);this.Tm=this.ca.sd;return this.vt}return a},dispose:function(){null!=this.Rt&&
(this.Rt.dispose(),this.Rt=null);this.f.Ml(this);this.f.lL(this);oa.prototype.dispose.call(this)},l:Ia,F:S(oa.prototype.F,{cv:"get_type"})});var Md=K.BABYLON.IShadowLight=function(){};n["com.babylonhx.lights.IShadowLight"]=Md;Md.h=["com","babylonhx","lights","IShadowLight"];Md.prototype={l:Md};var be=K.BABYLON.DirectionalLight=function(a,b,c){this.Nm=Infinity;this.Om=this.Pm=-Infinity;this.Gk=Infinity;this.nH=!0;this.Wr=.5;Ia.call(this,a,c);this.kn="DIRLIGHT";this.direction=b;this.position=new p(-1*
b.x,-1*b.y,-1*b.z)};n["com.babylonhx.lights.DirectionalLight"]=be;be.h=["com","babylonhx","lights","DirectionalLight"];be.xb=[Md];be.V=Ia;be.prototype=S(Ia.prototype,{hw:function(a,b,c){var d=this.f.M;if(this.nH||Infinity==this.Gk){var e,f;this.Gk=Infinity;this.Pm=this.Om=-Infinity;this.Nm=Infinity;for(var g=0,h=c.length;g<h;){var k=c[g++];if(null!=k&&(k=k.ed(),null!=k))for(var k=k.yc,l=0,m=k.gg.length;l<m;){f=k.gg[l++];e=f.x;var u=f.y,x=f.z,v=b.a,p=e*v[3]+u*v[7]+x*v[11]+v[15];f=(e*v[0]+u*v[4]+x*
v[8]+v[12])/p;e=(e*v[1]+u*v[5]+x*v[9]+v[13])/p;f<this.Gk&&(this.Gk=f);e<this.Nm&&(this.Nm=e);f>this.Om&&(this.Om=f);e>this.Pm&&(this.Pm=e)}}}b=this.Om-this.Gk;c=this.Pm-this.Nm;r.Kj(this.Gk-b*this.Wr,this.Om+b*this.Wr,this.Nm-c*this.Wr,this.Pm+c*this.Wr,-d.Fb,d.Fb,a)},Eo:function(){return!0},Hv:function(){return!0},Gv:function(){return!1},Uu:function(){return this.direction},Bn:function(){if(null!=this.ca&&null!=(hc=this.ca,F(hc,hc.va))){null==this.$d&&(this.$d=new p(0,0,0));var a=this.position,b=
this.ca.va(),c=this.$d,d=a.x,e=a.y,a=a.z,b=b.a,f=d*b[1]+e*b[5]+a*b[9]+b[13],g=d*b[2]+e*b[6]+a*b[10]+b[14],h=d*b[3]+e*b[7]+a*b[11]+b[15];c.x=(d*b[0]+e*b[4]+a*b[8]+b[12])/h;c.y=f/h;c.z=g/h;return!0}return!1},Xi:function(a,b){if(null!=this.ca&&null!=(hc=this.ca,F(hc,hc.va))){null==this.Td&&(this.Td=new p(0,0,0));var c=this.direction,d=this.ca.va(),e=this.Td;e.x=c.x*d.a[0]+c.y*d.a[4]+c.z*d.a[8];e.y=c.x*d.a[1]+c.y*d.a[5]+c.z*d.a[9];e.z=c.x*d.a[2]+c.y*d.a[6]+c.z*d.a[10];c=this.Td.x;d=this.Td.y;e=this.Td.z;
a.Oa(b,c,d,e,1)&&a.c.Tb(a.u.get(b),c,d,e,1)}else c=this.direction.x,d=this.direction.y,e=this.direction.z,a.Oa(b,c,d,e,1)&&a.c.Tb(a.u.get(b),c,d,e,1)},im:function(){if(null==this.Ea){var a=new r;a.a[0]=1;a.a[1]=0;a.a[2]=0;a.a[3]=0;a.a[4]=0;a.a[5]=1;a.a[6]=0;a.a[7]=0;a.a[8]=0;a.a[9]=0;a.a[10]=1;a.a[11]=0;a.a[12]=0;a.a[13]=0;a.a[14]=0;a.a[15]=1;this.Ea=a}r.da(1,0,0,0,1,0,0,0,1,this.position.x,this.position.y,this.position.z,this.Ea);return this.Ea},l:be});var Kc=K.BABYLON.HemisphericLight=function(a,
b,c){this.RI=new Q(0,0,0);Ia.call(this,a,c);this.kn="HEMILIGHT";this.direction=b};n["com.babylonhx.lights.HemisphericLight"]=Kc;Kc.h=["com","babylonhx","lights","HemisphericLight"];Kc.V=Ia;Kc.prototype=S(Ia.prototype,{fr:function(){return null},Xi:function(a,b,c){var d=this.direction,e=new p(0,0,0);e.x=d.x;e.y=d.y;e.z=d.z;e.normalize();Kc.Ba=e;var d=Kc.Ba.x,e=Kc.Ba.y,f=Kc.Ba.z;a.Oa(b,d,e,f,0)&&a.c.Tb(a.u.get(b),d,e,f,0);b=this.RI.scale(this.qr);a.ve(c,b.r,b.v,b.m)&&(d=a.c,a=a.u.get(c),d.b.uniform3f(a,
b.r,b.v,b.m))},im:function(){if(null==this.Ea){var a=new r;a.a[0]=1;a.a[1]=0;a.a[2]=0;a.a[3]=0;a.a[4]=0;a.a[5]=1;a.a[6]=0;a.a[7]=0;a.a[8]=0;a.a[9]=0;a.a[10]=1;a.a[11]=0;a.a[12]=0;a.a[13]=0;a.a[14]=0;a.a[15]=1;this.Ea=a}return this.Ea},l:Kc});var Yd=K.BABYLON.PointLight=function(a,b,c){Ia.call(this,a,c);this.kn="POINTLIGHT";this.position=b};n["com.babylonhx.lights.PointLight"]=Yd;Yd.h=["com","babylonhx","lights","PointLight"];Yd.xb=[Md];Yd.V=Ia;Yd.prototype=S(Ia.prototype,{Bn:function(){if(null!=this.ca&&
null!=this.ca.va()){null==this.$d&&(this.$d=new p(0,0,0));var a=this.position,b=this.ca.va(),c=this.$d,d=a.x,e=a.y,a=a.z,b=b.a,f=d*b[1]+e*b[5]+a*b[9]+b[13],g=d*b[2]+e*b[6]+a*b[10]+b[14],h=d*b[3]+e*b[7]+a*b[11]+b[15];c.x=(d*b[0]+e*b[4]+a*b[8]+b[12])/h;c.y=f/h;c.z=g/h;return!0}return!1},Xi:function(a,b){if(null!=this.ca&&null!=this.ca.va()){this.Bn();var c=this.$d.x,d=this.$d.y,e=this.$d.z}else c=this.position.x,d=this.position.y,e=this.position.z;a.Oa(b,c,d,e,0)&&a.c.Tb(a.u.get(b),c,d,e,0)},Gv:function(){return!0},
Eo:function(){return!1},Hv:function(){return!1},Uu:function(a){switch(a){case 0:return new p(1,0,0);case 1:return new p(-1,0,0);case 2:return new p(0,-1,0);case 3:return new p(0,1,0);case 4:return new p(0,0,1);case 5:return new p(0,0,-1)}return new p(0,0,0)},hw:function(a){var b=this.f.M;r.lg(Math.PI/2,1,b.Sb,b.Fb,a)},im:function(){if(null==this.Ea){var a=new r;a.a[0]=1;a.a[1]=0;a.a[2]=0;a.a[3]=0;a.a[4]=0;a.a[5]=1;a.a[6]=0;a.a[7]=0;a.a[8]=0;a.a[9]=0;a.a[10]=1;a.a[11]=0;a.a[12]=0;a.a[13]=0;a.a[14]=
0;a.a[15]=1;this.Ea=a}r.da(1,0,0,0,1,0,0,0,1,this.position.x,this.position.y,this.position.z,this.Ea);return this.Ea},l:Yd});var pd=K.SpotLight=function(a,b,c,d,e,f){Ia.call(this,a,f);this.kn="SPOTLIGHT";this.position=b;this.direction=c;this.Ad=d;this.Ku=e};n["com.babylonhx.lights.SpotLight"]=pd;pd.h=["com","babylonhx","lights","SpotLight"];pd.xb=[Md];pd.V=Ia;pd.prototype=S(Ia.prototype,{hw:function(a){var b=this.f.M;r.lg(this.Ad,1,b.Sb,b.Fb,a)},Gv:function(){return!1},Eo:function(){return!0},Hv:function(){return!1},
Uu:function(){return this.direction},Bn:function(){if(null!=this.ca&&null!=this.ca.va()){null==this.$d&&(this.$d=new p(0,0,0));var a=this.position,b=this.ca.va(),c=this.$d,d=a.x,e=a.y,a=a.z,b=b.a,f=d*b[1]+e*b[5]+a*b[9]+b[13],g=d*b[2]+e*b[6]+a*b[10]+b[14],h=d*b[3]+e*b[7]+a*b[11]+b[15];c.x=(d*b[0]+e*b[4]+a*b[8]+b[12])/h;c.y=f/h;c.z=g/h;return!0}return!1},Xi:function(a,b,c){var d;if(null!=this.ca&&null!=this.ca.va()){null==this.Td&&(this.Td=new p(0,0,0));this.Bn();var e=this.direction;d=this.ca.va();
var f=this.Td;f.x=e.x*d.a[0]+e.y*d.a[4]+e.z*d.a[8];f.y=e.x*d.a[1]+e.y*d.a[5]+e.z*d.a[9];f.z=e.x*d.a[2]+e.y*d.a[6]+e.z*d.a[10];e=this.$d.x;d=this.$d.y;var f=this.$d.z,g=this.Ku;a.Oa(b,e,d,f,g)&&a.c.Tb(a.u.get(b),e,d,f,g);b=this.Td;e=new p(0,0,0);e.x=b.x;e.y=b.y;e.z=b.z}else e=this.position.x,d=this.position.y,f=this.position.z,g=this.Ku,a.Oa(b,e,d,f,g)&&a.c.Tb(a.u.get(b),e,d,f,g),b=this.direction,e=new p(0,0,0),e.x=b.x,e.y=b.y,e.z=b.z;e.normalize();d=e;b=d.x;e=d.y;d=d.z;f=Math.cos(.5*this.Ad);a.Oa(c,
b,e,d,f)&&a.c.Tb(a.u.get(c),b,e,d,f)},im:function(){if(null==this.Ea){var a=new r;a.a[0]=1;a.a[1]=0;a.a[2]=0;a.a[3]=0;a.a[4]=0;a.a[5]=1;a.a[6]=0;a.a[7]=0;a.a[8]=0;a.a[9]=0;a.a[10]=1;a.a[11]=0;a.a[12]=0;a.a[13]=0;a.a[14]=0;a.a[15]=1;this.Ea=a}r.da(1,0,0,0,1,0,0,0,1,this.position.x,this.position.y,this.position.z,this.Ea);return this.Ea},l:pd});var Yb=K.BABYLON.ShadowGenerator=function(){this.Ks=this.Kx=0;var a=new r;a.a[0]=0;a.a[1]=0;a.a[2]=0;a.a[3]=0;a.a[4]=0;a.a[5]=0;a.a[6]=0;a.a[7]=0;a.a[8]=0;a.a[9]=
0;a.a[10]=0;a.a[11]=0;a.a[12]=0;a.a[13]=0;a.a[14]=0;a.a[15]=0;this.sb=a;a=new r;a.a[0]=0;a.a[1]=0;a.a[2]=0;a.a[3]=0;a.a[4]=0;a.a[5]=0;a.a[6]=0;a.a[7]=0;a.a[8]=0;a.a[9]=0;a.a[10]=0;a.a[11]=0;a.a[12]=0;a.a[13]=0;a.a[14]=0;a.a[15]=0;this.Va=a;a=new r;a.a[0]=0;a.a[1]=0;a.a[2]=0;a.a[3]=0;a.a[4]=0;a.a[5]=0;a.a[6]=0;a.a[7]=0;a.a[8]=0;a.a[9]=0;a.a[10]=0;a.a[11]=0;a.a[12]=0;a.a[13]=0;a.a[14]=0;a.a[15]=0;this.za=a;this.wF=0;this.Ck=new p(0,0,0);this.ZE=5E-5;this.wH=2;this.IF=Yb.nE};n["com.babylonhx.lights.shadows.ShadowGenerator"]=
Yb;Yb.h=["com","babylonhx","lights","shadows","ShadowGenerator"];Yb.prototype={JA:function(){return this.ZE},ql:function(){return this.IF},eB:function(){return this.ql()==Yb.Cz?this.ji.Eo():!1},dB:function(){return this.ql()!=Yb.pE?this.ji.Eo()?!1:this.ql()!=Yb.Cz?this.ql()==Yb.Nw:!0:!0},bB:function(){return this.ql()==Yb.Nw?this.ji.Eo():!1},MI:function(){return null!=this.St?this.St:this.Nk},OI:function(){var a=this.f;if(this.qF==a.Pa&&this.Kx==this.Ks)return this.sb;this.qF=a.Pa;this.Kx=this.Ks;
var a=this.ji.position,b=this.ji.Uu(this.Ks),c=this.Ck;c.x=b.x;c.y=b.y;c.z=b.z;c.normalize();b=this.Ck;1==Math.abs(0*b.x+b.y+0*b.z)&&(this.Ck.z=1E-13);this.ji.Bn()&&(a=this.ji.$d);this.ji.Hv()||null==this.ox||null==this.nx?b=!0:(b=this.ox,b=!(null!=b&&a.x==b.x&&a.y==b.y&&a.z==b.z));b?b=!0:(b=this.Ck,c=this.nx,b=!(null!=c&&b.x==c.x&&b.y==c.y&&b.z==c.z));b&&(this.ox=new p(a.x,a.y,a.z),b=this.Ck,this.nx=new p(b.x,b.y,b.z),b=this.Ck,r.Uc(a,new p(a.x+b.x,a.y+b.y,a.z+b.z),new p(0,1,0),this.za),this.ji.hw(this.Va,
this.za,this.Nk.mc),this.za.qa(this.Va,this.sb.a,0));return this.sb},dispose:function(){this.Nk.dispose();null!=this.St&&this.St.dispose();null!=this.cm&&this.cm.dispose();null!=this.$E&&this.$E.dispose()},l:Yb,F:{bB:"get_useBlurVarianceShadowMap",dB:"get_usePoissonSampling",eB:"get_useVarianceShadowMap",ql:"get_filter",JA:"get_bias"}};var hg=K.BABYLON.SceneLoader=function(){};n["com.babylonhx.loading.SceneLoader"]=hg;hg.h=["com","babylonhx","loading","SceneLoader"];n["js.Boot"]=z;z.h=["js","Boot"];
z.yh=function(a){if(a instanceof Array&&null==a.jb)return Array;var b=a.l;if(null!=b)return b;a=z.MB(a);return null!=a?z.DH(a):null};z.Te=function(a,b){if(null==a)return"null";if(5<=b.length)return"<...>";var c=typeof a;"function"==c&&(a.h||a.Zi)&&(c="object");switch(c){case "function":return"<function>";case "object":if(a instanceof Array){if(a.jb){if(2==a.length)return a[0];c=a[0]+"(";b+="\t";for(var d=2,e=a.length;d<e;)var f=d++,c=2!=f?c+(","+z.Te(a[f],b)):c+z.Te(a[f],b);return c+")"}c=a.length;
d="[";b+="\t";for(e=0;e<c;)f=e++,d+=(0<f?",":"")+z.Te(a[f],b);return d+"]"}try{d=a.toString}catch(g){return"???"}if(null!=d&&d!=Object.toString&&"function"==typeof d&&(c=a.toString(),"[object Object]"!=c))return c;c=null;d="{\n";b+="\t";e=null!=a.hasOwnProperty;for(c in a)e&&!a.hasOwnProperty(c)||"prototype"==c||"__class__"==c||"__super__"==c||"__interfaces__"==c||"__properties__"==c||(2!=d.length&&(d+=", \n"),d+=b+c+" : "+z.Te(a[c],b));b=b.substring(1);return d+("\n"+b+"}");case "string":return a;
default:return String(a)}};z.qs=function(a,b){if(null==a)return!1;if(a==b)return!0;var c=a.xb;if(null!=c)for(var d=0,e=c.length;d<e;){var f=c[d++];if(f==b||z.qs(f,b))return!0}return z.qs(a.V,b)};z.D=function(a,b){if(null==b)return!1;switch(b){case Array:return a instanceof Array?null==a.jb:!1;case Eg:return"boolean"==typeof a;case Sg:return!0;case Fg:return"number"==typeof a;case tg:return"number"==typeof a?(a|0)===a:!1;case String:return"string"==typeof a;default:if(null!=a)if("function"==typeof b){if(a instanceof
b||z.qs(z.yh(a),b))return!0}else{if("object"==typeof b&&z.rH(b)&&a instanceof b)return!0}else return!1;return b==Tg&&null!=a.h||b==Ug&&null!=a.Zi?!0:a.jb==b}};z.g=function(a,b){if(z.D(a,b))return a;throw new ja("Cannot cast "+sa.Ib(a)+" to "+sa.Ib(b));};z.MB=function(a){a=z.YH.call(a).slice(8,-1);return"Object"==a||"Function"==a||"Math"==a||"JSON"==a?null:a};z.rH=function(a){return null!=z.MB(a)};z.DH=function(a){return Nf[a]};var Ie=K.BABYLON.IGetSetVerticesData=function(){};n["com.babylonhx.mesh.IGetSetVerticesData"]=
Ie;Ie.h=["com","babylonhx","mesh","IGetSetVerticesData"];Ie.prototype={l:Ie};var Zb=K.BABYLON.Geometry=function(a,b,c,d,e){null==d&&(d=!1);this.kz=0;this.ac=[];this.La=this.yg=0;this.id=a;this.c=b.c;this.vc=[];this.f=b;this.ua=new ea;this.ah=[];null!=c?this.EL(c,d):this.yg=0;null!=e&&(z.D(e,xc)&&(this.VC(new W(0,z.g(e,xc).$u())),this.Rl()),this.cc(e),e.Wd(!0))};n["com.babylonhx.mesh.Geometry"]=Zb;Zb.h=["com","babylonhx","mesh","Geometry"];Zb.xb=[Ie];Zb.Ba=function(a,b){var c=b.f,d=a.lO;if(null!=d)d=
c.DA(d),null!=d&&d.cc(b);else if(null!=a.Na&&null!=a.fb&&null!=a.ob){b.Fa("position",a.Na,!1);b.Fa("normal",a.fb,!1);null!=a.zb&&b.Fa("uv",a.zb,!1);null!=a.AM&&b.Fa("uv2",a.AM,!1);null!=a.BM&&b.Fa("uv3",a.BM,!1);null!=a.CM&&b.Fa("uv4",a.CM,!1);null!=a.DM&&b.Fa("uv5",a.DM,!1);null!=a.EM&&b.Fa("uv6",a.EM,!1);null!=a.ke&&b.Fa("color",ca.Zc(a.ke,a.Na.length/3|0),!1);if(null!=a.Id)if(a.Id.ht)a.Id.ht=null,b.Fa("matricesIndices",a.Id,!1);else{for(var d=[],e=0,f=a.Id.length;e<f;){var g=a.Id[e++];d.push(g&
255);d.push((g&65280)>>8);d.push((g&16711680)>>16);d.push(g>>24)}b.Fa("matricesIndices",d,!1)}if(null!=a.oe)if(a.oe.ht)a.Id.ht=null,b.Fa("matricesIndicesExtra",a.oe,!1);else{d=[];e=0;for(f=a.oe.length;e<f;)g=a.oe[e++],d.push(g&255),d.push((g&65280)>>8),d.push((g&16711680)>>16),d.push(g>>24);b.Fa("matricesIndicesExtra",d,!1)}null!=a.Tf&&b.Fa("matricesWeights",a.Tf,!1);null!=a.Uf&&b.Fa("matricesWeightsExtra",a.Uf,!1);b.Zj(a.ob)}if(null!=a.Ga)for(b.Ga=[],d=0,e=a.Ga.length;d<e;)f=a.Ga[d++],new ub(f.uf,
f.te,f.Tg,f.Wb,f.Xd,b);b.iz&&(b.MH(),b.iz=!1);b.Wd(!0);null!=c.Xu()&&c.Xu().fu(b)};Zb.prototype={KA:function(){return this.Cs},VC:function(a){var b;null!=this.Cs?(b=this.Cs,b=null!=a&&b.x==a.x?b.y==a.y:!1):b=!1;if(b)return a;this.Cs=new W(a.x,a.y);this.Rl();return a},EL:function(a,b){null==b&&(b=!1);a.kH(this,b);this.Dr()},Fa:function(a,b,c,d){null==c&&(c=!1);this.$j(new oc(this.c,b,a,c,0==this.vc.length,d))},$j:function(a){var b=a.$F,c=this.ua;null!=(null!=t[b]?c.I(b):c.i[b])&&(c=this.ua,c=null!=
t[b]?c.I(b):c.i[b],c.Df&&c.S.dispose());c=this.ua;null!=t[b]?c.C(b,a):c.i[b]=a;if("position"==b){c=a.S.qg;a=a.zd;this.yg=c.length/a|0;this.Rl(c,a);a=this.vc;for(var c=a.length,d=0;d<c;){var e=a[d++];e.mh=null;e.ra=new Gb(this.$g.Gb,this.$g.Mb);e.Hs();e.Wd(!0)}}this.Dr(b)},Wh:function(a,b,c){null==c&&(c=!1);var d=this.Bh(a);null!=d&&(d.create(b),"position"==a&&(this.yg=b.length/d.zd,c&&this.Rl(b),this.nM(c,b)),this.Dr(a))},nM:function(a,b){a&&this.Rl(b);for(var c=this.vc,d=c.length,e=0;e<d;){var f=
c[e++];f.mh=null;if(a){f.ra=new Gb(this.$g.Gb,this.$g.Mb);for(var g=0,h=f.Ga.length;g<h;)f.Ga[g++].Uv()}}},Nf:function(){return 1!=this.La&&0!=this.La?0:this.yg},Aa:function(a,b){null==b&&(b=!1);var c=this.Bh(a);if(null==c)return null;c=c.S.qg;if(b&&1!=this.vc.length){for(var d=c.length,e=[],f=0;f<d;)e.push(c[f++]);return e}return c},Bh:function(a){if(1!=this.La&&0!=this.La)return null;var b=this.ua;return null!=t[a]?b.I(a):b.i[a]},Nn:function(){return 1!=this.La&&0!=this.La?null:this.ua},eb:function(a){if(null==
this.ua)return null!=this.ac?-1!=this.ac.indexOf(a):!1;var b=this.ua;return null!=(null!=t[a]?b.I(a):b.i[a])},Wu:function(){var a=[];if(null==this.ua&&null!=this.ac)for(var b=0,c=this.ac;b<c.length;){var d=c[b];++b;a.push(d)}else for(b=this.ua.keys();b.Ca();)a.push(b.next());return a},Zj:function(a,b){null==b&&(b=-1);if(null!=this.wa){var c=this.wa;c.ia--;0==c.ia&&this.c.b.deleteBuffer(c.buffer)}this.ah=a;if(0!=this.vc.length&&null!=this.ah){var c=this.c,d=this.ah,e=new Kb(c.b.createBuffer());c.W.get(34963)!=
e&&(c.b.bindBuffer(34963,null==e?null:e.buffer),c.W.set(34963,null==e?null:e));var f=null,g=!1;if(c.U.Ql){for(var h=0,k=d.length;h<k;)if(65535<d[h++]){g=!0;break}g?f=new Int32Array(d):f=new Int16Array(d)}else f=new Int16Array(d);c.b.bufferData(34963,f,35044);null!=c.W.get(34963)&&(c.b.bindBuffer(34963,null),c.W.set(34963,null));c.kb=null;e.ia=1;e.Rc=g;this.wa=e}-1!=b&&(this.yg=b);c=this.vc;d=c.length;for(e=0;e<d;)c[e++].Hs();this.Dr()},Mn:function(){return 1!=this.La&&0!=this.La?0:this.ah.length},
Ac:function(a){null==a&&(a=!1);if(1!=this.La&&0!=this.La)return null;var b=this.ah;if(a&&1!=this.vc.length){a=b.length;for(var c=[],d=0;d<a;)c.push(b[d++]);return c}return b},ll:function(){return 1!=this.La&&0!=this.La?null:this.wa},Jr:function(a,b){null==b&&(b=!1);var c=this.vc,d=c.indexOf(a);if(-1!=d){for(var e=this.ua.keys();e.Ca();){var f=e.next(),g=this.ua,f=null!=t[f]?g.I(f):g.i[f];f.Df&&f.S.dispose()}null!=this.wa?(e=this.wa,e.ia--,0==e.ia?(this.c.b.deleteBuffer(e.buffer),e=!0):e=!1):e=!1;
e&&(this.wa=null);c.splice(d,1);a.xa=null;0==c.length&&b&&this.dispose()}},cc:function(a){if(a.xa!=this){var b=a.xa;null!=b&&b.Jr(a);b=this.vc;a.xa=this;this.f.YK(this);b.push(a);1==this.La||0==this.La?this.WE(a):a.ra=this.ra}},Rl:function(a,b){if(null==a){var c=this.ua;a=(null!=t.position?c.I("position"):c.i.position).S.qg}var c=this.yg,d=this.KA(),e=new p(Infinity,Infinity,Infinity),f=new p(-Infinity,-Infinity,-Infinity),g;new p(0,0,0);for(var h=0;h<c;){g=h++;g=new p(a[g*b],a[g*b+1],a[g*b+2]);var k=
new p(g.x,g.y,g.z);e.x<k.x&&(k.x=e.x);e.y<k.y&&(k.y=e.y);e.z<k.z&&(k.z=e.z);e=k;g=new p(g.x,g.y,g.z);f.x>g.x&&(g.x=f.x);f.y>g.y&&(g.y=f.y);f.z>g.z&&(g.z=f.z);f=g}null!=d&&(e.x-=e.x*d.x+d.y,e.y-=e.y*d.x+d.y,e.z-=e.z*d.x+d.y,f.x+=f.x*d.x+d.y,f.y+=f.y*d.x+d.y,f.z+=f.z*d.x+d.y);this.$g={Gb:e,Mb:f}},WE:function(a){for(var b=this.vc.length,c=this.ua.keys();c.Ca();){var d=c.next();if(1==b){var e=this.ua;(null!=t[d]?e.I(d):e.i[d]).create()}e=this.ua;(null!=t[d]?e.I(d):e.i[d]).S.S.ia=b;if("position"==d){a.mh=
null;null==this.$g&&(e=this.ua,this.Rl((null!=t[d]?e.I(d):e.i[d]).S.qg));a.ra=new Gb(this.$g.Gb,this.$g.Mb);a.Hs();a.ra=null==a.ra?new Gb(a.qf(),a.qf()):a.ra;e=a.ra;d=a.me();if(!e.Ak){var f=e.yc,g=f.fa;g.x=Infinity;g.y=Infinity;g.z=Infinity;g=f.ea;g.x=-Infinity;g.y=-Infinity;g.z=-Infinity;for(var h,k,l,g=0,m=f.Ab.length;g<m;){h=g++;pa.g=f.gg[h];var u=f.Ab[h];h=pa.g;k=u.x;l=u.y;var u=u.z,x=d.a,v=k*x[1]+l*x[5]+u*x[9]+x[13],p=k*x[2]+l*x[6]+u*x[10]+x[14],D=k*x[3]+l*x[7]+u*x[11]+x[15];h.x=(k*x[0]+l*x[4]+
u*x[8]+x[12])/D;h.y=v/D;h.z=p/D;h=pa.g.x;k=pa.g.y;l=pa.g.z;h<f.fa.x&&(f.fa.x=h);k<f.fa.y&&(f.fa.y=k);l<f.fa.z&&(f.fa.z=l);h>f.ea.x&&(f.ea.x=h);k>f.ea.y&&(f.ea.y=k);l>f.ea.z&&(f.ea.z=l)}g=f.ea;m=f.fa;h=f.oa;h.x=g.x+m.x;h.y=g.y+m.y;h.z=g.z+m.z;g=f.oa;g.x*=.5;g.y*=.5;g.z*=.5;g=d.a;m=f.w[0];m.x=g[0];m.y=g[1];m.z=g[2];g=d.a;m=f.w[1];m.x=g[4];m.y=g[5];m.z=g[6];g=d.a;m=f.w[2];m.x=g[8];m.y=g[9];m.z=g[10];f.Ea=d;e=e.Oc;f=Math.max;g=Math.abs;l=e.oa;m=e.Gc;h=l.x;k=l.y;l=l.z;u=d.a;x=h*u[1]+k*u[5]+l*u[9]+u[13];
v=h*u[2]+k*u[6]+l*u[10]+u[14];p=h*u[3]+k*u[7]+l*u[11]+u[15];m.x=(h*u[0]+k*u[4]+l*u[8]+u[12])/p;m.y=x/p;m.z=v/p;m=e.Eb;m.x=d.a[0]+d.a[4]+d.a[8];m.y=d.a[1]+d.a[5]+d.a[9];m.z=d.a[2]+d.a[6]+d.a[10];e.Zf=f(f(g(e.Eb.x),g(e.Eb.y)),g(e.Eb.z))*e.R}a.Vk(a.me())}}if(1==b&&null!=this.ah&&0<this.ah.length){a=this.c;c=this.ah;d=new Kb(a.b.createBuffer());a.W.get(34963)!=d&&(a.b.bindBuffer(34963,null==d?null:d.buffer),a.W.set(34963,null==d?null:d));e=null;f=!1;if(a.U.Ql){g=0;for(m=c.length;g<m;)if(65535<c[g++]){f=
!0;break}f?e=new Int32Array(c):e=new Int16Array(c)}else e=new Int16Array(c);a.b.bufferData(34963,e,35044);null!=a.W.get(34963)&&(a.b.bindBuffer(34963,null),a.W.set(34963,null));a.kb=null;d.ia=1;d.Rc=f;this.wa=d}null!=this.wa&&(this.wa.ia=b)},Dr:function(a){null!=this.oK&&this.oK(this,a)},load:function(a,b){2!=this.La&&(1==this.La||0==this.La?null!=b&&b():(this.La=2,a.qp(this)))},dispose:function(){for(var a=this.vc,b=a.length,c=0;c<b;)this.Jr(a[c++]);this.vc=[];for(a=this.ua.keys();a.Ca();)b=a.next(),
c=this.ua,b=null!=t[b]?c.I(b):c.i[b],b.Df&&b.S.dispose();this.ua=new ea;this.yg=0;null!=this.wa&&(a=this.wa,a.ia--,0==a.ia&&this.c.b.deleteBuffer(a.buffer));this.wa=null;this.ah=[];this.La=0;this.Ms=this.bl=null;this.ac=[];this.ra=null;this.f.jL(this)},wu:function(a){for(var b=new O,c=this.Ac(),d=0,e=c.length;d<e;)b.ob.push(c[d++]);d=c=!1;for(e=this.ua.keys();e.Ca();){var f=e.next();b.set(this.Aa(f).slice(),f);d||(c=this.Bh(f).S.qh,d=!c)}a=new Zb(a,this.f,b,c,null);a.La=this.La;a.bl=this.bl;a.Ms=
this.Ms;b=0;for(c=this.ac;b<c.length;)d=c[b],++b,a.ac=null!=a.ac?a.ac:[],a.ac.push(d);a.ra=new Gb(this.$g.Gb,this.$g.Mb);return a},l:Zb,F:{VC:"set_boundingBias",KA:"get_boundingBias"}};var qa=K.BABYLON.AbstractMesh=function(a,b){this.ZF=this.Yt=!1;this.dh=[];this.Pa=0;var c=new r;c.a[0]=1;c.a[1]=0;c.a[2]=0;c.a[3]=0;c.a[4]=0;c.a[5]=1;c.a[6]=0;c.a[7]=0;c.a[8]=0;c.a[9]=0;c.a[10]=1;c.a[11]=0;c.a[12]=0;c.a[13]=0;c.a[14]=0;c.a[15]=1;this.nj=c;this.vm=!1;c=new r;c.a[0]=0;c.a[1]=0;c.a[2]=0;c.a[3]=0;c.a[4]=
0;c.a[5]=0;c.a[6]=0;c.a[7]=0;c.a[8]=0;c.a[9]=0;c.a[10]=0;c.a[11]=0;c.a[12]=0;c.a[13]=0;c.a[14]=0;c.a[15]=0;this.Dx=c;c=new r;c.a[0]=0;c.a[1]=0;c.a[2]=0;c.a[3]=0;c.a[4]=0;c.a[5]=0;c.a[6]=0;c.a[7]=0;c.a[8]=0;c.a[9]=0;c.a[10]=0;c.a[11]=0;c.a[12]=0;c.a[13]=0;c.a[14]=0;c.a[15]=0;this.Ex=c;this.us=new p(0,0,0);var d=Math.PI,c=new r,e=Math.sin(d),d=Math.cos(d);c.a[5]=1;c.a[15]=1;c.a[0]=d;c.a[2]=-e;c.a[8]=e;c.a[10]=d;c.a[1]=0;c.a[3]=0;c.a[4]=0;c.a[6]=0;c.a[7]=0;c.a[9]=0;c.a[11]=0;c.a[12]=0;c.a[13]=0;c.a[14]=
0;this.AG=c;c=new r;c.a[0]=0;c.a[1]=0;c.a[2]=0;c.a[3]=0;c.a[4]=0;c.a[5]=0;c.a[6]=0;c.a[7]=0;c.a[8]=0;c.a[9]=0;c.a[10]=0;c.a[11]=0;c.a[12]=0;c.a[13]=0;c.a[14]=0;c.a[15]=0;this.Ea=c;c=new r;c.a[0]=0;c.a[1]=0;c.a[2]=0;c.a[3]=0;c.a[4]=0;c.a[5]=0;c.a[6]=0;c.a[7]=0;c.a[8]=0;c.a[9]=0;c.a[10]=0;c.a[11]=0;c.a[12]=0;c.a[13]=0;c.a[14]=0;c.a[15]=0;this.ki=c;this.Hu=new ca(1,0,0,1);this.Uq=1;this.rA=new p(0,0,0);this.xi=new p(.5,1,.5);this.zq=this.yx=!1;this.tb=268435455;this.Gw=this.Fw=this.Ew=!0;this.Ke=4;this.uo=
1;this.Iw=this.rh=this.lf=!0;this.tl=!1;this.Mv=.5;this.Nv=new Q(1,0,0);this.Xv=!1;this.outlineWidth=.02;this.outlineColor=new Q(1,0,0);this.Qy=this.Kr=!1;this.ag=0;this.qy=this.Ao=this.Bo=this.oB=!1;this.gd=!0;this.Ii=!1;this.Xk=Infinity;this.yz=1;this.Be=new p(1,1,1);this.Kb=new p(0,0,0);this.Bd=qa.D;this.position=new p(0,0,0);this.fA=!0;this.VB=new U;this.lK=new U;this.kK=new U;this.Nb=new U;oa.call(this,a,b);b.fu(this);Object.defineProperty(this,"visibility",{get:this.Ci,set:this.Ur});Object.defineProperty(this,
"isPickable",{get:this.Bi,set:this.Qr});Object.defineProperty(this,"skeleton",{get:this.fd,set:this.Sr});Object.defineProperty(this,"material",{get:this.Fg,set:this.kd});Object.defineProperty(this,"receiveShadows",{get:this.Fj,set:this.Rr});Object.defineProperty(this,"positions",{get:this.mr,set:this.EP});Object.defineProperty(this,"useBones",{get:this.Gg,set:this.FP});Object.defineProperty(this,"isBlocked",{get:this.hr,set:this.CP});Object.defineProperty(this,"worldMatrixFromCache",{get:this.me});
Object.defineProperty(this,"absolutePosition",{get:this.qf});Object.defineProperty(this,"isWorldMatrixFrozen",{get:this.uO})};n["com.babylonhx.mesh.AbstractMesh"]=qa;qa.h=["com","babylonhx","mesh","AbstractMesh"];qa.xb=[Ae];qa.V=oa;qa.prototype=S(oa.prototype,{Ci:function(){return this.yz},Ur:function(a){return this.yz=a},Bi:function(){return this.qy},Qr:function(a){return this.qy=a},Fg:function(){return this.Ae},kd:function(a){return this.Ae=a},Fj:function(){return this.Qy},Rr:function(a){return this.Qy=
a},mr:function(){return this.mh},Gg:function(){return null!=this.fd()&&this.f.ow&&this.eb("matricesIndices")?this.eb("matricesWeights"):!1},fd:function(){return this.$m},Sr:function(a){null!=this.$m&&this.$m.Oi&&this.$m.UG(this);null!=a&&a.Oi&&a.rG(this);this.$m=a;null==this.$m&&(this.ee=null);return a},Ll:function(a){this.yd=a;var b;null!=a?(b=this.Kb,b=0<Math.sqrt(b.x*b.x+b.y*b.y+b.z*b.z)):b=!1;b&&(b=this.Kb,b.x=0,b.y=0,b.z=0);return a},pO:function(){return this.yt},hr:function(){return!1},er:function(){return this},
Nf:function(){return 0},Ac:function(){return null},Aa:function(){return null},eb:function(){return!1},ed:function(){if(null!=this.Ek)return this.Ek.ed();null==this.ra&&this.VG();return this.ra},Wm:function(){},Ly:function(){},ws:function(a){this.Pa=a},va:function(){if(null!=this.Ek)return this.Ek.va();this.sd!=this.f.Pa&&this.Wd();return this.Ea},me:function(){return this.Ea},qf:function(){return this.us},rotate:function(a,b,c){a.normalize();if(null==this.yd){var d=new X,e=.5*this.Kb.z,f=.5*this.Kb.x,
g=.5*this.Kb.y,h=Math.sin(e),e=Math.cos(e),k=Math.sin(f),f=Math.cos(f),l=Math.sin(g),g=Math.cos(g);d.x=g*k*e+l*f*h;d.y=l*f*e-g*k*h;d.z=g*f*h-l*k*e;d.o=g*f*e+l*k*h;this.Ll(d);this.Kb=new p(0,0,0)}if(null==c||0==c)c=qa.Ma,d=Math.sin(b/2),a.normalize(),c.o=Math.cos(b/2),c.x=a.x*d,c.y=a.y*d,c.z=a.z*d,a=this.yd,b=qa.Ma;else{if(null!=this.ca){c=this.ca.va();var d=c.a[0],h=c.a[1],g=c.a[2],e=c.a[3],k=c.a[4],f=c.a[5],l=c.a[6],m=c.a[7],u=c.a[8],x=c.a[9],v=c.a[10],G=c.a[11],D=c.a[12],w=c.a[13],q=c.a[14],n=c.a[15];
c=new r;c.a[0]=d;c.a[1]=h;c.a[2]=g;c.a[3]=e;c.a[4]=k;c.a[5]=f;c.a[6]=l;c.a[7]=m;c.a[8]=u;c.a[9]=x;c.a[10]=v;c.a[11]=G;c.a[12]=D;c.a[13]=w;c.a[14]=q;c.a[15]=n;var d=c.a[0],h=c.a[1],g=c.a[2],e=c.a[3],t=c.a[4],y=c.a[5],H=c.a[6],B=c.a[7],E=c.a[8],M=c.a[9],R=c.a[10],I=c.a[11],C=c.a[12],ba=c.a[13],N=c.a[14],L=c.a[15],k=R*L-I*N,f=M*L-I*ba,l=M*N-R*ba,m=E*L-I*C,u=E*N-R*C,x=E*ba-M*C,v=y*k-H*f+B*l,G=-(t*k-H*m+B*u),D=t*f-y*m+B*x,w=-(t*l-y*u+H*x),q=1/(d*v+h*G+g*D+e*w),n=H*L-B*N,z=y*L-B*ba,A=y*N-H*ba,L=t*L-B*C,
N=t*N-H*C,C=t*ba-y*C,ba=H*I-B*R,T=y*I-B*M,F=y*R-H*M,B=t*I-B*E,H=t*R-H*E,t=t*M-y*E;c.a[0]=v*q;c.a[4]=G*q;c.a[8]=D*q;c.a[12]=w*q;c.a[1]=-(h*k-g*f+e*l)*q;c.a[5]=(d*k-g*m+e*u)*q;c.a[9]=-(d*f-h*m+e*x)*q;c.a[13]=(d*l-h*u+g*x)*q;c.a[2]=(h*n-g*z+e*A)*q;c.a[6]=-(d*n-g*L+e*N)*q;c.a[10]=(d*z-h*L+e*C)*q;c.a[14]=-(d*A-h*N+g*C)*q;c.a[3]=-(h*ba-g*T+e*F)*q;c.a[7]=(d*ba-g*B+e*H)*q;c.a[11]=-(d*T-h*B+e*t)*q;c.a[15]=(d*F-h*H+g*t)*q;d=new p(0,0,0);d.x=a.x*c.a[0]+a.y*c.a[4]+a.z*c.a[8];d.y=a.x*c.a[1]+a.y*c.a[5]+a.z*c.a[9];
d.z=a.x*c.a[2]+a.y*c.a[6]+a.z*c.a[10];a=d}c=qa.Ma;d=Math.sin(b/2);a.normalize();c.o=Math.cos(b/2);c.x=a.x*d;c.y=a.y*d;c.z=a.z*d;a=qa.Ma;b=this.yd}c=this.yd;d=-a.x*b.z+a.y*b.o+a.z*b.x+a.o*b.y;h=a.x*b.y-a.y*b.x+a.z*b.o+a.o*b.z;g=-a.x*b.x-a.y*b.y-a.z*b.z+a.o*b.o;c.x=a.x*b.o+a.y*b.z-a.z*b.y+a.o*b.x;c.y=d;c.z=h;c.o=g},translate:function(a,b,c){var d=a.x*b,e=a.y*b;a=a.z*b;if(null==c||0==c){this.Wd();c=this.ki;b=c.a[0];var f=c.a[1],g=c.a[2],h=c.a[3],k=c.a[4],l=c.a[5],m=c.a[6],u=c.a[7],x=c.a[8],v=c.a[9],
G=c.a[10],D=c.a[11],w=c.a[12],q=c.a[13],n=c.a[14],t=c.a[15];c=new r;c.a[0]=b;c.a[1]=f;c.a[2]=g;c.a[3]=h;c.a[4]=k;c.a[5]=l;c.a[6]=m;c.a[7]=u;c.a[8]=x;c.a[9]=v;c.a[10]=G;c.a[11]=D;c.a[12]=w;c.a[13]=q;c.a[14]=n;c.a[15]=t;b=c.a[0];var f=c.a[1],g=c.a[2],h=c.a[3],y=c.a[4],H=c.a[5],B=c.a[6],E=c.a[7],M=c.a[8],R=c.a[9],I=c.a[10],C=c.a[11],ba=c.a[12],N=c.a[13],L=c.a[14],z=c.a[15],k=I*z-C*L,l=R*z-C*N,m=R*L-I*N,u=M*z-C*ba,x=M*L-I*ba,v=M*N-R*ba,G=H*k-B*l+E*m,D=-(y*k-B*u+E*x),w=y*l-H*u+E*v,q=-(y*m-H*x+B*v),n=1/
(b*G+f*D+g*w+h*q),t=B*z-E*L,A=H*z-E*N,T=H*L-B*N,z=y*z-E*ba,L=y*L-B*ba,ba=y*N-H*ba,N=B*C-E*I,F=H*C-E*R,O=H*I-B*R,E=y*C-E*M,B=y*I-B*M,y=y*R-H*M;c.a[0]=G*n;c.a[4]=D*n;c.a[8]=w*n;c.a[12]=q*n;c.a[1]=-(f*k-g*l+h*m)*n;c.a[5]=(b*k-g*u+h*x)*n;c.a[9]=-(b*l-f*u+h*v)*n;c.a[13]=(b*m-f*x+g*v)*n;c.a[2]=(f*t-g*A+h*T)*n;c.a[6]=-(b*t-g*z+h*L)*n;c.a[10]=(b*A-f*z+h*ba)*n;c.a[14]=-(b*T-f*L+g*ba)*n;c.a[3]=-(f*N-g*F+h*O)*n;c.a[7]=(b*N-g*E+h*B)*n;c.a[11]=-(b*F-f*E+h*y)*n;c.a[15]=(b*O-f*B+g*y)*n;f=this.position;b=new p(0,
0,0);b.x=f.x*c.a[0]+f.y*c.a[4]+f.z*c.a[8];b.y=f.x*c.a[1]+f.y*c.a[5]+f.z*c.a[9];b.z=f.x*c.a[2]+f.y*c.a[6]+f.z*c.a[10];d=b.x+d;e=b.y+e;a=b.z+a;this.Wd();c=this.ki;b=new p(0,0,0);b.x=d*c.a[0]+e*c.a[4]+a*c.a[8];b.y=d*c.a[1]+e*c.a[5]+a*c.a[9];b.z=d*c.a[2]+e*c.a[6]+a*c.a[10];this.position=b}else this.Wd(),c=this.us,this.DL(new p(c.x+d,c.y+e,c.z+a))},DL:function(a){var b,c,d;if(null!=a){if(a instanceof Array&&null==a.jb){if(3>a.length)return;d=a[0];c=a[1];b=a[2]}else d=a.x,c=a.y,b=a.z;if(null!=this.ca){a=
this.ca.va();var e=a.a[0],f=a.a[1],g=a.a[2],h=a.a[3],k=a.a[4],l=a.a[5],m=a.a[6],u=a.a[7],x=a.a[8],v=a.a[9],G=a.a[10],D=a.a[11],w=a.a[12],q=a.a[13],n=a.a[14],t=a.a[15];a=new r;a.a[0]=e;a.a[1]=f;a.a[2]=g;a.a[3]=h;a.a[4]=k;a.a[5]=l;a.a[6]=m;a.a[7]=u;a.a[8]=x;a.a[9]=v;a.a[10]=G;a.a[11]=D;a.a[12]=w;a.a[13]=q;a.a[14]=n;a.a[15]=t;var e=a.a[0],f=a.a[1],g=a.a[2],h=a.a[3],y=a.a[4],H=a.a[5],B=a.a[6],E=a.a[7],M=a.a[8],R=a.a[9],I=a.a[10],C=a.a[11],z=a.a[12],N=a.a[13],L=a.a[14],A=a.a[15],k=I*A-C*L,l=R*A-C*N,m=
R*L-I*N,u=M*A-C*z,x=M*L-I*z,v=M*N-R*z,G=H*k-B*l+E*m,D=-(y*k-B*u+E*x),w=y*l-H*u+E*v,q=-(y*m-H*x+B*v),n=1/(e*G+f*D+g*w+h*q),t=B*A-E*L,F=H*A-E*N,T=H*L-B*N,A=y*A-E*z,L=y*L-B*z,z=y*N-H*z,N=B*C-E*I,O=H*C-E*R,S=H*I-B*R,E=y*C-E*M,B=y*I-B*M,y=y*R-H*M;a.a[0]=G*n;a.a[4]=D*n;a.a[8]=w*n;a.a[12]=q*n;a.a[1]=-(f*k-g*l+h*m)*n;a.a[5]=(e*k-g*u+h*x)*n;a.a[9]=-(e*l-f*u+h*v)*n;a.a[13]=(e*m-f*x+g*v)*n;a.a[2]=(f*t-g*F+h*T)*n;a.a[6]=-(e*t-g*A+h*L)*n;a.a[10]=(e*F-f*A+h*z)*n;a.a[14]=-(e*T-f*L+g*z)*n;a.a[3]=-(f*N-g*O+h*S)*n;
a.a[7]=(e*N-g*E+h*B)*n;a.a[11]=-(e*O-f*E+h*y)*n;a.a[15]=(e*S-f*B+g*y)*n;e=new p(0,0,0);a=a.a;f=d*a[1]+c*a[5]+b*a[9]+a[13];g=d*a[2]+c*a[6]+b*a[10]+a[14];h=d*a[3]+c*a[7]+b*a[11]+a[15];e.x=(d*a[0]+c*a[4]+b*a[8]+a[12])/h;e.y=f/h;e.z=g/h;this.position=e}else this.position.x=d,this.position.y=c,this.position.z=b}},zm:function(){if(this.vm||this.Bd!=this.L.Bd||this.Bd!=qa.D||this.L.oo||this.Ii)return!1;var a=this.L.position,b=this.position;if(null==b||a.x!=b.x||a.y!=b.y||a.z!=b.z||null!=this.yd&&(a=this.L.ub,
b=this.yd,null==b||a.x!=b.x||a.y!=b.y||a.z!=b.z||a.o!=b.o))return!1;a=this.L.rotation;b=this.Kb;if(null==b||a.x!=b.x||a.y!=b.y||a.z!=b.z)return!1;a=this.L.Il;b=this.Be;return null==b||a.x!=b.x||a.y!=b.y||a.z!=b.z?!1:!0},bh:function(){oa.prototype.bh.call(this);this.L.TO=!1;this.L.position=new p(0,0,0);this.L.Il=new p(0,0,0);this.L.rotation=new p(0,0,0);this.L.ub=new X(0,0,0,0);this.L.Bd=-1},VG:function(){var a=this.ra=null==this.ra?new Gb(this.qf(),this.qf()):this.ra,b=this.me();if(!a.Ak){var c=a.yc,
d=c.fa;d.x=Infinity;d.y=Infinity;d.z=Infinity;d=c.ea;d.x=-Infinity;d.y=-Infinity;d.z=-Infinity;for(var e,f,g,d=0,h=c.Ab.length;d<h;){e=d++;pa.g=c.gg[e];var k=c.Ab[e];e=pa.g;f=k.x;g=k.y;var k=k.z,l=b.a,m=f*l[1]+g*l[5]+k*l[9]+l[13],u=f*l[2]+g*l[6]+k*l[10]+l[14],x=f*l[3]+g*l[7]+k*l[11]+l[15];e.x=(f*l[0]+g*l[4]+k*l[8]+l[12])/x;e.y=m/x;e.z=u/x;e=pa.g.x;f=pa.g.y;g=pa.g.z;e<c.fa.x&&(c.fa.x=e);f<c.fa.y&&(c.fa.y=f);g<c.fa.z&&(c.fa.z=g);e>c.ea.x&&(c.ea.x=e);f>c.ea.y&&(c.ea.y=f);g>c.ea.z&&(c.ea.z=g)}d=c.ea;
h=c.fa;e=c.oa;e.x=d.x+h.x;e.y=d.y+h.y;e.z=d.z+h.z;d=c.oa;d.x*=.5;d.y*=.5;d.z*=.5;d=b.a;h=c.w[0];h.x=d[0];h.y=d[1];h.z=d[2];d=b.a;h=c.w[1];h.x=d[4];h.y=d[5];h.z=d[6];d=b.a;h=c.w[2];h.x=d[8];h.y=d[9];h.z=d[10];c.Ea=b;a=a.Oc;c=Math.max;d=Math.abs;g=a.oa;h=a.Gc;e=g.x;f=g.y;g=g.z;k=b.a;l=e*k[1]+f*k[5]+g*k[9]+k[13];m=e*k[2]+f*k[6]+g*k[10]+k[14];u=e*k[3]+f*k[7]+g*k[11]+k[15];h.x=(e*k[0]+f*k[4]+g*k[8]+k[12])/u;h.y=l/u;h.z=m/u;h=a.Eb;h.x=b.a[0]+b.a[4]+b.a[8];h.y=b.a[1]+b.a[5]+b.a[9];h.z=b.a[2]+b.a[6]+b.a[10];
a.Zf=c(c(d(a.Eb.x),d(a.Eb.y)),d(a.Eb.z))*a.R}this.Vk(this.me())},Vk:function(a){if(null!=this.Ga)for(var b=0,c=this.Ga;b<c.length;){var d=c[b];++b;if(!d.Of()&&(null==(d.Of()?d.ta.ed():d.ra)&&d.Uv(),d=d.Of()?d.ta.ed():d.ra,!d.Ak)){var e=d.yc,f=e.fa;f.x=Infinity;f.y=Infinity;f.z=Infinity;f=e.ea;f.x=-Infinity;f.y=-Infinity;f.z=-Infinity;for(var g,h,k,f=0,l=e.Ab.length;f<l;){g=f++;pa.g=e.gg[g];var m=e.Ab[g];g=pa.g;h=m.x;k=m.y;var m=m.z,u=a.a,x=h*u[1]+k*u[5]+m*u[9]+u[13],v=h*u[2]+k*u[6]+m*u[10]+u[14],
p=h*u[3]+k*u[7]+m*u[11]+u[15];g.x=(h*u[0]+k*u[4]+m*u[8]+u[12])/p;g.y=x/p;g.z=v/p;g=pa.g.x;h=pa.g.y;k=pa.g.z;g<e.fa.x&&(e.fa.x=g);h<e.fa.y&&(e.fa.y=h);k<e.fa.z&&(e.fa.z=k);g>e.ea.x&&(e.ea.x=g);h>e.ea.y&&(e.ea.y=h);k>e.ea.z&&(e.ea.z=k)}f=e.ea;l=e.fa;g=e.oa;g.x=f.x+l.x;g.y=f.y+l.y;g.z=f.z+l.z;f=e.oa;f.x*=.5;f.y*=.5;f.z*=.5;f=a.a;l=e.w[0];l.x=f[0];l.y=f[1];l.z=f[2];f=a.a;l=e.w[1];l.x=f[4];l.y=f[5];l.z=f[6];f=a.a;l=e.w[2];l.x=f[8];l.y=f[9];l.z=f[10];e.Ea=a;d=d.Oc;e=Math.max;f=Math.abs;k=d.oa;l=d.Gc;g=
k.x;h=k.y;k=k.z;m=a.a;u=g*m[1]+h*m[5]+k*m[9]+m[13];x=g*m[2]+h*m[6]+k*m[10]+m[14];v=g*m[3]+h*m[7]+k*m[11]+m[15];l.x=(g*m[0]+h*m[4]+k*m[8]+m[12])/v;l.y=u/v;l.z=x/v;l=d.Eb;l.x=a.a[0]+a.a[4]+a.a[8];l.y=a.a[1]+a.a[5]+a.a[9];l.z=a.a[2]+a.a[6]+a.a[10];d.Zf=e(e(f(d.Eb.x),f(d.Eb.y)),f(d.Eb.z))*d.R}}},Wd:function(a){null==a&&(a=!1);var b,c,d;if(this.ZF)return this.Ea;var e;if(a)e=!1;else if(this.sd!=this.f.Pa){var f=this.gB(),f=(f=f?!0:!this.ov())?!0:!this.zm();this.xw(!0);e=!f}else e=!0;if(e)return this.sd=
this.f.Pa,this.Ea;var g=this.L.position,h=this.position;g.x=h.x;g.y=h.y;g.z=h.z;var k=this.L.Il,l=this.Be;k.x=l.x;k.y=l.y;k.z=l.z;this.L.oo=!1;this.L.Bd=this.Bd;this.sd=this.f.Pa;this.vm=!1;var m=fa.Ra[1];m.a[0]=this.Be.x*this.uo;m.a[1]=0;m.a[2]=0;m.a[3]=0;m.a[4]=0;m.a[5]=this.Be.y*this.uo;m.a[6]=0;m.a[7]=0;m.a[8]=0;m.a[9]=0;m.a[10]=this.Be.z*this.uo;m.a[11]=0;m.a[12]=0;m.a[13]=0;m.a[14]=0;m.a[15]=1;if(null!=this.yd){var u=this.Kb;if(0!=Math.sqrt(u.x*u.x+u.y*u.y+u.z*u.z)){var x=this.yd,v=new X,G=
.5*this.Kb.z,D=.5*this.Kb.x,w=.5*this.Kb.y,q=Math.sin(G),n=Math.cos(G),t=Math.sin(D),y=Math.cos(D),H=Math.sin(w),B=Math.cos(w);v.x=B*t*n+H*y*q;v.y=H*y*n-B*t*q;v.z=B*y*q-H*t*n;v.o=B*y*n+H*t*q;var E=-x.x*v.z+x.y*v.o+x.z*v.x+x.o*v.y,M=x.x*v.y-x.y*v.x+x.z*v.o+x.o*v.z,z=-x.x*v.x-x.y*v.y-x.z*v.z+x.o*v.o;x.x=x.x*v.o+x.y*v.z-x.z*v.y+x.o*v.x;x.y=E;x.z=M;x.o=z;var I=this.Kb;I.x=0;I.y=0;I.z=0}}if(null!=this.yd){this.yd.yf(fa.Ra[0]);var C=this.L.ub,A=this.yd;C.x=A.x;C.y=A.y;C.z=A.z;C.o=A.o}else{var N=fa.Ra[0],
L=r.Ma,F=.5*this.Kb.z,O=.5*this.Kb.x,T=.5*this.Kb.y,S=Math.sin(F),Q=Math.cos(F),aa=Math.sin(O),W=Math.cos(O),Y=Math.sin(T),U=Math.cos(T);L.x=U*aa*Q+Y*W*S;L.y=Y*W*Q-U*aa*S;L.z=U*W*S-Y*aa*Q;L.o=U*W*Q+Y*aa*S;r.Ma.yf(N);var ea=this.L.rotation,V=this.Kb;ea.x=V.x;ea.y=V.y;ea.z=V.z}if(this.Ii&&null==this.ca){var Z=this.f.M;if(null!=Z){var ca=Z.va();d=ca.a[12];c=ca.a[13];b=ca.a[14];r.da(1,0,0,0,1,0,0,0,1,this.position.x+d,this.position.y+c,this.position.z+b,fa.Ra[2])}}else r.da(1,0,0,0,1,0,0,0,1,this.position.x,
this.position.y,this.position.z,fa.Ra[2]);this.nj.qa(fa.Ra[1],fa.Ra[4].a,0);fa.Ra[4].qa(fa.Ra[0],fa.Ra[5].a,0);if(this.Bd!=qa.D&&null!=this.f.M){var ha=fa.nc[0],Ud=this.position;ha.x=Ud.x;ha.y=Ud.y;ha.z=Ud.z;var Ob=fa.nc[0];if(null!=this.ca&&null!=this.ca.va()){this.Tm=this.ca.sd;var J=null;null!=this.lt?(this.ca.va().qa(this.lt.va(),fa.Ra[6].a,0),J=fa.Ra[6]):J=this.ca.va();var P=fa.nc[1];P.x=Ob.x*J.a[0]+Ob.y*J.a[4]+Ob.z*J.a[8];P.y=Ob.x*J.a[1]+Ob.y*J.a[5]+Ob.z*J.a[9];P.z=Ob.x*J.a[2]+Ob.y*J.a[6]+Ob.z*
J.a[10];Ob=fa.nc[1]}var ka=this.f.M.Ch(),ja=new p(ka.x,ka.y,ka.z);if(null!=this.ca&&Object.prototype.hasOwnProperty.call(this.ca,"position")){var la=this.ca.position;Ob.x+=la.x;Ob.y+=la.y;Ob.z+=la.z;r.da(1,0,0,0,1,0,0,0,1,Ob.x,Ob.y,Ob.z,fa.Ra[2])}(this.Bd&qa.Md)!=qa.Md&&(0!=(this.Bd&qa.Af)&&(ja.x=Ob.x+.001),0!=(this.Bd&qa.lg)&&(ja.y=Ob.y+.001),0!=(this.Bd&qa.jg)&&(ja.z=Ob.z+.001));r.Uc(Ob,ja,new p(0,1,0),fa.Ra[3]);fa.Ra[3].a[12]=0;fa.Ra[3].a[13]=0;fa.Ra[3].a[14]=0;var na=fa.Ra[3],da=na.a[0],ia=na.a[1],
ga=na.a[2],Fb=na.a[3],zb=na.a[4],ma=na.a[5],oa=na.a[6],Vb=na.a[7],sa=na.a[8],Ha=na.a[9],va=na.a[10],ra=na.a[11],ta=na.a[12],rc=na.a[13],ed=na.a[14],Za=na.a[15],xa=va*Za-ra*ed,Cc=Ha*Za-ra*rc,Ba=Ha*ed-va*rc,Aa=sa*Za-ra*ta,Fa=sa*ed-va*ta,Oa=sa*rc-Ha*ta,za=ma*xa-oa*Cc+Vb*Ba,Ia=-(zb*xa-oa*Aa+Vb*Fa),Ga=zb*Cc-ma*Aa+Vb*Oa,Ca=-(zb*Ba-ma*Fa+oa*Oa),eb=1/(da*za+ia*Ia+ga*Ga+Fb*Ca),Ma=oa*Za-Vb*ed,Ja=ma*Za-Vb*rc,wa=ma*ed-oa*rc,Qa=zb*Za-Vb*ta,Ra=zb*ed-oa*ta,Va=zb*rc-ma*ta,ya=oa*ra-Vb*va,Ea=ma*ra-Vb*Ha,Da=ma*va-oa*
Ha,lb=zb*ra-Vb*sa,cb=zb*va-oa*sa,jb=zb*Ha-ma*sa;na.a[0]=za*eb;na.a[4]=Ia*eb;na.a[8]=Ga*eb;na.a[12]=Ca*eb;na.a[1]=-(ia*xa-ga*Cc+Fb*Ba)*eb;na.a[5]=(da*xa-ga*Aa+Fb*Fa)*eb;na.a[9]=-(da*Cc-ia*Aa+Fb*Oa)*eb;na.a[13]=(da*Ba-ia*Fa+ga*Oa)*eb;na.a[2]=(ia*Ma-ga*Ja+Fb*wa)*eb;na.a[6]=-(da*Ma-ga*Qa+Fb*Ra)*eb;na.a[10]=(da*Ja-ia*Qa+Fb*Va)*eb;na.a[14]=-(da*wa-ia*Ra+ga*Va)*eb;na.a[3]=-(ia*ya-ga*Ea+Fb*Da)*eb;na.a[7]=(da*ya-ga*lb+Fb*cb)*eb;na.a[11]=-(da*Ea-ia*lb+Fb*jb)*eb;na.a[15]=(da*Da-ia*cb+ga*jb)*eb;fa.Ra[5].qa(fa.Ra[3],
this.ki.a,0);this.AG.qa(this.ki,fa.Ra[5].a,0)}fa.Ra[5].qa(fa.Ra[2],this.ki.a,0);if(null!=this.ca&&this.Bd==qa.D)this.Tm=this.ca.sd,null!=this.lt?(this.ki.qa(this.ca.va(),fa.Ra[6].a,0),fa.Ra[6].qa(this.lt.va(),this.Ea.a,0)):this.ki.qa(this.ca.va(),this.Ea.a,0);else for(var vb=this.Ea,nb=this.ki,qb=0;16>qb;){var Zc=qb++;vb.a[Zc]=nb.a[Zc]}var od=this.ra=null==this.ra?new Gb(this.qf(),this.qf()):this.ra,Sa=this.me();if(!od.Ak){var Ka=od.yc,Ab=Ka.fa;Ab.x=Infinity;Ab.y=Infinity;Ab.z=Infinity;var gb=Ka.ea;
gb.x=-Infinity;gb.y=-Infinity;gb.z=-Infinity;for(var La=0,Ic=0,Ta=0,rb=0,ib=Ka.Ab.length;rb<ib;){var Vd=rb++;pa.g=Ka.gg[Vd];var id=Ka.Ab[Vd],fd=pa.g,jd=id.x,Jc=id.y,Ec=id.z,ob=Sa.a,Wd=jd*ob[1]+Jc*ob[5]+Ec*ob[9]+ob[13],fb=jd*ob[2]+Jc*ob[6]+Ec*ob[10]+ob[14],Fc=jd*ob[3]+Jc*ob[7]+Ec*ob[11]+ob[15];fd.x=(jd*ob[0]+Jc*ob[4]+Ec*ob[8]+ob[12])/Fc;fd.y=Wd/Fc;fd.z=fb/Fc;La=pa.g.x;Ic=pa.g.y;Ta=pa.g.z;La<Ka.fa.x&&(Ka.fa.x=La);Ic<Ka.fa.y&&(Ka.fa.y=Ic);Ta<Ka.fa.z&&(Ka.fa.z=Ta);La>Ka.ea.x&&(Ka.ea.x=La);Ic>Ka.ea.y&&
(Ka.ea.y=Ic);Ta>Ka.ea.z&&(Ka.ea.z=Ta)}var Zd=Ka.ea,gd=Ka.fa,kd=Ka.oa;kd.x=Zd.x+gd.x;kd.y=Zd.y+gd.y;kd.z=Zd.z+gd.z;var Qc=Ka.oa;Qc.x*=.5;Qc.y*=.5;Qc.z*=.5;var sb=Sa.a,Xd=Ka.w[0];Xd.x=sb[0];Xd.y=sb[1];Xd.z=sb[2];var Xa=Sa.a,ub=Ka.w[1];ub.x=Xa[4];ub.y=Xa[5];ub.z=Xa[6];var Eb=Sa.a,wb=Ka.w[2];wb.x=Eb[8];wb.y=Eb[9];wb.z=Eb[10];Ka.Ea=Sa;var Ua=od.Oc,hc=Math.max,Yb=Math.abs,pb=Ua.oa,$b=Ua.Gc,ab=pb.x,ic=pb.y,Cb=pb.z,Wb=Sa.a,Ib=ab*Wb[1]+ic*Wb[5]+Cb*Wb[9]+Wb[13],ec=ab*Wb[2]+ic*Wb[6]+Cb*Wb[10]+Wb[14],Nb=ab*Wb[3]+
ic*Wb[7]+Cb*Wb[11]+Wb[15];$b.x=(ab*Wb[0]+ic*Wb[4]+Cb*Wb[8]+Wb[12])/Nb;$b.y=Ib/Nb;$b.z=ec/Nb;var fc=Ua.Eb;fc.x=Sa.a[0]+Sa.a[4]+Sa.a[8];fc.y=Sa.a[1]+Sa.a[5]+Sa.a[9];fc.z=Sa.a[2]+Sa.a[6]+Sa.a[10];Ua.Zf=hc(hc(Yb(Ua.Eb.x),Yb(Ua.Eb.y)),Yb(Ua.Eb.z))*Ua.R}this.Vk(this.me());var Ub=this.us,mc=this.Ea.a[13],sc=this.Ea.a[14];Ub.x=this.Ea.a[12];Ub.y=mc;Ub.z=sc;this.VB.la(this);if(null==this.yt){var Tb=this.Ea,Jb=new r,Pa=Tb.a[0],bb=Tb.a[1],hb=Tb.a[2],hd=Tb.a[3],Wa=Tb.a[4],ld=Tb.a[5],mb=Tb.a[6],db=Tb.a[7],xb=
Tb.a[8],yb=Tb.a[9],Lb=Tb.a[10],Mb=Tb.a[11],tb=Tb.a[12],md=Tb.a[13],wc=Tb.a[14],$a=Tb.a[15],Db=Lb*$a-Mb*wc,Zb=yb*$a-Mb*md,ac=yb*wc-Lb*md,bc=xb*$a-Mb*tb,cc=xb*wc-Lb*tb,dc=xb*md-yb*tb,uc=ld*Db-mb*Zb+db*ac,jc=-(Wa*Db-mb*bc+db*cc),kc=Wa*Zb-ld*bc+db*dc,lc=-(Wa*ac-ld*cc+mb*dc),Xb=1/(Pa*uc+bb*jc+hb*kc+hd*lc),nc=mb*$a-db*wc,xc=ld*$a-db*md,oc=ld*wc-mb*md,kb=Wa*$a-db*tb,Kb=Wa*wc-mb*tb,yc=Wa*md-ld*tb,zc=mb*Mb-db*Lb,pc=ld*Mb-db*yb,Bb=ld*Lb-mb*yb,Gc=Wa*Mb-db*xb,vc=Wa*Lb-mb*xb,Bc=Wa*yb-ld*xb;Jb.a[0]=uc*Xb;Jb.a[4]=
jc*Xb;Jb.a[8]=kc*Xb;Jb.a[12]=lc*Xb;Jb.a[1]=-(bb*Db-hb*Zb+hd*ac)*Xb;Jb.a[5]=(Pa*Db-hb*bc+hd*cc)*Xb;Jb.a[9]=-(Pa*Zb-bb*bc+hd*dc)*Xb;Jb.a[13]=(Pa*ac-bb*cc+hb*dc)*Xb;Jb.a[2]=(bb*nc-hb*xc+hd*oc)*Xb;Jb.a[6]=-(Pa*nc-hb*kb+hd*Kb)*Xb;Jb.a[10]=(Pa*xc-bb*kb+hd*yc)*Xb;Jb.a[14]=-(Pa*oc-bb*Kb+hb*yc)*Xb;Jb.a[3]=-(bb*zc-hb*pc+hd*Bb)*Xb;Jb.a[7]=(Pa*zc-hb*Gc+hd*vc)*Xb;Jb.a[11]=-(Pa*pc-bb*Gc+hd*Bc)*Xb;Jb.a[15]=(Pa*Bb-bb*vc+hb*Bc)*Xb;this.yt=Jb}return this.Ea},Ki:function(a){return this.ra.Ki(a)},iJ:function(a,b){null==
b&&(b=!1);return null==this.ra||null==a.ra?!1:this.ra.Ji(a.ra,b)},IL:function(a,b){var c=this.f.ie;if(null==c)return null;null==a&&(a=0);Object.prototype.hasOwnProperty.call(a,"impostor")&&(b=a,a=a.IO);if(0==a)return c.TG(this),null;null==b?(b.xr=0,b.$q=.2,b.Nr=.2):(null==b.xr&&(b.xr=0),null==b.$q&&(b.$q=.2),null==b.Nr&&(b.Nr=.2));return c.qG(this,a,b)},pl:function(){return this.yx},yo:function(a){this.yx=a;this.f.nr();return a},jF:function(a){var b=this.ra;if(a.wx(b.Oc.Gc,b.Oc.Zf,b.yc.fa,b.yc.ea)){b=
this.Dx;b.a[0]=1/a.R.x;b.a[1]=0;b.a[2]=0;b.a[3]=0;b.a[4]=0;b.a[5]=1/a.R.y;b.a[6]=0;b.a[7]=0;b.a[8]=0;b.a[9]=0;b.a[10]=1/a.R.z;b.a[11]=0;b.a[12]=0;b.a[13]=0;b.a[14]=0;b.a[15]=1;this.me().qa(this.Dx,this.Ex.a,0);var b=this.Ex,c,d;if(null!=this.en&&this.Ew){c=a.Jw+Math.max(Math.max(a.R.x,a.R.y),a.R.z);d=this.en;var e=a.Dq,f=d.Sd;f.length=0;f.Ja++;for(var f=0,g=d.hc.length;f<g;)d.hc[f++].Ji(e,c,d.Sd,!1);c=d.Sd;e=d.Tq;f=0;for(g=e.length;f<g;)c.Yf(e[f++]);c=d.Sd;d=c.length;c=c.data}else c=this.Ga,d=c.length;
e=0;for(f=d;e<f;){var g=c[e++],h;1<d?(h=g.Of()?g.ta.ed():g.ra,h=!a.wx(h.Oc.Gc,h.Oc.Zf,h.yc.fa,h.yc.ea)):h=!1;if(!h){this.gm();null!=g.Xp?(h=g.aG,h=!(null!=b&&h.a[0]==b.a[0]&&h.a[1]==b.a[1]&&h.a[2]==b.a[2]&&h.a[3]==b.a[3]&&h.a[4]==b.a[4]&&h.a[5]==b.a[5]&&h.a[6]==b.a[6]&&h.a[7]==b.a[7]&&h.a[8]==b.a[8]&&h.a[9]==b.a[9]&&h.a[10]==b.a[10]&&h.a[11]==b.a[11]&&h.a[12]==b.a[12]&&h.a[13]==b.a[13]&&h.a[14]==b.a[14]&&h.a[15]==b.a[15])):h=!0;if(h){h=b.a[0];var k=b.a[1],l=b.a[2],m=b.a[3],u=b.a[4],x=b.a[5],v=b.a[6],
G=b.a[7],D=b.a[8],w=b.a[9],q=b.a[10],n=b.a[11],t=b.a[12],y=b.a[13],H=b.a[14],B=b.a[15],E=new r;E.a[0]=h;E.a[1]=k;E.a[2]=l;E.a[3]=m;E.a[4]=u;E.a[5]=x;E.a[6]=v;E.a[7]=G;E.a[8]=D;E.a[9]=w;E.a[10]=q;E.a[11]=n;E.a[12]=t;E.a[13]=y;E.a[14]=H;E.a[15]=B;g.aG=E;g.Xp=[];g.tj=[];h=g.te+g.Tg;for(k=g.te;k<h;)x=this.mh[k++],l=new p(0,0,0),m=x.x,u=x.y,x=x.z,v=b.a,G=m*v[1]+u*v[5]+x*v[9]+v[13],D=m*v[2]+u*v[6]+x*v[10]+v[14],w=m*v[3]+u*v[7]+x*v[11]+v[15],l.x=(m*v[0]+u*v[4]+x*v[8]+v[12])/w,l.y=G/w,l.z=D/w,g.Xp.push(l)}h=
g.Xp;k=this.Ac();l=g.Wb+g.Xd;m=g.te;for(u=g.Wb;u<l;)a.OG(u,g,h[k[u+2]-m],h[k[u+1]-m],h[k[u]-m]),u+=3;a.Lq&&(a.tu=this)}}}},gm:function(){return!1},Ji:function(a,b){null==b&&(b=!1);var c=new dd,d;null!=this.Ga&&null!=this.ra&&a.jJ(this.ra.Oc)?(d=this.ra.yc,d=!a.rr(d.Gb,d.Mb)):d=!0;if(d||!this.gm())return c;d=null;var e,f;if(null!=this.en&&this.Fw){f=this.va();var g=a.origin;e=new p(0,0,0);var h=g.x,k=g.y,g=g.z,l=f.a,m=h*l[1]+k*l[5]+g*l[9]+l[13],u=h*l[2]+k*l[6]+g*l[10]+l[14],x=h*l[3]+k*l[7]+g*l[11]+
l[15];e.x=(h*l[0]+k*l[4]+g*l[8]+l[12])/x;e.y=m/x;e.z=u/x;h=a.direction;k=new p(0,0,0);k.x=h.x*f.a[0]+h.y*f.a[4]+h.z*f.a[8];k.y=h.x*f.a[1]+h.y*f.a[5]+h.z*f.a[9];k.z=h.x*f.a[2]+h.y*f.a[6]+h.z*f.a[10];e=this.en.sr(new Ra(e,k,a.length));f=e.length;e=e.data}else e=this.Ga,f=e.length;h=0;for(k=f;h<k;)if(g=h++,l=e[g],1<f?(m=(l.Of()?l.ta.ed():l.ra).yc,m=!a.rr(m.Gb,m.Mb)):m=!1,!m){m=this.mh;u=this.Ac();x=null;null==m&&(m=l.ta.mr());if(z.D(l.ta,xc))for(var v=l.ta,G=l.Wb;G<l.Wb+l.Xd;){var D=a.hJ(m[u[G]],m[u[G+
1]],v.$u());if(!(0>D)&&(b||null==x||D<x.Rb)&&(x=new Fe(0,0,D),b))break;G+=2}else for(v=l.Wb;v<l.Wb+l.Xd;){G=a.kJ(m[u[v]],m[u[v+1]],m[u[v+2]]);if(null!=G){if(0>G.Rb){v+=3;continue}if(b||null==x||G.Rb<x.Rb)if(x=G,G.Wq=v/3|0,b)break}v+=3}l=x;if(null!=l&&(b||null==d||l.Rb<d.Rb)&&(d=l,l.Sg=g,b))break}null!=d&&(e=this.va(),g=a.origin,f=new p(0,0,0),h=g.x,k=g.y,g=g.z,l=e.a,m=h*l[1]+k*l[5]+g*l[9]+l[13],u=h*l[2]+k*l[6]+g*l[10]+l[14],x=h*l[3]+k*l[7]+g*l[11]+l[15],f.x=(h*l[0]+k*l[4]+g*l[8]+l[12])/x,f.y=m/x,
f.z=u/x,h=a.direction,h=new p(h.x,h.y,h.z),k=d.Rb,h=new p(h.x*k,h.y*k,h.z*k),k=new p(0,0,0),k.x=h.x*e.a[0]+h.y*e.a[4]+h.z*e.a[8],k.y=h.x*e.a[1]+h.y*e.a[5]+h.z*e.a[9],k.z=h.x*e.a[2]+h.y*e.a[6]+h.z*e.a[10],e=new p(f.x+k.x,f.y+k.y,f.z+k.z),c.sf=!0,h=f.x-e.x,k=f.y-e.y,f=f.z-e.z,c.Rb=Math.sqrt(h*h+k*k+f*f),c.PK=e,c.hb=this,c.ou=d.ou,c.pu=d.pu,c.Wq=d.Wq,c.Sg=d.Sg);return c},clone:function(){return null},qo:function(){if(null!=this.Ga)for(;0<this.Ga.length;)this.Ga[0].dispose();else this.Ga=[]},dispose:function(a){null==
a&&(a=!1);null!=this.ka&&(this.ka.dispose(),this.ka=null);this.Sr(null);this.f.Ml(this);for(var b=0,c=this.dh.length;b<c;){var d=this.dh[b++];d.dh.splice(d.dh.indexOf(this),1)}this.dh=[];b=this.f.jc;for(c=0;c<b.length;){d=b[c];++c;var e=d.Ij.indexOf(this);-1!=e&&d.Ij.splice(e,1);e=d.Dj.indexOf(this);-1!=e&&d.Dj.splice(e,1)}null!=this.Np&&(this.Np.dispose(),this.Np=null);this.qo();b=this.f.c;c=0;for(d=b.na.length;c<d;)e=c++,e>=b.U.GB||!b.na[e]||(b.b.disableVertexAttribArray(e),b.na[e]=!1);this.f.Wv(this);
if(a)for(a=this.FI(!0),b=0,c=a.length;b<c;)d=a[b++],d.bk(null),d.Wd(!0);else{for(a=0;a<this.f.Ne.length;)this.f.Ne[a].Ed==this&&(b=this.f.Ne[a],null!=b.G&&(b.G.dispose(),b.G=null),null!=b.wa&&(c=b.wa,c.ia--,0==c.ia&&b.c.b.deleteBuffer(c.buffer),b.wa=null),null!=b.Jd&&(b.Jd.dispose(),b.Jd=null),Z.remove(b.f.Ne,b),b.Nb.la(b),b.Nb.clear(),--a);a=[];this.Zs(a,!0,null);b=0;for(c=a.length;b<c;)a[b++].dispose()}oa.prototype.dispose.call(this);this.VB.clear();this.kK.clear();this.lK.clear();this.Nb.la(this);
this.Nb.clear()},l:qa,F:S(oa.prototype.F,{yo:"set_checkCollisions",pl:"get_checkCollisions",qf:"get_absolutePosition",me:"get_worldMatrixFromCache",hr:"get_isBlocked",Sr:"set_skeleton",fd:"get_skeleton",Gg:"get_useBones",mr:"get_positions",Rr:"set_receiveShadows",Fj:"get_receiveShadows",kd:"set_material",Fg:"get_material",Qr:"set_isPickable",Bi:"get_isPickable",Ur:"set_visibility",Ci:"get_visibility",Ll:"set_rotationQuaternion"})});var aa=K.BABYLON.Mesh=function(a,b,c,d,e){null==e&&(e=!1);this.Fs=
this.mF=!1;this.Vd=0;this.XE=!1;this.Ce=0;this.zk=2048;this.Xe=new Bf;this.Uy=[];this.mg=[];this.Eh=[];this.La=0;this.gK=new U;this.Kc=new U;this.sc=new U;qa.call(this,a,b);if(null!=d){null!=d.xa&&d.xa.cc(this);aa.Bb(d,this);this.bk(d.ca);this.nj=d.nj;this.L.oo=!0;this.id=a+"."+d.id;this.kd(d.Fg());if(!e)for(var f=0,g=b.Xb.length;f<g;){var h=b.Xb[f++];h.ca==d&&h.clone(a+"."+h.name,this,e)}a=0;for(e=b.Ne.length;a<e;)f=b.Ne[a++],f.Ed==d&&f.clone(f.name,this);this.Wd(!0)}null!=c&&this.bk(c)};n["com.babylonhx.mesh.Mesh"]=
aa;aa.h=["com","babylonhx","mesh","Mesh"];aa.xb=[lc,Ie];aa.Bb=function(a,b){var c=a.position;b.position=new p(c.x,c.y,c.z);c=a.Kb;b.Kb=new p(c.x,c.y,c.z);null!=a.yd&&(c=a.yd,b.Ll(new X(c.x,c.y,c.z,c.o)));c=a.Be;b.Be=new p(c.x,c.y,c.z);b.Bd=a.Bd;b.Xk=a.Xk;b.Ii=a.Ii;b.gd=a.gd;b.Ao=a.Ao;b.Bo=a.Bo;b.oB=a.oB;b.ag=a.ag;b.ka=a.ka;b.Kr=a.Kr;c=a.outlineColor;b.outlineColor=new Q(c.r,c.v,c.m);b.outlineWidth=a.outlineWidth;b.Xv=a.Xv;c=a.Nv;b.Nv=new Q(c.r,c.v,c.m);b.Mv=a.Mv;b.tl=a.tl;b.Iw=a.Iw;b.rh=a.rh;b.Gw=
a.Gw;b.Fw=a.Fw;b.Ew=a.Ew;b.tb=a.tb;c=a.xi;b.xi=new p(c.x,c.y,c.z);c=a.rA;b.rA=new p(c.x,c.y,c.z);b.state=a.state;b.fA=a.fA;b.Ya=a.Ya.slice();b.Ur(a.Ci());b.Qr(a.Bi());b.Rr(a.Fj());b.lf=a.lf;b.uo=a.uo;b.Ke=a.Ke;b.zq=a.zq;b.Uq=a.Uq;b.Hu=a.Hu.clone();b.La=a.La;b.Ce=a.Ce;b.yo(a.pl());b.yb=a.yb.slice()};aa.Ma=function(a,b,c,d,e,f,g,h){var k=0;null==g&&(g=0);null==f&&(f=!1);null==k&&(k=0);null==d&&(d=!1);null==c&&(c=!1);return A.Ue(a,{Pg:b,Zk:c,closePath:d,offset:k,Hg:h,aa:g,Ha:f},e)};aa.Ag=function(a,
b,c,d,e,f){null==f&&(f=0);null==e&&(e=!1);return A.Yo(a,{R:b,Kd:c,aa:f,Ha:e},d)};aa.Ue=function(a,b,c,d,e){null==e&&(e=0);null==d&&(d=!1);return A.uh(a,{width:b,height:b,depth:b,aa:e,Ha:d},c)};aa.nc=function(a,b,c){var d,e;null==e&&(e=0);null==d&&(d=!1);return A.ep("capsuleSphereTop",{OC:a,hA:b,iA:b,jA:b,aa:e,Ha:d},c)};aa.Nd=function(a,b,c,d,e){b>c&&(c=b/2);a=A.uh("tempbox",{width:b,height:c,depth:b},e);var f=aa.nc(d,b,e);f.position.y=c/2;var g=sc.Qz(f),h=sc.Qz(a);g.$L(h);a.dispose();f.dispose();
a=g.hM("test",e.Qq,e,!1);f=a.clone("tempsphereclone");f.position.y=-c/2;f.Kb.x=Math.PI;b=aa.pb([A.zl("capsuleCylinder",{height:c,Gn:b,Fn:b,Kd:(2*d|0)+4,Tc:6,Ju:!1},e),a,f]);b.kd(e.Qq);return b};aa.Af=function(a,b,c,d,e,f,g,h,k){null==k&&(k=0);null==h&&(h=!1);return A.zl(a,{height:b,Gn:c,Fn:d,Kd:e,Tc:f,aa:k,Ha:h,Ju:!0},g)};aa.Mi=function(a,b,c,d,e,f,g){null==g&&(g=0);null==f&&(f=!1);return A.gp(a,{Du:b,uD:c,Kd:d,aa:g,Ha:f},e)};aa.Kj=function(a,b,c,d,e,f,g,h,k,l){null==l&&(l=0);null==k&&(k=!1);return A.hp(a,
{R:b,xD:c,xC:d,yD:e,p:f,q:g,aa:l,Ha:k},h)};aa.Ah=function(a,b,c,d,e){null==d&&(d=!1);return A.bK(a,{Ir:b,Ha:d,Hg:e},c)};aa.lg=function(a,b,c,d,e,f,g,h){null==g&&(g=!1);return A.Xo(a,{Ir:b,Cj:c,hl:d,cA:e,Ha:g,Hg:h},f)};aa.Qj=function(a,b,c,d,e,f,g,h,k,l){null==k&&(k=0);null==h&&(h=!1);null==f&&(f=0);null==e&&(e=0);null==d&&(d=1);return A.ZK(a,{shape:b,path:c,scale:d,rotation:e,Vd:f,aa:k,Lu:l,Ha:h},g)};aa.Sj=function(a,b,c,d,e,f,g,h,k,l,m,u){null==m&&(m=0);null==l&&(l=!1);null==h&&(h=0);null==g&&(g=
!1);null==f&&(f=!1);return A.bL(a,{shape:b,path:c,NC:d,LC:e,IC:f,JC:g,Vd:h,aa:m,Lu:u,Ha:l},k)};aa.yh=function(a,b,c,d,e,f,g){null==g&&(g=0);null==f&&(f=!1);null==d&&(d=0);null==c&&(c=1);return A.YJ(a,{shape:b,R:c,IP:d,aa:g,Ha:f},e)};aa.zi=function(a,b,c,d,e){null==e&&(e=0);null==d&&(d=!1);return A.bp(a,{width:b,height:b,aa:e,Ha:d},c)};aa.Bg=function(a,b,c,d,e,f){null==f&&(f=!1);return A.Zo(a,{width:b,height:c,Tc:d,Ha:f},e)};aa.Fi=function(a,b,c,d,e,f,g,h,k){null==k&&(k=!1);return A.fp(a,{PM:b,TM:c,
OM:d,SM:e,Tc:f,precision:g,Ha:k},h)};aa.uh=function(a,b,c,d,e,f,g,h,k,l){null==k&&(k=!1);return A.$o(a,b,{width:c,height:d,Tc:e,minHeight:f,maxHeight:g,Ha:k,Kv:l},h)};aa.Pj=function(a,b,c,d,e,f,g,h,k,l){null==k&&(k=0);null==h&&(h=!1);return A.LK(a,{path:b,R:c,Kd:d,$K:e,arc:1,Vd:f,Ha:h,aa:k,Hg:l},g)};aa.Di=function(a,b,c){return A.cp(a,b,c)};aa.xh=function(a,b,c){return A.ap(a,b,c)};aa.jg=function(a,b,c,d,e,f){null==f&&(f=0);return A.QJ(a,b,{position:c,j:d,size:e,Ad:f})};aa.g=function(a){for(var b=
null,c=null,d=0;d<a.length;){var e=a[d];++d;e=e.ed().yc;if(null==b)b=e.fa,c=e.ea;else{var f=e.fa;f.x<b.x&&(b.x=f.x);f.y<b.y&&(b.y=f.y);f.z<b.z&&(b.z=f.z);e=e.ea;e.x>c.x&&(c.x=e.x);e.y>c.y&&(c.y=e.y);e.z>c.z&&(c.z=e.z)}}return{Gb:b,Mb:c}};aa.ec=function(a){var b=a instanceof Array&&null==a.jb?aa.g(a):a;a=b.Gb;b=b.Mb;a=new p(a.x+b.x,a.y+b.y,a.z+b.z);a.x*=.5;a.y*=.5;a.z*=.5;return a};aa.pb=function(a){var b,c,d=!0;null==b&&(b=!1);null==d&&(d=!0);if(!b)for(var e=b=0,f=a.length;e<f;){var g=e++;if(null!=
a[g]&&(b+=a[g].Nf(),65536<b))return console.log("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}for(var f=b=null,g=0,h=a.length;g<h;){var k=g++;if(null!=a[k]){a[k].Wd(!0);var e=O.lE(a[k]),l=a[k].va();if(null!=e.Na)for(var m,u,x,v=0;v<e.Na.length;){var p=e.Na;x=p[v];u=p[v+1];m=p[v+2];var p=O.Zc,D=l.a,w=x*D[1]+u*D[5]+m*D[9]+D[13],q=x*D[2]+u*D[6]+m*D[10]+D[14],n=x*D[3]+u*D[7]+m*D[11]+D[15];p.x=(x*D[0]+
u*D[4]+m*D[8]+D[12])/n;p.y=w/n;p.z=q/n;e.Na[v]=O.Zc.x;e.Na[v+1]=O.Zc.y;e.Na[v+2]=O.Zc.z;v+=3}if(null!=e.fb)for(x=0;x<e.fb.length;)u=e.fb,p=u[x],v=u[x+1],u=u[x+2],m=O.Zc,m.x=p*l.a[0]+v*l.a[4]+u*l.a[8],m.y=p*l.a[1]+v*l.a[5]+u*l.a[9],m.z=p*l.a[2]+v*l.a[6]+u*l.a[10],e.fb[x]=O.Zc.x,e.fb[x+1]=O.Zc.y,e.fb[x+2]=O.Zc.z,x+=3;null!=b?b.RJ(e):(b=e,f=a[k])}}null==c&&(c=new aa(f.name+"_merged",f.f));b.cc(c);c.kd(f.Fg());c.yo(f.pl());if(d)for(d=0,b=a.length;d<b;)e=d++,null!=a[e]&&a[e].dispose();return c};aa.ab=
function(a,b,c){var d=new aa(a.name,b);d.id=a.id;Ca.Md(d,a.Nl);var e=a.position;d.position=new p(e[0],e[1],e[2]);null!=a.zr&&(d.zr=a.zr);null!=a.ub?(e=a.ub,d.Ll(new X(e[0],e[1],e[2],e[3]))):null!=a.rotation&&(e=a.rotation,d.Kb=new p(e[0],e[1],e[2]));e=a.Il;d.Be=new p(e[0],e[1],e[2]);if(null!=a.CJ){for(var e=a.CJ,f=new r,g=0;16>g;){var h=g++;f.a[h]=e[h]}d.nj=f;d.L.oo=!0}else if(null!=a.SK){e=a.SK;f=new r;for(g=0;16>g;)h=g++,f.a[h]=e[h];d.nj=f;d.L.oo=!0}d.Vp=a.isEnabled;d.gd=a.gd;d.Ii=a.Ii;d.Ao=a.Ao;
d.Bo=a.Bo;null!=a.rh&&a.rh&&(d.rh=a.rh);null!=a.OK&&d.Qr(a.OK);null!=a.Xk&&(d.Xk=a.Xk);d.Rr(a.pP);d.Bd=a.Bd;null!=a.visibility&&d.Ur(a.visibility);d.yo(a.vh);d.iz=a.PP;null!=a.yI&&(d.KN=a.yI);null!=a.Dl&&(d.zz=a.Dl);null!=a.jf&&(d.JN=a.jf);d.tl=a.tl;null!=a.bl&&1==a.bl?(d.La=4,d.bl=c+sa.Ib(a.bl),c=a.RN,e=a.QN,d.ra=new Gb(new p(c[0],c[1],c[2]),new p(e[0],e[1],e[2])),null!=a.lx&&(d.lx=a.lx),d.ac=[],a.BO&&d.ac.push("uv"),a.CO&&d.ac.push("uv2"),a.DO&&d.ac.push("uv3"),a.EO&&d.ac.push("uv4"),a.FO&&d.ac.push("uv5"),
a.GO&&d.ac.push("uv6"),a.xO&&d.ac.push("color"),a.yO&&d.ac.push("matricesIndices"),a.zO&&d.ac.push("matricesWeights"),d.Ms=Zb.Ba,hg.sE&&d.zx()):Zb.Ba(a,d);null!=a.IJ?d.HL(a.IJ):d.kd(null);-1<a.RL&&(d.Sr(b.II(a.RL)),null!=a.Ke&&(d.Ke=a.Ke));null!=a.MK&&(null==b.ie&&b.jI(),c=new Cf,c.xr=a.kP,c.$q=a.jP,c.Nr=a.lP,d.IL(a.MK,c));if(null!=a.Ya){c=0;for(e=a.Ya.length;c<e;)d.Ya.push(fc.ab(a.Ya[c++]));oa.da(d,a)}null!=a.lu&&b.Eq(d,a.Mz,a.Oz,a.Nz,1);d.tb=null!=a.tb?Math.abs(a.tb)|0:-1;if(null!=a.Eh)for(b=0,
c=a.Eh.length;b<c;)if(f=a.Eh[b++],e=d.al(f.name),Ca.Md(e,f.Nl),g=f.position,e.position=new p(g[0],g[1],g[2]),null!=f.ub?(g=f.ub,e.Ll(new X(g[0],g[1],g[2],g[3]))):null!=f.rotation&&(g=f.rotation,e.Kb=new p(g[0],g[1],g[2])),f=f.Il,e.Be=new p(f[0],f[1],f[2]),e.yo(d.pl()),null!=a.Ya){f=0;for(g=a.Ya.length;f<g;)e.Ya.push(fc.ab(a.Ya[f++]));oa.da(e,a)}return d};aa.V=qa;aa.prototype=S(qa.prototype,{KG:function(){this.mg.sort(function(a,b){return a.Rb<b.Rb?1:a.Rb>b.Rb?-1:0})},Ez:function(a,b){if(null!=b&&
null!=b.Ek)return console.log("You cannot use a mesh as LOD level twice"),this;this.mg.push(new Df(a,b));null!=b&&(b.Ek=this);this.KG();return this},er:function(a,b){if(null==this.mg||0==this.mg.length)return this;var c=(null!=b?b:this.ed().Oc).Gc,d=a.position,e=c.x-d.x,f=c.y-d.y,c=c.z-d.z,e=Math.sqrt(e*e+f*f+c*c);if(this.mg[this.mg.length-1].Rb>e)return null!=this.no&&this.no(e,this,this.mg[this.mg.length-1].Yc),this;f=0;for(c=this.mg.length;f<c;)if(d=this.mg[f++],d.Rb<e)return null!=d.Yc&&(d.Yc.Wm(),
d.Yc.Vk(this.me())),null!=this.no&&this.no(e,this,d.Yc),d.Yc;null!=this.no&&this.no(e,this,this);return this},rl:function(){return this.xa},Nf:function(){return null==this.xa?0:this.xa.Nf()},Aa:function(a,b){null==b&&(b=!1);return null==this.xa?null:this.xa.Aa(a,b)},Bh:function(a){return null==this.xa?null:this.xa.Bh(a)},eb:function(a){return null==this.xa?null!=this.ac?-1!=this.ac.indexOf(a):!1:this.xa.eb(a)},Wu:function(){if(null==this.xa){var a=[];if(null!=this.ac)for(var b=0,c=this.ac;b<c.length;){var d=
c[b];++b;a.push(d)}return a}return this.xa.Wu()},Mn:function(){return null==this.xa?0:this.xa.Mn()},Ac:function(a){null==a&&(a=!1);return null==this.xa?[]:this.xa.Ac(a)},hr:function(){return null!=this.Ek},pa:function(){return 2==this.La?!1:qa.prototype.pa.call(this)},Wm:function(){var a=this.f.Pa;this.mG!=a&&(this.mG=a,this.Ee=null)},Ly:function(a){null!=this.Ee&&(this.Ee.kB=a)},pG:function(a,b){null==this.Ee&&(this.Ee=new Ef(b,this.Pa));this.Ee.map.i.hasOwnProperty(b)||(this.Ee.map.i[b]=[]);this.Ee.map.i[b].push(a)},
Hs:function(){var a=this.Nf();if(0==a||null==this.Ac())return null;this.qo();return new ub(0,0,a,0,this.Mn(),this)},Fa:function(a,b,c,d){null==c&&(c=!1);null==this.xa?(d=new O,d.set(b,a),a=this.f,b=function(a){var b=15;null==b&&(b=61);var c="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),d=[];for(61<b&&(b=61);0<a--;)d.push(c[Math.floor((b+1)*Math.random())]);return d.join("")},new Zb(b(8)+"-"+b(4)+"-4"+b(3)+"-"+Math.floor(4*Math.random())+b(3)+"-"+b(12),a,d,c,this)):this.xa.Fa(a,
b,c,d)},$j:function(a){if(null==this.xa){var b=this.f,c=function(a){var b=15;null==b&&(b=61);var c="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),g=[];for(61<b&&(b=61);0<a--;)g.push(c[Math.floor((b+1)*Math.random())]);return g.join("")};(new Zb(c(8)+"-"+c(4)+"-4"+c(3)+"-"+Math.floor(4*Math.random())+c(3)+"-"+c(12),b)).cc(this)}this.xa.$j(a)},Wh:function(a,b,c,d){null==d&&(d=!1);null==c&&(c=!1);null!=this.xa&&(d?(this.GJ(),this.Wh(a,b,c,!1)):this.xa.Wh(a,b,c))},BD:function(a,
b){null==b&&(b=!0);var c=this.Aa("position");a(c);this.Wh("position",c,!1,!1);if(b){var d=this.Ac(),e=this.Aa("normal");O.Nd(c,d,e);this.Wh("normal",e,!1,!1)}},GJ:function(){if(null!=this.xa){var a=this.xa,b=function(a){var b=15;null==b&&(b=61);var e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),f=[];for(61<b&&(b=61);0<a--;)f.push(e[Math.floor((b+1)*Math.random())]);return f.join("")},b=this.xa.wu(b(8)+"-"+b(4)+"-4"+b(3)+"-"+Math.floor(4*Math.random())+b(3)+"-"+b(12));
a.Jr(this,!0);b.cc(this)}},Zj:function(a,b){null==b&&(b=-1);if(null==this.xa){var c=new O;c.ob=a;var d=this.f,e=function(a){var b=15;null==b&&(b=61);var c="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),d=[];for(61<b&&(b=61);0<a--;)d.push(c[Math.floor((b+1)*Math.random())]);return d.join("")};new Zb(e(8)+"-"+e(4)+"-4"+e(3)+"-"+Math.floor(4*Math.random())+e(3)+"-"+e(12),d,c,!1,this)}else this.xa.Zj(a,b)},wp:function(a,b,c){var d=this.f.c,e=null;if(!this.Yt)switch(c){case 0:e=
this.xa.ll();break;case 1:c=this.Ac();if(null==a.Bm){for(var e=[],f=a.Wb;f<a.Wb+a.Xd;)e.push(c[f]),e.push(c[f+1]),e.push(c[f+1]),e.push(c[f+2]),e.push(c[f+2]),e.push(c[f]),f+=3;c=new Kb(d.b.createBuffer());d.W.get(34963)!=c&&(d.b.bindBuffer(34963,null==c?null:c.buffer),d.W.set(34963,null==c?null:c));var f=null,g=!1;if(d.U.Ql){for(var h=0,k=e.length;h<k;)if(65535<e[h++]){g=!0;break}g?f=new Int32Array(e):f=new Int16Array(e)}else f=new Int16Array(e);d.b.bufferData(34963,f,35044);null!=d.W.get(34963)&&
(d.b.bindBuffer(34963,null),d.W.set(34963,null));d.kb=null;c.ia=1;c.Rc=g;a.Bm=c;a.BB=e.length}e=a.Bm;break;case 2:e=null}a=this.xa.Nn();if(d.qb!=a||d.Pb!=b)for(d.qb=a,d.Pb=b,q.sa=b.ue,c=0,f=q.sa.length;c<f;)g=c++,q.g=b.sa[g],0<=q.g&&(g=q.sa[g],q.G=null!=t[g]?a.I(g):a.i[g],null==q.G?d.na[q.g]&&(d.b.disableVertexAttribArray(q.g),d.na[q.g]=!1):(d.na[q.g]||(d.b.enableVertexAttribArray(q.g),d.na[q.g]=!0),g=q.G.S.S,d.vertexAttribPointer(g,q.g,q.G.Db,5126,!1,4*q.G.zd,4*q.G.Cb),q.G.S.ge&&(d.U.Jc.vertexAttribDivisorANGLE(q.g,
1),d.$c.push(q.g),d.rd.push(g))));null!=e&&d.kb!=e&&(d.kb=e,d.W.get(34963)!=e&&(d.b.bindBuffer(34963,null==e?null:e.buffer),d.W.set(34963,null==e?null:e)),d.Ud=e.Rc)},Jp:function(a,b,c){null==c&&(c=0);if(null!=this.xa&&null!=this.xa.Nn()&&null!=this.xa.ll()){this.gK.la(this);var d=this.f.c;switch(b){case 1:this.Yt?d.oA(!1,a.te,a.Tg,c):d.Hc(!1,0,0<c?a.BB/2:a.BB,c);break;case 2:d.eI(a.te,a.Tg,c);break;default:this.Yt?d.oA(!0,a.te,a.Tg,c):d.Hc(!0,a.Wb,a.Xd,c)}}},Wx:function(a){var b=this.f;this.Xe.Br=
!1;this.Xe.Lr[a]=this.isEnabled()&&this.gd;this.Xe.Ld[a]=null;if(null!=this.Ee){var c=b.Pa,b=b.mm?this.Ee.kB:this.Ee.eA;this.Xe.Ld[a]=this.Ee.map.i[c];var d=this.Pa;null==this.Xe.Ld[a]&&0<b&&(this.Xe.Ld[a]=this.Ee.map.i[b],c=Math.max(b,c),d=Math.max(this.Ee.zL,c));if(null!=this.Xe.Ld[a]&&0<this.Xe.Ld[a].length){if(this.Uy[a]==c)return this.Xe.Br=!0,this.Xe;c!=d&&(this.Xe.Lr[a]=!1)}this.Uy[a]=c}return this.Xe},zG:function(a,b,c,d,e){for(var f=c.Ld[a.cb],g=64*(f.length+1)|0,h=this.zk,k=this.Tp;this.zk<
g;)this.zk*=2;if(null==this.lm||h!=this.zk)this.lm=[];var l=0,g=0,m=this.va();if(c.Lr[a.cb]){g=this.lm;for(l=0;16>l;)c=l++,g[c]=m.a[c];l=16;g=1}if(null!=f)for(m=0,c=f.length;m<c;){for(var u=f[m++].va(),x=this.lm,v=0;16>v;){var p=v++;x[l+p]=u.a[p]}l+=16;++g}null==k||h!=this.zk?(null!=k&&k.dispose(),this.Tp=k=new Tc(e,this.lm,!0,16,!1,!0),this.$j(k.Bj("world0",0,4)),this.$j(k.Bj("world1",4,4)),this.$j(k.Bj("world2",8,4)),this.$j(k.Bj("world3",12,4))):k.oM(this.lm,0,g);f=this.rl().Nn();h=this.rl().ll();
if(e.qb!=f||e.Pb!=d)for(e.qb=f,e.Pb=d,q.sa=d.ue,k=0,l=q.sa.length;k<l;)m=k++,q.g=d.sa[m],0<=q.g&&(m=q.sa[m],q.G=null!=t[m]?f.I(m):f.i[m],null==q.G?e.na[q.g]&&(e.b.disableVertexAttribArray(q.g),e.na[q.g]=!1):(e.na[q.g]||(e.b.enableVertexAttribArray(q.g),e.na[q.g]=!0),m=q.G.S.S,e.vertexAttribPointer(m,q.g,q.G.Db,5126,!1,4*q.G.zd,4*q.G.Cb),q.G.S.ge&&(e.U.Jc.vertexAttribDivisorANGLE(q.g,1),e.$c.push(q.g),e.rd.push(m))));null!=h&&e.kb!=h&&(e.kb=h,e.W.get(34963)!=h&&(e.b.bindBuffer(34963,null==h?null:h.buffer),
e.W.set(34963,null==h?null:h)),e.Ud=h.Rc);this.Jp(a,b,g);e.kM()},Et:function(a,b,c,d,e,f,g){if(e)this.zG(a,c,d,b,this.f.c);else if(d.Lr[a.cb]&&(null!=f&&f(!1,this.va(),g),this.Jp(a,c,this.EN)),null!=d.Ld[a.cb])for(b=0,e=d.Ld[a.cb].length;b<e;){var h=d.Ld[a.cb][b++].va();null!=f&&f(!0,h,g);this.Jp(a,c)}},gb:function(a,b){var c=this.f,d=this.Wx(a.cb);if(!d.Br&&null!=this.xa&&null!=this.xa.Nn()&&null!=this.xa.ll()){this.sc.la(this);var e=c.c,f=null!=e.U.Jc&&null!=d.Ld[a.cb]&&d.Ld.length>a.cb&&null!=
d.Ld[a.cb],g=a.Lf();if(null!=g&&g.pa(this,f)){var h=e.H.gr();this.Kr&&(e.H.vb(!1),c.tt.gb(a,d),e.H.vb(h));g.At();var k=g.s,l=c.Mu?2:c.Nu?1:g.Yu();this.wp(a,k,l);g.bind(this.va(),this);if(b){var m=g.Fz;if(e.bb!=m){switch(m){case 0:e.K.ya(!1);break;case 1:e.K.Za(770,1,0,1);e.K.ya(!0);break;case 2:e.K.Za(770,771,1,1);e.K.ya(!0);break;case 3:e.K.Za(0,769,1,1);e.K.ya(!0);break;case 4:e.K.Za(774,0,1,1);e.K.ya(!0);break;case 5:e.K.Za(770,769,1,1);e.K.ya(!0);break;case 6:e.K.Za(1,1,0,1),e.K.ya(!0)}e.H.vb(0==
m);e.bb=m}}this.Et(a,k,l,d,f,F(this,this.jG),g);g.Io();this.Kr&&h&&(e.H.vb(!0),e.b.colorMask(!1,!1,!1,!1),c.tt.gb(a,d),e.b.colorMask(!0,!0,!0,!0));if(this.Xv&&(f=e.bb,2!=e.bb&&(e.K.Za(770,771,1,1),e.K.ya(!0),e.H.vb(!1),e.bb=2),c.tt.gb(a,d,!0),e.bb!=f)){switch(f){case 0:e.K.ya(!1);break;case 1:e.K.Za(770,1,0,1);e.K.ya(!0);break;case 2:e.K.Za(770,771,1,1);e.K.ya(!0);break;case 3:e.K.Za(0,769,1,1);e.K.ya(!0);break;case 4:e.K.Za(774,0,1,1);e.K.ya(!0);break;case 5:e.K.Za(770,769,1,1);e.K.ya(!0);break;
case 6:e.K.Za(1,1,0,1),e.K.ya(!0)}e.H.vb(0==f);e.bb=f}this.Kc.la(this)}}},jG:function(a,b,c){a&&null!=c&&c.wn(b)},zx:function(){var a=this.f;null!=this.xa?this.xa.load(a):4==this.La&&(this.La=2,a.qp(this))},Ki:function(a){if(2==this.La||!qa.prototype.Ki.call(this,a))return!1;this.zx();return!0},HL:function(a){for(var b=this.f.vf,c=0,d=b.length;c<d;){var e=c++;if(b[e].id==a){this.kd(b[e]);return}}b=this.f.KB;c=0;for(d=b.length;c<d;)if(e=c++,b[e].id==a){this.kd(b[e]);break}},gm:function(){if(null!=
this.mh)return!0;this.mh=[];var a=this.Aa("position");if(null==a)return!1;for(var b=0;b<a.length;)this.mh.push(new p(a[b],a[b+1],a[b+2])),b+=3;return!0},clone:function(a,b,c){null==c&&(c=!1);return new aa(a,this.f,b,this,c)},dispose:function(a){null==a&&(a=!1);null!=this.xa&&this.xa.Jr(this,!0);null!=this.Tp&&(this.Tp.dispose(),this.Tp=null);for(;0<this.Eh.length;)this.Eh[0].dispose();for(var b=this.f.rf,c=0,d=b.length;c<d;){var e=b[c++];null!=e&&(e.Wv(this),e.iL(this))}qa.prototype.dispose.call(this,
a)},MH:function(){for(var a,b,c,d,e,f,g,h,k,l=this.Wu(),m=new ea,u=new ea,x=new ea,v=!1,G=0;G<l.length;){var D=l[G],w=this.Bh(D);"normal"==D?(v=w.S.qh,l.splice(G,1),--G):(null!=t[D]?m.C(D,w):m.i[D]=w,w=(null!=t[D]?m.I(D):m.i[D]).S.qg,null!=t[D]?u.C(D,w):u.i[D]=w,w=[],null!=t[D]?x.C(D,w):x.i[D]=w,++G)}if(null!=this.Ga){for(var G=this.Ga.slice(0),D=this.Ac(),w=this.Mn(),q=0;q<w;){var n=D[q++];d=0;for(e=l.length;d<e;)for(k=l[d++],a=(null!=t[k]?m.I(k):m.i[k]).zd,b=0;b<a;)f=b++,(null!=t[k]?x.I(k):x.i[k]).push((null!=
t[k]?u.I(k):u.i[k])[n*a+f])}u=[];q=null!=t.position?x.I("position"):x.i.position;for(n=0;n<w;){D[n]=n;D[n+1]=n+1;D[n+2]=n+2;d=3*n;k=q[d];h=q[d+1];g=q[d+2];d=3*(n+1);f=q[d];e=q[d+1];d=q[d+2];a=3*(n+2);c=q[a];b=q[a+1];a=q[a+2];k-=f;h-=e;g-=d;f=c-f;e=b-e;a-=d;d=new p(0,0,0);d.x=h*a-g*e;d.y=g*f-k*a;d.z=k*e-h*f;e=new p(0,0,0);e.x=d.x;e.y=d.y;e.z=d.z;e.normalize();for(d=0;3>d;)++d,u.push(e.x),u.push(e.y),u.push(e.z);n+=3}this.Zj(D);this.Fa("normal",u,v);v=0;for(D=l.length;v<D;)w=l[v++],this.Fa(w,null!=
t[w]?x.I(w):x.i[w],(null!=t[w]?m.I(w):m.i[w]).S.qh);this.qo();l=0;for(m=G.length;l<m;)x=G[l++],new ub(x.uf,x.Wb,x.Xd,x.Wb,x.Xd,this);l=0;for(m=this.Eh.length;l<m;)if(x=this.Eh[l++],x.qo(),null!=x.gc.Ga)for(G=0,v=x.gc.Ga.length;G<v;)x.gc.Ga[G++].clone(x,x.gc)}},al:function(a){return new ce(a,this)},jH:function(a){if(null==this.rl()||this.rl().kz==this.f.Pa)return this;this.rl().kz=this.f.Pa;if(!(this.eb("position")&&this.eb("normal")&&this.eb("matricesIndices")&&this.eb("matricesWeights")))return this;
if(null==this.oq){var b=this.Aa("position");this.oq=b;this.Bh("position").S.qh||this.Fa("position",b,!0)}null==this.nq&&(this.nq=b=this.Aa("normal"),this.Bh("normal").S.qh||this.Fa("normal",b,!0));var b=this.Aa("position"),c=this.Aa("normal"),d=this.Aa("matricesIndices"),e=this.Aa("matricesWeights"),f=4<this.Ke,g=f?this.Aa("matricesIndicesExtra"):null,h=f?this.Aa("matricesWeightsExtra"):null;a.Oi&&null!=this.ee?a=this.ee:(null==a.De&&a.Fl(),a=a.De);for(var k,l,m,u=new r,x=new vb([1,0,0,0,0,1,0,0,
0,0,1,0,0,0,0,1]),p=0,G=0;G<b.length;){for(l=0;4>l;)if(k=l++,m=e[p+k],0<m){k=16*d[p+k];for(var D=0;16>D;){var w=D++;x[w]=a[w+k]*m}for(m=0;16>m;)k=m++,u.a[k]+=x[k]}else break;p+=4;if(f)for(l=0;4>l;)if(D=l++,m=h[p+D],0<m){k=new vb(a);D=16*g[p+D];for(w=0;16>w;){var q=w++;x[q]=k[q+D]*m}for(m=0;16>m;)k=m++,u.a[k]+=x[k]}else break;k=this.oq[G];D=this.oq[G+1];w=this.oq[G+2];q=k*u.a[3]+D*u.a[7]+w*u.a[11]+u.a[15];m=(k*u.a[0]+D*u.a[4]+w*u.a[8]+u.a[12])/q;l=(k*u.a[1]+D*u.a[5]+w*u.a[9]+u.a[13])/q;k=(k*u.a[2]+
D*u.a[6]+w*u.a[10]+u.a[14])/q;b[G]=m;b[G+1]=l;b[G+2]=k;k=this.nq[G];D=this.nq[G+1];w=this.nq[G+2];m=k*u.a[0]+D*u.a[4]+w*u.a[8];l=k*u.a[1]+D*u.a[5]+w*u.a[9];k=k*u.a[2]+D*u.a[6]+w*u.a[10];c[G]=m;c[G+1]=l;c[G+2]=k;for(l=0;16>l;)u.a[l++]=0;G+=3}this.Wh("position",b);this.Wh("normal",c);return this},l:aa,F:S(qa.prototype.F,{rl:"get_geometry"})});var xc=K.BABYLON.LinesMesh=function(a,b,c,d,e){null==e&&(e=!1);this.zt=new ea;this.alpha=1;this.color=new Q(1,1,1);this.Cj=this.hl=0;aa.call(this,a,b,c,d,e);null!=
d&&(a=d.color,this.color=new Q(a.r,a.v,a.m),this.alpha=d.alpha);this.TF=.1;this.qd=new Rc("colorShader",b,"color",{attributes:["position"],wb:["worldViewProjection","color"],Ni:!0});b=this.zt;null!=t.position?b.C("position",null):b.i.position=null};n["com.babylonhx.mesh.LinesMesh"]=xc;xc.h=["com","babylonhx","mesh","LinesMesh"];xc.V=aa;xc.prototype=S(aa.prototype,{$u:function(){return this.TF},Fg:function(){return this.qd},pl:function(){return!1},al:function(){console.log("LinesMeshes do not support createInstance.");
return null},wp:function(){var a=this.f.c,b=this.xa.Bh("position"),c=this.zt;null!=t.position?c.C("position",b):c.i.position=b;var b=this.zt,c=this.xa.ll(),d=this.qd.s;if(a.qb!=b||a.Pb!=d){a.qb=b;a.Pb=d;q.sa=d.ue;for(var e=0,f=q.sa.length;e<f;){var g=e++;q.g=d.sa[g];0<=q.g&&(g=q.sa[g],q.G=null!=t[g]?b.I(g):b.i[g],null==q.G?a.na[q.g]&&(a.b.disableVertexAttribArray(q.g),a.na[q.g]=!1):(a.na[q.g]||(a.b.enableVertexAttribArray(q.g),a.na[q.g]=!0),g=q.G.S.S,a.vertexAttribPointer(g,q.g,q.G.Db,5126,!1,4*q.G.zd,
4*q.G.Cb),q.G.S.ge&&(a.U.Jc.vertexAttribDivisorANGLE(q.g,1),a.$c.push(q.g),a.rd.push(g))))}}null!=c&&a.kb!=c&&(a.kb=c,a.W.get(34963)!=c&&(a.b.bindBuffer(34963,null==c?null:c.buffer),a.W.set(34963,null==c?null:c)),a.Ud=c.Rc);a=this.qd;b=this.color;b=new ca(b.r,b.v,b.m,this.alpha);-1==a.Da.wb.indexOf("color")&&a.Da.wb.push("color");a.Yg.set("color",b)},Jp:function(a){null!=this.xa&&null!=this.xa.Nn()&&null!=this.xa.ll()&&this.f.c.Hc(!1,a.Wb,a.Xd)},dispose:function(a){null==a&&(a=!1);this.qd.dispose();
aa.prototype.dispose.call(this,a)},clone:function(a,b,c){null==c&&(c=!1);return new xc(a,this.f,b,this,c)},l:xc,F:S(aa.prototype.F,{$u:"get_intersectionThreshold"})});var W=K.BABYLON.Vector2=function(a,b){this.x=a;this.y=b};n["com.babylonhx.math.Vector2"]=W;W.h=["com","babylonhx","math","Vector2"];W.Te=function(){return new W(0,0)};W.zl=function(a,b){null==b&&(b=0);return new W(a[b],a[b+1])};W.Cl=function(a,b,c){c.x=a[b];c.y=a[b+1];return c};W.Fi=function(a,b,c,d,e){var f=e*e,g=e*f;return new W(.5*
(2*b.x+(-a.x+c.x)*e+(2*a.x-5*b.x+4*c.x-d.x)*f+(-a.x+3*b.x-3*c.x+d.x)*g),.5*(2*b.y+(-a.y+c.y)*e+(2*a.y-5*b.y+4*c.y-d.y)*f+(-a.y+3*b.y-3*c.y+d.y)*g))};W.Kj=function(a,b,c){var d=a.x;d>c.x&&(d=c.x);d<b.x&&(d=b.x);a=a.y;a>c.y&&(a=c.y);a<b.y&&(a=b.y);return new W(d,a)};W.Hl=function(a,b,c,d,e){var f=e*e,g=e*f,h=2*g-3*f+1,k=-2*g+3*f;e=g-2*f+e;f=g-f;return new W(a.x*h+c.x*k+b.x*e+d.x*f,a.y*h+c.y*k+b.y*e+d.y*f)};W.Zc=function(a,b,c){return new W(a.x+(b.x-a.x)*c,a.y+(b.y-a.y)*c)};W.Sj=function(a,b){return a.x*
b.x+a.y*b.y};W.Go=function(a){a=new W(a.x,a.y);a.normalize();return a};W.to=function(a,b){return new W(a.x<b.x?a.x:b.x,a.y<b.y?a.y:b.y)};W.po=function(a,b){return new W(a.x>b.x?a.x:b.x,a.y>b.y?a.y:b.y)};W.zi=function(a,b){return new W(a.x*b.a[0]+a.y*b.a[4],a.x*b.a[1]+a.y*b.a[5])};W.Pj=function(a,b){var c=a.x-b.x,d=a.y-b.y;return Math.sqrt(c*c+d*d)};W.Qj=function(a,b){var c=a.x-b.x,d=a.y-b.y;return c*c+d*d};W.Mi=function(a,b){var c=new W(a.x+b.x,a.y+b.y);c.x*=.5;c.y*=.5;return c};W.uh=function(a,b,
c){var d=b.x-c.x,e=b.y-c.y,e=d*d+e*e;if(0==e)return c=a.x-b.x,a=a.y-b.y,Math.sqrt(c*c+a*a);d=c.x-b.x;c=c.y-b.y;e=Math.max(0,Math.min(1,((a.x-b.x)*d+(a.y-b.y)*c)/e));d=a.x-(b.x+d*e);a=a.y-(b.y+c*e);return Math.sqrt(d*d+a*a)};W.prototype={normalize:function(){var a=Math.sqrt(this.x*this.x+this.y*this.y);if(0==a)return this;a=1/a;this.x*=a;this.y*=a;return this},l:W};var Ca=K.BABYLON.Tags=function(){};n["com.babylonhx.tools.Tags"]=Ca;Ca.h=["com","babylonhx","tools","Tags"];Ca.jE=function(a){a.ui=null!=
a.ui?a.ui:{};a.AO=function(){return Ca.qA(a)};a.MN=function(b){Ca.Md(a,b)};a.rP=function(b){Ca.JE(a,b)}};Ca.qA=function(a){return a.ui?!ha.CE(a.ui):!1};Ca.wE=function(a){return null==a.ui?null:a.ui};Ca.Md=function(a,b){null==b&&(b="");if(""!=b)for(var c=b.split(" "),d=0;d<c.length;){var e=c[d];++d;Ca.KE(a,e)}};Ca.KE=function(a,b){b=Ga.Cl(b);if(""!=b&&"true"!=b&&"false"!=b){var c=new Mb("^([!]|([|]|[&]){2})","");if(!(new Mb("[\\s]","")).match(b)&&!c.match(b)){Ca.jE(a);var c=a.ui,d,e;c.F?e=d=c.F["set_"+
b]:e=!1;if(e)c[d](!0);else c[b]=!0}}};Ca.JE=function(a,b){if(Ca.qA(a))for(var c=b.split(" "),d=0;d<c.length;){var e=c[d];++d;Ca.bH(a,e)}};Ca.bH=function(a,b){a.ui.remove(b)};var ha=K.BABYLON.Tools=function(){};n["com.babylonhx.tools.Tools"]=ha;ha.h=["com","babylonhx","tools","Tools"];ha.xh=function(a,b){var c=new dc(b);c.cw=function(){c.stop();a()}};ha.ns=function(){var a="pointer";window.navigator.Ba||(a="mouse");return a};ha.os=function(a){for(var b=0;b<a.length;){var c=a[b];++b;window.addEventListener(c.name,
c.Qc,!1);try{window.parent&&window.parent.addEventListener(c.name,c.Qc,!1)}catch(d){}}};ha.ps=function(a){for(var b=0;b<a.length;){var c=a[b];++b;window.removeEventListener(c.name,c.Qc);try{window.parent&&window.parent.removeEventListener(c.name,c.Qc)}catch(d){}}};ha.Tw=function(a){return a=a.replace(RegExp("#","mg"),"%23")};ha.Fi=function(a,b,c,d){function e(){var d=new XMLHttpRequest,e=ha.bE+a;d.open("GET",e,!0);f&&(d.responseType="arraybuffer");d.onprogress=c;d.onreadystatechange=function(){if(4==
d.readyState)if(200==d.status)b(f?d.response:d.responseText);else throw new ja("Error status: "+d.status+" - Unable to load "+e);};d.send(null)}var f;null==f&&(f=!1);a=ha.Tw(a);-1==a.indexOf("file:")&&(null!=d&&d.eO?d.gP(function(){d.SO(a,b,c,e,f)},e):e())};ha.Mi=function(a,b){a=ha.Tw(a);var c=new Image;"data:"!=Z.substr(a,0,5)&&(c.crossOrigin="anonymous");c.onload=function(){var a=window.document.createElement("canvas");a.width=c.width;a.height=c.height;a=a.getContext("2d",null);a.drawImage(c,0,
0,c.width,c.height,0,0,c.width,c.height);a=a.getImageData(0,0,c.width,c.height).data;a=Array.prototype.slice.call(a);null!=b&&b(new Ye(new hb(a),c.width,c.height))};c.src=a};ha.CE=function(a){if(a instanceof Array&&null==a.jb)for(a=z.g(a,Array);0<a.length;)return!1;return!0};var r=K.BABYLON.Matrix=function(){this.a=new vb([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])};n["com.babylonhx.math.Matrix"]=r;r.h=["com","babylonhx","math","Matrix"];r.XP=function(a,b){null==b&&(b=0);for(var c=new r,d=0;16>d;){var e=d++;
c.a[e]=a[e+b]}return c};r.YP=function(a,b,c){for(var d=0;16>d;){var e=d++;c.a[e]=a[e+b]}};r.oN=function(a,b,c,d){for(var e=0;16>e;){var f=e++;d.a[f]=a[f+b]*c}};r.da=function(a,b,c,d,e,f,g,h,k,l,m,u,x){x.a[0]=a;x.a[1]=b;x.a[2]=c;x.a[3]=0;x.a[4]=d;x.a[5]=e;x.a[6]=f;x.a[7]=0;x.a[8]=g;x.a[9]=h;x.a[10]=k;x.a[11]=0;x.a[12]=l;x.a[13]=m;x.a[14]=u;x.a[15]=1};r.qN=function(a,b,c,d,e,f,g,h,k,l,m,u,x,p,G,q){var w=new r;w.a[0]=a;w.a[1]=b;w.a[2]=c;w.a[3]=d;w.a[4]=e;w.a[5]=f;w.a[6]=g;w.a[7]=h;w.a[8]=k;w.a[9]=l;
w.a[10]=m;w.a[11]=u;w.a[12]=x;w.a[13]=p;w.a[14]=G;w.a[15]=q;return w};r.mN=function(a,b,c){var d=a.x,e=a.y,f=a.z;a=new r;a.a[0]=d;a.a[1]=0;a.a[2]=0;a.a[3]=0;a.a[4]=0;a.a[5]=e;a.a[6]=0;a.a[7]=0;a.a[8]=0;a.a[9]=0;a.a[10]=f;a.a[11]=0;a.a[12]=0;a.a[13]=0;a.a[14]=0;a.a[15]=1;d=new r;d.a[0]=1;d.a[1]=0;d.a[2]=0;d.a[3]=0;d.a[4]=0;d.a[5]=1;d.a[6]=0;d.a[7]=0;d.a[8]=0;d.a[9]=0;d.a[10]=1;d.a[11]=0;d.a[12]=0;d.a[13]=0;d.a[14]=0;d.a[15]=1;b.yf(d);b=new r;a.qa(d,b.a,0);b.a[12]=c.x;b.a[13]=c.y;b.a[14]=c.z;return b};
r.ZP=function(){var a=new r;a.a[0]=1;a.a[1]=0;a.a[2]=0;a.a[3]=0;a.a[4]=0;a.a[5]=1;a.a[6]=0;a.a[7]=0;a.a[8]=0;a.a[9]=0;a.a[10]=1;a.a[11]=0;a.a[12]=0;a.a[13]=0;a.a[14]=0;a.a[15]=1;return a};r.vN=function(a){r.da(1,0,0,0,1,0,0,0,1,0,0,0,a)};r.eN=function(){var a=new r;a.a[0]=0;a.a[1]=0;a.a[2]=0;a.a[3]=0;a.a[4]=0;a.a[5]=0;a.a[6]=0;a.a[7]=0;a.a[8]=0;a.a[9]=0;a.a[10]=0;a.a[11]=0;a.a[12]=0;a.a[13]=0;a.a[14]=0;a.a[15]=0;return a};r.QO=function(a){var b=new r,c=Math.sin(a);a=Math.cos(a);b.a[0]=1;b.a[15]=1;
b.a[5]=a;b.a[10]=a;b.a[9]=-c;b.a[6]=c;b.a[1]=0;b.a[2]=0;b.a[3]=0;b.a[4]=0;b.a[7]=0;b.a[8]=0;b.a[11]=0;b.a[12]=0;b.a[13]=0;b.a[14]=0;return b};r.VM=function(a){var b=new r,c=a.a[0],d=a.a[1],e=a.a[2],f=a.a[3],g=a.a[4],h=a.a[5],k=a.a[6],l=a.a[7],m=a.a[8],u=a.a[9],p=a.a[10],v=a.a[11],G=a.a[12],q=a.a[13],w=a.a[14],n=a.a[15];a=p*n-v*w;var t=u*n-v*q,gc=u*w-p*q,y=m*n-v*G,H=m*w-p*G,B=m*q-u*G,E=h*a-k*t+l*gc,M=-(g*a-k*y+l*H),z=g*t-h*y+l*B,I=-(g*gc-h*H+k*B),C=1/(c*E+d*M+e*z+f*I),A=k*n-l*w,N=h*n-l*q,L=h*w-k*q,
n=g*n-l*G,w=g*w-k*G,G=g*q-h*G,q=k*v-l*p,F=h*v-l*u,O=h*p-k*u,l=g*v-l*m,k=g*p-k*m,g=g*u-h*m;b.a[0]=E*C;b.a[4]=M*C;b.a[8]=z*C;b.a[12]=I*C;b.a[1]=-(d*a-e*t+f*gc)*C;b.a[5]=(c*a-e*y+f*H)*C;b.a[9]=-(c*t-d*y+f*B)*C;b.a[13]=(c*gc-d*H+e*B)*C;b.a[2]=(d*A-e*N+f*L)*C;b.a[6]=-(c*A-e*n+f*w)*C;b.a[10]=(c*N-d*n+f*G)*C;b.a[14]=-(c*L-d*w+e*G)*C;b.a[3]=-(d*q-e*F+f*O)*C;b.a[7]=(c*q-e*l+f*k)*C;b.a[11]=-(c*F-d*l+f*g)*C;b.a[15]=(c*O-d*k+e*g)*C;return b};r.WO=function(a,b){var c=Math.sin(a),d=Math.cos(a);b.a[0]=1;b.a[15]=
1;b.a[5]=d;b.a[10]=d;b.a[9]=-c;b.a[6]=c;b.a[1]=0;b.a[2]=0;b.a[3]=0;b.a[4]=0;b.a[7]=0;b.a[8]=0;b.a[11]=0;b.a[12]=0;b.a[13]=0;b.a[14]=0};r.dP=function(a){var b=new r,c=Math.sin(a);a=Math.cos(a);b.a[5]=1;b.a[15]=1;b.a[0]=a;b.a[2]=-c;b.a[8]=c;b.a[10]=a;b.a[1]=0;b.a[3]=0;b.a[4]=0;b.a[6]=0;b.a[7]=0;b.a[9]=0;b.a[11]=0;b.a[12]=0;b.a[13]=0;b.a[14]=0;return b};r.eP=function(a,b){var c=Math.sin(a),d=Math.cos(a);b.a[5]=1;b.a[15]=1;b.a[0]=d;b.a[2]=-c;b.a[8]=c;b.a[10]=d;b.a[1]=0;b.a[3]=0;b.a[4]=0;b.a[6]=0;b.a[7]=
0;b.a[9]=0;b.a[11]=0;b.a[12]=0;b.a[13]=0;b.a[14]=0};r.iP=function(a){var b=new r,c=Math.sin(a);a=Math.cos(a);b.a[10]=1;b.a[15]=1;b.a[0]=a;b.a[1]=c;b.a[4]=-c;b.a[5]=a;b.a[2]=0;b.a[3]=0;b.a[6]=0;b.a[7]=0;b.a[8]=0;b.a[9]=0;b.a[11]=0;b.a[12]=0;b.a[13]=0;b.a[14]=0;return b};r.nP=function(a,b){var c=Math.sin(a),d=Math.cos(a);b.a[10]=1;b.a[15]=1;b.a[0]=d;b.a[1]=c;b.a[4]=-c;b.a[5]=d;b.a[2]=0;b.a[3]=0;b.a[6]=0;b.a[7]=0;b.a[8]=0;b.a[9]=0;b.a[11]=0;b.a[12]=0;b.a[13]=0;b.a[14]=0};r.XM=function(a,b){var c=new r;
c.a[0]=0;c.a[1]=0;c.a[2]=0;c.a[3]=0;c.a[4]=0;c.a[5]=0;c.a[6]=0;c.a[7]=0;c.a[8]=0;c.a[9]=0;c.a[10]=0;c.a[11]=0;c.a[12]=0;c.a[13]=0;c.a[14]=0;c.a[15]=0;r.ip(a,b,c);return c};r.ip=function(a,b,c){var d=Math.sin(-b);b=Math.cos(-b);var e=1-b;a.normalize();c.a[0]=a.x*a.x*e+b;c.a[1]=a.x*a.y*e-a.z*d;c.a[2]=a.x*a.z*e+a.y*d;c.a[3]=0;c.a[4]=a.y*a.x*e+a.z*d;c.a[5]=a.y*a.y*e+b;c.a[6]=a.y*a.z*e-a.x*d;c.a[7]=0;c.a[8]=a.z*a.x*e-a.y*d;c.a[9]=a.z*a.y*e+a.x*d;c.a[10]=a.z*a.z*e+b;c.a[11]=0;c.a[15]=1};r.$M=function(a,
b,c){var d=new r,e=r.Ma;c*=.5;var f=.5*b;b=.5*a;a=Math.sin(c);c=Math.cos(c);var g=Math.sin(f),f=Math.cos(f),h=Math.sin(b);b=Math.cos(b);e.x=b*g*c+h*f*a;e.y=h*f*c-b*g*a;e.z=b*f*a-h*g*c;e.o=b*f*c+h*g*a;r.Ma.yf(d);return d};r.cN=function(a,b,c,d){var e=r.Ma;c*=.5;var f=.5*b;b=.5*a;a=Math.sin(c);c=Math.cos(c);var g=Math.sin(f),f=Math.cos(f),h=Math.sin(b);b=Math.cos(b);e.x=b*g*c+h*f*a;e.y=h*f*c-b*g*a;e.z=b*f*a-h*g*c;e.o=b*f*c+h*g*a;r.Ma.yf(d)};r.oP=function(a,b,c){var d=new r;d.a[0]=0;d.a[1]=0;d.a[2]=
0;d.a[3]=0;d.a[4]=0;d.a[5]=0;d.a[6]=0;d.a[7]=0;d.a[8]=0;d.a[9]=0;d.a[10]=0;d.a[11]=0;d.a[12]=0;d.a[13]=0;d.a[14]=0;d.a[15]=0;d.a[0]=a;d.a[1]=0;d.a[2]=0;d.a[3]=0;d.a[4]=0;d.a[5]=b;d.a[6]=0;d.a[7]=0;d.a[8]=0;d.a[9]=0;d.a[10]=c;d.a[11]=0;d.a[12]=0;d.a[13]=0;d.a[14]=0;d.a[15]=1;return d};r.wP=function(a,b,c,d){d.a[0]=a;d.a[1]=0;d.a[2]=0;d.a[3]=0;d.a[4]=0;d.a[5]=b;d.a[6]=0;d.a[7]=0;d.a[8]=0;d.a[9]=0;d.a[10]=c;d.a[11]=0;d.a[12]=0;d.a[13]=0;d.a[14]=0;d.a[15]=1};r.HP=function(a,b,c){var d=new r;d.a[0]=1;
d.a[1]=0;d.a[2]=0;d.a[3]=0;d.a[4]=0;d.a[5]=1;d.a[6]=0;d.a[7]=0;d.a[8]=0;d.a[9]=0;d.a[10]=1;d.a[11]=0;d.a[12]=0;d.a[13]=0;d.a[14]=0;d.a[15]=1;r.da(1,0,0,0,1,0,0,0,1,a,b,c,d);return d};r.MP=function(a,b,c,d){r.da(1,0,0,0,1,0,0,0,1,a,b,c,d)};r.WM=function(a,b,c){var d=new r;d.a[0]=0;d.a[1]=0;d.a[2]=0;d.a[3]=0;d.a[4]=0;d.a[5]=0;d.a[6]=0;d.a[7]=0;d.a[8]=0;d.a[9]=0;d.a[10]=0;d.a[11]=0;d.a[12]=0;d.a[13]=0;d.a[14]=0;for(var e=d.a[15]=0;16>e;){var f=e++;d.a[f]=a.a[f]*(1-c)+b.a[f]*c}return d};r.nN=function(a,
b,c){var d=new p(0,0,0),e=new X,f=new p(0,0,0);a.dA(d,e,f);var g=new p(0,0,0),h=new X;a=new p(0,0,0);b.dA(g,h,a);b=p.D(d,g,c);e=X.Ib(e,h,c);c=p.D(f,a,c);a=b.x;d=b.y;b=b.z;f=new r;f.a[0]=a;f.a[1]=0;f.a[2]=0;f.a[3]=0;f.a[4]=0;f.a[5]=d;f.a[6]=0;f.a[7]=0;f.a[8]=0;f.a[9]=0;f.a[10]=b;f.a[11]=0;f.a[12]=0;f.a[13]=0;f.a[14]=0;f.a[15]=1;a=new r;a.a[0]=1;a.a[1]=0;a.a[2]=0;a.a[3]=0;a.a[4]=0;a.a[5]=1;a.a[6]=0;a.a[7]=0;a.a[8]=0;a.a[9]=0;a.a[10]=1;a.a[11]=0;a.a[12]=0;a.a[13]=0;a.a[14]=0;a.a[15]=1;e.yf(a);e=new r;
f.qa(a,e.a,0);e.a[12]=c.x;e.a[13]=c.y;e.a[14]=c.z;return e};r.LN=function(a,b,c){var d=new r;d.a[0]=0;d.a[1]=0;d.a[2]=0;d.a[3]=0;d.a[4]=0;d.a[5]=0;d.a[6]=0;d.a[7]=0;d.a[8]=0;d.a[9]=0;d.a[10]=0;d.a[11]=0;d.a[12]=0;d.a[13]=0;d.a[14]=0;d.a[15]=0;r.Uc(a,b,c,d);return d};r.Uc=function(a,b,c,d){var e=r.Ta;e.x=b.x-a.x;e.y=b.y-a.y;e.z=b.z-a.z;r.Ta.normalize();b=r.Ta;e=r.Ba;e.x=c.y*b.z-c.z*b.y;e.y=c.z*b.x-c.x*b.z;e.z=c.x*b.y-c.y*b.x;c=r.Ba;0==c.x*c.x+c.y*c.y+c.z*c.z?r.Ba.x=1:r.Ba.normalize();c=r.Ta;b=r.Ba;
e=r.Bb;e.x=c.y*b.z-c.z*b.y;e.y=c.z*b.x-c.x*b.z;e.z=c.x*b.y-c.y*b.x;r.Bb.normalize();c=r.Ba;r.BI=-(c.x*a.x+c.y*a.y+c.z*a.z);c=r.Bb;r.WI=-(c.x*a.x+c.y*a.y+c.z*a.z);c=r.Ta;r.YI=-(c.x*a.x+c.y*a.y+c.z*a.z);r.da(r.Ba.x,r.Bb.x,r.Ta.x,r.Ba.y,r.Bb.y,r.Ta.y,r.Ba.z,r.Bb.z,r.Ta.z,r.BI,r.WI,r.YI,d)};r.PN=function(a,b,c){var d=new r;d.a[0]=0;d.a[1]=0;d.a[2]=0;d.a[3]=0;d.a[4]=0;d.a[5]=0;d.a[6]=0;d.a[7]=0;d.a[8]=0;d.a[9]=0;d.a[10]=0;d.a[11]=0;d.a[12]=0;d.a[13]=0;d.a[14]=0;d.a[15]=0;r.uA(a,b,c,d);return d};r.uA=function(a,
b,c,d){var e=r.Ta;e.x=a.x-b.x;e.y=a.y-b.y;e.z=a.z-b.z;r.Ta.normalize();b=r.Ta;e=r.Ba;e.x=c.y*b.z-c.z*b.y;e.y=c.z*b.x-c.x*b.z;e.z=c.x*b.y-c.y*b.x;c=r.Ba;0==c.x*c.x+c.y*c.y+c.z*c.z?r.Ba.x=1:r.Ba.normalize();c=r.Ta;b=r.Ba;e=r.Bb;e.x=c.y*b.z-c.z*b.y;e.y=c.z*b.x-c.x*b.z;e.z=c.x*b.y-c.y*b.x;r.Bb.normalize();c=r.Ba;b=r.Bb;e=r.Ta;r.da(r.Ba.x,r.Bb.x,r.Ta.x,r.Ba.y,r.Bb.y,r.Ta.y,r.Ba.z,r.Bb.z,r.Ta.z,-(c.x*a.x+c.y*a.y+c.z*a.z),-(b.x*a.x+b.y*a.y+b.z*a.z),-(e.x*a.x+e.y*a.y+e.z*a.z),d)};r.SN=function(a,b,c,d){var e=
new r;e.a[0]=2/a;e.a[1]=0;e.a[2]=0;e.a[3]=0;e.a[4]=0;e.a[5]=2/b;e.a[6]=0;e.a[7]=0;e.a[8]=0;e.a[9]=0;e.a[10]=1/(d-c);e.a[11]=0;e.a[12]=0;e.a[13]=0;e.a[14]=c/(c-d);e.a[15]=1;return e};r.WN=function(a,b,c,d,e,f){var g=new r;g.a[0]=0;g.a[1]=0;g.a[2]=0;g.a[3]=0;g.a[4]=0;g.a[5]=0;g.a[6]=0;g.a[7]=0;g.a[8]=0;g.a[9]=0;g.a[10]=0;g.a[11]=0;g.a[12]=0;g.a[13]=0;g.a[14]=0;g.a[15]=0;r.Kj(a,b,c,d,e,f,g);return g};r.Kj=function(a,b,c,d,e,f,g){g=g.a;g[0]=2/(b-a);g[1]=0;g[2]=0;g[3]=0;g[5]=2/(d-c);g[4]=0;g[6]=0;g[7]=
0;g[10]=1/(f-e);g[8]=0;g[9]=0;g[11]=0;g[12]=(a+b)/(a-b);g[13]=(d+c)/(c-d);g[14]=-e/(f-e);g[15]=1};r.bO=function(a,b,c,d,e,f){var g=new r;g.a[0]=0;g.a[1]=0;g.a[2]=0;g.a[3]=0;g.a[4]=0;g.a[5]=0;g.a[6]=0;g.a[7]=0;g.a[8]=0;g.a[9]=0;g.a[10]=0;g.a[11]=0;g.a[12]=0;g.a[13]=0;g.a[14]=0;g.a[15]=0;r.AA(a,b,c,d,e,f,g);return g};r.AA=function(a,b,c,d,e,f,g){r.Kj(a,b,c,d,e,f,g);g.a[10]*=-1};r.OO=function(a,b,c,d){var e=new r;e.a[0]=0;e.a[1]=0;e.a[2]=0;e.a[3]=0;e.a[4]=0;e.a[5]=0;e.a[6]=0;e.a[7]=0;e.a[8]=0;e.a[9]=
0;e.a[10]=0;e.a[11]=0;e.a[12]=0;e.a[13]=0;e.a[14]=0;e.a[15]=0;e.a[0]=2*c/a;e.a[1]=0;e.a[2]=0;e.a[3]=0;e.a[5]=2*c/b;e.a[4]=0;e.a[6]=0;e.a[7]=0;e.a[10]=-d/(c-d);e.a[8]=0;e.a[9]=0;e.a[11]=1;e.a[12]=0;e.a[13]=0;e.a[15]=0;e.a[14]=c*d/(c-d);return e};r.gO=function(a,b,c,d){var e=new r;e.a[0]=0;e.a[1]=0;e.a[2]=0;e.a[3]=0;e.a[4]=0;e.a[5]=0;e.a[6]=0;e.a[7]=0;e.a[8]=0;e.a[9]=0;e.a[10]=0;e.a[11]=0;e.a[12]=0;e.a[13]=0;e.a[14]=0;e.a[15]=0;r.lg(a,b,c,d,e);return e};r.lg=function(a,b,c,d,e,f){null==f&&(f=!0);a=
1/Math.tan(.5*a);e.a[0]=f?a/b:a;e.a[1]=0;e.a[2]=0;e.a[3]=0;e.a[5]=f?a:a*b;e.a[4]=0;e.a[6]=0;e.a[7]=0;e.a[8]=0;e.a[9]=0;e.a[10]=-d/(c-d);e.a[11]=1;e.a[12]=0;e.a[13]=0;e.a[15]=0;e.a[14]=c*d/(c-d)};r.kO=function(a,b,c,d){var e=new r;e.a[0]=0;e.a[1]=0;e.a[2]=0;e.a[3]=0;e.a[4]=0;e.a[5]=0;e.a[6]=0;e.a[7]=0;e.a[8]=0;e.a[9]=0;e.a[10]=0;e.a[11]=0;e.a[12]=0;e.a[13]=0;e.a[14]=0;e.a[15]=0;r.sB(a,b,c,d,e);return e};r.sB=function(a,b,c,d,e,f){null==f&&(f=!0);a=1/Math.tan(.5*a);e.a[0]=f?a/b:a;e.a[1]=0;e.a[2]=0;
e.a[3]=0;e.a[5]=f?a:a*b;e.a[4]=0;e.a[6]=0;e.a[7]=0;e.a[8]=0;e.a[9]=0;e.a[10]=d/(c-d);e.a[11]=-1;e.a[12]=0;e.a[13]=0;e.a[15]=0;e.a[14]=c*d/(c-d)};r.HO=function(a,b,c,d){var e=Math.tan(a.OP*Math.PI/180),f=Math.tan(a.YN*Math.PI/180),g=Math.tan(a.RO*Math.PI/180);a=Math.tan(a.tP*Math.PI/180);var h=2/(g+a),k=2/(e+f);d.a[0]=h;d.a[1]=0;d.a[2]=0;d.a[3]=0;d.a[4]=0;d.a[5]=k;d.a[6]=0;d.a[7]=0;d.a[8]=(g-a)*h*.5;d.a[9]=-((e-f)*k*.5);d.a[10]=-c/(b-c);d.a[11]=1;d.a[12]=0;d.a[13]=0;d.a[15]=0;d.a[14]=b*c/(b-c)};r.uN=
function(a,b,c,d,e,f){var g=a.width,h=a.height,k=a.x,l=a.y;a=new r;a.a[0]=g/2;a.a[1]=0;a.a[2]=0;a.a[3]=0;a.a[4]=0;a.a[5]=-h/2;a.a[6]=0;a.a[7]=0;a.a[8]=0;a.a[9]=0;a.a[10]=f-e;a.a[11]=0;a.a[12]=k+g/2;a.a[13]=h/2+l;a.a[14]=e;a.a[15]=1;e=new r;b.qa(c,e.a,0);b=new r;e.qa(d,b.a,0);d=new r;b.qa(a,d.a,0);return d};r.sN=function(a){return new vb([a.a[0],a.a[1],a.a[4],a.a[5]])};r.tN=function(a){return new vb([a.a[0],a.a[1],a.a[2],a.a[4],a.a[5],a.a[6],a.a[8],a.a[9],a.a[10]])};r.TP=function(a){var b=new r;b.a[0]=
a.a[0];b.a[1]=a.a[4];b.a[2]=a.a[8];b.a[3]=a.a[12];b.a[4]=a.a[1];b.a[5]=a.a[5];b.a[6]=a.a[9];b.a[7]=a.a[13];b.a[8]=a.a[2];b.a[9]=a.a[6];b.a[10]=a.a[10];b.a[11]=a.a[14];b.a[12]=a.a[3];b.a[13]=a.a[7];b.a[14]=a.a[11];b.a[15]=a.a[15];return b};r.PO=function(a){var b=new r;r.uB(a,b);return b};r.uB=function(a,b){var c=Math.sqrt(a.j.x*a.j.x+a.j.y*a.j.y+a.j.z*a.j.z),d=0;0!=c&&(d=1/c);a.j.x*=d;a.j.y*=d;a.j.z*=d;a.d*=d;var c=a.j.x,d=a.j.y,e=a.j.z,f=-2*c,g=-2*d,h=-2*e;b.a[0]=f*c+1;b.a[1]=g*c;b.a[2]=h*c;b.a[3]=
0;b.a[4]=f*d;b.a[5]=g*d+1;b.a[6]=h*d;b.a[7]=0;b.a[8]=f*e;b.a[9]=g*e;b.a[10]=h*e+1;b.a[11]=0;b.a[12]=f*a.d;b.a[13]=g*a.d;b.a[14]=h*a.d;b.a[15]=1};r.rN=function(a,b,c,d){d.a[0]=a.x;d.a[1]=a.y;d.a[2]=a.z;d.a[3]=0;d.a[4]=b.x;d.a[5]=b.y;d.a[6]=b.z;d.a[7]=0;d.a[8]=c.x;d.a[9]=c.y;d.a[10]=c.z;d.a[11]=0;d.a[12]=0;d.a[13]=0;d.a[14]=0;d.a[15]=1};r.pN=function(a,b){var c=a.x*a.x,d=a.y*a.y,e=a.z*a.z,f=a.x*a.y,g=a.z*a.o,h=a.z*a.x,k=a.y*a.o,l=a.y*a.z,m=a.x*a.o;b.a[0]=1-2*(d+e);b.a[1]=2*(f+g);b.a[2]=2*(h-k);b.a[3]=
0;b.a[4]=2*(f-g);b.a[5]=1-2*(e+c);b.a[6]=2*(l+m);b.a[7]=0;b.a[8]=2*(h+k);b.a[9]=2*(l-m);b.a[10]=1-2*(d+c);b.a[11]=0;b.a[12]=0;b.a[13]=0;b.a[14]=0;b.a[15]=1};r.prototype={qa:function(a,b,c){var d=this.a[0],e=this.a[1],f=this.a[2],g=this.a[3],h=this.a[4],k=this.a[5],l=this.a[6],m=this.a[7],u=this.a[8],p=this.a[9],v=this.a[10],G=this.a[11],q=this.a[12],w=this.a[13],n=this.a[14],r=this.a[15],t=a.a[0],y=a.a[1],H=a.a[2],B=a.a[3],E=a.a[4],M=a.a[5],z=a.a[6],I=a.a[7],C=a.a[8],A=a.a[9],N=a.a[10],L=a.a[11],
F=a.a[12],O=a.a[13],T=a.a[14];a=a.a[15];b[c]=d*t+e*E+f*C+g*F;b[c+1]=d*y+e*M+f*A+g*O;b[c+2]=d*H+e*z+f*N+g*T;b[c+3]=d*B+e*I+f*L+g*a;b[c+4]=h*t+k*E+l*C+m*F;b[c+5]=h*y+k*M+l*A+m*O;b[c+6]=h*H+k*z+l*N+m*T;b[c+7]=h*B+k*I+l*L+m*a;b[c+8]=u*t+p*E+v*C+G*F;b[c+9]=u*y+p*M+v*A+G*O;b[c+10]=u*H+p*z+v*N+G*T;b[c+11]=u*B+p*I+v*L+G*a;b[c+12]=q*t+w*E+n*C+r*F;b[c+13]=q*y+w*M+n*A+r*O;b[c+14]=q*H+w*z+n*N+r*T;b[c+15]=q*B+w*I+n*L+r*a;return this},dA:function(a,b,c){c.x=this.a[12];c.y=this.a[13];c.z=this.a[14];c=this.a[0]*
this.a[1]*this.a[2]*this.a[3];var d=this.a[4]*this.a[5]*this.a[6]*this.a[7],e=this.a[8]*this.a[9]*this.a[10]*this.a[11];a.x=(0>(0==c?0:0<c?1:-1)?-1:1)*Math.sqrt(this.a[0]*this.a[0]+this.a[1]*this.a[1]+this.a[2]*this.a[2]);a.y=(0>(0==d?0:0<d?1:-1)?-1:1)*Math.sqrt(this.a[4]*this.a[4]+this.a[5]*this.a[5]+this.a[6]*this.a[6]);a.z=(0>(0==e?0:0<e?1:-1)?-1:1)*Math.sqrt(this.a[8]*this.a[8]+this.a[9]*this.a[9]+this.a[10]*this.a[10]);if(0==a.x||0==a.y||0==a.z)return b.x=0,b.y=0,b.z=0,b.o=1,!1;r.da(this.a[0]/
a.x,this.a[1]/a.x,this.a[2]/a.x,this.a[4]/a.y,this.a[5]/a.y,this.a[6]/a.y,this.a[8]/a.z,this.a[9]/a.z,this.a[10]/a.z,0,0,0,fa.Ra[0]);X.ec(fa.Ra[0],b);return!0},l:r};var O=K.BABYLON.VertexData=function(){};n["com.babylonhx.mesh.VertexData"]=O;O.h=["com","babylonhx","mesh","VertexData"];O.lE=function(a){var b=!0;null==b&&(b=!1);return O.YD(a,b)};O.YD=function(a,b){null==b&&(b=!1);var c=new O;a.eb("position")&&(c.Na=a.Aa("position",b));a.eb("normal")&&(c.fb=a.Aa("normal",b));a.eb("uv")&&(c.zb=a.Aa("uv",
b));a.eb("uv2")&&(c.Xh=a.Aa("uv2",b));a.eb("uv3")&&(c.Yh=a.Aa("uv3",b));a.eb("uv4")&&(c.Zh=a.Aa("uv4",b));a.eb("uv5")&&(c.$h=a.Aa("uv5",b));a.eb("uv6")&&(c.ai=a.Aa("uv6",b));a.eb("color")&&(c.ke=a.Aa("color",b));a.eb("matricesIndices")&&(c.Id=a.Aa("matricesIndices",b));a.eb("matricesWeights")&&(c.Tf=a.Aa("matricesWeights",b));a.eb("matricesIndicesExtra")&&(c.oe=a.Aa("matricesIndicesExtra",b));a.eb("matricesWeightsExtra")&&(c.Uf=a.Aa("matricesWeightsExtra",b));c.ob=a.Ac(b);return c};O.Ue=function(a){var b=
a.Pg,c=null!=a.Zk&&a.Zk,d=null!=a.closePath&&a.closePath,e=Math.floor(b[0].length/2),f=null!=a.offset?a.offset:e,f=f>e?e:Math.floor(f),g=null!=a.aa?a.aa:0;a=[];var e=[],h=[],k=[],l=[],m=[],u=[],p=[],v,q=[],n=[],w;if(2>b.length){for(var r=[],t=[],gc=0,y=b[0].length-f;gc<y;){var H=gc++;r.push(b[0][H]);t.push(b[0][H+f])}b=[r,t]}t=0;r=d?1:0;f=b[0].length;y=0;for(H=b.length;y<H;){var B=y++;u[B]=0;l[B]=[0];v=b[B];gc=v.length;f<gc||(f=gc);for(w=0;w<gc;){e.push(v[w].x);e.push(v[w].y);e.push(v[w].z);if(0<
w){var E=v[w],z=v[w-1],A=E.x-z.x,I=E.y-z.y,E=E.z-z.z,A=Math.sqrt(A*A+I*I+E*E)+u[B];l[B].push(A);u[B]=A}++w}d&&(--w,e.push(v[0].x),e.push(v[0].y),e.push(v[0].z),w=v[w],I=v[0],v=w.x-I.x,A=w.y-I.y,w=w.z-I.z,v=Math.sqrt(v*v+A*A+w*w),v+=u[B],l[B].push(v),u[B]=v);q[B]=gc+r;n[B]=t;t+=gc+r}t=0;for(gc=f+r;t<gc;){y=t++;p[y]=0;m[y]=[0];H=0;for(B=b.length-1;H<B;)w=H++,v=b[w],w=b[w+1],y==f?(v=v[0],I=w[0]):(v=v[y],I=w[y]),w=I.x-v.x,A=I.y-v.y,v=I.z-v.z,v=Math.sqrt(w*w+A*A+v*v),v+=p[y],m[y].push(v),p[y]=v;c&&(v=
b[0],w=b[0],H=w[y],w=v[y],B=H.x-w.x,v=H.y-w.y,H=H.z-w.z,v=Math.sqrt(B*B+v*v+H*H),v+=p[y],p[y]=v)}gc=0;for(y=b.length;gc<y;)for(H=gc++,B=0,v=f+r;B<v;)w=B++,t=l[H][w]/u[H],w=m[w][H]/p[w],k.push(t),k.push(w);m=l=0;p=q[0]-1;f=q[1]-1;p=p<f?p:f;u=n[1]-n[0];for(c=c?q.length:q.length-1;m<=p&&l<c;)a.push(m),a.push(m+u),a.push(m+1),a.push(m+u+1),a.push(m+1),a.push(m+u),++m,m==p&&(++l,l==q.length-1?(u=n[0]-n[l],p=q[l]-1,f=q[0]-1):(u=n[l+1]-n[l],p=q[l]-1,f=q[l+1]-1),m=n[l],p=p<f?p+m:f+m);O.Nd(e,a,h);if(d)for(q=
0,l=b.length;q<l;)m=q++,c=3*n[m],m=m+1<b.length?3*(n[m+1]-1):h.length-3,h[c]=.5*(h[c]+h[m]),h[c+1]=.5*(h[c+1]+h[m+1]),h[c+2]=.5*(h[c+2]+h[m+2]),h[m]=h[c],h[m+1]=h[c+1],h[m+2]=h[c+2];O.ec(g,e,a,h,k);b=new O;b.ob=a;b.Na=e;b.fb=h;b.zb=k;d&&(b.Sp=n);return b};O.uh=function(a){var b=[new p(0,0,1),new p(0,0,-1),new p(1,0,0),new p(-1,0,0),new p(0,1,0),new p(0,-1,0)],c=[],d=[],e=[],f=[],g=a.width,h=a.height,k=a.depth,l=null!=a.aa?a.aa:0,m=null!=a.Ln?a.Ln:[];a=a.Vq;for(var u=[],x=0;6>x;){var v=x++;null==m[v]&&
(m[v]=new de(0,0,1,1));null!=a&&null==a[v]&&(a[v]=new ca(1,1,1,1))}g/=2;h/=2;k/=2;m=0;for(x=b.length;m<x;){var v=m++,q=b[v],n=q.y,w=q.z,r=q.x,t=new p(0,0,0);t.x=q.y*r-q.z*w;t.y=q.z*n-q.x*r;t.z=q.x*w-q.y*n;var z=d.length/3|0;c.push(z);c.push(z+1);c.push(z+2);c.push(z);c.push(z+2);c.push(z+3);z=new p((q.x-n-t.x)*g,(q.y-w-t.y)*h,(q.z-r-t.z)*k);d.push(z.x);d.push(z.y);d.push(z.z);e.push(q.x);e.push(q.y);e.push(q.z);f.push(1);f.push(1);null!=a&&(u.push(a[v].r),u.push(a[v].v),u.push(a[v].m),u.push(a[v].$));
z=new p((q.x-n+t.x)*g,(q.y-w+t.y)*h,(q.z-r+t.z)*k);d.push(z.x);d.push(z.y);d.push(z.z);e.push(q.x);e.push(q.y);e.push(q.z);f.push(0);f.push(1);null!=a&&(u.push(a[v].r),u.push(a[v].v),u.push(a[v].m),u.push(a[v].$));z=new p((q.x+n+t.x)*g,(q.y+w+t.y)*h,(q.z+r+t.z)*k);d.push(z.x);d.push(z.y);d.push(z.z);e.push(q.x);e.push(q.y);e.push(q.z);f.push(0);f.push(0);null!=a&&(u.push(a[v].r),u.push(a[v].v),u.push(a[v].m),u.push(a[v].$));z=new p((q.x+n-t.x)*g,(q.y+w-t.y)*h,(q.z+r-t.z)*k);d.push(z.x);d.push(z.y);
d.push(z.z);e.push(q.x);e.push(q.y);e.push(q.z);f.push(1);f.push(0);null!=a&&(u.push(a[v].r),u.push(a[v].v),u.push(a[v].m),u.push(a[v].$))}O.ec(l,d,c,e,f);b=new O;b.ob=c;b.Na=d;b.fb=e;b.zb=f;null!=a&&0<a.length&&(b.ke=2==l?u.concat(u):u);return b};O.ep=function(a){var b=[],c=[],d=[],e=[],f=null!=a.aa?a.aa:0,g=(null!=a.hA?a.hA:1)/2,h=(null!=a.iA?a.iA:1)/2,k=(null!=a.jA?a.jA:1)/2;a=2+(null!=a.OC?a.OC:32);for(var l=2*a,m=0,u=a+1;m<u;){for(var x=m++,v=x/a,q=v*Math.PI,n=0,w=l+1;n<w;){var t=n++/l,z=t*Math.PI*
2,A=-q,y=new r,H=Math.sin(A),A=Math.cos(A);y.a[10]=1;y.a[15]=1;y.a[0]=A;y.a[1]=H;y.a[4]=-H;y.a[5]=A;y.a[2]=0;y.a[3]=0;y.a[6]=0;y.a[7]=0;y.a[8]=0;y.a[9]=0;y.a[11]=0;y.a[12]=0;y.a[13]=0;y.a[14]=0;H=new r;A=Math.sin(z);z=Math.cos(z);H.a[5]=1;H.a[15]=1;H.a[0]=z;H.a[2]=-A;H.a[8]=A;H.a[10]=z;H.a[1]=0;H.a[3]=0;H.a[4]=0;H.a[6]=0;H.a[7]=0;H.a[9]=0;H.a[11]=0;H.a[12]=0;H.a[13]=0;H.a[14]=0;var z=new p(0,0,0),y=y.a,A=0*y[1]+y[5]+0*y[9]+y[13],B=0*y[2]+y[6]+0*y[10]+y[14],E=0*y[3]+y[7]+0*y[11]+y[15];z.x=(0*y[0]+
y[4]+0*y[8]+y[12])/E;z.y=A/E;z.z=B/E;var y=new p(0,0,0),A=z.x,B=z.y,z=z.z,H=H.a,E=A*H[1]+B*H[5]+z*H[9]+H[13],M=A*H[2]+B*H[6]+z*H[10]+H[14],R=A*H[3]+B*H[7]+z*H[11]+H[15];y.x=(A*H[0]+B*H[4]+z*H[8]+H[12])/R;y.y=E/R;y.z=M/R;H=y.x*g;z=y.y*h;y=y.z*k;A=new p(0,0,0);A.x=H;A.y=z;A.z=y;A.normalize();c.push(H);c.push(z);c.push(y);d.push(A.x);d.push(A.y);d.push(A.z);e.push(t);e.push(v)}if(0<x)for(x=c.length/3,v=x-2*(l+1)|0;v+l+2<x;)b.push(v),b.push(v+1),b.push(v+l+1),b.push(v+l+1),b.push(v+1),b.push(v+l+2),++v}O.ec(f,
c,b,d,e);f=new O;f.ob=b;f.Na=c;f.fb=d;f.zb=e;return f};O.zl=function(a){function b(a){var b=a?g/2:h/2;if(0!=b){var l,m=a?q[2]:q[0],u=null;null!=n&&(u=a?n[2]:n[0]);var v=z.length/3|0,w=a?f/2:-f/2;e=w;z.push(0);z.push(e);z.push(0);y.push(0);y.push(a?1:-1);y.push(0);H.push(m.x+.5*(m.z-m.x));H.push(m.y+.5*(m.o-m.y));null!=n&&(B.push(u.r),B.push(u.v),B.push(u.m),B.push(u.$));for(var r=0,C=k+1;r<C;){l=2*Math.PI*r++*x/k;var A=Math.cos(-l),E=Math.sin(-l);l=new p(A*b,w,E*b);d=.5*A+.5;c=.5*E+.5;z.push(l.x);
z.push(l.y);z.push(l.z);y.push(0);y.push(a?1:-1);y.push(0);H.push(m.x+(m.z-m.x)*d);H.push(m.y+(m.o-m.y)*c);null!=n&&(B.push(u.r),B.push(u.v),B.push(u.m),B.push(u.$))}for(b=0;b<k;)m=b++,a?(t.push(v),t.push(v+(m+2)),t.push(v+(m+1))):(t.push(v),t.push(v+(m+1)),t.push(v+(m+2)))}}var c,d,e,f=null!=a.height?a.height:2,g=null!=a.Gn?a.Gn:1,h=null!=a.Fn?a.Fn:1,k=null!=a.Kd?a.Kd:24,l=null!=a.Tc?a.Tc:1,m=null!=a.UI&&a.UI,u=null!=a.Ju&&a.Ju,x=null!=a.arc?a.arc:1;if(0>=x||1<x)x=1;var v=null!=a.aa?a.aa:0,q=null!=
a.Ln?a.Ln:[],n=null!=a.Vq?a.Vq:null;a=2+(1+(1!=x&&u?2:0))*(m?l:1);for(var w=0;w<a;){var r=w++;null!=n&&null==n[r]&&(n[r]=new ca(1,1,1,1))}for(w=0;w<a;)r=w++,null!=q&&null==q[r]&&(q[r]=new de(0,0,1,1));var t=[],z=[],y=[],H=[],B=[];a=2*Math.PI*x/k;for(var E=0,r=w=0,A=(h-g)/2/f,R,I=0,E=R=0,C=new p(0,0,0),ba=new p(0,0,0),N=new p(0,0,0),L=new p(0,0,0),F=Db.Y,S=1,T=1,Q=0,aa=0,W=l+1;aa<W;)for(var X=aa++,w=X/l,r=(w*(g-h)+h)/2,S=m&&0!=X&&X!=l?2:1,Y=0;Y<S;){var U=Y++;m&&(T+=U);u&&(T+=2*U);for(var U=0,fa=k+
1;U<fa;){var ea=U++,E=ea*a,I=Math.cos(-E)*r;R=-f/2+w*f;E=Math.sin(-E)*r;0==g&&X==l?(C.x=y[y.length-3*(k+1)],C.y=y[y.length-3*(k+1)+1],C.z=y[y.length-3*(k+1)+2]):(C.x=I,C.z=E,C.y=Math.sqrt(C.x*C.x+C.z*C.z)*A,C.normalize());0==ea&&(ba.x=I,ba.y=R,ba.z=E,N.x=C.x,N.y=C.y,N.z=C.z);z.push(I);z.push(R);z.push(E);y.push(C.x);y.push(C.y);y.push(C.z);Q=m?0!=T?q[T].y:q[T].o:q[T].y+(q[T].o-q[T].y)*w;H.push(q[T].x+(q[T].z-q[T].x)*ea/k);H.push(Q);null!=n&&(B.push(n[T].r),B.push(n[T].v),B.push(n[T].m),B.push(n[T].$))}1!=
x&&u&&(z.push(I),z.push(R),z.push(E),z.push(0),z.push(R),z.push(0),z.push(0),z.push(R),z.push(0),z.push(ba.x),z.push(ba.y),z.push(ba.z),L.x=F.y*C.z-F.z*C.y,L.y=F.z*C.x-F.x*C.z,L.z=F.x*C.y-F.y*C.x,L.normalize(),y.push(L.x),y.push(L.y),y.push(L.z),y.push(L.x),y.push(L.y),y.push(L.z),L.x=N.y*F.z-N.z*F.y,L.y=N.z*F.x-N.x*F.z,L.z=N.x*F.y-N.y*F.x,L.normalize(),y.push(L.x),y.push(L.y),y.push(L.z),y.push(L.x),y.push(L.y),y.push(L.z),Q=m?0!=T?q[T+1].y:q[T+1].o:q[T+1].y+(q[T+1].o-q[T+1].y)*w,H.push(q[T+1].x),
H.push(Q),H.push(q[T+1].z),H.push(Q),Q=m?0!=T?q[T+2].y:q[T+2].o:q[T+2].y+(q[T+2].o-q[T+2].y)*w,H.push(q[T+2].x),H.push(Q),H.push(q[T+2].z),H.push(Q),0<n.length&&(B.push(n[T+1].r),B.push(n[T+1].v),B.push(n[T+1].m),B.push(n[T+1].$),B.push(n[T+1].r),B.push(n[T+1].v),B.push(n[T+1].m),B.push(n[T+1].$),B.push(n[T+2].r),B.push(n[T+2].v),B.push(n[T+2].m),B.push(n[T+2].$),B.push(n[T+2].r),B.push(n[T+2].v),B.push(n[T+2].m),B.push(n[T+2].$)))}a=1!=x&&u?k+4:k;for(I=N=R=A=r=w=0;I<l;){++I;C=0;for(ba=k;C<ba;)N=
C++,r=w*(a+1)+N,A=(w+1)*(a+1)+N,R=w*(a+1)+(N+1),N=(w+1)*(a+1)+(N+1),t.push(r),t.push(A),t.push(R),t.push(N),t.push(R),t.push(A);1!=x&&u&&(t.push(r+2),t.push(A+2),t.push(R+2),t.push(N+2),t.push(R+2),t.push(A+2),t.push(r+4),t.push(A+4),t.push(R+4),t.push(N+4),t.push(R+4),t.push(A+4));m?w+=2:++w}u&&(b(!1),b(!0));O.ec(v,z,t,y,H);l=new O;l.ob=t;l.Na=z;l.fb=y;l.zb=H;null!=n&&(l.ke=B);return l};O.gp=function(a){var b=[],c=[],d=[],e=[],f=null!=a.Du?a.Du:1,g=null!=a.uD?a.uD:.5,h=null!=a.Kd?a.Kd:16;a=null!=
a.aa?a.aa:0;for(var k=h+1,l=0,m=h+1;l<m;){var u=l++,x=u/h,v=u*Math.PI*2/h-Math.PI/2,q=new r;q.a[0]=1;q.a[1]=0;q.a[2]=0;q.a[3]=0;q.a[4]=0;q.a[5]=1;q.a[6]=0;q.a[7]=0;q.a[8]=0;q.a[9]=0;q.a[10]=1;q.a[11]=0;q.a[12]=0;q.a[13]=0;q.a[14]=0;q.a[15]=1;r.da(1,0,0,0,1,0,0,0,1,f/2,0,0,q);var n=new r,w=Math.sin(v),v=Math.cos(v);n.a[5]=1;n.a[15]=1;n.a[0]=v;n.a[2]=-w;n.a[8]=w;n.a[10]=v;n.a[1]=0;n.a[3]=0;n.a[4]=0;n.a[6]=0;n.a[7]=0;n.a[9]=0;n.a[11]=0;n.a[12]=0;n.a[13]=0;n.a[14]=0;w=new r;q.qa(n,w.a,0);q=0;for(n=h+
1;q<n;){var v=q++,t=v*Math.PI*2/h+Math.PI,t=new p(Math.cos(t),Math.sin(t),0),z=g/2,A=new p(t.x*z,t.y*z,t.z*z),z=new p(0,0,0),y=A.x,H=A.y,A=A.z,B=w.a,E=y*B[1]+H*B[5]+A*B[9]+B[13],M=y*B[2]+H*B[6]+A*B[10]+B[14],R=y*B[3]+H*B[7]+A*B[11]+B[15];z.x=(y*B[0]+H*B[4]+A*B[8]+B[12])/R;z.y=E/R;z.z=M/R;y=new p(0,0,0);y.x=t.x*w.a[0]+t.y*w.a[4]+t.z*w.a[8];y.y=t.x*w.a[1]+t.y*w.a[5]+t.z*w.a[9];y.z=t.x*w.a[2]+t.y*w.a[6]+t.z*w.a[10];c.push(z.x);c.push(z.y);c.push(z.z);d.push(y.x);d.push(y.y);d.push(y.z);e.push(x);e.push(1-
v/h);t=(u+1)%k;z=(v+1)%k;b.push(u*k+v);b.push(u*k+z);b.push(t*k+v);b.push(u*k+z);b.push(t*k+z);b.push(t*k+v)}}O.ec(a,c,b,d,e);f=new O;f.ob=b;f.Na=c;f.fb=d;f.zb=e;return f};O.Go=function(a){var b=[],c=[];a=a.AB;for(var d=0,e=0,f=a.length;e<f;)for(var g=a[e++],h=0,k=g.length;h<k;){var l=h++;c.push(g[l].x);c.push(g[l].y);c.push(g[l].z);0<l&&(b.push(d-1),b.push(d));++d}a=new O;a.ob=b;a.Na=c;return a};O.Xo=function(a){var b=[],c=[],d=null!=a.Cj?a.Cj:3,e=null!=a.hl?a.hl:1,f=null!=a.cA?a.cA:200;a=a.Ir;for(var g=
new p(0,0,0),h=0,k,l=0,m=0,u=a.length-1;m<u;){var x=m++;k=a[x+1];x=a[x];g.x=k.x-x.x;g.y=k.y-x.y;g.z=k.z-x.z;h+=Math.sqrt(g.x*g.x+g.y*g.y+g.z*g.z)}f=h/f;d=d*f/(d+e);e=0;for(h=a.length-1;e<h;)for(m=e++,u=a[m+1],k=a[m],g.x=u.x-k.x,g.y=u.y-k.y,g.z=u.z-k.z,k=Math.floor(Math.sqrt(g.x*g.x+g.y*g.y+g.z*g.z)/f),g.normalize(),u=0,x=k;u<x;)k=f*u++,b.push(a[m].x+k*g.x),b.push(a[m].y+k*g.y),b.push(a[m].z+k*g.z),b.push(a[m].x+(k+d)*g.x),b.push(a[m].y+(k+d)*g.y),b.push(a[m].z+(k+d)*g.z),c.push(l),c.push(l+1),l+=
2;a=new O;a.Na=b;a.ob=c;return a};O.Zo=function(a){var b,c,d=[],e=[],f=[],g=[],h=null!=a.width?a.width:1,k=null!=a.height?a.height:1,l=null!=a.rw?a.rw:null!=a.Tc?a.Tc:1;a=null!=a.sw?a.sw:null!=a.Tc?a.Tc:1;for(var m=0,u=a+1;m<u;)for(var p=m++,v=0,q=l+1;v<q;){var n=v++;c=n*h/l-h/2;b=(a-p)*k/a-k/2;e.push(c);e.push(0);e.push(b);f.push(0);f.push(1);f.push(0);g.push(n/l);g.push(1-p/l)}for(h=0;h<a;)for(k=h++,b=0,c=l;b<c;)m=b++,d.push(m+1+(k+1)*(l+1)),d.push(m+1+k*(l+1)),d.push(m+k*(l+1)),d.push(m+(k+1)*
(l+1)),d.push(m+1+(k+1)*(l+1)),d.push(m+k*(l+1));l=new O;l.ob=d;l.Na=e;l.fb=f;l.zb=g;return l};O.fp=function(a){var b,c,d,e,f=a.PM,g=a.TM,h=null!=a.YL?a.YL:{o:1,i:1},k=null!=a.precision?a.precision:{o:1,i:1},l=[],m=[],u=[],p=[];h.i=1>h.i?1:h.i;h.o=1>h.o?1:h.o;k.o=1>k.o?1:k.o;k.i=1>k.i?1:k.i;var v=(a.OM-f)/h.o;a=(a.SM-g)/h.i;for(var q=0,n=h.i;q<n;)for(var w=q++,t=0,r=h.o;t<r;){for(var z=t++,y=f+z*v,A=g+w*a,z=f+(z+1)*v,B=g+(w+1)*a,E=m.length/3,M=k.o+1,R=0,I=k.i;R<I;)for(var C=R++,F=0,N=k.o;F<N;)b=F++,
e=E+b+C*M|0,d=E+(b+1)+C*M|0,c=E+(b+1)+(C+1)*M|0,b=E+b+(C+1)*M|0,l.push(d),l.push(c),l.push(b),l.push(e),l.push(d),l.push(b);e=0;for(E=k.i+1;e<E;)for(M=e++,c=M*(B-A)/k.i+A,R=0,I=k.o+1;R<I;)C=R++,d=C*(z-y)/k.o+y,m.push(d),m.push(0),m.push(c),u.push(0),u.push(1),u.push(0),p.push(C/k.o),p.push(M/k.i)}f=new O;f.ob=l;f.Na=m;f.fb=u;f.zb=p;return f};O.$o=function(a){var b,c,d=a.width,e=a.height,f=a.Tc,g=a.minHeight,h=a.maxHeight,k=a.buffer,l=a.AH,m=a.yH;a=[];for(var u=[],p=[],v=[],q=0,n=f+1;q<n;)for(var w=
q++,t=0,r=f+1;t<r;){var z=t++,y;c=z*d/f-d/2;b=(f-w)*e/f-e/2;y=4*(((c+d/2)/d*(l-1)|0)+((1-(b+e/2)/e)*(m-1)|0)*l)|0;y=g+(h-g)*(k[y]/255*.3+k[y+1]/255*.59+k[y+2]/255*.11);u.push(c);u.push(y);u.push(b);p.push(0);p.push(0);p.push(0);v.push(z/f);v.push(1-w/f)}for(d=0;d<f;)for(e=d++,g=0;g<f;)h=g++,a.push(h+1+(e+1)*(f+1)),a.push(h+1+e*(f+1)),a.push(h+e*(f+1)),a.push(h+(e+1)*(f+1)),a.push(h+1+(e+1)*(f+1)),a.push(h+e*(f+1));O.Nd(u,a,p);f=new O;f.ob=a;f.Na=u;f.fb=p;f.zb=v;return f};O.bp=function(a){var b=[],
c=[],d=[],e=[],f=null!=a.aa?a.aa:0,g=(null!=a.width?a.width:1)/2;a=(null!=a.height?a.height:1)/2;c.push(-g);c.push(-a);c.push(0);d.push(0);d.push(0);d.push(-1);e.push(0);e.push(0);c.push(g);c.push(-a);c.push(0);d.push(0);d.push(0);d.push(-1);e.push(1);e.push(0);c.push(g);c.push(a);c.push(0);d.push(0);d.push(0);d.push(-1);e.push(1);e.push(1);c.push(-g);c.push(a);c.push(0);d.push(0);d.push(0);d.push(-1);e.push(0);e.push(1);b.push(0);b.push(1);b.push(2);b.push(0);b.push(2);b.push(3);O.ec(f,c,b,d,e);
f=new O;f.ob=b;f.Na=c;f.fb=d;f.zb=e;return f};O.Yo=function(a){var b=[],c=[],d=[],e=[],f=null!=a.R?a.R:.5,g=null!=a.Kd?a.Kd:64;a=null!=a.aa?a.aa:0;c.push(0);c.push(0);c.push(0);e.push(.5);e.push(.5);for(var g=2*Math.PI/g,h=0;h<2*Math.PI;){var k=Math.cos(h),l=Math.sin(h);c.push(f*k);c.push(f*l);c.push(0);e.push((k+1)/2);e.push((1-l)/2);h+=g}c.push(c[3]);c.push(c[4]);c.push(c[5]);e.push(e[2]);e.push(e[3]);f=1;for(g=(c.length/3|0)-1;f<g;)h=f++,b.push(h+1),b.push(0),b.push(h);O.Nd(c,b,d);O.ec(a,c,b,d,
e);a=new O;a.ob=b;a.Na=c;a.fb=d;a.zb=e;return a};O.ap=function(a){var b,c,d,e,f=a.aa,g=null!=a.R?a.R:1,h=null==a.tI?!0:a.tI,k=null!=a.Tc?a.Tc:4,l=null!=a.radiusX?a.radiusX:g,m=null!=a.radiusY?a.radiusY:g,u=null!=a.aL?a.aL:g;a=(1+Math.sqrt(5))/2;a=[-1,a,0,1,a,0,-1,-a,0,1,-a,0,0,-1,-a,0,1,-a,0,-1,a,0,1,a,a,0,1,a,0,-1,-a,0,1,-a,0,-1];for(var x=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],v=[4,1,2,1,6,3,5,4,4,3,3,2,
7,4,3,0,1,0,0,1,5,0,5,2],q=[],n=[],w=[],t=[],r=0,z=[],y=[],A=0;3>A;){var B=A++;z[B]=new p(0,0,0);y[B]=new W(0,0)}for(A=0;20>A;){for(var B=A++,E=0;3>E;){var M=E++,R=x[3*B+M],I=z[M];I.x=a[3*R];I.y=a[3*R+1];I.z=a[3*R+2];I=z[M].normalize();I.x*=g;I.y*=g;I.z*=g;I=0;5==B&&2==M&&(I=1);15==B&&1==M&&(I=2);10==B&&1==M&&(I=3);14==B&&2==M&&(I=4);4==B&&1==M&&(I=1);7==B&&1==M&&(I=2);17==B&&2==M&&(I=3);8==B&&0==M&&(I=4);8==B&&1==M&&(I=5);18==B&&0==M&&(I=5);13==B&&2==M&&(I=5);14==B&&1==M&&(I=5);18==B&&2==M&&(I=5);
M=y[M];M.x=.0947265625*(v[2*R]+I)+.048828125;M.y=.1640625*(v[2*R+1]+I)+.0498046875}B=function(a,f,g,v){var x=p.D(z[0],z[2],f/k),B=p.D(z[1],z[2],f/k),x=k==f?z[2]:p.D(x,B,a/(k-f));x.normalize();x.x*=l;x.y*=m;x.z*=u;h?(g=p.D(p.D(z[0],z[2],v/k),p.D(z[1],z[2],v/k),g/(k-v)),v=new p(0,0,0),v.x=g.x,v.y=g.y,v.z=g.z,v.normalize(),g=v):(g=new p(0,0,0),g.x=x.x,g.y=x.y,g.z=x.z,g.normalize());v=y[0];var B=y[2],A=f/k;e=v.x+(B.x-v.x)*A;d=v.y+(B.y-v.y)*A;v=y[1];B=y[2];A=f/k;c=v.x+(B.x-v.x)*A;b=v.y+(B.y-v.y)*A;k==
f?a=y[2]:(a/=k-f,a=new W(e+(c-e)*a,d+(b-d)*a));n.push(x.x);n.push(x.y);n.push(x.z);w.push(g.x);w.push(g.y);w.push(g.z);t.push(a.x);t.push(a.y);q.push(r);r+=1};E=0;for(R=k;E<R;)for(M=E++,I=0;I+M<k;)B(I,M,I+.3333333333333333,M+.3333333333333333),B(I+1,M,I+.3333333333333333,M+.3333333333333333),B(I,M+1,I+.3333333333333333,M+.3333333333333333),I+M+1<k&&(B(I+1,M,I+.6666666666666666,M+.6666666666666666),B(I+1,M+1,I+.6666666666666666,M+.6666666666666666),B(I,M+1,I+.6666666666666666,M+.6666666666666666)),
++I}O.ec(f,n,q,w,t);f=new O;f.ob=q;f.Na=n;f.fb=w;f.zb=t;return f};O.cp=function(a){var b=[{vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},{vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},{vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,
-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,
4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},{vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,
6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},{vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,
-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],
[14,20,23,19],[16,19,23,22],[18,22,23,21]]},{vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},{vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,
.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},{vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],
[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},{vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},{vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},{vertex:[[-.610389,
.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},{vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},{vertex:[[-.669867,.334933,-.529576],
[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},{vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,
-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},{vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,
.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],
face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]}],c=null!=a.type?a.type:0;0>c&&(c=0);c>=b.length&&(c=b.length-1);var d=null!=a.size?a.size:1,e=null!=a.OL?a.OL:d,f=null!=a.PL?a.PL:d,d=null!=a.QL?a.QL:d,c=null!=a.WH?a.WH:b[c],g=c.face.length,h=null!=a.Ln?a.Ln:[],b=null!=
a.Vq?a.Vq:[],k=null!=a.aa?a.aa:0;a=[];for(var l=[],m=[],u=[],p=[],v=0,q=0,n=[],w,t,r,z,y,A=0;A<g;){var B=A++;null!=b&&null==b[B]&&(b[B]=new ca(1,1,1,1));null!=h&&null==h[B]&&(h[B]=new de(0,0,1,1))}for(A=0;A<g;){var E=A++,B=c.face[E].length;r=2*Math.PI/B;z=.5*Math.tan(r/2);y=.5;for(var M=0;M<B;)w=M++,a.push(c.vertex[c.face[E][w]][0]*e),a.push(c.vertex[c.face[E][w]][1]*f),a.push(c.vertex[c.face[E][w]][2]*d),n.push(v),++v,w=h[E].x+(h[E].z-h[E].x)*(.5+z),t=h[E].y+(h[E].o-h[E].y)*(y-.5),u.push(w),u.push(t),
w=z*Math.cos(r)-y*Math.sin(r),y=z*Math.sin(r)+y*Math.cos(r),z=w,null!=b[E]&&(p.push(b[E].r),p.push(b[E].v),p.push(b[E].m),p.push(b[E].$));r=0;for(z=B-2;r<z;)y=r++,l.push(n[q]),l.push(n[y+2+q]),l.push(n[y+1+q]);q+=B}O.Nd(a,l,m);O.ec(k,a,l,m,u);e=new O;e.Na=a;e.ob=l;e.fb=m;e.zb=u;0<b.length&&(e.ke=p);return e};O.hp=function(a){function b(a){var b=u/m*a,c=Math.cos(b);return new p(g*(2+c)*.5*Math.cos(a),g*(2+c)*Math.sin(a)*.5,g*Math.sin(b)*.5)}var c=[],d=[],e=[],f=[],g=null!=a.R?a.R:2,h=null!=a.xD?a.xD:
.5,k=null!=a.xC?a.xC:32,l=null!=a.yD?a.yD:32,m=null!=a.p?a.p:2,u=null!=a.q?a.q:3;a=null!=a.aa?a.aa:0;for(var x=0,v=k+1;x<v;){var q=x++,n=q%k/k*2*m*Math.PI,w=b(n),n=b(n+.01),r=n.x-w.x,t=n.y-w.y,z=n.z-w.z,y=new p(n.x+w.x,n.y+w.y,n.z+w.z),n=new p(0,0,0);n.x=t*y.z-z*y.y;n.y=z*y.x-r*y.z;n.z=r*y.y-t*y.x;var A=new p(0,0,0);A.x=n.y*z-n.z*t;A.y=n.z*r-n.x*z;A.z=n.x*t-n.y*r;y=A;n.normalize();A.normalize();r=0;for(t=l;r<t;){var z=r++,B=z%l/l*2*Math.PI,y=-h*Math.cos(B),B=h*Math.sin(B);d.push(w.x+y*A.x+B*n.x);
d.push(w.y+y*A.y+B*n.y);d.push(w.z+y*A.z+B*n.z);f.push(q/k);f.push(z/l)}}for(h=0;h<k;)for(x=h++,v=0,q=l;v<q;)w=v++,n=(w+1)%l,A=(x+1)*l+w,r=x*l+n,c.push(r),c.push(A),c.push(x*l+w),c.push(r),c.push((x+1)*l+n),c.push(A);O.Nd(d,c,e);O.ec(a,d,c,e,f);k=new O;k.ob=c;k.Na=d;k.fb=e;k.zb=f;return k};O.Nd=function(a,b,c){var d,e,f,g,h,k,l,m,p,x;l=0;for(f=a.length;l<f;)c[l++]=0;for(var v=b.length/3|0,q=0;q<v;)l=q++,m=b[3*l],p=b[3*l+1],x=b[3*l+2],d=a[3*m]-a[3*p],e=a[3*m+1]-a[3*p+1],f=a[3*m+2]-a[3*p+2],g=a[3*x]-
a[3*p],h=a[3*x+1]-a[3*p+1],k=a[3*x+2]-a[3*p+2],l=e*k-f*h,f=f*g-d*k,d=d*h-e*g,e=Math.sqrt(l*l+f*f+d*d),0==e&&(e=1),l/=e,f/=e,d/=e,c[3*m]+=l,c[3*m+1]+=f,c[3*m+2]+=d,c[3*p]+=l,c[3*p+1]+=f,c[3*p+2]+=d,c[3*x]+=l,c[3*x+1]+=f,c[3*x+2]+=d;a=c.length/3|0;for(b=0;b<a;)m=b++,l=c[3*m],f=c[3*m+1],d=c[3*m+2],e=Math.sqrt(l*l+f*f+d*d),0==e&&(e=1),l/=e,f/=e,d/=e,c[3*m]=l,c[3*m+1]=f,c[3*m+2]=d};O.ec=function(a,b,c,d,e){null==a&&(a=0);var f=c.length,g=d.length;switch(a){case 1:for(b=0;b<f;)e=c[b],c[b]=c[b+2],c[b+2]=
e,b+=3;for(e=0;e<g;)c=e++,d[c]=-d[c];break;case 2:var h=b.length;a=h/3|0;for(var k=0;k<h;){var l=k++;b[h+l]=b[l]}for(b=0;b<f;)c[b+f]=c[b+2]+a,c[b+1+f]=c[b+1]+a,c[b+2+f]=c[b]+a,b+=3;for(c=0;c<g;)f=c++,d[g+f]=-d[f];d=e.length;for(g=0;g<d;)c=g++,e[c+d]=e[c]}};O.prototype={set:function(a,b){switch(b){case "color":this.ke=a;break;case "matricesIndices":this.Id=a;break;case "matricesIndicesExtra":this.oe=a;break;case "matricesWeights":this.Tf=a;break;case "matricesWeightsExtra":this.Uf=a;break;case "normal":this.fb=
a;break;case "position":this.Na=a;break;case "uv":this.zb=a;break;case "uv2":this.Xh=a;break;case "uv3":this.Yh=a;break;case "uv4":this.Zh=a;break;case "uv5":this.$h=a;break;case "uv6":this.ai=a}},cc:function(a,b){null==b&&(b=!1);this.hx(a,b)},kH:function(a,b){null==b&&(b=!1);this.hx(a,b)},hx:function(a,b){null==b&&(b=!1);null!=this.Na&&a.Fa("position",this.Na,b);null!=this.fb&&a.Fa("normal",this.fb,b);null!=this.zb&&a.Fa("uv",this.zb,b);null!=this.Xh&&a.Fa("uv2",this.Xh,b);null!=this.Yh&&a.Fa("uv3",
this.Yh,b);null!=this.Zh&&a.Fa("uv4",this.Zh,b);null!=this.$h&&a.Fa("uv5",this.$h,b);null!=this.ai&&a.Fa("uv6",this.ai,b);null!=this.ke&&a.Fa("color",this.ke,b);null!=this.Id&&a.Fa("matricesIndices",this.Id,b);null!=this.Tf&&a.Fa("matricesWeights",this.Tf,b);null!=this.oe&&a.Fa("matricesIndicesExtra",this.oe,b);null!=this.Uf&&a.Fa("matricesWeightsExtra",this.Uf,b);null!=this.ob&&a.Zj(this.ob)},RJ:function(a){if(null!=a.ob){null==this.ob&&(this.ob=[]);for(var b=(null!=this.Na?this.Na.length/3:0)|0,
c=0,d=a.ob.length;c<d;)this.ob.push(a.ob[c++]+b)}if(null!=a.Na)for(null==this.Na&&(this.Na=[]),b=0,c=a.Na.length;b<c;)this.Na.push(a.Na[b++]);if(null!=a.fb)for(null==this.fb&&(this.fb=[]),b=0,c=a.fb.length;b<c;)this.fb.push(a.fb[b++]);if(null!=a.zb)for(null==this.zb&&(this.zb=[]),b=0,c=a.zb.length;b<c;)this.zb.push(a.zb[b++]);if(null!=a.Xh)for(null==this.Xh&&(this.Xh=[]),b=0,c=a.Xh.length;b<c;)this.Xh.push(a.Xh[b++]);if(null!=a.Yh)for(null==this.Yh&&(this.Yh=[]),b=0,c=a.Yh.length;b<c;)this.Yh.push(a.Yh[b++]);
if(null!=a.Zh)for(null==this.Zh&&(this.Zh=[]),b=0,c=a.Zh.length;b<c;)this.Zh.push(a.Zh[b++]);if(null!=a.$h)for(null==this.$h&&(this.$h=[]),b=0,c=a.$h.length;b<c;)this.$h.push(a.$h[b++]);if(null!=a.ai)for(null==this.ai&&(this.ai=[]),b=0,c=a.ai.length;b<c;)this.ai.push(a.ai[b++]);if(null!=a.Id)for(null==this.Id&&(this.Id=[]),b=0,c=a.Id.length;b<c;)this.Id.push(a.Id[b++]);if(null!=a.Tf)for(null==this.Tf&&(this.Tf=[]),b=0,c=a.Tf.length;b<c;)this.Tf.push(a.Tf[b++]);if(null!=a.oe)for(null==this.oe&&(this.oe=
[]),b=0,c=a.oe.length;b<c;)this.oe.push(a.oe[b++]);if(null!=a.Uf)for(null==this.Uf&&(this.Uf=[]),b=0,c=a.Uf.length;b<c;)this.Uf.push(a.Uf[b++]);if(null!=a.ke)for(null==this.ke&&(this.ke=[]),b=0,c=a.ke.length;b<c;)this.ke.push(a.ke[b++])},l:O};var V=K.BABYLON.StandardMaterial=function(a,b){this.Yj="diffuseSampler ambientSampler opacitySampler reflectionCubeSampler reflection2DSampler emissiveSampler specularSampler bumpSampler lightmapSampler refractionCubeSampler refraction2DSampler".split(" ");this.wb=
"world view viewProjection vEyePosition vLightsType vAmbientColor vDiffuseColor vSpecularColor vEmissiveColor vFogInfos vFogColor pointSize vDiffuseInfos vAmbientInfos vOpacityInfos vReflectionInfos vEmissiveInfos vSpecularInfos vBumpInfos vLightmapInfos vRefractionInfos mBones vClipPlane diffuseMatrix ambientMatrix opacityMatrix reflectionMatrix emissiveMatrix specularMatrix bumpMatrix lightmapMatrix refractionMatrix depthValues diffuseLeftColor diffuseRightColor opacityParts reflectionLeftColor reflectionRightColor emissiveLeftColor emissiveRightColor refractionLeftColor refractionRightColor logarithmicDepthConstant".split(" ");
this.eD="default";this.WG=!1;this.Xg=new Sc;this.Lc=new Sc;this.Pa=0;this.dy=new Q(0,0,0);this.ff=new Ja(16);this.yj=this.Iq=null;this.mB=this.nB=!1;this.Rj=4;this.ID=this.HD=!1;this.tr=!0;this.pr=.98;this.bw=0;this.jC=.05;this.FD=this.ds=this.CB=this.es=this.gs=this.fs=this.In=this.JD=this.KD=!1;this.as=64;this.Iu=new Q(0,0,0);this.Co=new Q(1,1,1);this.Hn=new Q(1,1,1);this.sn=new Q(0,0,0);this.Wc=this.Fe=this.Zd=this.kc=this.Dd=this.Re=this.He=this.Sf=this.lc=null;var c=this;va.call(this,a,b);this.Xg.Yi=
-1;this.GA=function(){var a=c.ff;a.length=0;a.Ja++;if(null!=c.kc&&c.kc.Li){var a=c.ff,b=c.kc;a.data[a.length++]=b;b.yb[a.cb]=a.Ja}null!=c.lc&&c.lc.Li&&(a=c.ff,b=c.lc,a.data[a.length++]=b,b.yb[a.cb]=a.Ja);return c.ff};this.O=this.Lc.zc};n["com.babylonhx.materials.StandardMaterial"]=V;V.h=["com","babylonhx","materials","StandardMaterial"];V.Ba=function(a){var b=new yc;b.isEnabled=a.isEnabled;var c=a.Hh;b.Hh=new Q(c[0],c[1],c[2]);c=a.Mh;b.Mh=new Q(c[0],c[1],c[2]);b.th=a.th;b.Xf=null!=a.Xf?a.Xf:1;return b};
V.ab=function(a,b,c){var d=new V(a.name,b),e=a.NN;d.sn=new Q(e[0],e[1],e[2]);e=a.Eu;d.Hn=new Q(e[0],e[1],e[2]);e=a.$r;d.Co=new Q(e[0],e[1],e[2]);d.as=a.as;e=a.cO;d.Iu=new Q(e[0],e[1],e[2]);d.es=a.es;d.ds=a.ds;d.pr=a.pr;d.tr=a.tr;d.gs=a.gs;d.fs=a.fs;d.alpha=a.alpha;d.id=a.id;null!=a.fl&&(d.fl=a.fl);Ca.Md(d,a.Nl);d.un=a.un;d.nw(a.LM);null!=a.Wc&&(d.Wc=ka.ab(a.Wc,b,c));null!=a.Jf&&(d.Jf=V.Ba(a.Jf));null!=a.Fe&&(d.Fe=ka.ab(a.Fe,b,c));null!=a.Zd&&(d.Zd=ka.ab(a.Zd,b,c));null!=a.Me&&(d.Me=V.Ba(a.Me));null!=
a.kc&&(d.kc=ka.ab(a.kc,b,c));null!=a.$f&&(d.$f=V.Ba(a.$f));null!=a.Dd&&(d.Dd=ka.ab(a.Dd,b,c));null!=a.Sf&&(d.Sf=ka.ab(a.Sf,b,c),d.vJ=a.vJ);null!=a.Kf&&(d.Kf=V.Ba(a.Kf));null!=a.Re&&(d.Re=ka.ab(a.Re,b,c));null!=a.He&&(d.He=ka.ab(a.He,b,c));null!=a.lc&&(d.lc=ka.ab(a.lc,b,c));null!=a.Yk&&(d.Yk=a.Yk);return d};V.V=va;V.prototype=S(va.prototype,{cB:function(){return this.WG},Ni:function(){return 1>this.alpha||null!=this.Zd||this.jz()?!0:null!=this.Me?this.Me.isEnabled:!1},Vf:function(){return null!=this.Wc?
this.Wc.Hj:!1},jz:function(){return null!=this.Wc&&this.Wc.Hj?this.FD:!1},br:function(){return this.Wc},Ds:function(a,b,c){null==c&&(c=!1);return null==b?!0:this.O[28]!=c?!1:null!=b.Zp&&b.Zp.isEqual(this.Lc)?!0:!1},pa:function(a,b){null==b&&(b=!1);if(this.av()&&this.Az)return!0;var c=this.f;if(!this.ru&&this.Pa==c.Pa&&this.Ds(c,a,b))return!0;var d=c.c,e=!1,f=!1;this.Lc.reset();if(c.tD){if(null!=this.Wc&&V.ib)if(this.Wc.pa())f=!0,this.O[0]=!0;else return!1;if(null!=this.Fe&&V.Ta)if(this.Fe.pa())f=
!0,this.O[1]=!0;else return!1;if(null!=this.Zd&&V.ec)if(this.Zd.pa())f=!0,this.O[2]=!0,this.Zd.Qu&&(this.O[3]=!0);else return!1;if(null!=this.kc&&V.nc)if(this.kc.pa())switch(e=!0,this.O[4]=!0,0<this.bw&&(this.O[30]=!0),this.fs&&(this.O[49]=!0),6==this.kc.Cd&&(this.O[45]=!0),this.O[36]=this.kc.rc,this.kc.Cd){case 0:this.O[42]=!0;break;case 1:this.O[37]=!0;break;case 2:this.O[38]=!0;break;case 3:case 6:this.O[39]=!0;break;case 4:this.O[40]=!0;break;case 5:this.O[41]=!0;break;case 7:this.O[43]=!0;break;
case 8:this.O[44]=!0}else return!1;if(null!=this.Dd&&V.ae)if(this.Dd.pa())f=!0,this.O[5]=!0;else return!1;if(null!=this.Sf&&V.Ib)if(this.Sf.pa())f=!0,this.O[34]=!0,this.O[35]=this.ID;else return!1;if(null!=this.Re&&V.Uc)if(this.Re.pa())f=!0,this.O[6]=!0,this.O[29]=this.HD;else return!1;if(1==c.c.U.qw&&null!=this.He&&V.$a)if(this.He.pa())f=!0,this.O[7]=!0,this.JD&&(this.O[8]=!0,this.KD&&(this.O[9]=!0)),this.mB&&(this.O[50]=!0),this.nB&&(this.O[51]=!0);else return!1;if(null!=this.lc&&V.Dc)if(this.lc.pa())f=
!0,this.O[47]=!0,this.O[48]=this.lc.rc;else return!1;if(null!=this.yj&&V.Nd)if(this.yj.pa())this.O[55]=!0;else return!1}null!=c.zj&&(this.O[11]=!0);d.zs&&(this.O[12]=!0);this.jz()&&(this.O[13]=!0);this.ds&&(this.O[31]=!0);this.CB&&(this.O[32]=!0);this.cB()&&(this.O[46]=!0);null!=this.Iq&&(this.O[54]=!0);if(this.lr()||c.Mu)this.O[14]=!0;c.nf&&null!=a&&a.rh&&c.Ej!=Ma.g&&this.nf&&(this.O[15]=!0);c.zB&&!this.In&&(e=ic.FE(c,a,this.Lc,this.Rj));V.pb&&(null!=this.Jf&&this.Jf.isEnabled&&(this.O[17]=!0),null!=
this.Me&&this.Me.isEnabled&&(this.O[18]=!0),null!=this.$f&&this.$f.isEnabled&&(this.O[19]=!0,this.es&&(this.O[33]=!0)),null!=this.Ui&&this.Ui.isEnabled&&(this.O[20]=!0),null!=this.Kf&&this.Kf.isEnabled&&(this.O[21]=!0),this.O[17]||this.O[18]||this.O[19]||this.O[21]||this.O[20])&&(e=!0,this.O[22]=!0);this.O[16]&&this.gs&&(this.O[10]=!0);null!=a&&(e&&a.eb("normal")&&(this.O[23]=!0),f&&(a.eb("uv")&&(this.O[24]=!0),a.eb("uv2")&&(this.O[25]=!0)),a.Iw&&a.eb("color")&&(this.O[26]=!0,a.tl&&(this.O[27]=!0)),
a.Gg()&&a.lf&&(this.Lc.ci=a.Ke,this.Lc.Yi=a.fd().Ge.length+1),b&&(this.O[28]=!0));this.Lc.isEqual(this.Xg)||(this.Lc.Kq(this.Xg),c.Ye=null,d=new Je,this.O[4]&&d.Nc(0,"REFLECTION"),this.O[6]&&d.Nc(0,"SPECULAR"),this.O[7]&&d.Nc(0,"BUMP"),this.O[8]&&d.Nc(1,"PARALLAX"),this.O[9]&&d.Nc(0,"PARALLAXOCCLUSION"),this.O[10]&&d.Nc(0,"SPECULAROVERALPHA"),this.O[15]&&d.Nc(1,"FOG"),this.O[14]&&d.Nc(0,"POINTSIZE"),this.O[46]&&d.Nc(0,"LOGARITHMICDEPTH"),ic.AE(this.Lc,d,this.Rj),this.O[16]&&d.Nc(0,"SPECULARTERM"),
this.O[17]&&d.Nc(1,"DIFFUSEFRESNEL"),this.O[18]&&d.Nc(2,"OPACITYFRESNEL"),this.O[19]&&d.Nc(3,"REFLECTIONFRESNEL"),this.O[21]&&d.Nc(4,"EMISSIVEFRESNEL"),this.O[22]&&d.Nc(4,"FRESNEL"),0<this.Lc.ci&&d.cu(0,a),e=["position"],this.O[23]&&e.push("normal"),this.O[24]&&e.push("uv"),this.O[25]&&e.push("uv2"),this.O[26]&&e.push("color"),f=this.Lc.ci,0<f&&(d.cu(0,a),e.push("matricesIndices"),e.push("matricesWeights"),4<f&&(e.push("matricesIndicesExtra"),e.push("matricesWeightsExtra"))),ic.EE(e,this.O),1!=c.c.U.qw&&
(this.eD="legacydefault"),f=this.Lc.toString(),this.O[54]&&Aa.GE(this.wb),this.O[55]&&Gc.HE(this.wb,this.Yj),ic.IE(this.wb,this.Yj,this.Lc.jc,this.Rj),this.s=c.c.Aj(this.eD,e,this.wb,this.Yj,f,d,this.Fr,this.Kh,{Rj:this.Rj-1}));if(null==this.s||!this.s.Mc)return!1;this.Pa=c.Pa;this.Az=!0;null!=a&&(null==a.Zp&&(a.Zp=new Sc),this.Lc.Kq(a.Zp));return!0},Io:function(){null!=this.kc&&this.kc.Li&&this.s.Hb("reflection2DSampler",null);null!=this.lc&&this.lc.Li&&this.s.Hb("refraction2DSampler",null);va.prototype.Io.call(this)},
wn:function(a){var b=this.s;if(b.Wa("world",a)){var c=b.c,b=b.u.get("world");c.b.uniformMatrix4fv(b,!1,a.a)}},bind:function(a,b){var c,d,e,f=this.f;this.wn(a);var g=this.s;if(null!=b&&b.Gg()&&b.lf){var h=b.fd(),k;h.Oi&&null!=b.ee?k=b.ee:(null==h.De&&h.Fl(),k=h.De);if(null!=k){g.Qa.set("mBones",null);var l=g.c,m=g.u.get("mBones");l.b.uniformMatrix4fv(m,!1,k)}}if(f.Ye!=this){var p=this.s,q=f.sb;if(p.Wa("viewProjection",q)){var v=p.c,n=p.u.get("viewProjection");v.b.uniformMatrix4fv(n,!1,q.a)}if(V.pb){if(null!=
this.Jf&&this.Jf.isEnabled){var r=this.s,t=this.Jf.Hh,A=this.Jf.Xf;if(r.Oa("diffuseLeftColor",t.r,t.v,t.m,A)){var F=r.c,O=r.u.get("diffuseLeftColor");F.b.uniform4f(O,t.r,t.v,t.m,A)}var y=this.s,H=this.Jf.Mh,B=this.Jf.th;if(y.Oa("diffuseRightColor",H.r,H.v,H.m,B)){var E=y.c,M=y.u.get("diffuseRightColor");E.b.uniform4f(M,H.r,H.v,H.m,B)}}if(null!=this.Me&&this.Me.isEnabled){var R=this.s,I=this.Me.Hh,C=this.Me.Mh;e=.3*I.r+.59*I.v+.11*I.m;d=.3*C.r+.59*C.v+.11*C.m;c=this.Me.th;var ba=this.Me.Xf;if(R.Oa("opacityParts",
e,d,c,ba)){var N=R.c,L=R.u.get("opacityParts");N.b.uniform4f(L,e,d,c,ba)}}if(null!=this.$f&&this.$f.isEnabled){var S=this.s,Q=this.$f.Hh,T=this.$f.Xf;if(S.Oa("reflectionLeftColor",Q.r,Q.v,Q.m,T)){var aa=S.c,X=S.u.get("reflectionLeftColor");aa.b.uniform4f(X,Q.r,Q.v,Q.m,T)}var W=this.s,Y=this.$f.Mh,U=this.$f.th;if(W.Oa("reflectionRightColor",Y.r,Y.v,Y.m,U)){var ea=W.c,fa=W.u.get("reflectionRightColor");ea.b.uniform4f(fa,Y.r,Y.v,Y.m,U)}}if(null!=this.Ui&&this.Ui.isEnabled){var ca=this.s,Z=this.Ui.Hh,
da=this.Ui.Xf;if(ca.Oa("refractionLeftColor",Z.r,Z.v,Z.m,da)){var ia=ca.c,ga=ca.u.get("refractionLeftColor");ia.b.uniform4f(ga,Z.r,Z.v,Z.m,da)}var ha=this.s,J=this.Ui.Mh,P=this.Ui.th;if(ha.Oa("refractionRightColor",J.r,J.v,J.m,P)){var ja=ha.c,ka=ha.u.get("refractionRightColor");ja.b.uniform4f(ka,J.r,J.v,J.m,P)}}if(null!=this.Kf&&this.Kf.isEnabled){var la=this.s,na=this.Kf.Hh,ma=this.Kf.Xf;if(la.Oa("emissiveLeftColor",na.r,na.v,na.m,ma)){var oa=la.c,pa=la.u.get("emissiveLeftColor");oa.b.uniform4f(pa,
na.r,na.v,na.m,ma)}var Fb=this.s,zb=this.Kf.Mh,qa=this.Kf.th;if(Fb.Oa("emissiveRightColor",zb.r,zb.v,zb.m,qa)){var sa=Fb.c,Vb=Fb.u.get("emissiveRightColor");sa.b.uniform4f(Vb,zb.r,zb.v,zb.m,qa)}}}if(f.tD){if(null!=this.Wc&&V.ib){this.s.Hb("diffuseSampler",this.Wc);var ra=this.s,Ha=this.Wc.If,ta=this.Wc.level;if(ra.Jb("vDiffuseInfos",Ha,ta)){var xa=ra.c,Ba=ra.u.get("vDiffuseInfos");xa.b.uniform2f(Ba,Ha,ta)}var rc=this.s,Fa=this.Wc.Je();if(rc.Wa("diffuseMatrix",Fa)){var Za=rc.c,Ia=rc.u.get("diffuseMatrix");
Za.b.uniformMatrix4fv(Ia,!1,Fa.a)}}if(null!=this.Fe&&V.Ta){this.s.Hb("ambientSampler",this.Fe);var Cc=this.s,Ga=this.Fe.If,Ca=this.Fe.level;if(Cc.Jb("vAmbientInfos",Ga,Ca)){var Ja=Cc.c,Oa=Cc.u.get("vAmbientInfos");Ja.b.uniform2f(Oa,Ga,Ca)}var za=this.s,wa=this.Fe.Je();if(za.Wa("ambientMatrix",wa)){var Qa=za.c,Ra=za.u.get("ambientMatrix");Qa.b.uniformMatrix4fv(Ra,!1,wa.a)}}if(null!=this.Zd&&V.ec){this.s.Hb("opacitySampler",this.Zd);var eb=this.s,ya=this.Zd.If,bb=this.Zd.level;if(eb.Jb("vOpacityInfos",
ya,bb)){var hb=eb.c,Ua=eb.u.get("vOpacityInfos");hb.b.uniform2f(Ua,ya,bb)}var Wa=this.s,Va=this.Zd.Je();if(Wa.Wa("opacityMatrix",Va)){var mb=Wa.c,db=Wa.u.get("opacityMatrix");mb.b.uniformMatrix4fv(db,!1,Va.a)}}if(null!=this.kc&&V.nc){this.kc.rc?this.s.Hb("reflectionCubeSampler",this.kc):this.s.Hb("reflection2DSampler",this.kc);var Da=this.s,Ea=this.kc.nl();if(Da.Wa("reflectionMatrix",Ea)){var lb=Da.c,cb=Da.u.get("reflectionMatrix");lb.b.uniformMatrix4fv(cb,!1,Ea.a)}var jb=this.s,gb=this.kc.level,
sb=this.bw;if(jb.Jb("vReflectionInfos",gb,sb)){var Zc=jb.c,xb=jb.u.get("vReflectionInfos");Zc.b.uniform2f(xb,gb,sb)}}if(null!=this.Dd&&V.ae){this.s.Hb("emissiveSampler",this.Dd);var Sa=this.s,Ka=this.Dd.If,Ab=this.Dd.level;if(Sa.Jb("vEmissiveInfos",Ka,Ab)){var yb=Sa.c,La=Sa.u.get("vEmissiveInfos");yb.b.uniform2f(La,Ka,Ab)}var Ic=this.s,Ta=this.Dd.Je();if(Ic.Wa("emissiveMatrix",Ta)){var Lb=Ic.c,Mb=Ic.u.get("emissiveMatrix");Lb.b.uniformMatrix4fv(Mb,!1,Ta.a)}}if(null!=this.Sf&&V.Ib){this.s.Hb("lightmapSampler",
this.Sf);var Xa=this.s,id=this.Sf.If,fd=this.Sf.level;if(Xa.Jb("vLightmapInfos",id,fd)){var jd=Xa.c,Jc=Xa.u.get("vLightmapInfos");jd.b.uniform2f(Jc,id,fd)}var Ec=this.s,ob=this.Sf.Je();if(Ec.Wa("lightmapMatrix",ob)){var Wd=Ec.c,fb=Ec.u.get("lightmapMatrix");Wd.b.uniformMatrix4fv(fb,!1,ob.a)}}if(null!=this.Re&&V.Uc){this.s.Hb("specularSampler",this.Re);var Fc=this.s,tb=this.Re.If,gd=this.Re.level;if(Fc.Jb("vSpecularInfos",tb,gd)){var kd=Fc.c,Qc=Fc.u.get("vSpecularInfos");kd.b.uniform2f(Qc,tb,gd)}var ub=
this.s,Xd=this.Re.Je();if(ub.Wa("specularMatrix",Xd)){var vb=ub.c,Eb=ub.u.get("specularMatrix");vb.b.uniformMatrix4fv(Eb,!1,Xd.a)}}if(null!=this.He&&1==f.c.U.qw&&V.$a){this.s.Hb("bumpSampler",this.He);var ab=this.s,qb=this.He.If,rb=1/this.He.level,Cb=this.jC;if(ab.ve("vBumpInfos",qb,rb,Cb)){var wb=ab.c,pb=ab.u.get("vBumpInfos");wb.b.uniform3f(pb,qb,rb,Cb)}var nb=this.s,Gb=this.He.Je();if(nb.Wa("bumpMatrix",Gb)){var Yb=nb.c,$b=nb.u.get("bumpMatrix");Yb.b.uniformMatrix4fv($b,!1,Gb.a)}}if(null!=this.lc&&
V.Dc){var Wb=1;if(this.lc.rc)this.s.Hb("refractionCubeSampler",this.lc);else{this.s.Hb("refraction2DSampler",this.lc);var ib=this.s,Nb=this.lc.nl();if(ib.Wa("refractionMatrix",Nb)){var fc=ib.c,hc=ib.u.get("refractionMatrix");fc.b.uniformMatrix4fv(hc,!1,Nb.a)}z.D(this.lc,ke)&&(Wb=this.lc.depth)}var Db=this.s,Ub=this.lc.level,Zb=this.pr,Tb=this.tr?-1:1;Db.Oa("vRefractionInfos",Ub,Zb,Wb,Tb)&&Db.c.Tb(Db.u.get("vRefractionInfos"),Ub,Zb,Wb,Tb)}null!=this.yj&&V.Nd&&Gc.po(this.yj,this.s)}var Jb=this.s;if(null!=
f.zj){var Pa=f.zj,ac=Pa.j.x,bc=Pa.j.y,cc=Pa.j.z,dc=Pa.d;Jb.Oa("vClipPlane",ac,bc,cc,dc)&&Jb.c.Tb(Jb.u.get("vClipPlane"),ac,bc,cc,dc)}if(this.lr()){var Ib=this.s,ec=this.nC,mc=Ib.Qa.get("pointSize");if(null==mc||mc[0]!=ec){Ib.Qa.set("pointSize",[ec]);var sc=Ib.c,uc=Ib.u.get("pointSize");sc.b.uniform1f(uc,ec)}}var jc=f.sn,kc=this.sn,lc=this.dy;lc.r=jc.r*kc.r;lc.v=jc.v*kc.v;lc.m=jc.m*kc.m;var nc=this.s,wc=null!=f.ot?f.ot:f.M.position;if(nc.ve("vEyePosition",wc.x,wc.y,wc.z)){var $a=nc.c,xc=nc.u.get("vEyePosition");
$a.b.uniform3f(xc,wc.x,wc.y,wc.z)}var oc=this.s,Kb=this.dy;if(oc.ve("vAmbientColor",Kb.r,Kb.v,Kb.m)){var yc=oc.c,zc=oc.u.get("vAmbientColor");yc.b.uniform3f(zc,Kb.r,Kb.v,Kb.m)}if(this.O[16]){var pc=this.s,Bb=this.Co,vc=this.as;if(pc.Oa("vSpecularColor",Bb.r,Bb.v,Bb.m,vc)){var Bc=pc.c,Mc=pc.u.get("vSpecularColor");Bc.b.uniform4f(Mc,Bb.r,Bb.v,Bb.m,vc)}}var Xb=this.s,qc=this.Iu;if(Xb.ve("vEmissiveColor",qc.r,qc.v,qc.m)){var Nc=Xb.c,Oc=Xb.u.get("vEmissiveColor");Nc.b.uniform3f(Oc,qc.r,qc.v,qc.m)}}if(f.Ye!=
this||!this.av()){var kb=this.s,tc=this.Hn,Lc=this.alpha*b.Ci();if(kb.Oa("vDiffuseColor",tc.r,tc.v,tc.m,Lc)){var Wc=kb.c,Xc=kb.u.get("vDiffuseColor");Wc.b.uniform4f(Xc,tc.r,tc.v,tc.m,Lc)}f.zB&&!this.In&&ic.fE(f,b,this.s,this.O[16],this.Rj);if(f.nf&&b.rh&&f.Ej!=Ma.g||null!=this.kc||null!=this.lc){var Kc=this.s,Rc=f.za;if(Kc.Wa("view",Rc)){var $c=Kc.c,ad=Kc.u.get("view");$c.b.uniformMatrix4fv(ad,!1,Rc.a)}}var Ac=this.s;if(f.nf&&b.rh&&f.Ej!=Ma.g){var Sc=f.Ej,Tc=f.yA,Uc=f.xA,Vc=f.wA;Ac.Oa("vFogInfos",
Sc,Tc,Uc,Vc)&&Ac.c.Tb(Ac.u.get("vFogInfos"),Sc,Tc,Uc,Vc);var nd=f.vA;if(Ac.ve("vFogColor",nd.r,nd.v,nd.m)){var Hb=Ac.c,bd=Ac.u.get("vFogColor");Hb.b.uniform3f(bd,nd.r,nd.v,nd.m)}}var Hc=this.s;if(this.O[46]){var Pc=2/(Math.log(f.M.Fb+1)/.6931471805599453),Yc=Hc.Qa.get("logarithmicDepthConstant");if(null==Yc||Yc[0]!=Pc){Hc.Qa.set("logarithmicDepthConstant",[Pc]);var cd=Hc.c,dd=Hc.u.get("logarithmicDepthConstant");cd.b.uniform1f(dd,Pc)}}null!=this.Iq&&Aa.po(this.Iq,this.s)}va.prototype.bind.call(this,
a,b)},dispose:function(a,b){null==b&&(b=!0);null==a&&(a=!1);b&&(null!=this.Wc&&this.Wc.dispose(),null!=this.Fe&&this.Fe.dispose(),null!=this.Zd&&this.Zd.dispose(),null!=this.kc&&this.kc.dispose(),null!=this.Dd&&this.Dd.dispose(),null!=this.Re&&this.Re.dispose(),null!=this.He&&this.He.dispose(),null!=this.lc&&this.lc.dispose(),null!=this.yj&&this.yj.dispose());va.prototype.dispose.call(this,a)},l:V,F:S(va.prototype.F,{cB:"get_useLogarithmicDepth"})});var Q=K.BABYLON.Color3=function(a,b,c){null==c&&
(c=0);null==b&&(b=0);null==a&&(a=0);this.r=a;this.v=b;this.m=c};n["com.babylonhx.math.Color3"]=Q;Q.h=["com","babylonhx","math","Color3"];Q.bp=function(a){return"#"!=a.substring(0,1)||7!=a.length?(console.log("Color3.FromHexString must be called with a string like #FFFFFF"),new Q(0,0,0)):new Q(sa.$a("0x"+a.substring(1,3))/255,sa.$a("0x"+a.substring(3,5))/255,sa.$a("0x"+a.substring(5,7))/255)};Q.Zb=function(a){return new Q(a[0],a[1],a[2])};Q.Af=function(a){return new Q((a>>16&255)/255,(a>>8&255)/255,
(a&255)/255)};Q.cp=function(a,b,c){return new Q(a/255,b/255,c/255)};Q.D=function(a,b,c){return new Q(a.r+(b.r-a.r)*c,a.v+(b.v-a.v)*c,a.m+(b.m-a.m)*c)};Q.Hl=function(){return new Q(1,0,0)};Q.Ag=function(){return new Q(0,1,0)};Q.nc=function(){return new Q(0,0,1)};Q.ec=function(){return new Q(0,0,0)};Q.Qo=function(){return new Q(1,1,1)};Q.Mi=function(){return new Q(.5,0,.5)};Q.Bg=function(){return new Q(1,0,1)};Q.So=function(){return new Q(1,1,0)};Q.jg=function(){return new Q(.5,.5,.5)};Q.prototype=
{scale:function(a){return new Q(this.r*a,this.v*a,this.m*a)},l:Q};var Yc=K.BABYLON.CubeTexture=function(a,b,c,d,e){null==d&&(d=!1);Ub.call(this,b);this.Cd=3;this.url=this.name=a;this.Im=d;this.Hj=!1;if(null!=a&&""!=a||null!=e){if(null==e){null==c&&(c="_px.jpg _py.jpg _pz.jpg _nx.jpg _ny.jpg _nz.jpg".split(" "));e=[];for(var f=0,g=c.length;f<g;)e.push(a+c[f++])}this.HF=e;null==this.ga&&(b.GD?this.La=4:this.ga=b.c.Zz(a,b,e,d));this.rc=!0;a=new r;a.a[0]=1;a.a[1]=0;a.a[2]=0;a.a[3]=0;a.a[4]=0;a.a[5]=1;
a.a[6]=0;a.a[7]=0;a.a[8]=0;a.a[9]=0;a.a[10]=1;a.a[11]=0;a.a[12]=0;a.a[13]=0;a.a[14]=0;a.a[15]=1;this.sq=a}};n["com.babylonhx.materials.textures.CubeTexture"]=Yc;Yc.h=["com","babylonhx","materials","textures","CubeTexture"];Yc.ab=function(a,b,c){var d=null;null==a.name&&null==a.pI||a.Li||(d=new Yc(c+sa.Ib(a.name),b,a.pI),d.name=a.name,d.Hj=a.Hj,d.level=a.level,d.Cd=a.Cd);return d};Yc.V=Ub;Yc.prototype=S(Ub.prototype,{Rq:function(){4==this.La&&(this.La=1,this.ga=this.Pp(this.url,this.Im),null==this.ga&&
(this.ga=this.f.c.Zz(this.url,this.f,this.HF,this.Im)))},nl:function(){return this.sq},l:Yc});var mc=K.BABYLON.RenderTargetTexture=function(a,b,c,d,e,f,g,h,k,l){null==l&&(l=!1);null==k&&(k=!0);null==h&&(h=3);null==g&&(g=!1);null==f&&(f=0);null==e&&(e=!0);this.Ht=1;this.af=-1;this.Db={width:0,height:0};this.Iv=new U;this.Kc=new U;this.sc=new U;this.UB=new U;this.rL=!1;this.Yv=!0;this.mc=[];ka.call(this,null,c,!d);this.Cd=4;this.name=a;this.Li=!0;"number"==typeof b&&(b|0)===b?(this.Db.width=b,this.Db.height=
b):null!=b.width&&(this.Db.width=b.width,this.Db.height=b.height);this.Sx=e;this.rc=g;1==h&&(this.ig=this.hg=0);g?(this.ga=c.c.TH(this.Db,{qc:d,jd:h,il:k,jl:l}),this.Cd=6,a=new r,a.a[0]=1,a.a[1]=0,a.a[2]=0,a.a[3]=0,a.a[4]=0,a.a[5]=1,a.a[6]=0,a.a[7]=0,a.a[8]=0,a.a[9]=0,a.a[10]=1,a.a[11]=0,a.a[12]=0,a.a[13]=0,a.a[14]=0,a.a[15]=1,this.sq=a):this.ga=c.c.zu(this.Db,{qc:d,type:f,jd:h,il:k,jl:l});this.pj=new Be(c)};n["com.babylonhx.materials.textures.RenderTargetTexture"]=mc;mc.h=["com","babylonhx","materials",
"textures","RenderTargetTexture"];mc.V=ka;mc.prototype=S(ka.prototype,{GC:function(){this.af=-1},Rn:function(){return this.Ht},ph:function(){if(-1==this.af||this.Rn()==this.af)return this.af=1,!0;this.af++;return!1},pa:function(){return this.f.Mr?ka.prototype.pa.call(this):!1},nl:function(){return this.rc?this.sq:ka.prototype.nl.call(this)},gb:function(a){null==a&&(a=!1);var b=this.f,c=b.c;0==this.zM&&(a=this.zM);if(null!=this.qn){this.mc=[];for(var d=0,e=this.qn.length;d<e;)this.mc.push(b.Su(this.qn[d++]));
this.qn=null}if(null!=this.pL){this.mc.splice(0,this.mc.length-1);for(var d=this.f.Xb,e=0,f=d.length;e<f;){var g=d[e++];this.pL(g)&&this.mc.push(g)}}if(null==this.mc||0!=this.mc.length){null!=this.M?(d=this.M.viewport,e=c.Vb(),f=c.Lb(),c.Ze=d,c.b.viewport(d.x*e|0,d.y*f|0,e*d.width|0,f*d.height|0),this.M!=b.M&&(d=this.M.pf(),e=this.M.Mf(!0),b.za=d,b.Va=e,b.za.qa(b.Va,b.sb.a,0))):(d=b.M.viewport,e=c.Vb(),f=c.Lb(),c.Ze=d,c.b.viewport(d.x*e|0,d.y*f|0,e*d.width|0,f*d.height|0));this.pj.reset();d=null!=
this.mc?this.mc:b.Ug.data;e=null!=this.mc?this.mc.length:b.Ug.length;f=b.Pa;for(g=0;g<e;){var h=d[g++];if(null!=h)if(h.pa()){if(h.Ly(f),h.isEnabled()&&h.gd&&null!=h.Ga&&0!=(h.tb&b.M.tb)){h.ws(f);for(var k=0,h=h.Ga;k<h.length;){var l=h[k];++k;b.op+=l.Xd;this.pj.mf(l)}}}else this.GC()}if(this.rc)for(f=0;6>f;)this.EC(f++,d,e,a),b.Pa++,b.Ye=null;else this.EC(0,d,e,a);this.UB.la(this);null!=this.M&&this.M!=b.M&&(a=b.M.pf(),d=b.M.Mf(!0),b.za=a,b.Va=d,b.za.qa(b.Va,b.sb.a,0));a=b.M.viewport;d=c.Vb();e=c.Lb();
c.Ze=a;c.b.viewport(a.x*d|0,a.y*e|0,d*a.width|0,e*a.height|0);b.Ye=null}},EC:function(a,b,c,d){null==d&&(d=!1);var e=this.f;c=e.c;d&&e.El.Ny(this.ga)||(this.rc?c.bindFramebuffer(this.ga,a):c.bindFramebuffer(this.ga));this.sc.la(a);if(this.Iv.Dh())this.Iv.la(c);else{var f=e.clearColor;c.H.apply(c.b);c.rb.apply(c.b);c.K.apply(c.b);z.D(f,ca)?c.b.clearColor(f.r,f.v,f.m,f.$):c.b.clearColor(f.r,f.v,f.m,1);c.b.clearDepth(1);c.b.clearStencil(0);c.b.clear(17664)}if(!this.Sx){var f=e.M.pf(),g=e.M.Mf(!0);e.za=
f;e.Va=g;e.za.qa(e.Va,e.sb.a,0)}this.pj.gb(this.XH,b,this.Yv,this.rL);d&&e.El.Ux(!1,this.ga,a);this.Sx||(b=e.M.pf(),d=e.M.Mf(!0),e.za=b,e.Va=d,e.za.qa(e.Va,e.sb.a,0));this.Kc.la(a);this.rc&&5!=a||(this.rc&&5==a&&c.BA(this.ga),a=this.ga,c.pg=null,a.qc&&!this.rc&&(a=a.data,c.P[c.J]!=a&&(c.b.bindTexture(3553,a),c.P[c.J]=a),c.b.generateMipmap(3553),null!=c.P[c.J]&&(c.b.bindTexture(3553,null),c.P[c.J]=null)),null!=c.tc&&(c.b.bindFramebuffer(36160,null),c.tc=null))},l:mc,F:{Rn:"get_refreshRate"}});var Id=
K.BABYLON.MirrorTexture=function(a,b,c,d){null==d&&(d=!1);var e=new r;e.a[0]=0;e.a[1]=0;e.a[2]=0;e.a[3]=0;e.a[4]=0;e.a[5]=0;e.a[6]=0;e.a[7]=0;e.a[8]=0;e.a[9]=0;e.a[10]=0;e.a[11]=0;e.a[12]=0;e.a[13]=0;e.a[14]=0;e.a[15]=0;this.nt=e;e=new r;e.a[0]=0;e.a[1]=0;e.a[2]=0;e.a[3]=0;e.a[4]=0;e.a[5]=0;e.a[6]=0;e.a[7]=0;e.a[8]=0;e.a[9]=0;e.a[10]=0;e.a[11]=0;e.a[12]=0;e.a[13]=0;e.a[14]=0;e.a[15]=0;this.sb=e;this.eo=new cd(0,1,0,1);var f=this;mc.call(this,a,b,c,d,!0);this.sc.add(function(){r.uB(f.eo,f.nt);f.Zy=
c.za;f.nt.qa(f.Zy,f.sb.a,0);c.za=f.sb;c.Va=c.Va;c.za.qa(c.Va,c.sb.a,0);c.zj=f.eo;c.c.Cg=!1;var a=c.M.position,b=new p(0,0,0),d=a.x,e=a.y,a=a.z,m=f.nt.a,u=d*m[1]+e*m[5]+a*m[9]+m[13],q=d*m[2]+e*m[6]+a*m[10]+m[14],v=d*m[3]+e*m[7]+a*m[11]+m[15];b.x=(d*m[0]+e*m[4]+a*m[8]+m[12])/v;b.y=u/v;b.z=q/v;c.ot=b});this.Kc.add(function(){c.za=f.Zy;c.Va=c.Va;c.za.qa(c.Va,c.sb.a,0);c.c.Cg=!0;c.ot=null;c.zj=null})};n["com.babylonhx.materials.textures.MirrorTexture"]=Id;Id.h=["com","babylonhx","materials","textures",
"MirrorTexture"];Id.V=mc;Id.prototype=S(mc.prototype,{l:Id});var Be=K.BABYLON.RenderingManager=function(a){this.Kt=null;this.vF=[];this.tF=[];this.uF=[];this.ix=[];this.Xm=[];this.f=a;for(a=0;4>a;){var b=a++,c=this.ix,d=new ea;null!=t.autoClear?d.C("autoClear",!0):d.i.autoClear=!0;null!=t.depth?d.C("depth",!0):d.i.depth=!0;null!=t.stencil?d.C("stencil",!0):d.i.stencil=!0;c[b]=d}};n["com.babylonhx.rendering.RenderingManager"]=Be;Be.h=["com","babylonhx","rendering","RenderingManager"];Be.prototype=
{vG:function(a,b){if(0!=this.f.Xl.length){this.xs=this.f.M;for(var c=0,d=this.f.Xl.length;c<d;){var e=this.f.Xl.data[c++];if(e.ag==a&&0!=(this.xs.tb&e.tb)){if(!this.tk){var f=this.f.c;f.H.apply(f.b);f.rb.apply(f.b);f.K.apply(f.b);f.b.clearDepth(1);f.b.clearStencil(0);f.b.clear(1280);this.tk=!0}if(null==e.Ed.position||null==b||-1!=b.indexOf(e.Ed))this.f.cx+=e.gb()}}}},xG:function(a){if(this.f.lD&&0!=this.f.dg.length){this.xs=this.f.M;for(var b=0,c=this.f.dg.length;b<c;){var d=this.f.dg[b++];if(d.ag==
a&&0!=(this.xs.tb&d.tb)){if(!this.tk){var e=this.f.c;e.H.apply(e.b);e.rb.apply(e.b);e.K.apply(e.b);e.b.clearDepth(1);e.b.clearStencil(0);e.b.clear(1280);this.tk=!0}d.gb()}}}},Xy:function(){this.sF&&this.xG(this.Lx);this.rF&&this.vG(this.Lx,this.pF)},gb:function(a,b,c,d){var e=this.f.dC.Dh()?this.f.dC:null,f=null;null!=e&&(null==this.Kt&&(this.Kt=new ef),f=this.Kt,f.scene=this.f,f.Tz=this.f.M);this.pF=b;this.rF=c;this.sF=d;for(b=0;4>b;){this.tk=0==b;c=this.Xm[b];this.Lx=b;if(null!=c){d=0;null!=e&&
(d=Math.pow(2,b),f.ro=1,f.ag=b,e.la(f,d));var g=this.ix[b];if(null!=g&&(null!=t.autoClear?g.I("autoClear"):g.i.autoClear)){var h=null!=t.depth?g.I("depth"):g.i.depth,g=null!=t.stencil?g.I("stencil"):g.i.stencil;if(!this.tk){var k=this.f.c;k.H.apply(k.b);k.rb.apply(k.b);k.K.apply(k.b);var l=0;h&&(k.b.clearDepth(1),l=256);g&&(k.b.clearStencil(0),l|=1024);k.b.clear(l);this.tk=!0}}null!=e&&(f.ro=2,e.la(f,d));null==c.ko&&(c.ko=F(this,this.Xy));null!=e&&(f.ro=3,e.la(f,d));c.gb(a);null!=e&&(f.ro=4,e.la(f,
d))}else this.Xy(),null!=e&&(c=Math.pow(2,b),f.ro=1,f.ag=b,e.la(f,c),f.ro=4,e.la(f,c));++b}},reset:function(){for(var a=0;4>a;){var b=this.Xm[a++];if(null!=b){var c=b.Lm;c.length=0;c.Ja++;c=b.Uk;c.length=0;c.Ja++;b=b.Yl;b.length=0;b.Ja++}}},mf:function(a){var b=a.ta.ag;null==this.Xm[b]&&(this.Xm[b]=new wa(b,this.f,this.uF[b],this.tF[b],this.vF[b]));b=this.Xm[b];wa.Ta=a.Lf();wa.Yc=a.ta;b=wa.Ta.Ni()||1>wa.Yc.Ci()||wa.Yc.tl?b.Uk:wa.Ta.Vf()?b.Yl:b.Lm;b.data[b.length++]=a;a.yb[b.cb]=b.Ja},l:Be};var cd=
K.BABYLON.Plane=function(a,b,c,d){this.j=new p(a,b,c);this.d=d};n["com.babylonhx.math.Plane"]=cd;cd.h=["com","babylonhx","math","Plane"];cd.prototype={l:cd};var yc=K.BABYLON.FresnelParameters=function(){this.Xf=1;this.th=0;this.Mh=new Q(0,0,0);this.Hh=new Q(1,1,1);this.isEnabled=!0};n["com.babylonhx.materials.FresnelParameters"]=yc;yc.h=["com","babylonhx","materials","FresnelParameters"];yc.ab=function(a){var b=new yc;b.isEnabled=a.isEnabled;var c=a.Hh;b.Hh=new Q(c[0],c[1],c[2]);c=a.Mh;b.Mh=new Q(c[0],
c[1],c[2]);b.th=a.th;b.Xf=null!=a.Xf?a.Xf:1;return b};yc.prototype={l:yc};var ub=K.BABYLON.SubMesh=function(a,b,c,d,e,f,g,h){null==h&&(h=!0);this.yb=[];this.uf=a;this.te=b;this.Tg=c;this.Wb=d;this.Xd=e;this.ta=f;this.oh=null!=g?g:z.g(f,aa);f.Ga.push(this);this.tj=[];this.cb=f.Ga.length-1;h&&(this.Uv(),f.Wd(!0))};n["com.babylonhx.mesh.SubMesh"]=ub;ub.h=["com","babylonhx","mesh","SubMesh"];ub.xb=[Nb];ub.g=function(a,b,c,d){var e,f=Infinity,g=-Infinity;null==e&&(e=z.g(d,aa));for(var h=e.Ac(),k=b,l=b+
c;k<l;){var m=h[k++];m<f&&(f=m);m>g&&(g=m)}new ub(a,f|0,g-f+1|0,b,c,d,e)};ub.prototype={Of:function(){return 0==this.te?this.Tg==this.ta.Nf():!1},Lf:function(){var a=this.oh.Fg();return null!=a&&z.D(a,Ua)?a.IA(this.uf):null==a?this.ta.f.Qq:a},Uv:function(){var a,b,c;this.Xp=null;if(!this.Of()){var d=this.oh.Aa("position");if(null==d)this.ra=this.ta.ra;else{var e=this.oh.Ac();new p(0,0,0);var f;new p(0,0,0);if(0==this.Wb&&this.Xd==e.length)f=this.oh.ed().Gb,d=new p(f.x,f.y,f.z),f=this.oh.ed().Mb,f=
new p(f.x,f.y,f.z);else{var g=this.Wb,h=new p(Infinity,Infinity,Infinity);f=new p(-Infinity,-Infinity,-Infinity);for(var k=g,g=g+this.Xd;k<g;){a=k++;c=d[3*e[a]];b=d[3*e[a]+1];a=d[3*e[a]+2];var l=new p(c,b,a);h.x<l.x&&(l.x=h.x);h.y<l.y&&(l.y=h.y);h.z<l.z&&(l.z=h.z);h=l;b=new p(c,b,a);f.x>b.x&&(b.x=f.x);f.y>b.y&&(b.y=f.y);f.z>b.z&&(b.z=f.z);f=b}d=h}this.ra=new Gb(d,f)}}},clone:function(a,b){var c=new ub(this.uf,this.te,this.Tg,this.Wb,this.Xd,a,b,!1);this.Of()||(c.ra=new Gb(this.ra.Gb,this.ra.Mb));
return c},dispose:function(){if(null!=this.Bm){var a=this.Bm;a.ia--;0==a.ia&&this.ta.f.c.b.deleteBuffer(a.buffer);this.Bm=null}Z.remove(this.ta.Ga,this)},l:ub,F:{Of:"get_IsGlobal"}};var Cf=K.BABYLON.PhysicsBodyCreationOptions=function(a,b,c,d){null==d&&(d="");this.name="";""==d&&(d=function(a){var b=15;null==b&&(b=61);var c="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),d=[];for(61<b&&(b=61);0<a--;)d.push(c[Math.floor((b+1)*Math.random())]);return d.join("")},d=d(8)+"-"+
d(4)+"-4"+d(3)+"-"+Math.floor(4*Math.random())+d(3)+"-"+d(12));this.name=d;this.xr=a;this.$q=b;this.Nr=c};n["com.babylonhx.physics.PhysicsBodyCreationOptions"]=Cf;Cf.h=["com","babylonhx","physics","PhysicsBodyCreationOptions"];Cf.prototype={l:Cf};var $b=K.BABYLON.ParticleSystem=function(a,b,c,d){this.pp=0;this.pq=this.sj=!1;this.ys=!0;this.sd=-1;this.dz=new p(0,0,0);this.cz=new p(0,0,0);this.Fx=new ca(0,0,0,0);this.bz=new ca(0,0,0,0);this.ua=new ea;this.li=0;this.Tt=[];this.Og=[];this.bs=new ca(1,
1,1,1);this.IH=new ca(0,0,0,0);this.HH=new ca(1,1,1,.4);this.GH=new ca(1,1,1,.5);this.Av=new p(.5,.5,.5);this.Cv=new p(-.5,-.5,-.5);this.Gu=new p(0,1,0);this.Fu=new p(0,1,0);this.Tn=new p(0,0,0);this.vI=!1;this.tH=$b.Zb;this.Nb=new U;this.tb=268435455;this.SJ=this.JJ=0;this.TJ=this.MJ=this.UJ=this.NJ=this.VJ=this.OJ=1;this.yb=[];this.cI=!1;this.pD=0;this.xM=.01;this.xv=-1;this.sA=10;this.Ed=null;this.ag=0;this.Ya=[];var e=this;this.id=this.name=a;this.aj=b;this.f=c;this.c=c.c;this.Nx=d;c.Ne.push(this);
a=[];for(var f=d=0;f<b;)++f,a.push(d),a.push(d+1),a.push(d+2),a.push(d),a.push(d+2),a.push(d+3),d+=4;d=this.c;f=new Kb(d.b.createBuffer());d.W.get(34963)!=f&&(d.b.bindBuffer(34963,null==f?null:f.buffer),d.W.set(34963,null==f?null:f));var g=null,h=!1;if(d.U.Ql){for(var k=0,l=a.length;k<l;)if(65535<a[k++]){h=!0;break}h?g=new Int32Array(a):g=new Int16Array(a)}else g=new Int16Array(a);d.b.bufferData(34963,g,35044);null!=d.W.get(34963)&&(d.b.bindBuffer(34963,null),d.W.set(34963,null));d.kb=null;f.ia=1;
f.Rc=h;this.wa=f;this.ha=[];a=0;for(b=44*b|0;a<b;)this.ha[a++]=0;this.G=new Tc(c.c,this.ha,!0,11);a=this.G.Bj("position",0,3);b=this.G.Bj("color",3,4);c=this.G.Bj("options",7,4);d=this.ua;null!=t.position?d.C("position",a):d.i.position=a;a=this.ua;null!=t.color?a.C("color",b):a.i.color=b;b=this.ua;null!=t.options?b.C("options",c):b.i.options=c;this.WL=function(a,b,c){var d=e.Fu.x,f=e.Gu.x,g=e.Fu.y,h=e.Gu.y,k=e.Fu.z,l=e.Gu.z,d=(d==f?d:Math.random()*(f-d)+d)*a,g=(g==h?g:Math.random()*(h-g)+g)*a;a=(k==
l?k:Math.random()*(l-k)+k)*a;c.x=d*b.a[0]+g*b.a[4]+a*b.a[8];c.y=d*b.a[1]+g*b.a[5]+a*b.a[9];c.z=d*b.a[2]+g*b.a[6]+a*b.a[10]};this.XL=function(a,b){var c=e.Cv.x,d=e.Av.x,c=c==d?c:Math.random()*(d-c)+c,d=e.Cv.y,f=e.Av.y,d=d==f?d:Math.random()*(f-d)+d,f=e.Cv.z,g=e.Av.z,f=f==g?f:Math.random()*(g-f)+f,g=c*a.a[1]+d*a.a[5]+f*a.a[9]+a.a[13],h=c*a.a[2]+d*a.a[6]+f*a.a[10]+a.a[14],k=c*a.a[3]+d*a.a[7]+f*a.a[11]+a.a[15];b.x=(c*a.a[0]+d*a.a[4]+f*a.a[8]+a.a[12])/k;b.y=g/k;b.z=h/k};this.qM=function(a){for(var b=0;b<
a.length;){var c=a[b];c.Wk+=e.si;if(c.Wk>=c.bo){var d=e.Og.pop();if(d!=c){var f=c.position,g=d.position;f.x=g.x;f.y=g.y;f.z=g.z;f=c.direction;g=d.direction;f.x=g.x;f.y=g.y;f.z=g.z;c.color.Yz(d.color);c.Mq.Yz(d.Mq);c.bo=d.bo;c.Wk=d.Wk;c.size=d.size;c.Ad=d.Ad;c.Aq=d.Aq;e.Tt.push(d)}}else c.Mq.fw(e.si,e.bz),c.color.Dz(e.bz),0>c.color.$&&(c.color.$=0),c.Ad+=c.Aq*e.si,d=c.direction,f=e.si,g=e.cz,g.x=d.x*f,g.y=d.y*f,g.z=d.z*f,d=c.position,f=e.cz,d.x+=f.x,d.y+=f.y,d.z+=f.z,d=e.Tn,f=e.si,g=e.dz,g.x=d.x*f,
g.y=d.y*f,g.z=d.z*f,c=c.direction,d=e.dz,c.x+=d.x,c.y+=d.y,c.z+=d.z,++b}};this.s=this.MF()};n["com.babylonhx.particles.ParticleSystem"]=$b;$b.h=["com","babylonhx","particles","ParticleSystem"];$b.xb=[lc,Nb,Ae];$b.prototype={start:function(){this.pq=!0;this.sj=!1;this.pp=0},stop:function(){this.sj=!0},MF:function(){if(null!=this.Nx)return this.Nx;var a=[];null!=this.f.zj&&a.push("#define CLIPPLANE");a=a.join("\n");this.Xg!=a&&(this.Xg=a,this.s=this.f.c.Aj("particles",["position","color","options"],
["invView","view","projection","vClipPlane","textureMask"],["diffuseSampler"],a));return this.s},iu:function(){if(this.pq&&null!=this.Ed&&this.s.Mc&&null!=this.Jd&&this.Jd.pa()&&this.sd!=this.f.Pa){this.sd=this.f.Pa;this.si=this.xM*this.f.fx;var a;-1<this.xv?(a=this.xv,this.xv=this.li=0):(a=this.sA*this.si|0,this.li+=(this.sA*this.si|0)-a);1<this.li&&(a+=this.li,this.li-=this.li);this.ys=!1;this.sj?a=0:(this.pp+=this.si,0!=this.pD&&this.pp>=this.pD&&this.stop());this.ys=0<this.Og.length;this.qM(this.Og);
if(null!=this.Ed.position)$b.ib=this.Ed.va();else{var b=this.Ed.x,c=this.Ed.y,d=this.Ed.z,e=new r;e.a[0]=1;e.a[1]=0;e.a[2]=0;e.a[3]=0;e.a[4]=0;e.a[5]=1;e.a[6]=0;e.a[7]=0;e.a[8]=0;e.a[9]=0;e.a[10]=1;e.a[11]=0;e.a[12]=0;e.a[13]=0;e.a[14]=0;e.a[15]=1;r.da(1,0,0,0,1,0,0,0,1,b,c,d,e);$b.ib=e}for(b=0;b<a;){++b;if(this.Og.length==this.aj)break;0!=this.Tt.length?(this.xf=this.Tt.pop(),this.xf.Wk=0):this.xf=new Ff;this.Og.push(this.xf);c=this.TJ;d=this.MJ;this.WL(c==d?c:Math.random()*(d-c)+c,$b.ib,this.xf.direction);
c=this.UJ;d=this.NJ;this.xf.bo=c==d?c:Math.random()*(d-c)+c;c=this.VJ;d=this.OJ;this.xf.size=c==d?c:Math.random()*(d-c)+c;c=this.SJ;d=this.JJ;this.xf.Aq=c==d?c:Math.random()*(d-c)+c;this.XL($b.ib,this.xf.position);ca.Dc(this.GH,this.HH,Math.random(),this.xf.color);this.IH.tw(this.xf.color,this.Fx);this.Fx.fw(1/this.xf.bo,this.xf.Mq)}this.sj&&!this.ys&&(this.pq=!1,this.cI&&(b=this.f.jn,b.data[b.length++]=this,this.yb[b.cb]=b.Ja));a=b=0;for(c=this.Og.length;a<c;)d=this.Og[a++],e=11*b++,this.ha[e]=d.position.x,
this.ha[e+1]=d.position.y,this.ha[e+2]=d.position.z,this.ha[e+3]=d.color.r,this.ha[e+4]=d.color.v,this.ha[e+5]=d.color.m,this.ha[e+6]=d.color.$,this.ha[e+7]=d.Ad,this.ha[e+8]=d.size,this.ha[e+9]=0,this.ha[e+10]=0,e=11*b++,this.ha[e]=d.position.x,this.ha[e+1]=d.position.y,this.ha[e+2]=d.position.z,this.ha[e+3]=d.color.r,this.ha[e+4]=d.color.v,this.ha[e+5]=d.color.m,this.ha[e+6]=d.color.$,this.ha[e+7]=d.Ad,this.ha[e+8]=d.size,this.ha[e+9]=1,this.ha[e+10]=0,e=11*b++,this.ha[e]=d.position.x,this.ha[e+
1]=d.position.y,this.ha[e+2]=d.position.z,this.ha[e+3]=d.color.r,this.ha[e+4]=d.color.v,this.ha[e+5]=d.color.m,this.ha[e+6]=d.color.$,this.ha[e+7]=d.Ad,this.ha[e+8]=d.size,this.ha[e+9]=1,this.ha[e+10]=1,e=11*b++,this.ha[e]=d.position.x,this.ha[e+1]=d.position.y,this.ha[e+2]=d.position.z,this.ha[e+3]=d.color.r,this.ha[e+4]=d.color.v,this.ha[e+5]=d.color.m,this.ha[e+6]=d.color.$,this.ha[e+7]=d.Ad,this.ha[e+8]=d.size,this.ha[e+9]=0,this.ha[e+10]=1;this.G.create(this.ha)}},gb:function(){if(null==this.Ed||
!this.s.Mc||null==this.Jd||!this.Jd.pa()||0==this.Og.length)return 0;var a=this.c,b=this.s,c=b.xd;a.uc!=c&&(a.b.useProgram(c),a.uc=c);a.Cf=b;null!=b.Sc&&b.Sc(b);a=this.c;0==a.H.Pf()&&a.H.Eg()==(a.Cg?1029:1028)||a.H.cg(!1);a.H.Oh(0);b=this.f.za;this.s.Hb("diffuseSampler",this.Jd);c=this.s;c.Wa("view",b)&&(a=c.c,c=c.u.get("view"),a.b.uniformMatrix4fv(c,!1,b.a));var d=this.s,a=this.f.Va;d.Wa("projection",a)&&(c=d.c,d=d.u.get("projection"),c.b.uniformMatrix4fv(d,!1,a.a));var a=this.s,c=this.bs.r,d=this.bs.v,
e=this.bs.m,f=this.bs.$;a.Oa("textureMask",c,d,e,f)&&a.c.Tb(a.u.get("textureMask"),c,d,e,f);if(null!=this.f.zj){var a=this.f.zj,c=b.a[0],d=b.a[1],e=b.a[2],f=b.a[3],g=b.a[4],h=b.a[5],k=b.a[6],l=b.a[7],m=b.a[8],p=b.a[9],n=b.a[10],v=b.a[11],z=b.a[12],D=b.a[13],w=b.a[14],A=b.a[15],b=new r;b.a[0]=c;b.a[1]=d;b.a[2]=e;b.a[3]=f;b.a[4]=g;b.a[5]=h;b.a[6]=k;b.a[7]=l;b.a[8]=m;b.a[9]=p;b.a[10]=n;b.a[11]=v;b.a[12]=z;b.a[13]=D;b.a[14]=w;b.a[15]=A;var c=b.a[0],d=b.a[1],e=b.a[2],f=b.a[3],F=b.a[4],O=b.a[5],y=b.a[6],
H=b.a[7],B=b.a[8],E=b.a[9],M=b.a[10],R=b.a[11],I=b.a[12],C=b.a[13],ba=b.a[14],N=b.a[15],g=M*N-R*ba,h=E*N-R*C,k=E*ba-M*C,l=B*N-R*I,m=B*ba-M*I,p=B*C-E*I,n=O*g-y*h+H*k,v=-(F*g-y*l+H*m),z=F*h-O*l+H*p,D=-(F*k-O*m+y*p),w=1/(c*n+d*v+e*z+f*D),A=y*N-H*ba,L=O*N-H*C,Q=O*ba-y*C,N=F*N-H*I,ba=F*ba-y*I,I=F*C-O*I,C=y*R-H*M,S=O*R-H*E,T=O*M-y*E,H=F*R-H*B,y=F*M-y*B,F=F*E-O*B;b.a[0]=n*w;b.a[4]=v*w;b.a[8]=z*w;b.a[12]=D*w;b.a[1]=-(d*g-e*h+f*k)*w;b.a[5]=(c*g-e*l+f*m)*w;b.a[9]=-(c*h-d*l+f*p)*w;b.a[13]=(c*k-d*m+e*p)*w;b.a[2]=
(d*A-e*L+f*Q)*w;b.a[6]=-(c*A-e*N+f*ba)*w;b.a[10]=(c*L-d*N+f*I)*w;b.a[14]=-(c*Q-d*ba+e*I)*w;b.a[3]=-(d*C-e*S+f*T)*w;b.a[7]=(c*C-e*H+f*y)*w;b.a[11]=-(c*S-d*H+f*F)*w;b.a[15]=(c*T-d*y+e*F)*w;d=this.s;d.Wa("invView",b)&&(c=d.c,d=d.u.get("invView"),c.b.uniformMatrix4fv(d,!1,b.a));b=this.s;c=a.j.x;d=a.j.y;e=a.j.z;a=a.d;b.Oa("vClipPlane",c,d,e,a)&&b.c.Tb(b.u.get("vClipPlane"),c,d,e,a)}a=this.c;b=this.ua;c=this.wa;d=this.s;if(a.qb!=b||a.Pb!=d)for(a.qb=b,a.Pb=d,q.sa=d.ue,e=0,f=q.sa.length;e<f;)g=e++,q.g=d.sa[g],
0<=q.g&&(g=q.sa[g],q.G=null!=t[g]?b.I(g):b.i[g],null==q.G?a.na[q.g]&&(a.b.disableVertexAttribArray(q.g),a.na[q.g]=!1):(a.na[q.g]||(a.b.enableVertexAttribArray(q.g),a.na[q.g]=!0),g=q.G.S.S,a.vertexAttribPointer(g,q.g,q.G.Db,5126,!1,4*q.G.zd,4*q.G.Cb),q.G.S.ge&&(a.U.Jc.vertexAttribDivisorANGLE(q.g,1),a.$c.push(q.g),a.rd.push(g))));null!=c&&a.kb!=c&&(a.kb=c,a.W.get(34963)!=c&&(a.b.bindBuffer(34963,null==c?null:c.buffer),a.W.set(34963,null==c?null:c)),a.Ud=c.Rc);this.tH==$b.Zb?(a=this.c,6!=a.bb&&(a.K.Za(1,
1,0,1),a.K.ya(!0),a.H.vb(!1),a.bb=6)):(a=this.c,2!=a.bb&&(a.K.Za(770,771,1,1),a.K.ya(!0),a.H.vb(!1),a.bb=2));this.vI&&this.c.H.vb(!0);this.c.Hc(!0,0,6*this.Og.length);a=this.c;0!=a.bb&&(a.K.ya(!1),a.H.vb(!0),a.bb=0);return this.Og.length},dispose:function(){null!=this.G&&(this.G.dispose(),this.G=null);if(null!=this.wa){var a=this.wa;a.ia--;0==a.ia&&this.c.b.deleteBuffer(a.buffer);this.wa=null}null!=this.Jd&&(this.Jd.dispose(),this.Jd=null);Z.remove(this.f.Ne,this);this.Nb.la(this);this.Nb.clear()},
clone:function(a,b){var c=new $b(a,this.aj,this.f);null==b&&(b=this.Ed);c.Ed=b;null!=this.Jd&&(c.Jd=new ka(this.Jd.url,this.f));c.start();return c},l:$b};var Kb=K.BABYLON.WebGLBuffer=function(a){function b(a){var b=15;null==b&&(b=61);var e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),f=[];for(61<b&&(b=61);0<a--;)f.push(e[Math.floor((b+1)*Math.random())]);return f.join("")}this.Rc=!1;this.id=b(8)+"-"+b(4)+"-4"+b(3)+"-"+Math.floor(4*Math.random())+b(3)+"-"+b(12);this.buffer=
a;this.ia=1};n["com.babylonhx.mesh.WebGLBuffer"]=Kb;Kb.h=["com","babylonhx","mesh","WebGLBuffer"];Kb.prototype={l:Kb};n["com.babylonhx.mesh.Buffer"]=Tc;Tc.h=["com","babylonhx","mesh","Buffer"];Tc.prototype={Bj:function(a,b,c,d){return new oc(this.c,this,a,this.qh,!0,null!=d?d:this.Ut,this.ge,b,c)},create:function(a){null==a&&(a=this.qg);if(null==this.S)if(this.qh){var b=this.c,c=new Kb(b.b.createBuffer());b.W.get(34962)!=c&&(b.b.bindBuffer(34962,null==c?null:c.buffer),b.W.set(34962,null==c?null:c));
b.b.bufferData(34962,new vb(a),35048);null!=b.W.get(34962)&&(b.b.bindBuffer(34962,null),b.W.set(34962,null));b.qb=null;c.ia=1;this.S=c;this.qg=a}else b=this.c,c=new Kb(b.b.createBuffer()),b.W.get(34962)!=c&&(b.b.bindBuffer(34962,null==c?null:c.buffer),b.W.set(34962,null==c?null:c)),b.b.bufferData(34962,new vb(a),35044),null!=b.W.get(34962)&&(b.b.bindBuffer(34962,null),b.W.set(34962,null)),b.qb=null,c.ia=1,this.S=c;else this.qh&&(b=this.c,c=this.S,b.W.get(34962)!=c&&(b.b.bindBuffer(34962,null==c?null:
c.buffer),b.W.set(34962,null==c?null:c)),b.b.bufferSubData(34962,0,new vb(a)),null!=b.W.get(34962)&&(b.b.bindBuffer(34962,null),b.W.set(34962,null)),b.qb=null,this.qg=a)},oM:function(a,b,c){if(null!=this.S&&this.qh){var d=this.c,e=this.S;c=null!=c?c*this.Ut:0;d.W.get(34962)!=e&&(d.b.bindBuffer(34962,null==e?null:e.buffer),d.W.set(34962,null==e?null:e));-1==c||c==a.length&&0==b?d.b.bufferSubData(34962,b,new vb(a)):d.b.bufferSubData(34962,0,new vb(a.splice(b,b+c)));null!=d.W.get(34962)&&(d.b.bindBuffer(34962,
null),d.W.set(34962,null));this.qg=d.qb=null}},dispose:function(){if(null!=this.S){var a=this.S;a.ia--;0==a.ia?(this.c.b.deleteBuffer(a.buffer),a=!0):a=!1;a&&(this.S=null)}},l:Tc};n["com.babylonhx.tools.serialization.SerializationHelper"]=cf;cf.h=["com","babylonhx","tools","serialization","SerializationHelper"];cf.ab=function(a,b,c,d){a=a();Ca.Md(a,b.Nl);for(var e=0,f=jb.Dg(a.SE);e<f.length;){var g=f[e];++e;var h=a.SE,k;if(null==h)h=null;else{var l;h.F?l=k=h.F.get_property:l=!1;h=l?h[k]():h.property}l=
null!=h.UL?h.UL:g;var m;if(null==b)l=null;else{var u;b.F?u=m=b.F["get_"+l]:u=!1;l=u?b[m]():b[l]}h=h.type;if(null!=l)switch(h){case 0:var q;a.F?h=q=a.F["set_"+g]:h=!1;if(h)a[q](l);else a[g]=l;break;case 1:var h=ka.ab(l,c,d),v;a.F?l=v=a.F["set_"+g]:l=!1;if(l)a[v](h);else a[g]=h;break;case 2:var h=new Q(l[0],l[1],l[2]),n;a.F?l=n=a.F["set_"+g]:l=!1;if(l)a[n](h);else a[g]=h;break;case 3:var h=yc.ab(l),r;a.F?l=r=a.F["set_"+g]:l=!1;if(l)a[r](h);else a[g]=h;break;case 4:var h=new W(l[0],l[1]),t;a.F?l=t=a.F["set_"+
g]:l=!1;if(l)a[t](h);else a[g]=h;break;case 5:var h=new p(l[0],l[1],l[2]),z;a.F?l=z=a.F["set_"+g]:l=!1;if(l)a[z](h);else a[g]=h}}return a};var Nc=K.BABYLON.PassPostProcess=function(a,b,c,d,e,f){null==f&&(f=!1);ga.call(this,a,"pass",null,null,b,c,d,e,f)};n["com.babylonhx.postprocess.PassPostProcess"]=Nc;Nc.h=["com","babylonhx","postprocess","PassPostProcess"];Nc.V=ga;Nc.prototype=S(ga.prototype,{l:Nc});var Gd=K.BABYLON.AnaglyphPostProcess=function(a,b,c,d,e,f){null==f&&(f=!1);var g=this;ga.call(this,
a,"anaglyph",null,["leftSampler"],b,c[1],d,e,f);this.Um=c[0].Ff;this.Le.add(function(a){var b=g.Um,c=a.c;a=a.Rd.indexOf("leftSampler");0<b.nb.length&&(b=b.nb.data[b.Zg].data,0<=a&&(a=33984+a,c.J!=a-33984&&(c.b.activeTexture(a),c.J=a-33984),c.P[c.J]!=b&&(c.b.bindTexture(3553,b),c.P[c.J]=b)))})};n["com.babylonhx.postprocess.AnaglyphPostProcess"]=Gd;Gd.h=["com","babylonhx","postprocess","AnaglyphPostProcess"];Gd.V=ga;Gd.prototype=S(ga.prototype,{l:Gd});var oc=K.BABYLON.VertexBuffer=function(a,b,c,d,
e,f,g,h,k){null==h&&(h=0);null==e&&(e=!1);if(null==f)switch(c){case "color":f=4;break;case "matricesIndices":case "matricesIndicesExtra":f=4;break;case "matricesWeights":case "matricesWeightsExtra":f=4;break;case "normal":f=3;break;case "position":f=3;break;case "uv":case "uv2":case "uv3":case "uv4":case "uv5":case "uv6":f=2}z.D(b,Tc)?(null==f&&(f=b.Ut),this.S=b,this.Df=!1):(this.S=new Tc(a,b,d,f,e,g),this.Df=!0);this.zd=f;this.Cb=h;this.Db=null!=k?k:f;this.$F=c};n["com.babylonhx.mesh.VertexBuffer"]=
oc;oc.h=["com","babylonhx","mesh","VertexBuffer"];oc.prototype={create:function(a){this.S.create(a)},l:oc};n["com.babylonhx.materials.ColorCurves"]=Aa;Aa.h=["com","babylonhx","materials","ColorCurves"];Aa.po=function(a,b){a.Rx&&(a.Rx=!1,a.cr(a.gy,a.ey,a.hy,a.fy,a.Qp),a.cr(a.ly,a.jy,a.my,a.ky,a.Sk),a.Sk.Fv(a.Qp,a.iy),a.cr(a.Dy,a.By,a.Ey,a.Cy,a.Sk),a.Sk.Fv(a.Qp,a.jj),a.cr(a.HG,a.FG,a.IG,a.GG,a.Sk),a.Sk.Fv(a.Qp,a.hz),a.iy.tw(a.jj,a.Vm),a.jj.tw(a.hz,a.Hm));var c=a.Vm.r,d=a.Vm.v,e=a.Vm.m,f=a.Vm.$;b.Oa("vCameraColorCurvePositive",
c,d,e,f)&&b.c.Tb(b.u.get("vCameraColorCurvePositive"),c,d,e,f);c=a.jj.r;d=a.jj.v;e=a.jj.m;f=a.jj.$;b.Oa("vCameraColorCurveNeutral",c,d,e,f)&&b.c.Tb(b.u.get("vCameraColorCurveNeutral"),c,d,e,f);c=a.Hm.r;d=a.Hm.v;e=a.Hm.m;f=a.Hm.$;b.Oa("vCameraColorCurveNegative",c,d,e,f)&&b.c.Tb(b.u.get("vCameraColorCurveNegative"),c,d,e,f)};Aa.GE=function(a){a.push("vCameraColorCurveNeutral");a.push("vCameraColorCurvePositive");a.push("vCameraColorCurveNegative")};Aa.vC=function(a){a/=100;var b=Math.abs(a),b=Math.pow(b,
2);0>a&&(b*=-1);return 100*b};Aa.tJ=function(a,b,c,d){var e=Aa.be(a,0,360);b=Aa.be(b/100,0,1);c=Aa.be(c/100,0,1);if(0==b)d.r=c,d.v=c,d.m=c;else{e/=60;a=Math.floor(e);var f=e-a,e=c*(1-b),g=c*(1-b*f);b=c*(1-b*(1-f));switch(a){case 0:d.r=c;d.v=b;d.m=e;break;case 1:d.r=g;d.v=c;d.m=e;break;case 2:d.r=e;d.v=c;d.m=b;break;case 3:d.r=e;d.v=g;d.m=c;break;case 4:d.r=b;d.v=e;d.m=c;break;default:d.r=c,d.v=e,d.m=g}}d.$=1};Aa.be=function(a,b,c){return Math.min(Math.max(a,b),c)};Aa.ab=function(a){return cf.ab(function(){return new Aa},
a,null,null)};Aa.prototype={cr:function(a,b,c,d,e){null!=a&&(a=Aa.be(a,0,360),b=Aa.be(b,-100,100),c=Aa.be(c,-100,100),d=Aa.be(d,-100,100),b=Aa.vC(b),b*=.5,d=Aa.vC(d),0>b&&(b*=-1,a=(a+180)%360),Aa.tJ(a,b,50+.25*d,e),e.fw(2,e),e.$=1+.01*c)},l:Aa};var pf=K.BABYLON.Effect=function(a,b,c,d,e,f,g,h,k,l){function m(){var a="",b=wb.pb,c=v+".fragment";(null!=t[c]?b.Gd(c):b.i.hasOwnProperty(c))?(b=wb.pb,c=v+".fragment",a=null!=t[c]?b.I(c):b.i[c],n.Dt(a,function(b){a=b;p(a)})):ha.Fi(r+".fragment.fx",function(b){a=
b;p(a)},null,"text")}function p(a){n.Bt(z,a,b,f,g);n.Qa=new ea;n.vz=new ea}this.Gs="";this.Mc=!1;var n=this;this.c=e;this.name=a;this.zc=f;this.SG=c.concat(d);this.Rd=d;this.ue=b;this.RF=l;this.Kh=k;this.Fr=h;c=null!=a.vertex?a.vertex:a;var v=null!=a.fragment?a.fragment:a;a="";"."==c.charAt(0)?a=c:a=q.Bb+c;var r="";"."==v.charAt(0)?r=v:r=q.Bb+v;var z="";d=wb.pb;e=c+".vertex";(null!=t[e]?d.Gd(e):d.i.hasOwnProperty(e))?(a=wb.pb,c+=".vertex",z=null!=t[c]?a.I(c):a.i[c],this.Dt(z,function(a){z=a;m()})):
ha.Fi(a+".vertex.fx",function(a){z=a;m()},null,"text")};n["com.babylonhx.materials.Effect"]=pf;pf.h=["com","babylonhx","materials","Effect"];pf.prototype={Dt:function(a,b){for(var c,d=this,e=new Mb("#include<(.+)>(\\((.*)\\))*(\\[(.*)\\])*","g"),f=e.match(a),g=a;f;){f=[e.Jg(1)];c=ee.pb;if(null!=(null!=t[f[0]]?c.I(f[0]):c.i[f[0]])){c=e.Jg(0);var h=ee.pb;a=Ga.replace(a,c,null!=t[f[0]]?h.I(f[0]):h.i[f[0]]);c=ee.pb;f=null!=t[f[0]]?c.I(f[0]):c.i[f[0]];if(null!=e.Jg(2))for(var h=e.Jg(3).split(","),k=0;k<
h.length;)c=new RegExp(h[k],"g"),f=f.replace(c,h[k+1]),k+=2;if(null!=e.Jg(4))if(c=RegExp("\\{X\\}","g"),h=e.Jg(5),-1!=h.indexOf("..")){var l=h.split(".."),k=sa.$a(l[0]),m=sa.$a(l[1]),h=Z.substr(f,0,null),f="";if(null==m||isNaN(m)){var m=this.RF,l=l[1],p;if(null==m)m=null;else{var n;m.F?n=p=m.F["get_"+l]:n=!1;m=n?m[p]():m[l]}m|=0}for(m+=1;k<m;)f+=h.replace(c,k++ +"")+"\n"}else f=f.replace(c,h);g=Ga.replace(g,e.Jg(0),f)}else{ha.Fi(q.Bb+"ShadersInclude/"+f[0]+".fx",function(c){return function(e){var f=
ee.pb;null!=t[c[0]]?f.C(c[0],e):f.i[c[0]]=e;d.Dt(a,b)}}(f));return}f=e.match(a)}b(g)},Oy:function(a){-1==a.indexOf("precision highp float")?a=this.c.U.gv?"precision highp float;\n"+a:"precision mediump float;\n"+a:this.c.U.gv||(a=Ga.replace(a,"precision highp float","precision mediump float"));return a},Bt:function(a,b,c,d,e){try{var f=this.c;a=this.Oy(a);b=this.Oy(b);for(var g=this.xd=f.aA(a,b,d),h=this.SG,k=new ea,l=0;l<h.length;){var m=h[l];++l;var p=f.b.getUniformLocation(g,m);null!=p&&(null!=
t[m]?k.C(m,p):k.i[m]=p)}this.u=k;for(var q=this.xd,g=[],h=0,n=c.length;h<n;){var r=h++;try{g.push(f.b.getAttribLocation(q,c[r]))}catch(y){y instanceof ja&&(y=y.Lo),console.log("getAttributes() -> ERROR: "+sa.Ib(y)),g.push(-1)}}this.sa=g;for(q=0;q<this.Rd.length;)null==this.u.get(this.Rd[q])&&(this.Rd.splice(q,1),--q),++q;var z=this.xd;f.uc!=z&&(f.b.useProgram(z),f.uc=z);for(var w=this.Rd,z=0,A=w.length;z<A;){var F=z++,O=this.u.get(w[F]);f.b.uniform1i(O,F)}f.Cf=null;this.Mc=!0;null!=this.Fr&&this.Fr(this)}catch(y){y instanceof
ja&&(y=y.Lo),-1!=y.indexOf("highp")?(a=Ga.replace(a,"precision highp float","precision mediump float"),b=Ga.replace(b,"precision highp float","precision mediump float"),this.Bt(a,b,c,d,e)):null!=e&&e.PA()?(d=e.reduce(d),this.Bt(a,b,c,d,e)):(console.log("Unable to compile effect: "+sa.Ib(this.name)),console.log("Defines: "+d),console.log("Error: "+sa.Ib(y)),this.Gs=y,null!=this.Kh&&this.Kh(this,this.Gs))}},Qf:function(){return""==this.Gs},Hb:function(a,b){this.c.Hb(this.Rd.indexOf(a),this.u.get(a),
b)},Wa:function(a,b){var c=!1,d=this.vz,d=null!=t[a]?d.I(a):d.i[a];null!=d&&z.D(d,r)||(c=!0,d=new r);for(var e=d.a,f=b.a,g=0;16>g;){var h=g++;e[h]!=f[h]&&(e[h]=f[h],c=!0)}e=this.vz;null!=t[a]?e.C(a,d):e.i[a]=d;return c},Jb:function(a,b,c){var d=this.Qa,d=null!=t[a]?d.I(a):d.i[a];if(null==d)return d=[b,c],b=this.Qa,null!=t[a]?b.C(a,d):b.i[a]=d,!0;a=!1;d[0]!=b&&(d[0]=b,a=!0);d[1]!=c&&(d[1]=c,a=!0);return a},ve:function(a,b,c,d){var e=this.Qa,e=null!=t[a]?e.I(a):e.i[a];if(null==e)return e=[b,c,d],b=
this.Qa,null!=t[a]?b.C(a,e):b.i[a]=e,!0;a=!1;e[0]!=b&&(e[0]=b,a=!0);e[1]!=c&&(e[1]=c,a=!0);e[2]!=d&&(e[2]=d,a=!0);return a},Oa:function(a,b,c,d,e){var f=this.Qa,f=null!=t[a]?f.I(a):f.i[a];if(null==f)return f=[b,c,d,e],b=this.Qa,null!=t[a]?b.C(a,f):b.i[a]=f,!0;a=!1;f[0]!=b&&(f[0]=b,a=!0);f[1]!=c&&(f[1]=c,a=!0);f[2]!=d&&(f[2]=d,a=!0);f[3]!=e&&(f[3]=e,a=!0);return a},l:pf,F:{Qf:"get_isSupported"}};var Je=K.BABYLON.EffectFallbacks=function(){this.Em=-1;this.sk=32;this.Lc=[]};n["com.babylonhx.materials.EffectFallbacks"]=
Je;Je.h=["com","babylonhx","materials","EffectFallbacks"];Je.prototype={Nc:function(a,b){null==this.Lc[a]&&(a<this.sk&&(this.sk=a),a>this.Em&&(this.Em=a),this.Lc[a]=[]);this.Lc[a].push(b+"\n")},cu:function(a,b){this.fG=a;this.ta=b;a>this.Em&&(this.Em=a)},reduce:function(a){for(var b=this.Lc[this.sk],c=0,d=b.length;c<d;)a=Ga.replace(a,"#define "+b[c++]+"\n","");null!=this.ta&&this.sk==this.fG&&(this.ta.lf=!1,a=Ga.replace(a,"#define NUM_BONE_INFLUENCERS "+this.ta.Ke,"#define NUM_BONE_INFLUENCERS 0"),
console.log("Falling back to CPU skinning for "+this.ta.name));this.sk++;return a},PA:function(){return this.sk<=this.Em},l:Je,F:{PA:"get_isMoreFallbacks"}};var ee=K.BABYLON.IncludesShadersStore=function(){};n["com.babylonhx.materials.IncludesShadersStore"]=ee;ee.h=["com","babylonhx","materials","IncludesShadersStore"];n["com.babylonhx.materials.MaterialDefines"]=Lc;Lc.h=["com","babylonhx","materials","MaterialDefines"];Lc.prototype={isEqual:function(a){if(this.ba.length!=a.ba.length)return!1;for(var b=
0,c=this.zc.length;b<c;){var d=b++;if(this.zc[d]!=a.zc[d])return!1}b=0;for(c=this.jc.length;b<c;)if(d=b++,this.jc[d]!=a.jc[d])return!1;b=0;for(c=this.Ri.length;b<c;)if(d=b++,this.Ri[d]!=a.Ri[d])return!1;b=0;for(c=this.wi.length;b<c;)if(d=b++,this.wi[d]!=a.wi[d])return!1;b=0;for(c=this.Ei.length;b<c;)if(d=b++,this.Ei[d]!=a.Ei[d])return!1;b=0;for(c=this.Wi.length;b<c;)if(d=b++,this.Wi[d]!=a.Wi[d])return!1;b=0;for(c=this.Qh.length;b<c;)if(d=b++,this.Qh[d]!=a.Qh[d])return!1;b=0;for(c=this.Rh.length;b<
c;)if(d=b++,this.Rh[d]!=a.Rh[d])return!1;b=0;for(c=this.Ph.length;b<c;)if(d=b++,this.Ph[d]!=a.Ph[d])return!1;return!0},Kq:function(a){if(this.ba.length!=a.ba.length)for(var b=0,c=this.ba.length;b<c;){var d=b++;a.ba[d]=this.ba[d]}b=0;for(c=this.zc.length;b<c;)d=b++,a.zc[d]=this.zc[d];a.jc=this.jc.slice();a.Ri=this.Ri.slice();a.wi=this.wi.slice();a.Ei=this.Ei.slice();a.Wi=this.Wi.slice();a.Qh=this.Qh.slice();a.Rh=this.Rh.slice();a.Ph=this.Ph.slice()},reset:function(){for(var a=0,b=this.zc.length;a<
b;)this.zc[a++]=!1;this.jc=[];this.Ri=[];this.wi=[];this.Ei=[];this.Wi=[];this.Qh=[];this.Rh=[];this.Ph=[]},toString:function(){this.Ic="";for(var a=0,b=this.zc.length;a<b;){var c=a++;1==this.zc[c]&&(this.Ic+="#define "+this.ba[c]+"\n")}a=0;for(b=this.jc.length;a<b;)this.Ic+="#define LIGHT"+a++ +"\n";a=0;for(b=this.Ri.length;a<b;)this.Ic+="#define POINTLIGHT"+a++ +"\n";a=0;for(b=this.wi.length;a<b;)this.Ic+="#define DIRLIGHT"+a++ +"\n";a=0;for(b=this.Ei.length;a<b;)this.Ic+="#define HEMILIGHT"+a++ +
"\n";a=0;for(b=this.Wi.length;a<b;)this.Ic+="#define SPOTLIGHT"+a++ +"\n";a=0;for(b=this.Qh.length;a<b;)this.Ic+="#define SHADOW"+a++ +"\n";a=0;for(b=this.Rh.length;a<b;)this.Ic+="#define SHADOWVSM"+a++ +"\n";a=0;for(b=this.Ph.length;a<b;)this.Ic+="#define SHADOWPCF"+a++ +"\n";return this.Ic},l:Lc};n["com.babylonhx.materials.MaterialHelper"]=ic;ic.h=["com","babylonhx","materials","MaterialHelper"];ic.FE=function(a,b,c,d){var e=16,f=53,g=52;null==g&&(g=-1);null==f&&(f=-1);null==e&&(e=-1);for(var h=
0,k=!1,l=!1,m=!1,p=0,q=a.jc.length;p<q;){var n=a.jc[p++];if(n.isEnabled()){if(0<n.dm.length){for(var r=0,t=n.dm.length;r<t;){var w=a.Su(n.dm[r++]);null!=w&&n.Dj.push(w)}n.dm=[]}if(0<n.km.length){r=0;for(t=n.km.length;r<t;)w=a.Su(n.km[r++]),null!=w&&n.Ij.push(w);n.km=[]}if(null==b||(0<n.Ij.length&&-1==n.Ij.indexOf(b)?0:0<n.Dj.length&&-1!=n.Dj.indexOf(b)?0:0!=n.Vn&&0==(n.Vn&b.tb)?0:0==n.Jn||0==(n.Jn&b.tb))){k=!0;c.jc[h]=!0;switch(n.cv()){case "DIRLIGHT":c.wi[h]=!0;break;case "HEMILIGHT":c.Ei[h]=!0;
break;case "POINTLIGHT":c.Ri[h]=!0;break;case "SPOTLIGHT":c.Wi[h]=!0}r=n.$r;(0!=r.r||0!=r.v||0!=r.m)&&-1<e&&(c.zc[e]=!0);if(a.Xr&&(r=n.fr(),null!=b&&b.Fj()&&null!=r)){c.Qh[h]=!0;c.zc[f]=!0;if(r.eB()||r.bB())c.Rh[h]=!0;r.dB()&&(c.Ph[h]=!0);l=!0}0!=n.pv&&(m=!0,c.wJ[h]=!0,2==n.pv&&(c.xJ[h]=!0));++h;if(h==d)break}}}a=a.c.U;l&&1==a.rD&&1==a.sD&&1==a.JP&&-1!=g&&(c.zc[g]=!0);m&&(c.rE=!0);return k};ic.IE=function(a,b,c,d){null==d&&(d=4);for(var e=0;e<d;){var f=e++;if(!c[f])break;a.push("vLightData"+f);a.push("vLightDiffuse"+
f);a.push("vLightSpecular"+f);a.push("vLightDirection"+f);a.push("vLightGround"+f);a.push("lightMatrix"+f);a.push("shadowsInfo"+f);b.push("shadowSampler"+f)}};ic.AE=function(a,b,c){null==c&&(c=4);for(var d=0;d<c;){var e=d++;a.jc[e]&&(0<e&&b.Nc(e,"LIGHT"+e),a.Qh[e]&&b.Nc(0,"SHADOW"+e),a.Ph[e]&&b.Nc(0,"SHADOWPCF"+e),a.Rh[e]&&b.Nc(0,"SHADOWVSM"+e))}};ic.EE=function(a,b){b[28]&&(a.push("world0"),a.push("world1"),a.push("world2"),a.push("world3"))};ic.dE=function(a,b,c,d,e,f){var g=a.fr();if(c.Fj()&&null!=
g){if(!z.g(a,Md).Gv())c="lightMatrix"+d,a=g.OI(),e.Wa(c,a)&&(b=e.c,c=e.u.get(c),b.b.uniformMatrix4fv(c,!1,a.a));else if(!f&&(f=!0,a=b.M.Sb,b=b.M.Fb,e.Jb("depthValues",a,b))){c=e.c;var h=e.u.get("depthValues");c.b.uniform2f(h,a,b)}e.Hb("shadowSampler"+d,g.MI());b="shadowsInfo"+d;d=g.wF;a=g.wH/g.Nk.Vu().width;g=g.JA();e.ve(b,d,a,g)&&(c=e.c,e=e.u.get(b),c.b.uniform3f(e,d,a,g))}return f};ic.fE=function(a,b,c,d,e){null==e&&(e=4);for(var f=0,g=!1,h=0,k=a.jc.length;h<k;){var l=a.jc[h++];if(l.isEnabled()&&
(null==b||(0<l.Ij.length&&-1==l.Ij.indexOf(b)?0:0<l.Dj.length&&-1!=l.Dj.indexOf(b)?0:0!=l.Vn&&0==(l.Vn&b.tb)?0:0==l.Jn||0==(l.Jn&b.tb)))){switch(l.cv()){case "DIRLIGHT":l.Xi(c,"vLightData"+f);break;case "HEMILIGHT":l.Xi(c,"vLightData"+f,"vLightGround"+f);break;case "POINTLIGHT":l.Xi(c,"vLightData"+f);break;case "SPOTLIGHT":l.Xi(c,"vLightData"+f,"vLightDirection"+f)}var m=l.Eu,p=l.qr,n=fa.Qj[0];n.r=m.r*p;n.v=m.v*p;n.m=m.m*p;var q="vLightDiffuse"+f,m=fa.Qj[0],p=l.Tv;c.Oa(q,m.r,m.v,m.m,p)&&(n=c.c,q=
c.u.get(q),n.b.uniform4f(q,m.r,m.v,m.m,p));d&&(m=l.$r,p=l.qr,n=fa.Qj[1],n.r=m.r*p,n.v=m.v*p,n.m=m.m*p,n="vLightSpecular"+f,m=fa.Qj[1],c.ve(n,m.r,m.v,m.m)&&(p=c.c,n=c.u.get(n),p.b.uniform3f(n,m.r,m.v,m.m)));a.Xr&&(g=ic.dE(l,a,b,f,c,g));++f;if(f==e)break}}};var Rc=K.BABYLON.ShaderMaterial=function(a,b,c,d){this.tx=new r;this.wz=new ea;this.xy=new ea;this.yy=new ea;this.Cm=new ea;this.nn=new ea;this.mn=new ea;this.Yg=new ea;this.am=new ea;this.em=new ea;this.hi=new ea;this.nb=new ea;va.call(this,a,b);
this.EG=c;d.Ni=null!=d.Ni&&d.Ni;d.Vf=null!=d.Vf&&d.Vf;d.attributes=null!=d.attributes?d.attributes:["position","normal","uv"];d.wb=null!=d.wb?d.wb:["worldViewProjection"];d.Yj=null!=d.Yj?d.Yj:[];d.zc=null!=d.zc?d.zc:[];this.Da=d};n["com.babylonhx.materials.ShaderMaterial"]=Rc;Rc.h=["com","babylonhx","materials","ShaderMaterial"];Rc.ab=function(a,b){return new Rc(a.name,b,a.GP,a.options)};Rc.V=va;Rc.prototype=S(va.prototype,{Ni:function(){return this.Da.Ni},Vf:function(){return this.Da.Vf},Ds:function(a,
b){return null==b?!0:!1},pa:function(a,b){null==b&&(b=!1);var c=this.f,d=c.c;if(!this.ru&&this.Pa==c.Pa&&this.Ds(c,a,b))return!0;var e=[],f=new Je;b&&e.push("#define INSTANCES");for(var g=0,h=this.Da.zc.length;g<h;)e.push(this.Da.zc[g++]);null!=a&&a.Gg()&&a.lf&&(e.push("#define NUM_BONE_INFLUENCERS "+a.Ke),e.push("#define BonesPerMesh "+(a.fd().Ge.length+1)),f.cu(0,a));d.zs&&e.push("#define ALPHATEST");g=this.s;this.s=d.Aj(this.EG,this.Da.attributes,this.Da.wb,this.Da.Yj,e.join("\n"),f,this.Fr,this.Kh);
if(!this.s.Mc)return!1;g!=this.s&&(c.Ye=null);this.Pa=c.Pa;return!0},wn:function(a){var b=this.f;if(-1!=this.Da.wb.indexOf("world")){var c=this.s;if(c.Wa("world",a)){var d=c.c,c=c.u.get("world");d.b.uniformMatrix4fv(c,!1,a.a)}}if(-1!=this.Da.wb.indexOf("worldView")){a.qa(b.za,this.tx.a,0);var e=this.s,d=this.tx;e.Wa("worldView",d)&&(c=e.c,e=e.u.get("worldView"),c.b.uniformMatrix4fv(e,!1,d.a))}-1!=this.Da.wb.indexOf("worldViewProjection")&&(d=this.s,c=b.sb,b=new r,a.qa(c,b.a,0),d.Wa("worldViewProjection",
b)&&(a=d.c,d=d.u.get("worldViewProjection"),a.b.uniformMatrix4fv(d,!1,b.a)))},bind:function(a,b){this.wn(a);if(this.f.Ye!=this){if(-1!=this.Da.wb.indexOf("view")){var c=this.s,d=this.f.za;if(c.Wa("view",d)){var e=c.c,c=c.u.get("view");e.b.uniformMatrix4fv(c,!1,d.a)}}-1!=this.Da.wb.indexOf("projection")&&(c=this.s,d=this.f.Va,c.Wa("projection",d)&&(e=c.c,c=c.u.get("projection"),e.b.uniformMatrix4fv(c,!1,d.a)));-1!=this.Da.wb.indexOf("viewProjection")&&(c=this.s,d=this.f.sb,c.Wa("viewProjection",d)&&
(e=c.c,c=c.u.get("viewProjection"),e.b.uniformMatrix4fv(c,!1,d.a)));d=this.s;null!=b&&b.Gg()&&b.lf&&(e=b.fd(),e.Oi&&null!=b.ee?e=b.ee:(null==e.De&&e.Fl(),e=e.De),null!=e&&(d.Qa.set("mBones",null),c=d.c,d=d.u.get("mBones"),c.b.uniformMatrix4fv(d,!1,e)));for(d=this.nb.keys();d.Ca();)e=d.next(),c=this.nb,this.s.Hb(e,null!=t[e]?c.I(e):c.i[e]);for(d=this.hi.keys();d.Ca();){var e=d.next(),c=this.s,f=this.hi,f=null!=t[e]?f.I(e):f.i[e],g=c.Qa.get(e);if(null==g||g[0]!=f)c.Qa.set(e,[f]),g=c.c,e=c.u.get(e),
g.b.uniform1f(e,f)}for(d=this.em.keys();d.Ca();)e=d.next(),c=this.s,f=this.em,f=null!=t[e]?f.I(e):f.i[e],c.Qa.set(e,null),g=c.c,e=c.u.get(e),g.b.uniform1fv(e,new vb(f));for(d=this.am.keys();d.Ca();)e=d.next(),c=this.s,f=this.am,f=null!=t[e]?f.I(e):f.i[e],c.ve(e,f.r,f.v,f.m)&&(g=c.c,e=c.u.get(e),g.b.uniform3f(e,f.r,f.v,f.m));for(d=this.Yg.keys();d.Ca();){var e=d.next(),c=this.Yg,h=null!=t[e]?c.I(e):c.i[e],c=this.s,f=h.r,g=h.v,k=h.m,h=h.$;c.Oa(e,f,g,k,h)&&c.c.Tb(c.u.get(e),f,g,k,h)}for(d=this.mn.keys();d.Ca();)e=
d.next(),c=this.s,f=this.mn,f=null!=t[e]?f.I(e):f.i[e],c.Jb(e,f.x,f.y)&&(g=c.c,e=c.u.get(e),g.b.uniform2f(e,f.x,f.y));for(d=this.nn.keys();d.Ca();)e=d.next(),c=this.s,f=this.nn,f=null!=t[e]?f.I(e):f.i[e],c.ve(e,f.x,f.y,f.z)&&(g=c.c,e=c.u.get(e),g.b.uniform3f(e,f.x,f.y,f.z));for(d=this.Cm.keys();d.Ca();)e=d.next(),c=this.s,f=this.Cm,f=null!=t[e]?f.I(e):f.i[e],c.Wa(e,f)&&(g=c.c,e=c.u.get(e),g.b.uniformMatrix4fv(e,!1,f.a));for(d=this.yy.keys();d.Ca();)e=d.next(),c=this.s,f=this.yy,f=null!=t[e]?f.I(e):
f.i[e],c.Qa.set(e,null),g=c.c,e=c.u.get(e),g.b.uniformMatrix3fv(e,!1,f);for(d=this.xy.keys();d.Ca();)e=d.next(),c=this.s,f=this.xy,f=null!=t[e]?f.I(e):f.i[e],c.Qa.set(e,null),g=c.c,e=c.u.get(e),g.b.uniformMatrix2fv(e,!1,f);for(d=this.wz.keys();d.Ca();)e=d.next(),c=this.s,f=this.wz,f=null!=t[e]?f.I(e):f.i[e],c.Qa.set(e,null),g=c.c,e=c.u.get(e),0==f.length%3&&g.b.uniform3fv(e,new vb(f))}va.prototype.bind.call(this,a,null)},dispose:function(a,b){null==b&&(b=!0);null==a&&(a=!1);if(b)for(var c=this.nb.keys();c.Ca();){var d=
c.next(),e=this.nb;(null!=t[d]?e.I(d):e.i[d]).dispose()}this.nb=null;va.prototype.dispose.call(this,a,b)},l:Rc});var wb=K.BABYLON.ShadersStore=function(){};n["com.babylonhx.materials.ShadersStore"]=wb;wb.h=["com","babylonhx","materials","ShadersStore"];n["com.babylonhx.materials.StandardMaterialDefines"]=Sc;Sc.h=["com","babylonhx","materials","StandardMaterialDefines"];Sc.V=Lc;Sc.prototype=S(Lc.prototype,{Kq:function(a){Lc.prototype.Kq.call(this,a);a.Yi=this.Yi;a.ci=this.ci},reset:function(){Lc.prototype.reset.call(this);
this.ci=this.Yi=0},toString:function(){var a=Lc.prototype.toString.call(this),a=a+("#define BonesPerMesh "+this.Yi+"\n");return a+="#define NUM_BONE_INFLUENCERS "+this.ci+"\n"},l:Sc});n["com.babylonhx.materials.textures.ColorGradingTexture"]=Gc;Gc.h=["com","babylonhx","materials","textures","ColorGradingTexture"];Gc.po=function(a,b){b.Hb("cameraColorGrading2DSampler",a);var c=a.level,d=a.Vu().height,e=d-1,f=1/d;b.Oa("vCameraColorGradingInfos",c,d,e,f)&&b.c.Tb(b.u.get("vCameraColorGradingInfos"),c,
d,e,f);var g=f/d,c=e*g,d=e/d,e=.5*g,f=.5*f;b.Oa("vCameraColorGradingScaleOffset",c,d,e,f)&&b.c.Tb(b.u.get("vCameraColorGradingScaleOffset"),c,d,e,f)};Gc.HE=function(a,b){a.push("vCameraColorGradingInfos");a.push("vCameraColorGradingScaleOffset");b.push("cameraColorGrading2DSampler")};Gc.V=Ub;Gc.prototype=S(Ub.prototype,{Je:function(){return this.sq},yJ:function(){var a=this,b=this.f.c.Oq(null,1,1,5,!1,!1,2);this.ga=b;ha.Fi(this.url,function(c){for(var d=null,e=[],f,g=c.split("\n"),h=c=0,k=0,l=0,m=
0,p=0,n=g.length;p<n;)if(f=g[p++],Gc.fI.match(f)&&0!=f.indexOf("#")){var v=f.split(" ");if(0==c)c=v.length,d=new hb(c*c*c*4);else if(0!=c){f=Math.max(sa.$a(v[0]),0);var r=Math.max(sa.$a(v[1]),0),v=Math.max(sa.$a(v[2]),0),m=Math.max(f,m),m=Math.max(r,m),m=Math.max(v,m),t=4*(h+l*c+k*c*c);e[t]=f;e[t+1]=r;e[t+2]=v;e[t+3]=0;++l;0==l%c&&(++k,l=0,0==k%c&&(++h,k=0))}}g=0;for(h=e.length;g<h;)k=g++,d[k]=e[k]/m*255;a.f.c.yM(b,c*c,c);e=a.f.c;c=e.Xx(5);m=b.data;e.P[e.J]!=m&&(e.b.bindTexture(3553,m),e.P[e.J]=m);
0!=b.Ka%4&&e.b.pixelStorei(3317,1);e.b.texImage2D(3553,0,c,b.Ka,b.Ua,0,c,5121,d);d=q.Ba(b.jd,b.qc);e.b.texParameteri(3553,10240,d.Ih);e.b.texParameteri(3553,10241,d.min);b.qc&&e.b.generateMipmap(3553);null!=e.P[e.J]&&(e.b.bindTexture(3553,null),e.P[e.J]=null);e.Lh();b.pa=!0});return this.ga},BJ:function(){""!=this.url&&this.url.toLowerCase().indexOf(".3dl")==this.url.length-4&&this.yJ()},Rq:function(){4==this.La&&(this.La=1,this.ga=this.Pp(this.url,!0),null==this.ga&&this.BJ())},l:Gc});var Hd=K.BABYLON.RawTexture=
function(a,b,c,d,e,f,g,h){null==h&&(h=3);null==g&&(g=!1);null==f&&(f=!0);ka.call(this,null,e,!f,g);this.format=d;this.ga=e.c.Oq(a,b,c,d,f,g,h);this.ig=this.hg=0};n["com.babylonhx.materials.textures.RawTexture"]=Hd;Hd.h=["com","babylonhx","materials","textures","RawTexture"];Hd.D=function(a,b,c,d){var e=!1,f=!1,g=2;null==g&&(g=3);null==f&&(f=!1);null==e&&(e=!0);return new Hd(a,b,c,5,d,e,f,g)};Hd.V=ka;Hd.prototype=S(ka.prototype,{l:Hd});n["com.babylonhx.materials.textures.RefractionTexture"]=ke;ke.h=
["com","babylonhx","materials","textures","RefractionTexture"];ke.V=mc;ke.prototype=S(mc.prototype,{l:ke});var Jd=K.BABYLON.VideoTexture=function(){this.jx=!0};n["com.babylonhx.materials.textures.VideoTexture"]=Jd;Jd.h=["com","babylonhx","materials","textures","VideoTexture"];Jd.V=ka;Jd.prototype=S(ka.prototype,{update:function(){this.jx&&(this.jx=!1,this.video.play());var a=1E3*((new Date).getTime()/1E3-ha.ae)|0;if(15>a-this.Yp||4!=this.video.readyState)return!1;this.Yp=a;this.f.c.ED(this.ga,this.video,
this.gt);return!0},l:Jd});var nc=K.BABYLON.WebGLTexture=function(a,b){this.yb=[];this.Cr=!0;this.url=a;this.data=b;this.rc=this.qc=!1;this.jd=3;this.Db=null;this.pk=this.nk=this.Ua=this.Ka=1;this.vx=this.ux=-1;this.Ep=this.fm=null;this.yp=-1;this.Cr=this.pa=this.oy=!1;this.ia=0};n["com.babylonhx.materials.textures.WebGLTexture"]=nc;nc.h=["com","babylonhx","materials","textures","WebGLTexture"];nc.xb=[Nb];nc.prototype={l:nc};var Gf=K.BABYLON.ProceduralTexture=function(){this.Vs=!1;this.Cm=new ea;this.nn=
new ea;this.mn=new ea;this.Yg=new ea;this.am=new ea;this.em=new ea;this.hi=new ea;this.nb=new ea;this.Rd=[];this.u=[];this.ua=new ea;this.aC=null;this.Ht=1;this.af=-1;this.isEnabled=!0};n["com.babylonhx.materials.textures.procedurals.ProceduralTexture"]=Gf;Gf.h="com babylonhx materials textures procedurals ProceduralTexture".split(" ");Gf.V=ka;Gf.prototype=S(ka.prototype,{pa:function(){var a=this,b=null;if(null==this.Ys)return!1;if(this.Vs)return!0;null!=this.Ys.Yq?b={vertex:"procedural",Yq:this.Ys.Yq}:
b={vertex:"procedural",fragment:this.Ys};this.s=this.f.c.Aj(b,["position"],this.u,this.Rd,"",null,null,function(){a.AC();null!=a.GF&&(a.ga=a.GF.ga,a.ga.ia++);a.Vs=!0});return this.s.Mc},Rn:function(){return this.Ht},ph:function(){if(!this.isEnabled||!this.pa()||null==this.ga||this.Vs)return!1;if(-1==this.af||this.Rn()==this.af)return this.af=1,!0;this.af++;return!1},gb:function(){var a=this.f,b=a.c;b.bindFramebuffer(this.ga);var c=a.clearColor;b.H.apply(b.b);b.rb.apply(b.b);b.K.apply(b.b);z.D(c,ca)?
b.b.clearColor(c.r,c.v,c.m,c.$):b.b.clearColor(c.r,c.v,c.m,1);b.b.clearDepth(1);b.b.clear(16640);var c=this.s,d=c.xd;b.uc!=d&&(b.b.useProgram(d),b.uc=d);b.Cf=c;null!=c.Sc&&c.Sc(c);0==b.H.Pf()&&b.H.Eg()==(b.Cg?1029:1028)||b.H.cg(!1);b.H.Oh(0);for(c=this.nb.keys();c.Ca();){var d=c.next(),e=this.nb;this.s.Hb(d,null!=t[d]?e.I(d):e.i[d])}for(c=this.hi.keys();c.Ca();){var d=c.next(),e=this.s,f=this.hi,f=null!=t[d]?f.I(d):f.i[d],g=e.Qa.get(d);if(null==g||g[0]!=f)e.Qa.set(d,[f]),g=e.c,d=e.u.get(d),g.b.uniform1f(d,
f)}for(c=this.em.keys();c.Ca();)d=c.next(),e=this.s,f=this.em,f=null!=t[d]?f.I(d):f.i[d],e.Qa.set(d,null),g=e.c,d=e.u.get(d),g.b.uniform1fv(d,new vb(f));for(c=this.am.keys();c.Ca();)d=c.next(),e=this.s,f=this.am,f=null!=t[d]?f.I(d):f.i[d],e.ve(d,f.r,f.v,f.m)&&(g=e.c,d=e.u.get(d),g.b.uniform3f(d,f.r,f.v,f.m));for(c=this.Yg.keys();c.Ca();){var d=c.next(),e=this.Yg,h=null!=t[d]?e.I(d):e.i[d],e=this.s,f=h.r,g=h.v,k=h.m,h=h.$;e.Oa(d,f,g,k,h)&&e.c.Tb(e.u.get(d),f,g,k,h)}for(c=this.mn.keys();c.Ca();)d=c.next(),
e=this.s,f=this.mn,f=null!=t[d]?f.I(d):f.i[d],e.Jb(d,f.x,f.y)&&(g=e.c,d=e.u.get(d),g.b.uniform2f(d,f.x,f.y));for(c=this.nn.keys();c.Ca();)d=c.next(),e=this.s,f=this.nn,f=null!=t[d]?f.I(d):f.i[d],e.ve(d,f.x,f.y,f.z)&&(g=e.c,d=e.u.get(d),g.b.uniform3f(d,f.x,f.y,f.z));for(c=this.Cm.keys();c.Ca();)d=c.next(),e=this.s,f=this.Cm,f=null!=t[d]?f.I(d):f.i[d],e.Wa(d,f)&&(g=e.c,d=e.u.get(d),g.b.uniformMatrix4fv(d,!1,f.a));c=this.ua;d=this.wa;e=this.s;if(b.qb!=c||b.Pb!=e)for(b.qb=c,b.Pb=e,q.sa=e.ue,f=0,g=q.sa.length;f<
g;)k=f++,q.g=e.sa[k],0<=q.g&&(k=q.sa[k],q.G=null!=t[k]?c.I(k):c.i[k],null==q.G?b.na[q.g]&&(b.b.disableVertexAttribArray(q.g),b.na[q.g]=!1):(b.na[q.g]||(b.b.enableVertexAttribArray(q.g),b.na[q.g]=!0),k=q.G.S.S,b.vertexAttribPointer(k,q.g,q.G.Db,5126,!1,4*q.G.zd,4*q.G.Cb),q.G.S.ge&&(b.U.Jc.vertexAttribDivisorANGLE(q.g,1),b.$c.push(q.g),b.rd.push(k))));null!=d&&b.kb!=d&&(b.kb=d,b.W.get(34963)!=d&&(b.b.bindBuffer(34963,null==d?null:d.buffer),b.W.set(34963,null==d?null:d)),b.Ud=d.Rc);if(this.rc)for(c=
0;6>c;){d=c++;b.bindFramebuffer(this.ga,d);e=this.s;f=e.Qa.get("face");if(null==f||f[0]!=d)e.Qa.set("face",[d]),f=e.c,e=e.u.get("face"),f.b.uniform1f(e,d);e=a.clearColor;b.H.apply(b.b);b.rb.apply(b.b);b.K.apply(b.b);z.D(e,ca)?b.b.clearColor(e.r,e.v,e.m,e.$):b.b.clearColor(e.r,e.v,e.m,1);b.b.clearDepth(1);b.b.clearStencil(0);b.b.clear(17664);b.Hc(!0,0,6);5==d&&b.BA(this.ga)}else b.bindFramebuffer(this.ga),a=a.clearColor,b.H.apply(b.b),b.rb.apply(b.b),b.K.apply(b.b),z.D(a,ca)?b.b.clearColor(a.r,a.v,
a.m,a.$):b.b.clearColor(a.r,a.v,a.m,1),b.b.clearDepth(1),b.b.clearStencil(0),b.b.clear(17664),b.Hc(!0,0,6);a=this.ga;b.pg=null;a.qc&&!this.rc&&(a=a.data,b.P[b.J]!=a&&(b.b.bindTexture(3553,a),b.P[b.J]=a),b.b.generateMipmap(3553),null!=b.P[b.J]&&(b.b.bindTexture(3553,null),b.P[b.J]=null));null!=b.tc&&(b.b.bindFramebuffer(36160,null),b.tc=null);null!=this.aC&&this.aC()},dispose:function(){var a=this.f.gq.indexOf(this);0<=a&&this.f.gq.splice(a,1);a=this.ua;a=null!=t.position?a.I("position"):a.i.position;
null!=a&&(a.Df&&a.S.dispose(),a=this.ua,null!=t.position?a.C("position",null):a.i.position=null);if(null!=this.wa){var a=this.f.c,b=this.wa;b.ia--;0==b.ia?(a.b.deleteBuffer(b.buffer),a=!0):a=!1}else a=!1;a&&(this.wa=null);ka.prototype.dispose.call(this)},l:Gf,F:{Rn:"get_refreshRate"}});var Db=K.BABYLON.Axis=function(){};n["com.babylonhx.math.Axis"]=Db;Db.h=["com","babylonhx","math","Axis"];n["com.babylonhx.math.ISize"]=sg;sg.h=["com","babylonhx","math","ISize"];var Ke=K.BABYLON.Path3D=function(a,
b,c){null==c&&(c=!1);this.oj=!1;this.qk=[];this.ni=[];this.xg=[];this.bm=[];this.ad=[];for(var d=0,e=a.length;d<e;){var f=d++,g=a[f];this.ad[f]=new p(g.x,g.y,g.z)}this.oj=c;this.Gx(b)};n["com.babylonhx.math.Path3D"]=Ke;Ke.h=["com","babylonhx","math","Path3D"];Ke.prototype={update:function(a,b){for(var c=0,d=a.length;c<d;){var e=c++;this.ad[e].x=a[e].x;this.ad[e].y=a[e].y;this.ad[e].z=a[e].z}this.Gx(b);return this},Gx:function(a){var b=this.ad.length;this.xg[0]=this.Vx(0);this.oj||this.xg[0].normalize();
var c=this.ad[b-1],d=this.ad[b-2];this.xg[b-1]=new p(c.x-d.x,c.y-d.y,c.z-d.z);this.oj||this.xg[b-1].normalize();c=this.xg[0];a=this.iG(this.ad[0],c,a);this.ni[0]=a;this.oj||this.ni[0].normalize();a=this.ni[0];d=new p(0,0,0);d.x=c.y*a.z-c.z*a.y;d.y=c.z*a.x-c.x*a.z;d.z=c.x*a.y-c.y*a.x;this.qk[0]=d;this.oj||this.qk[0].normalize();this.bm[0]=0;new p(0,0,0);var e;new p(0,0,0);new p(0,0,0);new p(0,0,0);for(c=1;c<b;){a=c++;d=this.NF(a);a<b-1&&(e=this.Vx(a),this.xg[a]=new p(d.x+e.x,d.y+e.y,d.z+e.z),this.xg[a].normalize());
this.bm[a]=this.bm[a-1]+Math.sqrt(d.x*d.x+d.y*d.y+d.z*d.z);d=this.xg[a];e=this.qk[a-1];var f=new p(0,0,0);f.x=e.y*d.z-e.z*d.y;f.y=e.z*d.x-e.x*d.z;f.z=e.x*d.y-e.y*d.x;this.ni[a]=f;this.oj||this.ni[a].normalize();e=this.ni[a];f=new p(0,0,0);f.x=d.y*e.z-d.z*e.y;f.y=d.z*e.x-d.x*e.z;f.z=d.x*e.y-d.y*e.x;this.qk[a]=f;this.oj||this.qk[a].normalize()}},Vx:function(a){for(var b=1,c=this.ad[a+1],d=this.ad[a],c=new p(c.x-d.x,c.y-d.y,c.z-d.z);0==Math.sqrt(c.x*c.x+c.y*c.y+c.z*c.z)&&a+b+1<this.ad.length;)++b,c=
this.ad[a+b],d=this.ad[a],c=new p(c.x-d.x,c.y-d.y,c.z-d.z);return c},NF:function(a){for(var b=1,c=this.ad[a],d=this.ad[a-1],c=new p(c.x-d.x,c.y-d.y,c.z-d.z);0==Math.sqrt(c.x*c.x+c.y*c.y+c.z*c.z)&&a>b+1;)++b,c=this.ad[a],d=this.ad[a-b],c=new p(c.x-d.x,c.y-d.y,c.z-d.z);return c},iG:function(a,b,c){new p(0,0,0);null==c?(c=new p(0,0,0),a=b.y-1,-.001<=a&&.001>=a?(a=b.x-1,-.001<=a&&.001>=a?(a=b.z-1,-.001<=a&&.001>=a||(c=new p(0,0,1))):c=new p(1,0,0)):c=new p(0,-1,0),a=new p(0,0,0),a.x=b.y*c.z-b.z*c.y,a.y=
b.z*c.x-b.x*c.z,a.z=b.x*c.y-b.y*c.x,c=a):(a=new p(0,0,0),a.x=b.y*c.z-b.z*c.y,a.y=b.z*c.x-b.x*c.z,a.z=b.x*c.y-b.y*c.x,c=a,a.x=a.y*b.z-a.z*b.y,a.y=a.z*b.x-a.x*b.z,a.z=a.x*b.y-a.y*b.x);c.normalize();return c},l:Ke};n["com.babylonhx.math.PositionNormalVertex"]=yd;yd.h=["com","babylonhx","math","PositionNormalVertex"];yd.prototype={clone:function(){var a=this.position,b=this.j;return new yd(new p(a.x,a.y,a.z),new p(b.x,b.y,b.z))},l:yd};n["com.babylonhx.math.Size"]=sb;sb.h=["com","babylonhx","math","Size"];
sb.xb=[sg];sb.Te=function(){return new sb(0,0)};sb.Zc=function(a,b,c){return new sb(a.width+(b.width-a.width)*c|0,a.height+(b.height-a.height)*c|0)};sb.prototype={add:function(a){return new sb(this.width+a.width,this.height+a.height)},ZL:function(a){return new sb(this.width-a.width,this.height-a.height)},l:sb};var de=K.BABYLON.Vector4=function(a,b,c,d){null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.x=a;this.y=b;this.z=c;this.o=d};n["com.babylonhx.math.Vector4"]=de;de.h=["com","babylonhx",
"math","Vector4"];de.prototype={l:de};n["com.babylonhx.math.Tmp"]=fa;fa.h=["com","babylonhx","math","Tmp"];var bd=K.BABYLON.Viewport=function(a,b,c,d){this.x=a;this.y=b;this.width=c;this.height=d};n["com.babylonhx.math.Viewport"]=bd;bd.h=["com","babylonhx","math","Viewport"];bd.prototype={l:bd};var fe=K.BABYLON.GroundMesh=function(a,b){aa.call(this,a,b)};n["com.babylonhx.mesh.GroundMesh"]=fe;fe.h=["com","babylonhx","mesh","GroundMesh"];fe.V=aa;fe.prototype=S(aa.prototype,{l:fe});var ce=K.BABYLON.InstancedMesh=
function(a,b){qa.call(this,a,b.f);b.Eh.push(this);this.gc=b;var c=this.position,d=b.position;c.x=d.x;c.y=d.y;c.z=d.z;c=this.Kb;d=b.Kb;c.x=d.x;c.y=d.y;c.z=d.z;c=this.Be;d=b.Be;c.x=d.x;c.y=d.y;c.z=d.z;null!=b.yd&&(c=b.yd,this.Ll(new X(c.x,c.y,c.z,c.o)));this.Ii=b.Ii;this.nj=b.nj;this.L.oo=!0;d=this.gc.ed();c=d.Gb;d=d.Mb;this.ra=new Gb(new p(c.x,c.y,c.z),new p(d.x,d.y,d.z));d=this.ra=null==this.ra?new Gb(this.qf(),this.qf()):this.ra;c=this.me();if(!d.Ak){var e=d.yc,f=e.fa;f.x=Infinity;f.y=Infinity;f.z=
Infinity;f=e.ea;f.x=-Infinity;f.y=-Infinity;f.z=-Infinity;for(var g,h,k,f=0,l=e.Ab.length;f<l;){g=f++;pa.g=e.gg[g];var m=e.Ab[g];g=pa.g;h=m.x;k=m.y;var m=m.z,n=c.a,q=h*n[1]+k*n[5]+m*n[9]+n[13],v=h*n[2]+k*n[6]+m*n[10]+n[14],r=h*n[3]+k*n[7]+m*n[11]+n[15];g.x=(h*n[0]+k*n[4]+m*n[8]+n[12])/r;g.y=q/r;g.z=v/r;g=pa.g.x;h=pa.g.y;k=pa.g.z;g<e.fa.x&&(e.fa.x=g);h<e.fa.y&&(e.fa.y=h);k<e.fa.z&&(e.fa.z=k);g>e.ea.x&&(e.ea.x=g);h>e.ea.y&&(e.ea.y=h);k>e.ea.z&&(e.ea.z=k)}f=e.ea;l=e.fa;g=e.oa;g.x=f.x+l.x;g.y=f.y+l.y;
g.z=f.z+l.z;f=e.oa;f.x*=.5;f.y*=.5;f.z*=.5;f=c.a;l=e.w[0];l.x=f[0];l.y=f[1];l.z=f[2];f=c.a;l=e.w[1];l.x=f[4];l.y=f[5];l.z=f[6];f=c.a;l=e.w[2];l.x=f[8];l.y=f[9];l.z=f[10];e.Ea=c;d=d.Oc;e=Math.max;f=Math.abs;k=d.oa;l=d.Gc;g=k.x;h=k.y;k=k.z;m=c.a;n=g*m[1]+h*m[5]+k*m[9]+m[13];q=g*m[2]+h*m[6]+k*m[10]+m[14];v=g*m[3]+h*m[7]+k*m[11]+m[15];l.x=(g*m[0]+h*m[4]+k*m[8]+m[12])/v;l.y=n/v;l.z=q/v;l=d.Eb;l.x=c.a[0]+c.a[4]+c.a[8];l.y=c.a[1]+c.a[5]+c.a[9];l.z=c.a[2]+c.a[6]+c.a[10];d.Zf=e(e(f(d.Eb.x),f(d.Eb.y)),f(d.Eb.z))*
d.R}this.Vk(this.me());this.qo();if(null!=this.gc.Ga)for(c=0,d=this.gc.Ga.length;c<d;)this.gc.Ga[c++].clone(this,this.gc)};n["com.babylonhx.mesh.InstancedMesh"]=ce;ce.h=["com","babylonhx","mesh","InstancedMesh"];ce.xb=[lc];ce.V=qa;ce.prototype=S(qa.prototype,{Fj:function(){return this.gc.Fj()},Fg:function(){return this.gc.Fg()},Ci:function(){return this.gc.Ci()},fd:function(){return this.gc.fd()},Nf:function(){return this.gc.Nf()},bv:function(){return this.gc},Aa:function(a,b){null==b&&(b=!1);return this.gc.Aa(a,
b)},eb:function(a){return this.gc.eb(a)},Ac:function(a){null==a&&(a=!1);return this.gc.Ac(a)},mr:function(){return this.gc.mh},Wm:function(){null!=this.rk&&this.rk.Wm()},ws:function(a){null!=this.rk&&this.rk.pG(this,a)},er:function(){this.rk=this.bv().er(this.f.M,this.ed().Oc);return this.rk==this.bv()?this:this.rk},gm:function(){return this.gc.gm()},clone:function(a,b,c){null==c&&(c=!1);a=this.gc.al(a);var d=this.gc.ed(),e=d.Gb,d=d.Mb;this.ra=new Gb(new p(e.x,e.y,e.z),new p(d.x,d.y,d.z));d=this.ra=
null==this.ra?new Gb(this.qf(),this.qf()):this.ra;e=this.me();if(!d.Ak){var f=d.yc,g=f.fa;g.x=Infinity;g.y=Infinity;g.z=Infinity;g=f.ea;g.x=-Infinity;g.y=-Infinity;g.z=-Infinity;for(var h,k,l,g=0,m=f.Ab.length;g<m;){h=g++;pa.g=f.gg[h];var n=f.Ab[h];h=pa.g;k=n.x;l=n.y;var n=n.z,q=e.a,v=k*q[1]+l*q[5]+n*q[9]+q[13],r=k*q[2]+l*q[6]+n*q[10]+q[14],t=k*q[3]+l*q[7]+n*q[11]+q[15];h.x=(k*q[0]+l*q[4]+n*q[8]+q[12])/t;h.y=v/t;h.z=r/t;h=pa.g.x;k=pa.g.y;l=pa.g.z;h<f.fa.x&&(f.fa.x=h);k<f.fa.y&&(f.fa.y=k);l<f.fa.z&&
(f.fa.z=l);h>f.ea.x&&(f.ea.x=h);k>f.ea.y&&(f.ea.y=k);l>f.ea.z&&(f.ea.z=l)}g=f.ea;m=f.fa;h=f.oa;h.x=g.x+m.x;h.y=g.y+m.y;h.z=g.z+m.z;g=f.oa;g.x*=.5;g.y*=.5;g.z*=.5;g=e.a;m=f.w[0];m.x=g[0];m.y=g[1];m.z=g[2];g=e.a;m=f.w[1];m.x=g[4];m.y=g[5];m.z=g[6];g=e.a;m=f.w[2];m.x=g[8];m.y=g[9];m.z=g[10];f.Ea=e;d=d.Oc;f=Math.max;g=Math.abs;l=d.oa;m=d.Gc;h=l.x;k=l.y;l=l.z;n=e.a;q=h*n[1]+k*n[5]+l*n[9]+n[13];v=h*n[2]+k*n[6]+l*n[10]+n[14];r=h*n[3]+k*n[7]+l*n[11]+n[15];m.x=(h*n[0]+k*n[4]+l*n[8]+n[12])/r;m.y=q/r;m.z=v/
r;m=d.Eb;m.x=e.a[0]+e.a[4]+e.a[8];m.y=e.a[1]+e.a[5]+e.a[9];m.z=e.a[2]+e.a[6]+e.a[10];d.Zf=f(f(g(d.Eb.x),g(d.Eb.y)),g(d.Eb.z))*d.R}this.Vk(this.me());null!=b&&a.bk(b);if(!c)for(b=0,c=this.f.Xb.length;b<c;)e=this.f.Xb[b++],e.ca==this&&e.clone(e.name,a);a.Wd(!0);return a},dispose:function(a){null==a&&(a=!1);Z.remove(this.gc.Eh,this);qa.prototype.dispose.call(this,a)},l:ce,F:S(qa.prototype.F,{bv:"get_sourceMesh"})});n["com.babylonhx.mesh.MeshBuilder"]=A;A.h=["com","babylonhx","mesh","MeshBuilder"];A.ib=
function(a){return 2==a?2:-1==a?0:a};A.uh=function(a,b,c){a=new aa(a,c);var d=O.uh(b);b.aa=A.ib(b.aa);a.Ce=b.aa;null!=c.ie&&(a.Hr={},a.Hr.size=b);d.cc(a,b.Ha);return a};A.ep=function(a,b,c){a=new aa(a,c);b.aa=A.ib(b.aa);a.Ce=b.aa;O.ep(b).cc(a,b.Ha);return a};A.ap=function(a,b,c){a=new aa(a,c);b.aa=A.ib(b.aa);a.Ce=b.aa;null==b.Ha&&(b.Ha=!1);O.ap(b).cc(a,b.Ha);return a};A.Yo=function(a,b,c){a=new aa(a,c);b.aa=A.ib(b.aa);a.Ce=b.aa;O.Yo(b).cc(a,b.Ha);return a};A.Ue=function(a,b,c){var d=b.Pg,e=b.Zk,f=
b.closePath,g=b.offset,h=b.Ha,k=A.ib(b.aa);b=b.Hg;if(null!=b){e=b.Aa("position");f=d[0].length;h=0;g=1;for(k=(2==b.Ce?2:1)+1;g<k;)for(++g,a=0,c=d.length;a<c;){var l=d[a++],m=l.length;f<m||(f=m);for(m=0;m<f;)e[h]=l[m].x,e[h+1]=l[m].y,e[h+2]=l[m].z,++m,h+=3;b.Fs&&(e[h]=l[0].x,e[h+1]=l[0].y,e[h+2]=l[0].z,h+=3)}b.Wh("position",e,!0,!1);if(!b.XE){h=b.Ac();f=b.Aa("normal");O.Nd(e,h,f);if(b.Fs)for(h=0,g=d.length;h<g;)k=h++,e=3*b.Sp[k],k=k+1<d.length?3*(b.Sp[k+1]-1):f.length-3,f[e]=.5*(f[e]+f[k]),f[e+1]=
.5*(f[e+1]+f[k+1]),f[e+2]=.5*(f[e+2]+f[k+2]),f[k]=f[e],f[k+1]=f[e+1],f[k+2]=f[e+2];b.Wh("normal",f,!0,!1)}return b}b=new aa(a,c);b.Ce=k;d=O.Ue({Pg:d,Zk:e,closePath:f,offset:g,aa:k});f&&(b.Sp=d.Sp);b.Fs=f;b.mF=e;d.cc(b,h);return b};A.zl=function(a,b,c){a=new aa(a,c);b.aa=A.ib(b.aa);a.Ce=b.aa;var d=O.zl(b);null!=c.ie&&(a.Hr={},a.Hr.height=b.height,a.Hr.Du=b.Fn>b.Gn?b.Fn:b.Gn);d.cc(a,b.Ha);return a};A.gp=function(a,b,c){a=new aa(a,c);b.aa=A.ib(b.aa);a.Ce=b.aa;O.gp(b).cc(a,b.Ha);return a};A.hp=function(a,
b,c){a=new aa(a,c);b.aa=A.ib(b.aa);a.Ce=b.aa;O.hp(b).cc(a,b.Ha);return a};A.Go=function(a,b,c){var d=b.Hg,e=b.AB;if(null!=d)return d.BD(function(a){for(var b=0,c=0,d=e.length;c<d;)for(var l=e[c++],m=0,p=l.length;m<p;){var n=m++;a[b]=l[n].x;a[b+1]=l[n].y;a[b+2]=l[n].z;b+=3}},!1),d;a=new xc(a,c);O.Go(b).cc(a,b.Ha);return a};A.bK=function(a,b,c){return A.Go(a,{AB:[b.Ir],Ha:b.Ha,Hg:b.Hg},c)};A.Xo=function(a,b,c){var d=b.Ir,e=b.Hg,f=b.hl,g=b.Cj;if(null!=e)return e.BD(function(a){var b=new p(0,0,0),c=a.length/
6,f=0,g,n,q=0,r=0,t;g=0;for(n=d.length-1;g<n;){var w=g++;t=d[w+1];w=d[w];b.x=t.x-w.x;b.y=t.y-w.y;b.z=t.z-w.z;f+=Math.sqrt(b.x*b.x+b.y*b.y+b.z*b.z)}c=f/c;for(f=e.Cj*c/(e.Cj+e.hl);r<d.length-1;){g=d[r+1];n=d[r];b.x=g.x-n.x;b.y=g.y-n.y;b.z=g.z-n.z;g=Math.floor(Math.sqrt(b.x*b.x+b.y*b.y+b.z*b.z)/c);b.normalize();for(t=0;t<g&&q<a.length;)n=c*t,a[q]=d[r].x+n*b.x,a[q+1]=d[r].y+n*b.y,a[q+2]=d[r].z+n*b.z,a[q+3]=d[r].x+(n+f)*b.x,a[q+4]=d[r].y+(n+f)*b.y,a[q+5]=d[r].z+(n+f)*b.z,q+=6,++t;++r}for(;q<a.length;)a[q]=
d[r].x,a[q+1]=d[r].y,a[q+2]=d[r].z,q+=3},!1),e;a=new xc(a,c);O.Xo(b).cc(a,b.Ha);a.Cj=g;a.hl=f;return a};A.ZK=function(a,b,c){return A.HB(a,b.shape,b.path,null!=b.scale?b.scale:1,null!=b.rotation?b.rotation:0,null,null,!1,!1,null!=b.Vd?b.Vd:0,!1,c,b.Ha,A.ib(b.aa),b.Lu)};A.bL=function(a,b,c){return A.HB(a,b.shape,b.path,null,null,null!=b.NC?b.NC:function(){return 1},null!=b.LC?b.LC:function(){return 0},null!=b.IC&&b.IC,null!=b.JC&&b.JC,null!=b.Vd?b.Vd:0,!0,c,b.Ha,A.ib(b.aa),b.Lu)};A.YJ=function(a,b,
c){var d=null!=b.arc?b.arc:1;0>=d&&(d=1);var e=null==b.closed?!0:b.closed,f=b.shape,g=null!=b.R?b.R:1,h=null!=b.Kd?b.Kd:64,k=b.Ha,l=A.ib(b.aa);b=null!=b.Vd?b.Vd:0;var m=[],d=2*Math.PI/h*d,n;[];for(var q=0,h=h+1;q<h;){var v=q++,r=[];if(1==b||3==b)r.push(new p(0,f[0].y,0)),r.push(new p(Math.cos(v*d)*f[0].x*g,f[0].y,Math.sin(v*d)*f[0].x*g));for(var t=0,w=f.length;t<w;)n=t++,n=new p(Math.cos(v*d)*f[n].x*g,f[n].y,Math.sin(v*d)*f[n].x*g),r.push(n);if(2==b||3==b)r.push(new p(Math.cos(v*d)*f[f.length-1].x*
g,f[f.length-1].y,Math.sin(v*d)*f[f.length-1].x*g)),r.push(new p(0,f[f.length-1].y,0));m.push(r)}return A.Ue(a,{Pg:m,Zk:e,aa:l,Ha:k},c)};A.bp=function(a,b,c){a=new aa(a,c);b.aa=A.ib(b.aa);a.Ce=b.aa;O.bp(b).cc(a,b.Ha);if(null!=b.Zr){a.translate(b.Zr.j,b.Zr.d);c=b.Zr.j;var d=Db.Z;c=Math.acos(c.x*d.x+c.y*d.y+c.z*d.z);d=Db.Z;b=b.Zr.j;var e=new p(0,0,0);e.x=d.y*b.z-d.z*b.y;e.y=d.z*b.x-d.x*b.z;e.z=d.x*b.y-d.y*b.x;a.rotate(e,c)}return a};A.Zo=function(a,b,c){a=new fe(a,c);a.lq(!1);a.LG=null!=b.rw?b.rw:null!=
b.Tc?b.Tc:1;a.MG=null!=b.sw?b.sw:null!=b.Tc?b.Tc:1;O.Zo(b).cc(a,b.Ha);a.lq(!0);return a};A.fp=function(a,b,c){a=new aa(a,c);O.fp(b).cc(a,b.Ha);return a};A.$o=function(a,b,c,d){var e=null!=c.width?c.width:10,f=null!=c.height?c.height:10,g=null!=c.Tc?c.Tc:1,h=c.Ha,k=c.Kv,l=new fe(a,d);l.LG=g;l.MG=g;l.Ka=e;l.Ua=f;l.dG=l.Ka/2;l.eG=l.Ua/2;l.CN=-l.dG;l.DN=-l.eG;l.lq(!1);ha.Mi(b,function(a){c.buffer=a.data;c.AH=a.width;c.yH=a.height;O.$o(c).cc(l,h);l.lq(!0);null!=k&&k(l)});return l};A.LK=function(a,b,c){function d(a,
b,c,d,e,f,g){function h(b,c){for(var d=[],e=0;e<b;)++e,d.push(a[c]);return d}var k;null==k&&(k=1);k=b.xg;var l=b.ni;b=b.bm;var m=2*Math.PI/e;f=null!=f?f:function(){return d};for(var n=[],q=0,t=new p(0,0,0),z=new p(0,0,0),A=fa.Ra[0],C=0==g||2==g?2:0,F=0,N=a.length;F<N;){for(var L=F++,q=f(L,b[L]),n=[],t=l[L],O=0;O<e;){var Q=O++;r.ip(k[L],m*Q,A);var z=null!=n[Q]?n[Q]:new p(0,0,0),T=t.x,S=t.y,aa=t.z,W=A.a,X=T*W[1]+S*W[5]+aa*W[9]+W[13],Y=T*W[2]+S*W[6]+aa*W[10]+W[14],U=T*W[3]+S*W[7]+aa*W[11]+W[15];z.x=
(T*W[0]+S*W[4]+aa*W[8]+W[12])/U;z.y=X/U;z.z=Y/U;z.x*=q;z.y*=q;z.z*=q;T=z;S=a[L];T.x+=S.x;T.y+=S.y;T.z+=S.z;n[Q]=z}c[C]=n;++C}switch(g){case 1:c.unshift(h(e+1,0));break;case 2:c.push(h(e+1,a.length-1));break;case 3:c.unshift(h(e+1,0)),c.push(h(e+1,a.length-1))}return c}var e=b.path,f=null!=b.R?b.R:1,g=null!=b.Kd?b.Kd:64,h=b.$K,k=null!=b.Vd?b.Vd:0,l=b.Ha,m=A.ib(b.aa);b=b.Hg;if(null!=b)return b=A.Ue(null,{Pg:d(e,b.Gr.update(e),b.Pg,f,b.Kd,h,b.Vd),Hg:b},c);b=new Ke(e);if(0>k||3<k)k=0;e=d(e,b,[],f,g,h,
k);a=A.Ue(a,{Pg:e,Zk:!1,closePath:!0,offset:0,Ha:l,aa:m},c);a.Pg=e;a.Gr=b;a.Kd=g;a.Vd=k;return a};A.cp=function(a,b,c){a=new aa(a,c);b.aa=A.ib(b.aa);a.Ce=b.aa;O.cp(b).cc(a,b.Ha);return a};A.QJ=function(a,b,c){function d(a,b){function c(a,e){var f=a.position,g=e.position,f=f.x*b.x+f.y*b.y+f.z*b.z-d,g=f/(f-(g.x*b.x+g.y*b.y+g.z*b.z-d));return new yd(p.D(a.position,e.position,g),p.D(a.j,e.j,g))}if(0==a.length)return a;for(var d=.5*Math.abs(h.x*b.x+h.y*b.y+h.z*b.z),e=[],f=!1,g=!1,k=!1,l=0,m=null,n=null,
q=null,r=null,u=k=g=f=0;u<a.length;){f=a[u].position;f=f.x*b.x+f.y*b.y+f.z*b.z-d;g=a[u+1].position;g=g.x*b.x+g.y*b.y+g.z*b.z-d;k=a[u+2].position;k=k.x*b.x+k.y*b.y+k.z*b.z-d;f=0<f;g=0<g;k=0<k;l=(f?1:0)+(g?1:0)+(k?1:0);switch(l){case 0:e.push(a[u]);e.push(a[u+1]);e.push(a[u+2]);break;case 1:f&&(m=a[u+1],n=a[u+2],q=c(a[u],m),r=c(a[u],n));g?(m=a[u],n=a[u+2],q=c(a[u+1],m),r=c(a[u+1],n),e.push(q),e.push(n.clone()),e.push(m.clone()),e.push(n.clone()),e.push(q.clone()),e.push(r)):(k&&(m=a[u],n=a[u+1],q=c(a[u+
2],m),r=c(a[u+2],n)),e.push(m.clone()),e.push(n.clone()),e.push(q),e.push(r),e.push(q.clone()),e.push(n.clone()));break;case 2:f||(m=a[u].clone(),n=c(m,a[u+1]),q=c(m,a[u+2]),e.push(m),e.push(n),e.push(q)),g||(m=a[u+1].clone(),n=c(m,a[u+2]),q=c(m,a[u]),e.push(m),e.push(n),e.push(q)),k||(m=a[u+2].clone(),n=c(m,a[u]),q=c(m,a[u+1]),e.push(m),e.push(n),e.push(q))}u+=3}return e}function e(a){a=A.to[a];var b=new yd;b.position=new p(A.Di[3*a],A.Di[3*a+1],A.Di[3*a+2]);var c=b.position,d=new p(0,0,0),e=c.x,
f=c.y,c=c.z,g=A.Ww.a,h=e*g[1]+f*g[5]+c*g[9]+g[13],k=e*g[2]+f*g[6]+c*g[10]+g[14],l=e*g[3]+f*g[7]+c*g[11]+g[15];d.x=(e*g[0]+f*g[4]+c*g[8]+g[12])/l;d.y=h/l;d.z=k/l;b.position=d;b.j=new p(A.zi[3*a],A.zi[3*a+1],A.zi[3*a+2]);return b}var f=null!=c.position?c.position:new p(0,0,0),g=c.j,h=null!=c.size?c.size:new p(1,1,1),k=c.Ad;A.to=b.Ac();A.Di=b.Aa("position");A.zi=b.Aa("normal");if(null==g){var l=b.f.M,m=A.hE,n=l.va(),q=new p(0,0,0),v=m.x,t=m.y,z=m.z,w=n.a,F=v*w[1]+t*w[5]+z*w[9]+w[13],O=v*w[2]+t*w[6]+
z*w[10]+w[14],S=v*w[3]+t*w[7]+z*w[11]+w[15];q.x=(v*w[0]+t*w[4]+z*w[8]+w[12])/S;q.y=F/S;q.z=O/S;A.Uw=q;var y=l.Ch(),H=A.Uw,g=new p(y.x-H.x,y.y-H.y,y.z-H.z)}var B=-Math.atan2(g.z,g.x)-Math.PI/2,E=Math.atan2(g.y,Math.sqrt(g.x*g.x+g.z*g.z)),M=new r,R=r.Ma,I=.5*k,C=.5*E,Q=.5*B,N=Math.sin(I),L=Math.cos(I),W=Math.sin(C),X=Math.cos(C),T=Math.sin(Q),Y=Math.cos(Q);R.x=Y*W*L+T*X*N;R.y=T*X*L-Y*W*N;R.z=Y*X*N-T*W*L;R.o=Y*X*L+T*W*N;r.Ma.yf(M);var U=f.x,ea=f.y,fa=f.z,Z=new r;Z.a[0]=1;Z.a[1]=0;Z.a[2]=0;Z.a[3]=0;Z.a[4]=
0;Z.a[5]=1;Z.a[6]=0;Z.a[7]=0;Z.a[8]=0;Z.a[9]=0;Z.a[10]=1;Z.a[11]=0;Z.a[12]=0;Z.a[13]=0;Z.a[14]=0;Z.a[15]=1;r.da(1,0,0,0,1,0,0,0,1,U,ea,fa,Z);var ca=new r;M.qa(Z,ca.a,0);A.zD=ca;var V=A.zD,da=new r,ha=V.a[0],ia=V.a[1],ga=V.a[2],ja=V.a[3],ka=V.a[4],J=V.a[5],P=V.a[6],la=V.a[7],ma=V.a[8],oa=V.a[9],na=V.a[10],pa=V.a[11],qa=V.a[12],ra=V.a[13],Fb=V.a[14],zb=V.a[15],sa=na*zb-pa*Fb,ta=oa*zb-pa*ra,Vb=oa*Fb-na*ra,va=ma*zb-pa*qa,Ha=ma*Fb-na*qa,xa=ma*ra-oa*qa,Ba=J*sa-P*ta+la*Vb,Fa=-(ka*sa-P*va+la*Ha),rc=ka*ta-
J*va+la*xa,Aa=-(ka*Vb-J*Ha+P*xa),Za=1/(ha*Ba+ia*Fa+ga*rc+ja*Aa),Ga=P*zb-la*Fb,Ca=J*zb-la*ra,Ia=J*Fb-P*ra,Ja=ka*zb-la*qa,wa=ka*Fb-P*qa,Oa=ka*ra-J*qa,za=P*pa-la*na,Ma=J*pa-la*oa,Qa=J*na-P*oa,ya=ka*pa-la*ma,eb=ka*na-P*ma,Ra=ka*oa-J*ma;da.a[0]=Ba*Za;da.a[4]=Fa*Za;da.a[8]=rc*Za;da.a[12]=Aa*Za;da.a[1]=-(ia*sa-ga*ta+ja*Vb)*Za;da.a[5]=(ha*sa-ga*va+ja*Ha)*Za;da.a[9]=-(ha*ta-ia*va+ja*xa)*Za;da.a[13]=(ha*Vb-ia*Ha+ga*xa)*Za;da.a[2]=(ia*Ga-ga*Ca+ja*Ia)*Za;da.a[6]=-(ha*Ga-ga*Ja+ja*wa)*Za;da.a[10]=(ha*Ca-ia*Ja+
ja*Oa)*Za;da.a[14]=-(ha*Ia-ia*wa+ga*Oa)*Za;da.a[3]=-(ia*za-ga*Ma+ja*Qa)*Za;da.a[7]=(ha*za-ga*ya+ja*eb)*Za;da.a[11]=-(ha*Ma-ia*ya+ja*Ra)*Za;da.a[15]=(ha*Qa-ia*eb+ga*Ra)*Za;A.TD=da;A.Vw=b.va();var bb=A.Vw,Wa=A.TD,hb=new r;bb.qa(Wa,hb.a,0);A.Ww=hb;A.Zb.ob=[];A.Zb.Na=[];A.Zb.fb=[];A.Zb.zb=[];for(var Ua=0,Va=[],Ea=0;Ea<A.to.length;){Va=[];Va.push(e(Ea));Va.push(e(Ea+1));Va.push(e(Ea+2));Va=d(Va,new p(1,0,0));Va=d(Va,new p(-1,0,0));Va=d(Va,new p(0,1,0));Va=d(Va,new p(0,-1,0));Va=d(Va,new p(0,0,1));Va=d(Va,
new p(0,0,-1));if(0!=Va.length){var mb=new r,Da=r.Ma,db=.5*k,jb=.5*E,lb=.5*B,cb=Math.sin(db),Xa=Math.cos(db),ub=Math.sin(jb),ab=Math.cos(jb),gb=Math.sin(lb),Sa=Math.cos(lb);Da.x=Sa*ub*Xa+gb*ab*cb;Da.y=gb*ab*Xa-Sa*ub*cb;Da.z=Sa*ab*cb-gb*ub*Xa;Da.o=Sa*ab*Xa+gb*ub*cb;r.Ma.yf(mb);for(var Ka=null,Ab=0,sb=Va.length;Ab<sb;){Ka=Va[Ab++];A.Zb.ob.push(Ua);var La=Ka.position,nb=A.Zb.Na,Ta=3*Ua;nb[Ta]=La.x;nb[Ta+1]=La.y;nb[Ta+2]=La.z;var tb=Ka.j,qb=A.Zb.fb,rb=3*Ua;qb[rb]=tb.x;qb[rb+1]=tb.y;qb[rb+2]=tb.z;A.Zb.zb.push(.5+
Ka.position.x/h.x);A.Zb.zb.push(.5+Ka.position.y/h.y);++Ua}}Ea+=3}var ib=new aa(a,b.f);A.Zb.cc(ib);ib.position=new p(f.x,f.y,f.z);ib.Kb=new p(E,B,k);return ib};A.HB=function(a,b,c,d,e,f,g,h,k,l,m,n,q,v,t){function z(a,b,c,d,e,f,g,h,k,l){function m(a){for(var b=[],c=new p(0,0,0),d=0,e=a.length;d<e;){var f=a[d++];c.x+=f.x;c.y+=f.y;c.z+=f.z}d=1/a.length;c.x*=d;c.y*=d;c.z*=d;d=0;for(a=a.length;d<a;)++d,b.push(c);return b}null==l&&(l=!1);l=c.xg;var n=c.ni,q=c.qk;c=c.bm;var u=0;h=null!=h?h:function(){return f};
g=null!=g?g:function(){return e};for(var v=0==k||2==k?0:2,t=fa.Ra[0],x=0,G=b.length;x<G;){for(var D=x++,Q=[],W=h(D,c[D]),X=g(D,c[D]),aa=0,Y=a.length;aa<Y;){var Z=aa++;r.ip(l[D],u,t);var U=l[D],V=a[Z].z;L=U.x*V;N=U.y*V;S=U.z*V;U=n[D];V=a[Z].x;C=U.x*V;I=U.y*V;R=U.z*V;M=L+C;E=N+I;B=S+R;U=q[D];V=a[Z].y;H=U.x*V;y=U.y*V;O=U.z*V;F=M+H;A=E+y;w=B+O;var U=null!=Q[Z]?Q[Z]:new p(0,0,0),V=F,da=A,ea=w,ca=t.a,ha=V*ca[1]+da*ca[5]+ea*ca[9]+ca[13],ia=V*ca[2]+da*ca[6]+ea*ca[10]+ca[14],ga=V*ca[3]+da*ca[7]+ea*ca[11]+
ca[15];U.x=(V*ca[0]+da*ca[4]+ea*ca[8]+ca[12])/ga;U.y=ha/ga;U.z=ia/ga;U.x*=X;U.y*=X;U.z*=X;V=U;da=b[D];V.x+=da.x;V.y+=da.y;V.z+=da.z;Q[Z]=U}d[v]=Q;u+=W;++v}switch(k){case 1:d[0]=m(d[2]);d[1]=d[2].slice(0);break;case 2:d[v]=d[v-1];d[v+1]=m(d[v-1]);break;case 3:d[0]=m(d[2]),d[1]=d[2].slice(0),d[v]=d[v-1],d[v+1]=m(d[v-1])}return d}var w,A,F,O,y,H,B,E,M,R,I,C,S,N,L;if(null!=t)return t.Gr.update(c),t=aa.Ma(null,z(b,c,t.Gr,t.Pg,d,e,f,g,t.Vd,m),!1,!1,n,!1,0,t);t=new Ke(c);if(0>l||3<l)l=0;b=z(b,c,t,[],d,e,
f,g,l,m);a=aa.Ma(a,b,h,k,n,q,v);a.Pg=b;a.Gr=t;a.Vd=l;return a};var Df=K.BABYLON.MeshLODLevel=function(a,b){this.Rb=a;this.Yc=b};n["com.babylonhx.mesh.MeshLODLevel"]=Df;Df.h=["com","babylonhx","mesh","MeshLODLevel"];Df.prototype={l:Df};var Bf=K.BABYLON._InstancesBatch=function(){this.Lr=[];this.Ld=[];this.Br=!1};n["com.babylonhx.mesh._InstancesBatch"]=Bf;Bf.h=["com","babylonhx","mesh","_InstancesBatch"];Bf.prototype={l:Bf};var Ef=K.BABYLON._VisibleInstances=function(a,b){this.eA=this.kB=0;this.map=
new Wa;this.eA=a;this.zL=b};n["com.babylonhx.mesh._VisibleInstances"]=Ef;Ef.h=["com","babylonhx","mesh","_VisibleInstances"];Ef.prototype={l:Ef};var sc=K.BABYLON.CSG=function(){this.Oe=[]};n["com.babylonhx.mesh.csg.CSG"]=sc;sc.h=["com","babylonhx","mesh","csg","CSG"];sc.Qz=function(a){var b,c,d,e,f=[],g,h,k,l;if(z.D(a,aa))a.Wd(!0),g=a.va(),h=a.position,h=new p(h.x,h.y,h.z),k=a.Kb,k=new p(k.x,k.y,k.z),l=a.Be,l=new p(l.x,l.y,l.z);else throw new ja("CSG:Wrong Mesh type, must be Mesh");var m=a.Ac(),n=
a.Aa("position"),q=a.Aa("normal"),r=a.Aa("uv");a=a.Ga;for(var t=0,A=a.length;t<A;)for(var w=t++,F=a[w].Wb,O=a[w].Xd+a[w].Wb;F<O;){e=[];for(var S=0;3>S;){d=S++;b=new p(q[3*m[F+d]],q[3*m[F+d]+1],q[3*m[F+d]+2]);c=new W(r[2*m[F+d]],r[2*m[F+d]+1]);d=new p(n[3*m[F+d]],n[3*m[F+d]+1],n[3*m[F+d]+2]);var y=d.x,H=d.y,B=d.z,E=g.a,M=y*E[1]+H*E[5]+B*E[9]+E[13],R=y*E[2]+H*E[6]+B*E[10]+E[14],I=y*E[3]+H*E[7]+B*E[11]+E[15];d.x=(y*E[0]+H*E[4]+B*E[8]+E[12])/I;d.y=M/I;d.z=R/I;b.x=b.x*g.a[0]+b.y*g.a[4]+b.z*g.a[8];b.y=
b.x*g.a[1]+b.y*g.a[5]+b.z*g.a[9];b.z=b.x*g.a[2]+b.y*g.a[6]+b.z*g.a[10];b=new Pd(d,b,c);e.push(b)}e=new xd(e,{Sg:w,Jh:sc.qD,uf:a[w].uf});null!=e.qe&&f.push(e);F+=3}f=sc.uE(f);f.Ra=g;f.position=h;f.rotation=k;f.Il=l;sc.qD++;return f};sc.uE=function(a){var b=new sc;b.Oe=a;return b};sc.prototype={$L:function(a){var b=new Ac(this.Oe);a=new Ac(a.Oe);b.wl();b.zn(a);a.zn(b);a.wl();a.zn(b);a.wl();b.Gq(a.xq());b.wl();this.Oe=b.xq()},BH:function(a,b,c){var d=this.Ra,e=d.a[0],f=d.a[1],g=d.a[2],h=d.a[3],k=d.a[4],
l=d.a[5],m=d.a[6],n=d.a[7],q=d.a[8],v=d.a[9],z=d.a[10],A=d.a[11],w=d.a[12],F=d.a[13],O=d.a[14],S=d.a[15],y=new r;y.a[0]=e;y.a[1]=f;y.a[2]=g;y.a[3]=h;y.a[4]=k;y.a[5]=l;y.a[6]=m;y.a[7]=n;y.a[8]=q;y.a[9]=v;y.a[10]=z;y.a[11]=A;y.a[12]=w;y.a[13]=F;y.a[14]=O;y.a[15]=S;var H=y.a[0],B=y.a[1],E=y.a[2],M=y.a[3],R=y.a[4],I=y.a[5],C=y.a[6],Q=y.a[7],N=y.a[8],L=y.a[9],U=y.a[10],V=y.a[11],T=y.a[12],X=y.a[13],Y=y.a[14],Z=y.a[15],ca=U*Z-V*Y,da=L*Z-V*X,fa=L*Y-U*X,ga=N*Z-V*T,ha=N*Y-U*T,ia=N*X-L*T,ja=I*ca-C*da+Q*fa,
ka=-(R*ca-C*ga+Q*ha),la=R*da-I*ga+Q*ia,ma=-(R*fa-I*ha+C*ia),J=1/(H*ja+B*ka+E*la+M*ma),P=C*Z-Q*Y,oa=I*Z-Q*X,pa=I*Y-C*X,qa=R*Z-Q*T,na=R*Y-C*T,ra=R*X-I*T,sa=C*V-Q*U,ta=I*V-Q*L,va=I*U-C*L,xa=R*V-Q*N,Ba=R*U-C*N,Fa=R*L-I*N;y.a[0]=ja*J;y.a[4]=ka*J;y.a[8]=la*J;y.a[12]=ma*J;y.a[1]=-(B*ca-E*da+M*fa)*J;y.a[5]=(H*ca-E*ga+M*ha)*J;y.a[9]=-(H*da-B*ga+M*ia)*J;y.a[13]=(H*fa-B*ha+E*ia)*J;y.a[2]=(B*P-E*oa+M*pa)*J;y.a[6]=-(H*P-E*qa+M*na)*J;y.a[10]=(H*oa-B*qa+M*ra)*J;y.a[14]=-(H*pa-B*na+E*ra)*J;y.a[3]=-(B*sa-E*ta+M*va)*
J;y.a[7]=(H*sa-E*xa+M*Ba)*J;y.a[11]=-(H*ta-B*xa+M*Fa)*J;y.a[15]=(H*va-B*Ba+E*Fa)*J;var Aa=new aa(a,b),Ga=[],Ha=[],Ca=[],Ia=[],Ja=new p(0,0,0),wa=new p(0,0,0),Ma=new W(0,0),Za=this.Oe,Qa=[0,0,0],ya,Ra=new ea,Ea=-1111,Ua=0,Oa=new ea,za;c&&Za.sort(function(a,b){return a.ld.Jh==b.ld.Jh?a.ld.Sg-b.ld.Sg|0:a.ld.Jh-b.ld.Jh|0});for(var bb=0,hb=Za.length;bb<hb;){ya=Za[bb++];var Wa=ya.ld.Jh;if(null!=t[Wa]?!Oa.Gd(Wa):!Oa.i.hasOwnProperty(Wa)){var eb=ya.ld.Jh,cb=new ea;null!=t[eb]?Oa.C(eb,cb):Oa.i[eb]=cb}var Xa=
ya.ld.Jh,ab=ya.ld.Sg,gb=null!=t[Xa]?Oa.I(Xa):Oa.i[Xa];if(null!=t[ab]?!gb.Gd(ab):!gb.i.hasOwnProperty(ab)){var db=ya.ld.Jh,Va=ya.ld.Sg,jb={Wb:Infinity,iv:-Infinity,uf:ya.ld.uf},lb=null!=t[db]?Oa.I(db):Oa.i[db];null!=t[Va]?lb.C(Va,jb):lb.i[Va]=jb}var Da=ya.ld.Jh,ib=ya.ld.Sg,mb=null!=t[Da]?Oa.I(Da):Oa.i[Da];za=null!=t[ib]?mb.I(ib):mb.i[ib];for(var nb=2,tb=ya.ja.length;nb<tb;){var qb=nb++;Qa[0]=0;Qa[1]=qb-1;Qa[2]=qb;for(var rb=0;3>rb;){var sb=rb++,Cb=ya.ja[Qa[sb]].Wf;Ja.x=Cb.x;Ja.y=Cb.y;Ja.z=Cb.z;var Sa=
ya.ja[Qa[sb]].j;wa.x=Sa.x;wa.y=Sa.y;wa.z=Sa.z;var Ka=ya.ja[Qa[sb]].hs;Ma.x=Ka.x;Ma.y=Ka.y;var Ab=new p(0,0,0),xb=Ja.x,La=Ja.y,yb=Ja.z,Ta=y.a,Lb=xb*Ta[1]+La*Ta[5]+yb*Ta[9]+Ta[13],Mb=xb*Ta[2]+La*Ta[6]+yb*Ta[10]+Ta[14],Db=xb*Ta[3]+La*Ta[7]+yb*Ta[11]+Ta[15];Ab.x=(xb*Ta[0]+La*Ta[4]+yb*Ta[8]+Ta[12])/Db;Ab.y=Lb/Db;Ab.z=Mb/Db;var vb=new p(0,0,0);vb.x=wa.x*y.a[0]+wa.y*y.a[4]+wa.z*y.a[8];vb.y=wa.x*y.a[1]+wa.y*y.a[5]+wa.z*y.a[9];vb.z=wa.x*y.a[2]+wa.y*y.a[6]+wa.z*y.a[10];var Eb=Ab.x+","+Ab.y+","+Ab.z,Ea=null!=
t[Eb]?Ra.I(Eb):Ra.i[Eb];if(-1111==Ea||Ca[3*Ea]!=vb.x||Ca[3*Ea+1]!=vb.y||Ca[3*Ea+2]!=vb.z||Ia[2*Ea]!=Ma.x||Ia[2*Ea+1]!=Ma.y){Ga.push(Ab.x);Ga.push(Ab.y);Ga.push(Ab.z);Ia.push(Ma.x);Ia.push(Ma.y);Ca.push(wa.x);Ca.push(wa.y);Ca.push(wa.z);var Ea=(Ga.length/3|0)-1,Gb=Ab.x+","+Ab.y+","+Ab.z;null!=t[Gb]?Ra.C(Gb,Ea):Ra.i[Gb]=Ea}Ha.push(Ea);za.Wb=Math.min(Ua,za.Wb);za.iv=Math.max(Ua,za.iv);++Ua}}}Aa.Fa("position",Ga);Aa.Fa("normal",Ca);Aa.Fa("uv",Ia);Aa.Zj(Ha);if(c){var Kb=0,Bb;Aa.Ga=[];for(var ob=Oa.keys();ob.Ca();){var wb=
ob.next();Bb=-1;for(var fb=(null!=t[wb]?Oa.I(wb):Oa.i[wb]).keys();fb.Ca();){var Ib=fb.next(),Nb=null!=t[wb]?Oa.I(wb):Oa.i[wb];za=null!=t[Ib]?Nb.I(Ib):Nb.i[Ib];ub.g(za.uf+Kb,za.Wb,za.iv-za.Wb+1|0,Aa);Bb=Math.max(za.uf,Bb)|0}Kb+=++Bb}}return Aa},hM:function(a,b,c,d){null==d&&(d=!1);a=this.BH(a,c,d);a.kd(b);b=a.position;c=this.position;b.x=c.x;b.y=c.y;b.z=c.z;b=a.Kb;c=this.rotation;b.x=c.x;b.y=c.y;b.z=c.z;b=a.Be;c=this.Il;b.x=c.x;b.y=c.y;b.z=c.z;a.Wd(!0);return a},l:sc};n["com.babylonhx.mesh.csg.Node"]=
Ac;Ac.h=["com","babylonhx","mesh","csg","Node"];Ac.prototype={wl:function(){for(var a=0,b=this.Oe.length;a<b;)this.Oe[a++].gl();null!=this.qe&&this.qe.gl();null!=this.Ie&&this.Ie.wl();null!=this.back&&this.back.wl();a=this.Ie;this.Ie=this.back;this.back=a},su:function(a){if(null==this.qe)return a.slice(0);for(var b=[],c=[],d=0,e=a.length;d<e;)this.qe.kD(a[d++],b,c,b,c);null!=this.Ie&&(b=this.Ie.su(b));null!=this.back?c=this.back.su(c):c=[];return b.concat(c)},zn:function(a){this.Oe=a.su(this.Oe);
null!=this.Ie&&this.Ie.zn(a);null!=this.back&&this.back.zn(a)},xq:function(){var a=this.Oe.slice(0);null!=this.Ie&&(a=a.concat(this.Ie.xq()));null!=this.back&&(a=a.concat(this.back.xq()));return a},Gq:function(a){if(null!=a&&0!=a.length){null==this.qe&&(this.qe=a[0].qe.clone());for(var b=[],c=[],d=0,e=a.length;d<e;)this.qe.kD(a[d++],this.Oe,this.Oe,b,c);0<b.length&&(null==this.Ie&&(this.Ie=new Ac),this.Ie.Gq(b));0<c.length&&(null==this.back&&(this.back=new Ac),this.back.Gq(c))}},l:Ac};n["com.babylonhx.mesh.csg.Plane"]=
uc;uc.h=["com","babylonhx","mesh","csg","Plane"];uc.Ag=function(a,b,c){var d=c.x-a.x,e=c.y-a.y;c=c.z-a.z;var f=b.x-a.x,g=b.y-a.y,h=b.z-a.z;if(0==d*d+e*e+c*c||0==f*f+g*g+h*h)return null;b=new p(0,0,0);b.x=e*h-c*g;b.y=c*f-d*h;b.z=d*g-e*f;d=new p(0,0,0);d.x=b.x;d.y=b.y;d.z=b.z;d.normalize();return new uc(d,d.x*a.x+d.y*a.y+d.z*a.z)};uc.prototype={clone:function(){var a=this.j;return new uc(new p(a.x,a.y,a.z),this.o)},gl:function(){var a=this.j;a.x*=-1;a.y*=-1;a.z*=-1;this.o=-this.o},kD:function(a,b,c,
d,e){for(var f=0,g=[],h=0,k=a.ja.length;h<k;){var l=this.j,m=a.ja[h++].Wf,l=l.x*m.x+l.y*m.y+l.z*m.z-this.o,l=l<-uc.ce?2:l>uc.ce?1:0,f=f|l;g.push(l)}switch(f){case 0:e=this.j;d=a.qe.j;(0<e.x*d.x+e.y*d.y+e.z*d.z?b:c).push(a);break;case 1:d.push(a);break;case 2:e.push(a);break;case 3:c=[];b=[];f=0;for(h=a.ja.length;f<h;){var k=f++,l=(k+1)%a.ja.length,m=g[k],n=g[l],k=a.ja[k],l=a.ja[l];2!=m&&c.push(k);1!=m&&b.push(2!=m?k.clone():k);if(3==(m|n)){var m=this.j,n=k.Wf,p=this.j,q=l.Wf,r=k.Wf,k=k.gJ(l,(this.o-
(m.x*n.x+m.y*n.y+m.z*n.z))/(p.x*(q.x-r.x)+p.y*(q.y-r.y)+p.z*(q.z-r.z)));c.push(k);b.push(k.clone())}}3<=c.length&&(g=new xd(c,a.ld),null!=g.qe&&d.push(g));3<=b.length&&(a=new xd(b,a.ld),null!=a.qe&&e.push(a))}},l:uc};n["com.babylonhx.mesh.csg.Polygon"]=xd;xd.h=["com","babylonhx","mesh","csg","Polygon"];xd.prototype={gl:function(){this.ja.reverse();this.ja.map(function(a){a.gl()});this.qe.gl()},l:xd};n["com.babylonhx.mesh.csg.Vertex"]=Pd;Pd.h=["com","babylonhx","mesh","csg","Vertex"];Pd.prototype=
{clone:function(){var a=this.Wf,b=this.j,c=this.hs;return new Pd(new p(a.x,a.y,a.z),new p(b.x,b.y,b.z),new W(c.x,c.y))},gl:function(){var a=this.j;this.j=new p(-1*a.x,-1*a.y,-1*a.z)},gJ:function(a,b){var c=p.D(this.Wf,a.Wf,b),d=p.D(this.j,a.j,b),e=this.hs,f=a.hs;return new Pd(c,d,new W(e.x+(f.x-e.x)*b,e.y+(f.y-e.y)*b))},l:Pd};var Hf=K.BABYLON.DecimationTriangle=function(a){this.error=[];this.lv=this.cl=!1;this.xn=0;this.ja=a;this.gA=!1};n["com.babylonhx.mesh.simplification.DecimationTriangle"]=Hf;
Hf.h=["com","babylonhx","mesh","simplification","DecimationTriangle"];Hf.prototype={l:Hf};var If=K.BABYLON.DecimationVertex=function(a,b){this.id=b;this.position=a;this.Xn=!0;this.q=new qd;this.Uh=this.se=0;this.Lv=[]};n["com.babylonhx.mesh.simplification.DecimationVertex"]=If;If.h=["com","babylonhx","mesh","simplification","DecimationVertex"];If.prototype={uM:function(a){var b=this.position;b.x=a.x;b.y=a.y;b.z=a.z},l:If};var ig=K.BABYLON.ISimplificationSettings=function(){};n["com.babylonhx.mesh.simplification.ISimplificationSettings"]=
ig;ig.h=["com","babylonhx","mesh","simplification","ISimplificationSettings"];ig.prototype={l:ig};var Jf=K.BABYLON.ISimplifier=function(){};n["com.babylonhx.mesh.simplification.ISimplifier"]=Jf;Jf.h=["com","babylonhx","mesh","simplification","ISimplifier"];Jf.prototype={l:Jf};var Le=K.BABYLON.QuadraticErrorSimplification=function(){this.Fo=5E3;this.dJ=!1;this.iH=7;this.ZH=100};n["com.babylonhx.mesh.simplification.QuadraticErrorSimplification"]=Le;Le.h=["com","babylonhx","mesh","simplification","QuadraticErrorSimplification"];
Le.xb=[Jf];Le.prototype={hD:function(a,b){var c=this;this.bJ();Ea.$a(this.ta.Ga.length,function(b){c.cJ(b.index,function(){c.wL(a,b.index,function(){b.zh()})})},function(){ha.xh(function(){b(c.wc)},0)})},wL:function(a,b,c){function d(a,b){ha.xh(function(){0==a%5&&e.tM(0==a);for(var c=0,d=e.Ob.length;c<d;)e.Ob[c++].lv=!1;var n=1E-9*Math.pow(a+3,e.iH);Ea.Ta(e.Ob.length,e.Fo,function(a){var b=e.Ob[(e.Ob.length/2+a)%e.Ob.length|0];if(null!=b&&!(b.error[3]>n||b.cl||b.lv))for(var c=0;3>c;){var d=c++;if(b.error[d]<
n){var f=[],h=[];a=b.ja[d];d=b.ja[(d+1)%3];if(a.Xn==d.Xn){var k=new p(0,0,0);e.yn(a,d,k,new p(0,0,0),new W(0,0),new ca(0,0,0,1));var l=[];if(!(e.pB(a,d,k,f,b.xn,l)||e.pB(d,a,k,h,b.xn,l)||0>f.indexOf(!0)||0>h.indexOf(!0))){for(var m=[],q=0;q<l.length;){var r=l[q];++q;-1==m.indexOf(r)&&(r.gA=!0,m.push(r))}if(0==m.length%2){a.q=d.q.add(a.q);a.uM(k);b=e.ia.length;g=e.DD(a,a,f,g);g=e.DD(a,d,h,g);f=e.ia.length-b;if(f<=a.se){if(0<f)for(h=0;h<f;)c=h++,e.ia[a.Uh+c]=e.ia[b+c]}else a.Uh=b;a.se=f;break}}}}}},
b,function(){return h-g<=f})},0)}var e=this,f=this.Ob.length*a.wC|0,g=0,h=this.Ob.length;Ea.$a(this.ZH,function(a){h-g<=f?a.Fq():d(a.index,F(a,a.zh))},function(){ha.xh(function(){e.cL(b);c()},0)})},cJ:function(a,b,c){null==c&&(c=!1);var d=this;this.ja=[];this.Ob=[];var e=this.ta.Aa("position"),f=this.ta.Ac(),g=this.ta.Ga[a],h=[];Ea.Ta(g.Tg,this.Fo/4|0,function(a){a+=g.te;var b=3*a,b=new p(e[b],e[b+1],e[b+2]),f;a:{if(c){f=0;for(var n=d.ja.length;f<n;){var q=f++,r=d.ja[q].position;if(null!=b&&r.x==
b.x&&r.y==b.y&&r.z==b.z){f=d.ja[q];break a}}}f=null}null==f&&(f=new If(b,d.ja.length));f.Lv.push(a);f.id==d.ja.length&&d.ja.push(f);h.push(f.id)},function(){Ea.Ta(f.length/3|0,d.Fo,function(a){a=3*(g.Wb/3+a)|0;var b=new Hf([d.ja[h[f[a]-g.te]],d.ja[h[f[a+1]-g.te]],d.ja[h[f[a+2]-g.te]]]);b.EK=a;d.Ob.push(b)},function(){d.Wn(b)})})},Wn:function(a){var b,c,d,e,f,g,h=this;Ea.Ta(this.Ob.length,this.Fo,function(a){a=h.Ob[a];var l=a.ja[1].position,m=a.ja[0].position;g=l.x-m.x;f=l.y-m.y;e=l.z-m.z;l=a.ja[2].position;
m=a.ja[0].position;d=l.x-m.x;c=l.y-m.y;b=l.z-m.z;l=new p(0,0,0);l.x=f*b-e*c;l.y=e*d-g*b;l.z=g*c-f*d;a.j=l.normalize();for(l=0;3>l;){var m=a.j,n=a.ja[0].position;a.ja[l++].q.cH(qd.Ma(a.j.x,a.j.y,a.j.z,-(m.x*n.x+m.y*n.y+m.z*n.z)))}},function(){Ea.Ta(h.Ob.length,h.Fo,function(a){a=h.Ob[a];for(var b=0;3>b;){var c=b++;a.error[c]=h.yn(a.ja[c],a.ja[(c+1)%3])}a.error[3]=Math.min(a.error[0],a.error[1]);a.error[3]=Math.min(a.error[3],a.error[2])},function(){h.dJ=!0;a()})})},cL:function(a){for(var b=[],c=0,
d=this.ja.length;c<d;)this.ja[c++].se=0;for(var e,c=0,d=this.Ob.length;c<d;)if(e=c++,!this.Ob[e].cl){e=this.Ob[e];for(var f=0;3>f;)e.ja[f++].se=1;b.push(e)}d=this.wc.Aa("position");null==d&&(d=[]);e=this.wc.Aa("normal");null==e&&(e=[]);f=this.wc.Aa("uv");null==f&&(f=[]);var g=this.wc.Aa("color");null==g&&(g=[]);for(var h=this.ta.Aa("normal"),k=this.ta.Aa("uv"),l=this.ta.Aa("color"),m=c=0,n=this.ja.length;m<n;){var p=this.ja[m++];p.id=c;if(0<p.se)for(var q=0,r=p.Lv;q<r.length;){var t=r[q];++q;d.push(p.position.x);
d.push(p.position.y);d.push(p.position.z);e.push(h[3*t]);e.push(h[3*t+1]);e.push(h[3*t+2]);null!=k&&0<k.length?(f.push(k[2*t]),f.push(k[2*t+1])):null!=l&&0<l.length&&(g.push(l[4*t]),g.push(l[4*t+1]),g.push(l[4*t+2]),g.push(l[4*t+3]));++c}}h=this.wc.Mn();k=this.wc.Nf();l=this.wc.Ga;this.wc.Ga=[];m=this.wc.Ac();n=this.ta.Ac();p=0;for(q=b.length;p<q;)for(var r=b[p++],t=0,w=[0,1,2];t<w.length;){var z=w[t];++t;var A=r.ja[z].Lv.indexOf(n[r.EK+z]);0>A&&(A=0);m.push(r.ja[z].id+A+k)}this.wc.Zj(m);this.wc.Fa("position",
d);this.wc.Fa("normal",e);0<f.length&&this.wc.Fa("uv",f);0<g.length&&this.wc.Fa("color",g);d=this.ta.Ga[a];if(0<a){this.wc.Ga=[];for(a=0;a<l.length;)e=l[a],++a,new ub(e.uf,e.te,e.Tg,e.Wb,e.Xd,e.ta);new ub(d.uf,k,c,h,3*b.length,this.wc)}},bJ:function(){this.wc=new aa(this.ta.name+"Decimated",this.ta.f);this.wc.kd(this.ta.Fg());this.wc.bk(this.ta.ca);this.wc.gd=!1;this.wc.ag=this.ta.ag},pB:function(a,b,c,d,e,f){e=0;for(var g=a.se;e<g;){var h=e++,k=this.Ob[this.ia[a.Uh+h].ww];if(!k.cl){var l=this.ia[a.Uh+
h].PD,m=k.ja[(l+1)%3],l=k.ja[(l+2)%3];if(m==b||l==b)d[h]=!0,f.push(k);else{m=m.position;m=new p(m.x-c.x,m.y-c.y,m.z-c.z);m=m.normalize();l=l.position;l=new p(l.x-c.x,l.y-c.y,l.z-c.z);l=l.normalize();if(.999<Math.abs(m.x*l.x+m.y*l.y+m.z*l.z))return!0;var n=new p(0,0,0);n.x=m.y*l.z-m.z*l.y;n.y=m.z*l.x-m.x*l.z;n.z=m.x*l.y-m.y*l.x;m=n.normalize();d[h]=!1;h=k.j;if(.2>m.x*h.x+m.y*h.y+m.z*h.z)return!0}}}return!1},DD:function(a,b,c,d){for(var e=0,f=b.se;e<f;){var g=e++,h=this.ia[b.Uh+g],k=this.Ob[h.ww];k.cl||
(c[g]&&k.gA?(k.cl=!0,++d):(k.ja[h.PD]=a,k.lv=!0,k.error[0]=this.yn(k.ja[0],k.ja[1])+k.xn/2,k.error[1]=this.yn(k.ja[1],k.ja[2])+k.xn/2,k.error[2]=this.yn(k.ja[2],k.ja[0])+k.xn/2,k.error[3]=Math.min(k.error[0],k.error[1]),k.error[3]=Math.min(k.error[3],k.error[2]),this.ia.push(h)))}return d},ZI:function(){for(var a=0,b=this.ja.length;a<b;){for(var c=[],d=[],e=this.ja[a++],f=0,g=e.se;f<g;)for(var h=this.Ob[this.ia[e.Uh+f++].ww],k=0;3>k;){for(var l=0,m=h.ja[k++];l<c.length&&d[l]!=m.id;)++l;l==c.length?
(c.push(1),d.push(m.id)):c[l]++}e=0;for(f=c.length;e<f;)g=e++,this.ja[d[g]].Xn=1==c[g]?!0:!1}},tM:function(a){null==a&&(a=!1);if(!a){for(var b=[],c=0,d=this.Ob.length;c<d;){var e=c++;this.Ob[e].cl||b.push(this.Ob[e])}this.Ob=b}b=0;for(c=this.ja.length;b<c;)d=b++,this.ja[d].se=0,this.ja[d].Uh=0;d=0;for(e=this.Ob.length;d<e;)for(var b=this.Ob[d++],f=0;3>f;)c=b.ja[f++],c.se++;c=b=0;for(d=this.ja.length;c<d;)e=c++,this.ja[e].Uh=b,b+=this.ja[e].se,this.ja[e].se=0;d=[];e=0;for(f=this.Ob.length;e<f;)for(var g=
e++,b=this.Ob[g],h=0;3>h;){var k=h++,c=b.ja[k];d[c.Uh+c.se]=new Kf(k,g);c.se++}this.ia=d;a&&this.ZI()},ls:function(a,b){var c=b.x,d=b.y,e=b.z;return a.data[0]*c*c+2*a.data[1]*c*d+2*a.data[2]*c*e+2*a.data[3]*c+a.data[4]*d*d+2*a.data[5]*d*e+2*a.data[6]*d+a.data[7]*e*e+2*a.data[8]*e+a.data[9]},yn:function(a,b,c){var d=a.q.add(b.q),e;e=d.Sq(0,1,2,1,4,5,2,5,7);if(0==e||a.Xn&&b.Xn){e=a.position;var f=b.position,f=new p((e.x+f.x)/2,(e.y+f.y)/2,(e.z+f.z)/2),g=this.ls(d,a.position),h=this.ls(d,b.position);
e=Math.min(g,h);e=Math.min(e,this.ls(d,f));e==g?null!=c&&(a=a.position,c.x=a.x,c.y=a.y,c.z=a.z):e==h?null!=c&&(a=b.position,c.x=a.x,c.y=a.y,c.z=a.z):null!=c&&(c.x=f.x,c.y=f.y,c.z=f.z)}else null==c&&(c=new p(0,0,0)),c.x=-1/e*d.Sq(1,2,3,4,5,6,5,7,8),c.y=1/e*d.Sq(0,2,3,1,5,6,2,7,8),c.z=-1/e*d.Sq(0,1,3,1,4,6,2,5,8),e=this.ls(d,c);return e},l:Le};var qd=K.BABYLON.QuadraticMatrix=function(a){this.data=[];if(null!=a)for(var b=0;10>b;){var c=b++;this.data[c]=c<=a.length?a[c]:0}};n["com.babylonhx.mesh.simplification.QuadraticMatrix"]=
qd;qd.h=["com","babylonhx","mesh","simplification","QuadraticMatrix"];qd.Ma=function(a,b,c,d){return[a*a,a*b,a*c,a*d,b*b,b*c,b*d,c*c,c*d,d*d]};qd.prototype={Sq:function(a,b,c,d,e,f,g,h,k){return this.data[a]*this.data[e]*this.data[k]+this.data[c]*this.data[d]*this.data[h]+this.data[b]*this.data[f]*this.data[g]-this.data[c]*this.data[e]*this.data[g]-this.data[a]*this.data[f]*this.data[h]-this.data[b]*this.data[d]*this.data[k]},cH:function(a){for(var b=0;10>b;){var c=b++;this.data[c]+=a[c]}},add:function(a){for(var b=
new qd,c=0;10>c;){var d=c++;b.data[d]=this.data[d]+a.data[d]}return b},l:qd};var Kf=K.BABYLON.Reference=function(a,b){this.PD=a;this.ww=b};n["com.babylonhx.mesh.simplification.Reference"]=Kf;Kf.h=["com","babylonhx","mesh","simplification","Reference"];Kf.prototype={l:Kf};var vf=K.BABYLON.SimplificationQueue=function(){this.dw=!1;this.JG=[]};n["com.babylonhx.mesh.simplification.SimplificationQueue"]=vf;vf.h=["com","babylonhx","mesh","simplification","SimplificationQueue"];vf.prototype={zh:function(){var a=
this.JG.pop();null!=a?(this.dw=!0,this.xL(a)):this.dw=!1},xL:function(a){var b=this;if(a.hP)for(var c=0,d=a.Vr;c<d.length;){var e=[d[c]];++c;this.HA(a).hD(e[0],function(c){return function(d){a.Yc.Ez(c[0].Rb,d);d.gd=!0;c[0].wC==a.Vr[a.Vr.length-1].wC&&null!=a.uw&&a.uw();b.zh()}}(e))}else{var f=this.HA(a),g=function(b,c){f.hD(b,function(d){a.Yc.Ez(b.Rb,d);d.gd=!0;c()})};Ea.$a(a.Vr.length,function(b){g(a.Vr[b.index],function(){b.zh()})},function(){null!=a.uw&&a.uw();b.zh()})}},HA:function(a){return new Le(a.Yc)},
l:vf};var jg=K.BABYLON.SimplificationTask=function(){};n["com.babylonhx.mesh.simplification.SimplificationTask"]=jg;jg.h=["com","babylonhx","mesh","simplification","SimplificationTask"];jg.prototype={l:jg};var Ff=K.BABYLON.Particle=function(){this.Wk=this.size=this.Ad=this.Aq=0;this.bo=1;this.Mq=new ca(0,0,0,0);this.color=new ca(0,0,0,0);this.direction=new p(0,0,0);this.position=new p(0,0,0)};n["com.babylonhx.particles.Particle"]=Ff;Ff.h=["com","babylonhx","particles","Particle"];Ff.prototype={l:Ff};
var kg=K.BABYLON.IPhysicsEnginePlugin=function(){};n["com.babylonhx.physics.IPhysicsEnginePlugin"]=kg;kg.h=["com","babylonhx","physics","IPhysicsEnginePlugin"];kg.prototype={l:kg};var xf=K.BABYLON.PhysicsEngine=function(a){this.fi=a};n["com.babylonhx.physics.PhysicsEngine"]=xf;xf.h=["com","babylonhx","physics","PhysicsEngine"];xf.prototype={dt:function(a){this.fi.initialize();this.CG(a)},BG:function(a){.1<a?a=.1:0>=a&&(a=.016666666666666666);this.fi.uP(a)},CG:function(a){this.Tn=null!=a?a:new p(0,
-9.82,0);this.fi.AP(this.Tn)},qG:function(a,b,c){return this.fi.qP(a,b,c)},TG:function(a){this.fi.NP(a)},dispose:function(){this.fi.dispose()},isSupported:function(){return null!=this.fi?this.fi.isSupported():!1},l:xf};var Ld=K.BABYLON.BlurPostProcess=function(a,b,c,d,e,f,g,h){null==h&&(h=!1);null==f&&(f=2);var k=this;ga.call(this,a,"blur",["screenSize","direction","blurWidth"],null,d,e,f,g,h);this.direction=b;this.nu=c;this.Le.add(function(a){var b=k.width,c=k.height;if(a.Jb("screenSize",b,c)){var d=
a.c,e=a.u.get("screenSize");d.b.uniform2f(e,b,c)}b=k.direction;a.Jb("direction",b.x,b.y)&&(c=a.c,d=a.u.get("direction"),c.b.uniform2f(d,b.x,b.y));b=k.nu;c=a.Qa.get("blurWidth");if(null==c||c[0]!=b)a.Qa.set("blurWidth",[b]),c=a.c,a=a.u.get("blurWidth"),c.b.uniform1f(a,b)})};n["com.babylonhx.postprocess.BlurPostProcess"]=Ld;Ld.h=["com","babylonhx","postprocess","BlurPostProcess"];Ld.V=ga;Ld.prototype=S(ga.prototype,{l:Ld});n["com.babylonhx.postprocess.GlowBlurPostProcess"]=wd;wd.h=["com","babylonhx",
"postprocess","GlowBlurPostProcess"];wd.V=ga;wd.prototype=S(ga.prototype,{l:wd});var qf=K.BABYLON.PostProcessManager=function(a){this.ua=new ea;this.f=a};n["com.babylonhx.postprocess.PostProcessManager"]=qf;qf.h=["com","babylonhx","postprocess","PostProcessManager"];qf.prototype={My:function(){var a=this.ua;if(null==(null!=t.position?a.I("position"):a.i.position)){var a=this.ua,b=new oc(this.f.c,[1,1,-1,1,-1,-1,1,-1],"position",!1,!1,2);null!=t.position?a.C("position",b):a.i.position=b;var a=[0,1,
2,0,2,3],b=this.f.c,c=new Kb(b.b.createBuffer());b.W.get(34963)!=c&&(b.b.bindBuffer(34963,null==c?null:c.buffer),b.W.set(34963,null==c?null:c));var d=null,e=!1;if(b.U.Ql){for(var f=0,g=a.length;f<g;)if(65535<a[f++]){e=!0;break}e?d=new Int32Array(a):d=new Int16Array(a)}else d=new Int16Array(a);b.b.bufferData(34963,d,35044);null!=b.W.get(34963)&&(b.b.bindBuffer(34963,null),b.W.set(34963,null));b.kb=null;c.ia=1;c.Rc=e;this.wa=c}},Ny:function(a){var b=this.f.M.bc;if(0==b.length||!this.f.rC)return!1;b[0].bu(this.f.M,
a);return!0},aI:function(a,b){for(var c=this.f.c,d=0,e=a.length;d<e;){var f=d++;if(f<a.length-1)a[f+1].bu(this.f.M,b);else if(null!=b)c.bindFramebuffer(b);else{c.pg=null;null!=c.tc&&(c.b.bindFramebuffer(36160,null),c.tc=null);var g=c.Ze,h=c.Vb(),k=c.Lb();c.Ze=g;c.b.viewport(g.x*h|0,g.y*k|0,h*g.width|0,k*g.height|0);c.Tl()}f=a[f];g=f.apply();if(null!=g){f.sc.la(g);this.My();h=this.ua;k=this.wa;if(c.qb!=h||c.Pb!=g){c.qb=h;c.Pb=g;q.sa=g.ue;for(var l=0,m=q.sa.length;l<m;){var n=l++;q.g=g.sa[n];0<=q.g&&
(n=q.sa[n],q.G=null!=t[n]?h.I(n):h.i[n],null==q.G?c.na[q.g]&&(c.b.disableVertexAttribArray(q.g),c.na[q.g]=!1):(c.na[q.g]||(c.b.enableVertexAttribArray(q.g),c.na[q.g]=!0),n=q.G.S.S,c.vertexAttribPointer(n,q.g,q.G.Db,5126,!1,4*q.G.zd,4*q.G.Cb),q.G.S.ge&&(c.U.Jc.vertexAttribDivisorANGLE(q.g,1),c.$c.push(q.g),c.rd.push(n))))}}null!=k&&c.kb!=k&&(c.kb=k,c.W.get(34963)!=k&&(c.b.bindBuffer(34963,null==k?null:k.buffer),c.W.set(34963,null==k?null:k)),c.Ud=k.Rc);c.Hc(!0,0,6);f.Kc.la(g)}}c.H.Pe(!0);c.H.vb(!0)},
Ux:function(a,b,c,d){null==c&&(c=0);null==a&&(a=!1);null==d&&(d=this.f.M.bc);if(0!=d.length&&this.f.rC){for(var e=this.f.c,f=0,g=d.length;f<g;){var h=f++;if(h<d.length-1)d[h+1].bu(this.f.M,b);else if(null!=b)e.bindFramebuffer(b,c);else{e.pg=null;null!=e.tc&&(e.b.bindFramebuffer(36160,null),e.tc=null);var k=e.Ze,l=e.Vb(),m=e.Lb();e.Ze=k;e.b.viewport(k.x*l|0,k.y*m|0,l*k.width|0,m*k.height|0);e.Tl()}if(a)break;h=d[h];k=h.apply();if(null!=k){h.sc.la(k);this.My();l=this.ua;m=this.wa;if(e.qb!=l||e.Pb!=
k){e.qb=l;e.Pb=k;q.sa=k.ue;for(var n=0,p=q.sa.length;n<p;){var r=n++;q.g=k.sa[r];0<=q.g&&(r=q.sa[r],q.G=null!=t[r]?l.I(r):l.i[r],null==q.G?e.na[q.g]&&(e.b.disableVertexAttribArray(q.g),e.na[q.g]=!1):(e.na[q.g]||(e.b.enableVertexAttribArray(q.g),e.na[q.g]=!0),r=q.G.S.S,e.vertexAttribPointer(r,q.g,q.G.Db,5126,!1,4*q.G.zd,4*q.G.Cb),q.G.S.ge&&(e.U.Jc.vertexAttribDivisorANGLE(q.g,1),e.$c.push(q.g),e.rd.push(r))))}}null!=m&&e.kb!=m&&(e.kb=m,e.W.get(34963)!=m&&(e.b.bindBuffer(34963,null==m?null:m.buffer),
e.W.set(34963,null==m?null:m)),e.Ud=m.Rc);e.Hc(!0,0,6);h.Kc.la(k)}}e.H.Pe(!0);e.H.vb(!0)}},dispose:function(){var a=this.ua,a=null!=t.position?a.I("position"):a.i.position;null!=a&&(a.Df&&a.S.dispose(),a=this.ua,null!=t.position?a.C("position",null):a.i.position=null);null!=this.wa&&(a=this.wa,a.ia--,0==a.ia&&this.f.c.b.deleteBuffer(a.buffer),this.wa=null)},l:qf};n["com.babylonhx.postprocess.StereoscopicInterlacePostProcess"]=je;je.h=["com","babylonhx","postprocess","StereoscopicInterlacePostProcess"];
je.V=ga;je.prototype=S(ga.prototype,{l:je});n["com.babylonhx.postprocess.VRDistortionCorrectionPostProcess"]=Od;Od.h=["com","babylonhx","postprocess","VRDistortionCorrectionPostProcess"];Od.V=ga;Od.prototype=S(ga.prototype,{l:Od});var lg=K.BABYLON.PostProcessRenderEffect=function(){};n["com.babylonhx.postprocess.renderpipeline.PostProcessRenderEffect"]=lg;lg.h=["com","babylonhx","postprocess","renderpipeline","PostProcessRenderEffect"];lg.prototype={Qf:function(){for(var a=this.bc.keys();a.Ca();){var b=
a.next(),c=this.bc;if(!(null!=t[b]?c.I(b):c.i[b]).Qf())return!1}return!0},dd:function(){for(var a=this.wG.keys();a.Ca();){var b=a.next(),c=this.wG,b=null!=t[b]?c.I(b):c.i[b];b.GN.mc=b.FN}},l:lg,F:{Qf:"get_isSupported"}};var mg=K.BABYLON.PostProcessRenderPass=function(){};n["com.babylonhx.postprocess.renderpipeline.PostProcessRenderPass"]=mg;mg.h=["com","babylonhx","postprocess","renderpipeline","PostProcessRenderPass"];mg.prototype={l:mg};var ng=K.BABYLON.PostProcessRenderPipeline=function(){};n["com.babylonhx.postprocess.renderpipeline.PostProcessRenderPipeline"]=
ng;ng.h=["com","babylonhx","postprocess","renderpipeline","PostProcessRenderPipeline"];ng.prototype={Qf:function(){for(var a=this.Jt.keys();a.Ca();){var b=a.next(),c=this.Jt;if(!(null!=t[b]?c.I(b):c.i[b]).Qf())return!1}return!0},dd:function(){for(var a=this.Jt.keys();a.Ca();){var b=a.next(),c=this.Jt;(null!=t[b]?c.I(b):c.i[b]).dd()}for(a=this.gF.keys();a.Ca();)if(b=a.next(),c=this.gF,b=(null!=t[b]?c.I(b):c.i[b]).name,c=this.uG,null!=t[b]?c.Gd(b):c.i.hasOwnProperty(b))c=this.uG,(null!=t[b]?c.I(b):
c.i[b]).dd()},l:ng,F:{Qf:"get_isSupported"}};var rf=K.BABYLON.PostProcessRenderPipelineManager=function(){this.iq=new ea};n["com.babylonhx.postprocess.renderpipeline.PostProcessRenderPipelineManager"]=rf;rf.h=["com","babylonhx","postprocess","renderpipeline","PostProcessRenderPipelineManager"];rf.prototype={update:function(){for(var a=this.iq.keys();a.Ca();){var b=a.next(),c=this.iq,c=null!=t[b]?c.I(b):c.i[b];c.Qf()?c.dd():(c=this.iq,null!=t[b]?c.C(b,null):c.i[b]=null,this.iq.remove(b))}},l:rf};var sf=
K.BABYLON.BoundingBoxRenderer=function(a){this.ua=new ea;this.mc=new Ja(32);this.ML=!0;this.oH=new Q(.1,.1,.1);this.AI=new Q(1,1,1);this.f=a};n["com.babylonhx.rendering.BoundingBoxRenderer"]=sf;sf.h=["com","babylonhx","rendering","BoundingBoxRenderer"];sf.prototype={nG:function(){if(null==this.qd){this.qd=new Rc("colorShader",this.f,"color",{attributes:["position"],wb:["worldViewProjection","color"]});var a=this.f.c,b=O.uh(1),c=this.ua,b=new oc(a,b.Na,"position",!1);null!=t.position?c.C("position",
b):c.i.position=b;c=[0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,7,1,6,2,5,3,4];b=new Kb(a.b.createBuffer());a.W.get(34963)!=b&&(a.b.bindBuffer(34963,null==b?null:b.buffer),a.W.set(34963,null==b?null:b));var d=null,e=!1;if(a.U.Ql){for(var f=0,g=c.length;f<g;)if(65535<c[f++]){e=!0;break}e?d=new Int32Array(c):d=new Int16Array(c)}else d=new Int16Array(c);a.b.bufferData(34963,d,35044);null!=a.W.get(34963)&&(a.b.bindBuffer(34963,null),a.W.set(34963,null));a.kb=null;b.ia=1;b.Rc=e;this.wa=b}},reset:function(){var a=
this.mc;a.length=0;a.Ja++},gb:function(){if(0!=this.mc.length&&(this.nG(),this.qd.pa())){var a=this.f.c;a.H.vb(!1);this.qd.At();for(var b=0,c=this.mc.length;b<c;){var d=this.mc.data[b++],e=d.Gb,f=d.Mb,g=f.x-e.x,h=f.y-e.y,k=f.z-e.z,f=e.x+.5*g,l=e.y+.5*h,m=e.z+.5*k,e=new r;e.a[0]=0;e.a[1]=0;e.a[2]=0;e.a[3]=0;e.a[4]=0;e.a[5]=0;e.a[6]=0;e.a[7]=0;e.a[8]=0;e.a[9]=0;e.a[10]=0;e.a[11]=0;e.a[12]=0;e.a[13]=0;e.a[14]=0;e.a[15]=0;e.a[0]=g;e.a[1]=0;e.a[2]=0;e.a[3]=0;e.a[4]=0;e.a[5]=h;e.a[6]=0;e.a[7]=0;e.a[8]=
0;e.a[9]=0;e.a[10]=k;e.a[11]=0;e.a[12]=0;e.a[13]=0;e.a[14]=0;e.a[15]=1;g=new r;g.a[0]=1;g.a[1]=0;g.a[2]=0;g.a[3]=0;g.a[4]=0;g.a[5]=1;g.a[6]=0;g.a[7]=0;g.a[8]=0;g.a[9]=0;g.a[10]=1;g.a[11]=0;g.a[12]=0;g.a[13]=0;g.a[14]=0;g.a[15]=1;r.da(1,0,0,0,1,0,0,0,1,f,l,m,g);h=new r;e.qa(g,h.a,0);g=d.Ea;d=new r;h.qa(g,d.a,0);g=this.ua;h=this.wa;f=this.qd.s;if(a.qb!=g||a.Pb!=f)for(a.qb=g,a.Pb=f,q.sa=f.ue,l=0,e=q.sa.length;l<e;)k=l++,q.g=f.sa[k],0<=q.g&&(k=q.sa[k],q.G=null!=t[k]?g.I(k):g.i[k],null==q.G?a.na[q.g]&&
(a.b.disableVertexAttribArray(q.g),a.na[q.g]=!1):(a.na[q.g]||(a.b.enableVertexAttribArray(q.g),a.na[q.g]=!0),k=q.G.S.S,a.vertexAttribPointer(k,q.g,q.G.Db,5126,!1,4*q.G.zd,4*q.G.Cb),q.G.S.ge&&(a.U.Jc.vertexAttribDivisorANGLE(q.g,1),a.$c.push(q.g),a.rd.push(k))));null!=h&&a.kb!=h&&(a.kb=h,a.W.get(34963)!=h&&(a.b.bindBuffer(34963,null==h?null:h.buffer),a.W.set(34963,null==h?null:h)),a.Ud=h.Rc);this.ML&&(a.H.ak(518),this.f.Ye=null,g=this.qd,h=this.oH,h=new ca(h.r,h.v,h.m,1),-1==g.Da.wb.indexOf("color")&&
g.Da.wb.push("color"),g.Yg.set("color",h),this.qd.bind(d),a.Hc(!1,0,24));a.H.ak(513);this.f.Ye=null;g=this.qd;h=this.AI;h=new ca(h.r,h.v,h.m,1);-1==g.Da.wb.indexOf("color")&&g.Da.wb.push("color");g.Yg.set("color",h);this.qd.bind(d);a.Hc(!1,0,24)}this.qd.Io();a.H.ak(515);a.H.vb(!0)}},dispose:function(){if(null!=this.qd){this.qd.dispose();var a=this.ua,a=null!=t.position?a.I("position"):a.i.position;null!=a&&(a.Df&&a.S.dispose(),a=this.ua,null!=t.position?a.C("position",null):a.i.position=null);a=this.wa;
a.ia--;0==a.ia&&this.f.c.b.deleteBuffer(a.buffer)}},l:sf};var og=K.BABYLON.DepthRenderer=function(){};n["com.babylonhx.rendering.DepthRenderer"]=og;og.h=["com","babylonhx","rendering","DepthRenderer"];og.prototype={dispose:function(){this.yF.dispose()},l:og};n["com.babylonhx.rendering.EdgesRenderer"]=bf;bf.h=["com","babylonhx","rendering","EdgesRenderer"];bf.xb=[Nb];bf.prototype={dispose:function(){var a=this.HN;a.Df&&a.S.dispose();a=this.IN;a.Df&&a.S.dispose();a=this.PF;a.ia--;0==a.ia&&this.an.f.c.b.deleteBuffer(a.buffer);
this.eh.dispose()},gb:function(){if(this.eh.pa()){var a=this.an.f,b=a.c;this.eh.At();var c=this.aF,d=this.PF,e=this.eh.s;if(b.qb!=c||b.Pb!=e){b.qb=c;b.Pb=e;q.sa=e.ue;for(var f=0,g=q.sa.length;f<g;){var h=f++;q.g=e.sa[h];0<=q.g&&(h=q.sa[h],q.G=null!=t[h]?c.I(h):c.i[h],null==q.G?b.na[q.g]&&(b.b.disableVertexAttribArray(q.g),b.na[q.g]=!1):(b.na[q.g]||(b.b.enableVertexAttribArray(q.g),b.na[q.g]=!0),h=q.G.S.S,b.vertexAttribPointer(h,q.g,q.G.Db,5126,!1,4*q.G.zd,4*q.G.Cb),q.G.S.ge&&(b.U.Jc.vertexAttribDivisorANGLE(q.g,
1),b.$c.push(q.g),b.rd.push(h))))}}null!=d&&b.kb!=d&&(b.kb=d,b.W.get(34963)!=d&&(b.b.bindBuffer(34963,null==d?null:d.buffer),b.W.set(34963,null==d?null:d)),b.Ud=d.Rc);a.Ye=null;c=this.eh;d=this.an.Hu;-1==c.Da.wb.indexOf("color")&&c.Da.wb.push("color");c.Yg.set("color",d);1==a.M.mode?(c=this.eh,d=this.an.Uq/this.gI):(c=this.eh,d=this.an.Uq/this.hI);-1==c.Da.wb.indexOf("width")&&c.Da.wb.push("width");c.hi.set("width",d);c=this.eh;a=b.kl(a.M);-1==c.Da.wb.indexOf("aspectRatio")&&c.Da.wb.push("aspectRatio");
c.hi.set("aspectRatio",a);this.eh.bind(this.an.va());b.Hc(!0,0,this.AN);this.eh.Io();b.H.vb(!0)}},l:bf};var tf=K.BABYLON.OutlineRenderer=function(a){this.f=a};n["com.babylonhx.rendering.OutlineRenderer"]=tf;tf.h=["com","babylonhx","rendering","OutlineRenderer"];tf.prototype={gb:function(a,b,c){null==c&&(c=!1);var d=this,e=this.f,f=this.f.c,g=null!=f.U.Jc&&null!=b.Ld[a.cb];if(this.pa(a,g)){var h=a.oh,k=a.Lf(),l=this.s,m=l.xd;f.uc!=m&&(f.b.useProgram(m),f.uc=m);f.Cf=l;null!=l.Sc&&l.Sc(l);l=this.s;f=
c?0:h.outlineWidth;m=l.Qa.get("offset");if(null==m||m[0]!=f)l.Qa.set("offset",[f]),m=l.c,l=l.u.get("offset"),m.b.uniform1f(l,f);l=this.s;f=c?h.Nv:h.outlineColor;c=c?h.Mv:1;l.Oa("color",f.r,f.v,f.m,c)&&(m=l.c,l=l.u.get("color"),m.b.uniform4f(l,f.r,f.v,f.m,c));c=this.s;e=e.sb;c.Wa("viewProjection",e)&&(f=c.c,c=c.u.get("viewProjection"),f.b.uniformMatrix4fv(c,!1,e.a));h.Gg()&&h.lf&&(e=this.s,c=h.fd(),c.Oi&&null!=h.ee?c=h.ee:(null==c.De&&c.Fl(),c=c.De),e.Qa.set("mBones",null),f=e.c,e=e.u.get("mBones"),
f.b.uniformMatrix4fv(e,!1,c));h.wp(a,this.s,0);null!=k&&k.Vf()&&(e=k.br(),this.s.Hb("diffuseSampler",e),k=this.s,e=e.Je(),k.Wa("diffuseMatrix",e)&&(c=k.c,k=k.u.get("diffuseMatrix"),c.b.uniformMatrix4fv(k,!1,e.a)));h.Et(a,this.s,0,b,g,function(a,b){var c=d.s;if(c.Wa("world",b)){var e=c.c,c=c.u.get("world");e.b.uniformMatrix4fv(c,!1,b.a)}})}},pa:function(a,b){var c=[],d=["position","normal"],e=a.ta,f=a.Lf();null!=f&&f.Vf()&&(c.push("#define ALPHATEST"),e.eb("uv")&&(d.push("uv"),c.push("#define UV1")),
e.eb("uv2")&&(d.push("uv2"),c.push("#define UV2")));e.Gg()&&e.lf?(d.push("matricesIndices"),d.push("matricesWeights"),4<e.Ke&&(d.push("matricesIndicesExtra"),d.push("matricesWeightsExtra")),c.push("#define NUM_BONE_INFLUENCERS "+e.Ke),c.push("#define BonesPerMesh "+(e.fd().Ge.length+1))):c.push("#define NUM_BONE_INFLUENCERS 0");b&&(c.push("#define INSTANCES"),d.push("world0"),d.push("world1"),d.push("world2"),d.push("world3"));c=c.join("\n");this.Xg!=c&&(this.Xg=c,this.s=this.f.c.Aj("outline",d,"world mBones viewProjection diffuseMatrix offset color".split(" "),
["diffuseSampler"],c));return this.s.Mc},l:tf};var wa=K.BABYLON.RenderingGroup=function(a,b,c,d,e){this.Yl=new Ja;this.Uk=new Ja;this.Lm=new Ja;this.f=b;this.index=a;this.YC(c);this.SC(d);this.aD(e)};n["com.babylonhx.rendering.RenderingGroup"]=wa;wa.h=["com","babylonhx","rendering","RenderingGroup"];wa.D=function(a,b,c,d){for(var e,f=0,g=a.length;f<g;){e=a.data[f++];e.sp=e.ta.Xk;var h=(e.Of()?e.ta.ed():e.ra).Oc.Gc,k=h.x-c.x,l=h.y-c.y,h=h.z-c.z;e.Gp=Math.sqrt(k*k+l*l+h*h)}a=a.data.slice(0,a.length);
a.sort(b);b=0;for(c=a.length;b<c;)e=a[b++],e.oh.gb(e,d)};wa.$a=function(a){for(var b=0,c=a.length;b<c;){var d=a.data[b++];d.oh.gb(d,!1)}};wa.Zb=function(a,b){return a.sp>b.sp?1:a.sp<b.sp?-1:wa.Ib(a,b)};wa.Ib=function(a,b){return a.Gp<b.Gp?1:a.Gp>b.Gp?-1:0};wa.prototype={YC:function(a){this.kG=a;null!=a?this.Wy=F(this,this.qL):this.Wy=wa.$a;return a},SC:function(a){this.UE=a;null!=a?this.Sy=F(this,this.nL):this.Sy=wa.$a;return a},aD:function(a){null!=a?this.pz=a:this.pz=wa.Zb;this.yG=F(this,this.tL);
return a},gb:function(a){if(null!=a)return a(this.Lm,this.Yl,this.Uk),!0;if(0==this.Lm.length&&0==this.Yl.length&&0==this.Uk.length)return null!=this.ko&&this.ko(),!1;a=this.f.c;this.Wy(this.Lm);a.zs=!0;this.Sy(this.Yl);a.zs=!1;null!=this.ko&&this.ko();0<this.Uk.length&&(this.yG(this.Uk),0!=a.bb&&(a.K.ya(!1),a.H.vb(!0),a.bb=0));return!0},qL:function(a){wa.D(a,this.kG,this.f.M.Ch(),!1)},nL:function(a){wa.D(a,this.UE,this.f.M.Ch(),!1)},tL:function(a){wa.D(a,this.pz,this.f.M.Ch(),!0)},l:wa,F:{aD:"set_transparentSortCompareFn",
SC:"set_alphaTestSortCompareFn",YC:"set_opaqueSortCompareFn"}};var pg=K.BABYLON.Sprite=function(){this.hn=0;this.zF=1;this.LF=this.QG=this.Px=0;this.lJ=this.mJ=this.vr=this.gx=this.cG=!1;this.Ad=this.cellIndex=0;this.width=this.height=1;this.color=new ca(1,1,1,1)};n["com.babylonhx.sprites.Sprite"]=pg;pg.h=["com","babylonhx","sprites","Sprite"];pg.prototype={dispose:function(){for(var a=0,b=this.wy.ck.length;a<b;){var c=a++;this.wy.ck[c]==this&&this.wy.ck.splice(c,1)}},l:pg};var qg=K.BABYLON.SpriteManager=
function(){this.ua=new ea;this.Nb=new U;this.vr=!1;this.nf=!0;this.tb=268435455;this.ag=0;this.ck=[]};n["com.babylonhx.sprites.SpriteManager"]=qg;qg.h=["com","babylonhx","sprites","SpriteManager"];qg.prototype={up:function(a,b,c,d,e){a*=16;0==c?c=this.Ts:1==c&&(c=1-this.Ts);0==d?d=this.Ts:1==d&&(d=1-this.Ts);this.ha[a]=b.position.x;this.ha[a+1]=b.position.y;this.ha[a+2]=b.position.z;this.ha[a+3]=b.Ad;this.ha[a+4]=b.width;this.ha[a+5]=b.height;this.ha[a+6]=c;this.ha[a+7]=d;this.ha[a+8]=b.lJ?1:0;this.ha[a+
9]=b.mJ?1:0;c=b.cellIndex/e|0;this.ha[a+10]=b.cellIndex-c*e;this.ha[a+11]=c;this.ha[a+12]=b.color.r;this.ha[a+13]=b.color.v;this.ha[a+14]=b.color.m;this.ha[a+15]=b.color.$},Ji:function(a,b,c,d){null==d&&(d=!1);var e=Math.min(this.aj,this.ck.length)|0,f=new p(0,0,0),g=new p(0,0,0),h=Infinity,k=null,l,m,n;b=b.pf();for(var q=0;q<e;){var r=this.ck[q++];if(null!=r){if(null!=c){if(!c(r))continue}else if(!r.vr)continue;m=r.position;l=m.x;var t=m.y,z=m.z,w=b.a,A=l*w[3]+t*w[7]+z*w[11]+w[15];n=(l*w[0]+t*w[4]+
z*w[8]+w[12])/A;m=(l*w[1]+t*w[5]+z*w[9]+w[13])/A;l=(l*w[2]+t*w[6]+z*w[10]+w[14])/A;f.x=n-r.width/2;f.y=m-r.height/2;f.z=l;g.x=n+r.width/2;g.y=m+r.height/2;g.z=l;if(a.rr(f,g)&&(t=a.origin,n-=t.x,m-=t.y,l-=t.z,m=Math.sqrt(n*n+m*m+l*l),h>m&&(h=m,k=r,d)))break}}return null!=k?(a=new dd,a.sf=!0,a.Yb=k,a.Rb=h,a):null},gb:function(){if(this.CF.Mc&&this.DF.Mc&&null!=this.Pk&&this.Pk.pa()){for(var a=this.f.c,b=this.Pk.EI(),c=a.dl,d=Math.min(this.aj,this.ck.length),e=b.width/this.EH,f=0,g=0;g<d;){var h=this.ck[g++];
null!=h&&(h.gx&&(h.hn+=c,h.hn>h.Px&&(h.hn%=h.Px,h.cellIndex+=h.zF,h.cellIndex==h.QG&&(h.cG?h.cellIndex=h.LF:(h.gx=!1,h.XN&&h.dispose())))),this.up(f++,h,0,0,e),this.up(f++,h,1,0,e),this.up(f++,h,1,1,e),this.up(f++,h,0,1,e))}this.S.create(this.ha);c=this.CF;this.f.nf&&this.f.Ej!=Ma.g&&this.nf&&(c=this.DF);e=c.xd;a.uc!=e&&(a.b.useProgram(e),a.uc=e);a.Cf=c;null!=c.Sc&&c.Sc(c);e=this.f.za;c.Hb("diffuseSampler",this.Pk);c.Wa("view",e)&&(f=c.c,g=c.u.get("view"),f.b.uniformMatrix4fv(g,!1,e.a));e=this.f.Va;
c.Wa("projection",e)&&(f=c.c,g=c.u.get("projection"),f.b.uniformMatrix4fv(g,!1,e.a));e=this.EH/b.width;b=this.TN/b.height;c.Jb("textureInfos",e,b)&&(f=c.c,g=c.u.get("textureInfos"),f.b.uniform2f(g,e,b));this.f.nf&&this.f.Ej!=Ma.g&&this.nf&&(b=this.f.Ej,e=this.f.yA,f=this.f.xA,g=this.f.wA,c.Oa("vFogInfos",b,e,f,g)&&c.c.Tb(c.u.get("vFogInfos"),b,e,f,g),b=this.f.vA,c.ve("vFogColor",b.r,b.v,b.m)&&(e=c.c,f=c.u.get("vFogColor"),e.b.uniform3f(f,b.r,b.v,b.m)));b=this.ua;e=this.wa;if(a.qb!=b||a.Pb!=c)for(a.qb=
b,a.Pb=c,q.sa=c.ue,f=0,g=q.sa.length;f<g;)h=f++,q.g=c.sa[h],0<=q.g&&(h=q.sa[h],q.G=null!=t[h]?b.I(h):b.i[h],null==q.G?a.na[q.g]&&(a.b.disableVertexAttribArray(q.g),a.na[q.g]=!1):(a.na[q.g]||(a.b.enableVertexAttribArray(q.g),a.na[q.g]=!0),h=q.G.S.S,a.vertexAttribPointer(h,q.g,q.G.Db,5126,!1,4*q.G.zd,4*q.G.Cb),q.G.S.ge&&(a.U.Jc.vertexAttribDivisorANGLE(q.g,1),a.$c.push(q.g),a.rd.push(h))));null!=e&&a.kb!=e&&(a.kb=e,a.W.get(34963)!=e&&(a.b.bindBuffer(34963,null==e?null:e.buffer),a.W.set(34963,null==
e?null:e)),a.Ud=e.Rc);a.H.ak(515);b=c.Qa.get("alphaTest");if(null==b||1!=b[0])c.Qa.set("alphaTest",[1]),b=c.c,e=c.u.get("alphaTest"),b.b.uniform1i(e,1);a.b.colorMask(!1,!1,!1,!1);a.Hc(!0,0,6*d);a.b.colorMask(!0,!0,!0,!0);b=c.Qa.get("alphaTest");if(null==b||0!=b[0])c.Qa.set("alphaTest",[0]),b=c.c,c=c.u.get("alphaTest"),b.b.uniform1i(c,0);2!=a.bb&&(a.K.Za(770,771,1,1),a.K.ya(!0),a.H.vb(!1),a.bb=2);a.Hc(!0,0,6*d);0!=a.bb&&(a.K.ya(!1),a.H.vb(!0),a.bb=0)}},dispose:function(){null!=this.S&&(this.S.dispose(),
this.S=null);if(null!=this.wa){var a=this.wa;a.ia--;0==a.ia&&this.f.c.b.deleteBuffer(a.buffer);this.wa=null}null!=this.Pk&&(this.Pk.dispose(),this.Pk=null);Z.remove(this.f.dg,this);this.Nb.la(this);this.Nb.clear()},l:qg};var mf=K.BABYLON._AlphaState=function(){this.pd=[];this.om=this.pm=this.rp=!1};n["com.babylonhx.states._AlphaState"]=mf;mf.h=["com","babylonhx","states","_AlphaState"];mf.prototype={On:function(){return this.om?!0:this.pm},ya:function(a){if(this.rp==a)return a;this.rp=a;this.om=!0;
return a},Za:function(a,b,c,d){if(this.pd[0]!=a||this.pd[1]!=b||this.pd[2]!=c||this.pd[3]!=d)this.pd[0]=a,this.pd[1]=b,this.pd[2]=c,this.pd[3]=d,this.pm=!0},reset:function(){this.rp=!1;this.pd[0]=-1;this.pd[1]=-1;this.pd[2]=-1;this.pd[3]=-1;this.om=!0;this.pm=!1},apply:function(a){this.On()&&(this.om&&(this.rp?a.enable(3042):a.disable(3042),this.om=!1),this.pm&&(a.blendFuncSeparate(this.pd[0],this.pd[1],this.pd[2],this.pd[3]),this.pm=!1))},l:mf,F:{ya:"set_alphaBlend",On:"get_isDirty"}};var nf=K.BABYLON._DepthCullingState=
function(){this.wq=0;this.um=this.tm=this.sm=this.rm=this.qm=this.Am=!1;this.reset()};n["com.babylonhx.states._DepthCullingState"]=nf;nf.h=["com","babylonhx","states","_DepthCullingState"];nf.prototype={On:function(){return this.sm||this.um||this.tm||this.rm||this.qm?!0:this.Am},dv:function(){return this.wq},Oh:function(a){if(this.wq==a)return a;this.wq=a;this.Am=!0;return a},Eg:function(){return this.Js},jw:function(a){if(this.Js==a)return a;this.Js=a;this.rm=!0;return a},Pf:function(){return this.Is},
cg:function(a){if(this.Is==a)return a;this.Is=a;this.qm=!0;return a},NA:function(){return this.Ns},ak:function(a){if(this.Ns==a)return a;this.Ns=a;this.sm=!0;return a},gr:function(){return this.Os},vb:function(a){if(this.Os==a)return a;this.Os=a;this.tm=!0;return a},OA:function(){return this.Qs},Pe:function(a){if(this.Qs==a)return a;this.Qs=a;this.um=!0;return a},reset:function(){this.Qs=this.Os=!0;this.Is=this.Js=this.Ns=null;this.wq=0;this.tm=this.um=!0;this.Am=this.qm=this.rm=this.sm=!1},apply:function(a){this.On()&&
(this.qm&&(null!=this.Pf()&&this.Pf()?a.enable(2884):a.disable(2884),this.qm=!1),this.rm&&(a.cullFace(this.Eg()),this.rm=!1),this.tm&&(a.depthMask(this.gr()),this.tm=!1),this.um&&(this.OA()?a.enable(2929):a.disable(2929),this.um=!1),this.sm&&(a.depthFunc(this.NA()),this.sm=!1),this.Am&&(0!=this.dv()?(a.enable(32823),a.polygonOffset(this.dv(),0)):a.disable(32823),this.Am=!1))},l:nf,F:{Pe:"set_depthTest",OA:"get_depthTest",vb:"set_depthMask",gr:"get_depthMask",ak:"set_depthFunc",NA:"get_depthFunc",
cg:"set_cull",Pf:"get_cull",jw:"set_cullFace",Eg:"get_cullFace",Oh:"set_zOffset",dv:"get_zOffset",On:"get_isDirty"}};n["com.babylonhx.states._StencilState"]=af;af.h=["com","babylonhx","states","_StencilState"];af.prototype={Tr:function(a){if(this.cn==a)return a;this.cn=a;this.Bk=!0;return a},ZC:function(a){if(this.qq==a)return a;this.qq=a;this.Bk=!0;return a},mw:function(a){if(this.dn==a)return a;this.dn=a;this.xm=!0;return a},zo:function(a){if(this.Qk==a)return a;this.Qk=a;this.ym=!0;return a},apply:function(a){if(this.ym||
this.xm||this.Bk||this.Wp)this.ym&&(this.Qk?a.enable(2960):a.disable(2960),this.ym=!1),this.xm&&(a.stencilMask(this.dn),this.xm=!1),this.Bk&&(a.stencilFunc(this.cn,this.qq,this.lz),this.Bk=!1),this.Wp&&(a.stencilOp(this.oz,this.mz,this.nz),this.Wp=!1)},l:af,F:{zo:"set_stencilTest",mw:"set_stencilMask",ZC:"set_stencilFuncRef",Tr:"set_stencilFunc"}};var Ea=K.BABYLON.AsyncLoop=function(a,b,c,d){null==d&&(d=0);this.oJ=a;this.JF=b;this.NG=c;this.index=d-1;this.Tx=!1};n["com.babylonhx.tools.AsyncLoop"]=
Ea;Ea.h=["com","babylonhx","tools","AsyncLoop"];Ea.$a=function(a,b,c){var d;null==d&&(d=0);(new Ea(a,b,c,d)).zh()};Ea.Ta=function(a,b,c,d,e){var f;null==f&&(f=0);Ea.$a(Math.ceil(a/b),function(d){null!=e&&e()?d.Fq():ha.xh(function(){for(var f=0;f<b;){var k=d.index*b+f++;if(k>=a)break;c(k);if(null!=e&&e()){d.Fq();break}}d.zh()},f)},d)};Ea.prototype={zh:function(){this.Tx||(this.index+1<this.oJ?(++this.index,this.JF(this)):this.Fq())},Fq:function(){this.Tx=!0;this.NG()},l:Ea};n["com.babylonhx.tools.EventState"]=
$e;$e.h=["com","babylonhx","tools","EventState"];$e.prototype={l:$e};n["com.babylonhx.tools.Observable"]=U;U.h=["com","babylonhx","tools","Observable"];U.prototype={add:function(a,b,c){null==c&&(c=!1);null==b&&(b=-1);if(null==a)return null;a=new Ze(a,b);c?this.tg.unshift(a):this.tg.push(a);return a},remove:function(a){a=this.tg.indexOf(a);return-1!=a?(this.tg.splice(a,1),!0):!1},gL:function(a){for(var b=0,c=this.tg.length;b<c;){var d=b++;if(this.tg[d].Sz==a)return this.tg.splice(d,1),!0}return!1},
la:function(a,b){null==b&&(b=-1);var c;null!=U.Qo?(c=U.Qo,c.zv=b,c.iD=!1):c=new $e(b);U.Qo=null;for(var d=0,e=this.tg;d<e.length;){var f=e[d];++d;0!=(f.zv&b)&&f.Sz(a,c);if(c.iD)break}U.Qo=c},Dh:function(){return 0<this.tg.length},clear:function(){this.tg=[]},l:U};n["com.babylonhx.tools.Observer"]=Ze;Ze.h=["com","babylonhx","tools","Observer"];Ze.prototype={l:Ze};var Ja=K.BABYLON.SmartArray=function(){this.length=this.Ja=0;this.data=[];this.cb=Ja.ib++};n["com.babylonhx.tools.SmartArray"]=Ja;Ja.h=["com",
"babylonhx","tools","SmartArray"];Ja.prototype={Yf:function(a){if(a.yb[this.cb]==this.Ja)return!1;this.data[this.length++]=a;a.yb[this.cb]=this.Ja;return!0},l:Ja};var zf=K.BABYLON.SmartCollection=function(){this.count=0;this.items=new ib;this.ba=[]};n["com.babylonhx.tools.SmartCollection"]=zf;zf.h=["com","babylonhx","tools","SmartCollection"];zf.prototype={add:function(a,b){if(null!=this.items.i[a.Bf])return-1;this.items.set(a,b);this.ba[this.count++]=a;return this.count},item:function(a){return null!=
a?this.items.i[a.Bf]:null},dr:function(a){return a<this.count&&-1<a?this.items.i[this.ba[a].Bf]:null},empty:function(){0<this.count&&(this.count=0,this.items=new ib,this.ba=[])},l:zf};n["com.babylonhx.tools.StringDictionary"]=Uf;Uf.h=["com","babylonhx","tools","StringDictionary"];Uf.prototype={l:Uf};n["com.babylonhx.tools.Ts2Hx"]=vd;vd.h=["com","babylonhx","tools","Ts2Hx"];vd.mE=function(a){return 0!=a?a==a:!1};vd.kE=function(a){return 0!=a?a==a:!1};vd.iE=function(a){return jb.eE(a)&&("string"!=typeof a||
0<z.g(a,String).length)||"boolean"==typeof a&&1==z.g(a,Eg)||"number"==typeof a&&(a|0)===a&&vd.mE(z.g(a,tg))?!0:"number"==typeof a?vd.kE(z.g(a,Fg)):!1};n["com.babylonhx.utils.Image"]=Ye;Ye.h=["com","babylonhx","utils","Image"];Ye.prototype={l:Ye};n["com.babylonhx.utils.Keycodes"]=Tf;Tf.h=["com","babylonhx","utils","Keycodes"];Tf.Dc=function(a){if(0!=(a&1073741824))return mb.Dc(a&-1073741825);switch(a){case 8:return mb.Dc(42);case 9:return mb.Dc(43);case 13:return mb.Dc(40);case 27:return mb.Dc(41);
case 32:return mb.Dc(44);case 127:return mb.Dc(76);default:var b=new Xe;b.ts+=String.fromCharCode(a);return b.ts}};n["com.babylonhx.utils.Scancodes"]=mb;mb.h=["com","babylonhx","utils","Scancodes"];mb.Dc=function(a){var b=null;0<=a&&a<mb.Pw.length&&(b=mb.Pw[a]);return null!=b?b:""};n["haxe.IMap"]=ud;ud.h=["haxe","IMap"];ud.prototype={l:ud};n["haxe.Timer"]=dc;dc.h=["haxe","Timer"];dc.da=function(a,b){var c=new dc(b);c.cw=function(){c.stop();a()}};dc.prototype={stop:function(){null!=this.id&&(clearInterval(this.id),
this.id=null)},cw:function(){},l:dc};n["haxe.Utf8"]=Xe;Xe.h=["haxe","Utf8"];Xe.prototype={l:Xe};n["haxe.io.Bytes"]=cb;cb.h=["haxe","io","Bytes"];cb.Uc=function(a){return new cb(new Lf(a))};cb.Ba=function(a){for(var b=[],c=0;c<a.length;){var d=a.charCodeAt(c++);55296<=d&&56319>=d&&(d=d-55232<<10|a.charCodeAt(c++)&1023);127>=d?b.push(d):(2047>=d?b.push(192|d>>6):(65535>=d?b.push(224|d>>12):(b.push(240|d>>18),b.push(128|d>>12&63)),b.push(128|d>>6&63)),b.push(128|d&63))}return new cb((new hb(b)).buffer)};
cb.Zb=function(a){var b=a.XI;return null!=b?b:new cb(a)};cb.Zc=function(a,b){return a.CH[b]};cb.prototype={NI:function(a,b){if(0>a||0>b||a+b>this.length)throw new ja(ab.ss);for(var c="",d=this.m,e=String.fromCharCode,f=a,g=a+b;f<g;){var h=d[f++];if(128>h){if(0==h)break;c+=e(h)}else 224>h?c+=e((h&63)<<6|d[f++]&127):240>h?c+=e((h&31)<<12|(d[f++]&127)<<6|d[f++]&127):(h=(h&15)<<18|(d[f++]&127)<<12|(d[f++]&127)<<6|d[f++]&127,c+=e((h>>10)+55232),c+=e(h&1023|56320))}return c},toString:function(){return this.NI(0,
this.length)},l:cb};n["haxe.crypto.BaseCode"]=We;We.h=["haxe","crypto","BaseCode"];We.prototype={lI:function(a){for(var b=this.XJ,c=this.pH,d=8*a.length/b|0,e=new cb(new Lf(d+(0==8*a.length%b?0:1))),f=0,g=0,h=(1<<b)-1,k=0,l=0;l<d;){for(;g<b;)g+=8,f<<=8,f|=a.m[k++];g-=b;e.m[l++]=c.m[f>>g&h]&255}0<g&&(e.m[l++]=c.m[f<<b-g&h]&255);return e},l:We};n["haxe.ds.IntMap"]=Wa;Wa.h=["haxe","ds","IntMap"];Wa.xb=[ud];Wa.prototype={set:function(a,b){this.i[a]=b},get:function(a){return this.i[a]},keys:function(){var a=
[],b;for(b in this.i)this.i.hasOwnProperty(b)&&a.push(b|0);return Z.XD(a)},l:Wa};n["haxe.ds.ObjectMap"]=ib;ib.h=["haxe","ds","ObjectMap"];ib.xb=[ud];ib.UP=function(a){return a.Bf=++ib.count};ib.gN=function(a){return a.Bf};ib.prototype={set:function(a,b){var c=a.Bf||(a.Bf=++ib.count);this.i[c]=b;this.i.QE[c]=a},get:function(a){return this.i[a.Bf]},l:ib};n["haxe.ds._StringMap.StringMapIterator"]=ie;ie.h=["haxe","ds","_StringMap","StringMapIterator"];ie.prototype={Ca:function(){return this.index<this.count},
next:function(){var a=this.map,b=this.keys[this.index++];return null!=t[b]?a.I(b):a.i[b]},l:ie};n["haxe.ds.StringMap"]=ea;ea.h=["haxe","ds","StringMap"];ea.xb=[ud];ea.prototype={set:function(a,b){null!=t[a]?this.C(a,b):this.i[a]=b},get:function(a){return null!=t[a]?this.I(a):this.i[a]},C:function(a,b){null==this.bg&&(this.bg={});this.bg["$"+a]=b},I:function(a){return null==this.bg?null:this.bg["$"+a]},Gd:function(a){return null==this.bg?!1:this.bg.hasOwnProperty("$"+a)},remove:function(a){if(null!=
t[a]){a="$"+a;if(null==this.bg||!this.bg.hasOwnProperty(a))return!1;delete this.bg[a]}else{if(!this.i.hasOwnProperty(a))return!1;delete this.i[a]}return!0},keys:function(){return Z.XD(this.ku())},ku:function(){var a=[],b;for(b in this.i)this.i.hasOwnProperty(b)&&a.push(b);if(null!=this.bg)for(b in this.bg)36==b.charCodeAt(0)&&a.push(b.substr(1));return a},l:ea};n["haxe.io.Eof"]=Sf;Sf.h=["haxe","io","Eof"];Sf.prototype={toString:function(){return"Eof"},l:Sf};var ab={Zi:!0,Zw:["Blocked","Overflow",
"OutsideBounds","Custom"],Qw:["Blocked",0]};ab.Qw.toString=Xa;ab.Qw.jb=ab;ab.Sw=["Overflow",1];ab.Sw.toString=Xa;ab.Sw.jb=ab;ab.ss=["OutsideBounds",2];ab.ss.toString=Xa;ab.ss.jb=ab;ab.aN=function(a){a=["Custom",3,a];a.jb=ab;a.toString=Xa;return a};n["haxe.io.FPHelper"]=he;he.h=["haxe","io","FPHelper"];he.KM=function(a){var b=a>>>23&255,c=a&8388607;return 0==c&&0==b?0:(1-(a>>>31<<1))*(1+Math.pow(2,-23)*c)*Math.pow(2,b-127)};he.qJ=function(a){if(0==a)return 0;var b=0>a?-a:a,c=Math.floor(Math.log(b)/
.6931471805599453);-127>c?c=-127:128<c&&(c=128);b=Math.round(8388608*(b/Math.pow(2,c)-1));8388608==b&&128>c&&(b=0,++c);return(0>a?-2147483648:0)|c+127<<23|b};n["haxe.io.Path"]=td;td.h=["haxe","io","Path"];td.pb=function(a){a=new td(a);return null==a.ext?"":a.ext};td.prototype={l:td};n["js._Boot.HaxeError"]=ja;ja.h=["js","_Boot","HaxeError"];ja.Nd=function(a){return a instanceof Error?a:new ja(a)};ja.V=Error;ja.prototype=S(Error.prototype,{l:ja});n["js.html.compat.ArrayBuffer"]=rb;rb.h=["js","html",
"compat","ArrayBuffer"];rb.ec=function(a,b){var c=new hb(this,a,null==b?null:b-a),d=new Lf(c.byteLength);(new hb(d)).set(c);return d};rb.prototype={slice:function(a,b){return new rb(this.$.slice(a,b))},l:rb};n["js.html.compat.Float32Array"]=Bb;Bb.h=["js","html","compat","Float32Array"];Bb.Ag=function(a,b,c){var d;if("number"==typeof a){d=[];for(b=0;b<a;){var e=b++;d[e]=0}d.byteLength=d.length<<2;d.byteOffset=0;a=[];b=0;for(e=d.length<<2;b<e;)b++,a.push(0);d.buffer=new rb(a)}else if(z.D(a,rb)){null==
b&&(b=0);null==c&&(c=a.byteLength-b>>2);d=[];for(e=0;e<c;){e++;var f=a.$[b++]|a.$[b++]<<8|a.$[b++]<<16|a.$[b++]<<24;d.push(he.KM(f))}d.byteLength=d.length<<2;d.byteOffset=b;d.buffer=a}else if(a instanceof Array&&null==a.jb){d=a.slice();a=[];for(b=0;b<d.length;)e=d[b],++b,e=he.qJ(e),a.push(e&255),a.push(e>>8&255),a.push(e>>16&255),a.push(e>>>24);d.byteLength=d.length<<2;d.byteOffset=0;d.buffer=new rb(a)}else throw new ja("TODO "+sa.Ib(a));d.subarray=Bb.So;d.set=Bb.Ro;return d};Bb.Ro=function(a,b){if(z.D(a.buffer,
rb)){if(a.byteLength+b>this.byteLength)throw new ja("set() outside of range");for(var c=0,d=a.byteLength;c<d;){var e=c++;this[e+b]=a[e]}}else if(a instanceof Array&&null==a.jb){if(a.length+b>this.byteLength)throw new ja("set() outside of range");c=0;for(d=a.length;c<d;)e=c++,this[e+b]=a[e]}else throw new ja("TODO");};Bb.So=function(a,b){var c=Bb.Ag(this.slice(a,b));c.byteOffset=4*a;return c};n["js.html.compat.Uint8Array"]=tc;tc.h=["js","html","compat","Uint8Array"];tc.Ag=function(a,b,c){if("number"==
typeof a){c=[];for(b=0;b<a;){var d=b++;c[d]=0}c.byteLength=c.length;c.byteOffset=0;c.buffer=new rb(c)}else if(z.D(a,rb))null==b&&(b=0),null==c&&(c=a.byteLength-b),c=0==b?a.$:a.$.slice(b,b+c),c.byteLength=c.length,c.byteOffset=b,c.buffer=a;else if(a instanceof Array&&null==a.jb)c=a.slice(),c.byteLength=c.length,c.byteOffset=0,c.buffer=new rb(c);else throw new ja("TODO "+sa.Ib(a));c.subarray=tc.So;c.set=tc.Ro;return c};tc.Ro=function(a,b){if(z.D(a.buffer,rb)){if(a.byteLength+b>this.byteLength)throw new ja("set() outside of range");
for(var c=0,d=a.byteLength;c<d;){var e=c++;this[e+b]=a[e]}}else if(a instanceof Array&&null==a.jb){if(a.length+b>this.byteLength)throw new ja("set() outside of range");c=0;for(d=a.length;c<d;)e=c++,this[e+b]=a[e]}else throw new ja("TODO");};tc.So=function(a,b){var c=tc.Ag(this.slice(a,b));c.byteOffset=a;return c};n["lime._backend.html5.HTML5HTTPRequest"]=Se;Se.h=["lime","_backend","html5","HTML5HTTPRequest"];Se.prototype={Wn:function(a){this.parent=a},load:function(a,b,c){this.request=new XMLHttpRequest;
this.request.addEventListener("progress",b,!1);this.request.onreadystatechange=c;0<this.parent.timeout&&(this.request.timeout=this.parent.timeout);b="";if(null==this.parent.data){for(c=this.parent.formData.keys();c.Ca();){var d=c.next();0<b.length&&(b+="&");var e=encodeURIComponent(d)+"=",f=this.parent.formData,d=sa.Ib(null!=t[d]?f.I(d):f.i[d]);b+=e+encodeURIComponent(d)}"GET"==this.parent.method&&""!=b&&(a=-1<a.indexOf("?")?a+("&"+b):a+("?"+b),b="")}this.request.open(sa.Ib(this.parent.method),a,
!0);this.sH&&(this.request.responseType="arraybuffer");a=!1;c=0;for(e=this.parent.headers;c<e.length;)d=e[c],++c,"Content-Type"==d.name&&(a=!0),this.request.setRequestHeader(d.name,d.value);a||this.request.setRequestHeader("Content-Type",this.parent.contentType);null!=this.parent.data?this.request.send(this.parent.data.m.zH):this.request.send(b)},AJ:function(a){var b=this,c=new cc;this.sH=!0;this.load(a,function(a){c.uC(a.loaded,a.total)},function(){if(4==b.request.readyState){if(null!=b.request.status&&
200<=b.request.status&&400>=b.request.status){var a;a=""==b.request.responseType?cb.Ba(b.request.responseText):cb.Zb(b.request.response);b.tC();c.complete(a)}else b.tC(),c.error(b.request.status);b.request=null}});return c.ic},tC:function(){if(this.parent.dO){this.parent.vL=[];for(var a,b,c=0,d=this.request.getAllResponseHeaders().split("\n");c<d.length;)b=d[c],++c,a=Ga.Cl(Z.substr(b,0,b.indexOf(":"))),b=Ga.Cl(Z.substr(b,b.indexOf(":")+1,null)),""!=a&&this.parent.vL.push(new Re(a,b))}this.parent.sP=
this.request.status},l:Se};n["lime.app.IModule"]=rg;rg.h=["lime","app","IModule"];n["lime.app.Module"]=sd;sd.h=["lime","app","Module"];sd.xb=[rg];sd.prototype={l:sd};n["lime.app.Application"]=ad;ad.h=["lime","app","Application"];ad.V=sd;ad.prototype=S(sd.prototype,{l:ad});n["lime.app.Future"]=Ve;Ve.h=["lime","app","Future"];Ve.prototype={Tj:function(a){null!=a&&(this.Yn?a(this.value):this.Zn||(null==this.Ul&&(this.Ul=[]),this.Ul.push(a)));return this},Kh:function(a){null!=a&&(this.Zn?a(this.error):
this.Yn||(null==this.Vl&&(this.Vl=[]),this.Vl.push(a)));return this},AK:function(a){null!=a&&(null==this.lp&&(this.lp=[]),this.lp.push(a));return this},l:Ve};n["lime.app._Future.FutureWork"]=lb;lb.h=["lime","app","_Future","FutureWork"];lb.Sv=function(a){null==lb.ce&&(lb.ce=new Qe,lb.ce.nA.add(lb.xE),lb.ce.Tj.add(lb.zE),lb.ce.Kh.add(lb.BE));lb.ce.Sv(a)};lb.xE=function(a){try{var b=a.MM();lb.ce.AL({Gl:a.Gl,result:b})}catch(c){c instanceof ja&&(c=c.Lo),lb.ce.BL({Gl:a.Gl,error:c})}};lb.zE=function(a){a.Gl.complete(a.result)};
lb.BE=function(a){a.Gl.error(a.error)};n["lime.app.Promise"]=cc;cc.h=["lime","app","Promise"];cc.prototype={complete:function(a){if(!this.ic.Zn&&(this.ic.Yn=!0,this.ic.value=a,null!=this.ic.Ul)){for(var b=0,c=this.ic.Ul;b<c.length;){var d=c[b];++b;d(a)}this.ic.Ul=null}return this},error:function(a){if(!this.ic.Yn&&(this.ic.Zn=!0,this.ic.error=a,null!=this.ic.Vl)){for(var b=0,c=this.ic.Vl;b<c.length;){var d=c[b];++b;d(a)}this.ic.Vl=null}return this},uC:function(a,b){if(!this.ic.Zn&&!this.ic.Yn&&null!=
this.ic.lp)for(var c=0,d=this.ic.lp;c<d.length;){var e=d[c];++c;e(a,b)}return this},l:cc};n["lime.app._Event_Dynamic_Void"]=Nd;Nd.h=["lime","app","_Event_Dynamic_Void"];Nd.prototype={add:function(a,b,c){null==c&&(c=0);null==b&&(b=!1);for(var d=0,e=this.Wl.length;d<e;){var f=d++;if(c>this.Wl[f]){this.mk.splice(f,0,a);this.Wl.splice(f,0,c);this.mp.splice(f,0,!b);return}}this.mk.push(a);this.Wl.push(c);this.mp.push(!b)},remove:function(a){for(var b=this.mk.length;0<=--b;)jb.Sj(this.mk[b],a)&&(this.mk.splice(b,
1),this.Wl.splice(b,1),this.mp.splice(b,1))},mf:function(a){this.Uz=!1;for(var b=this.mk,c=this.mp,d=0;d<b.length&&(b[d](a),c[d]?++d:this.remove(b[d]),!this.Uz););},l:Nd};n["lime.graphics.ConsoleRenderContext"]=Rf;Rf.h=["lime","graphics","ConsoleRenderContext"];Rf.prototype={l:Rf};n["lime.graphics.FlashRenderContext"]=Hg;Hg.h=["lime","graphics","FlashRenderContext"];n["lime.graphics.Image"]=da;da.h=["lime","graphics","Image"];da.ib=function(a,b,c){null!=a&&(new da).$w(a,b,c)};da.Ib=function(a){return null==
a?null:a.$I};da.ar=function(a,b){if(null==a)return null;var c=new da;c.NE(a,b);return c};da.Zb=function(a){if(null==a)return null;var b=new pc(null,a.width,a.height);b.lw(a);a=new da(b);a.type=ra.kg;return a};da.pb=function(a,b,c){null!=a&&(new da).OE(a,b,c)};da.Bb=function(a){if(null==a)return null;var b=new pc(null,a.width,a.height);b.lw(a);a=new da(b);a.type=ra.kg;return a};da.ec=function(a,b){var c=new cc;da.ib(a,b,function(a){c.complete(a)});return c.ic};da.nc=function(a){var b=new cc;da.ar(a,
function(a){b.complete(a)});return b.ic};da.Dc=function(a){var b=new cc;da.pb(a,function(a){b.complete(a)},function(){b.error("")});return b.ic};da.Ba=function(a){var b;switch(a.length%3){case 1:b="==";break;case 2:b="=";break;default:b=""}null==da.g&&(da.g=new We(cb.Ba(da.da)));return da.g.lI(a).toString()+b};da.Ta=function(a){return 255==a.m[0]?216==a.m[1]:!1};da.$a=function(a){return 137==a.m[0]&&80==a.m[1]&&78==a.m[2]&&71==a.m[3]&&13==a.m[4]&&10==a.m[5]&&26==a.m[6]?10==a.m[7]:!1};da.Ma=function(a){if(71==
a.m[0]&&73==a.m[1]&&70==a.m[2]&&56==a.m[3]){var b=a.m[4];if(55==b||57==b)return 97==a.m[5]}return!1};da.prototype={fillRect:function(a,b,c){a=this.ME(a);if(null!=this.buffer&&null!=a)switch(this.type[1]){case 0:xa.fillRect(this,a,b,c);break;case 1:xa.Vo(this);if(0==this.buffer.data.length)break;Of.fillRect(this,a,b,c);break;case 2:a.offset(this.offsetX,this.offsetY);if(null==c)a=(b&255)<<24|(b>>>24&255)<<16|(b>>>16&255)<<8|b>>>8&255;else switch(c){case 1:a=b;break;case 2:a=(b&255)<<24|(b>>>8&255)<<
16|(b>>>16&255)<<8|b>>>24&255;break;default:a=(b&255)<<24|(b>>>24&255)<<16|(b>>>16&255)<<8|b>>>8&255}this.buffer.wN.fillRect(null,a)}},ME:function(a){return null==a||0>a.x&&(a.width-=-a.x,a.x=0,0>=a.x+a.width)||0>a.y&&(a.height-=-a.y,a.y=0,0>=a.y+a.height)||a.x+a.width>=this.width&&(a.width-=a.x+a.width-this.width,0>=a.width)||a.y+a.height>=this.height&&(a.height-=a.y+a.height-this.height,0>=a.height)?null:a},$w:function(a,b,c){var d=this,e=new Image;e.addEventListener("load",function(){d.buffer=
new pc(null,e.width,e.height);d.buffer.ng=e;d.offsetX=0;d.offsetY=0;d.width=d.buffer.width;d.height=d.buffer.height;null!=c&&c(d)},!1);e.src="data:"+b+";base64,"+a},NE:function(a,b){var c;if(da.$a(a))c="image/png";else if(da.Ta(a))c="image/jpeg";else if(da.Ma(a))c="image/gif";else throw new ja("Image tried to read PNG/JPG Bytes, but found an invalid header.");this.$w(da.Ba(a),c,b)},OE:function(a,b,c){var d=this,e=new Image;e.crossOrigin="Anonymous";e.onload=function(){d.buffer=new pc(null,e.width,
e.height);d.buffer.ng=e;d.width=e.width;d.height=e.height;null!=b&&b(d)};e.onerror=function(){null!=c&&c()};e.src=a},PE:function(a){this.buffer=a;null!=a&&(-1==this.width&&(this.width=a.width),-1==this.height&&(this.height=a.height))},MA:function(){null==this.buffer.data&&0<this.buffer.width&&0<this.buffer.height&&xa.Vo(this);return this.buffer.data},YA:function(){return new zc(0,0,this.width,this.height)},Sn:function(){null==this.buffer.od&&xa.Bg(this);return this.buffer.Sn()},Gj:function(){return null==
this.buffer?!1:this.buffer.wD},$C:function(a){return null==this.buffer?!1:this.buffer.wD=a},l:da,F:{YA:"get_rect",$C:"set_transparent",Gj:"get_transparent",Sn:"get_src",MA:"get_data"}};n["lime.graphics.ImageBuffer"]=pc;pc.h=["lime","graphics","ImageBuffer"];pc.prototype={Sn:function(){return null!=this.ng?this.ng:this.od},lw:function(a){z.D(a,Image)?this.ng=a:z.D(a,HTMLCanvasElement)&&(this.od=a,this.oc=this.od.getContext("2d"));return a},aB:function(){return 4*this.width},l:pc,F:{aB:"get_stride",
lw:"set_src",Sn:"get_src"}};var ra={Zi:!0,Zw:["CANVAS","DATA","FLASH","CUSTOM"],kg:["CANVAS",0]};ra.kg.toString=Xa;ra.kg.jb=ra;ra.lk=["DATA",1];ra.lk.toString=Xa;ra.lk.jb=ra;ra.To=["FLASH",2];ra.To.toString=Xa;ra.To.jb=ra;ra.rs=["CUSTOM",3];ra.rs.toString=Xa;ra.rs.jb=ra;var bb={Zi:!0,Zw:"OPENGL CANVAS DOM FLASH CAIRO CONSOLE CUSTOM NONE".split(" "),lN:function(a){a=["OPENGL",0,a];a.jb=bb;a.toString=Xa;return a},kg:function(a){a=["CANVAS",1,a];a.jb=bb;a.toString=Xa;return a},bN:function(a){a=["DOM",
2,a];a.jb=bb;a.toString=Xa;return a},To:function(a){a=["FLASH",3,a];a.jb=bb;a.toString=Xa;return a},YM:function(a){a=["CAIRO",4,a];a.jb=bb;a.toString=Xa;return a},ZM:function(a){a=["CONSOLE",5,a];a.jb=bb;a.toString=Xa;return a},rs:function(a){a=["CUSTOM",6,a];a.jb=bb;a.toString=Xa;return a},NONE:["NONE",7]};bb.NONE.toString=Xa;bb.NONE.jb=bb;n["lime.graphics.Renderer"]=Qf;Qf.h=["lime","graphics","Renderer"];Qf.prototype={l:Qf};n["lime.graphics.cairo.Cairo"]=Pf;Pf.h=["lime","graphics","cairo","Cairo"];
Pf.prototype={l:Pf};n["lime.graphics.utils.ImageCanvasUtil"]=xa;xa.h=["lime","graphics","utils","ImageCanvasUtil"];xa.Bg=function(a,b){null==b&&(b=!1);var c=a.buffer;null!=c.ng?(null==c.od&&(xa.Wo(a,c.ng.width,c.ng.height),c.oc.drawImage(c.ng,0,0)),c.ng=null):null==c.od&&null!=c.data?(a.$C(!0),xa.Wo(a,c.width,c.height),xa.createImageData(a),c.oc.putImageData(c.de,0,0)):a.type==ra.lk&&null!=c.de&&a.el&&(c.oc.putImageData(c.de,0,0),a.el=!1);b?(c.data=null,c.de=null):null==c.data&&null!=c.de&&(c.data=
c.de.data);a.type=ra.kg};xa.Vo=function(a,b){null==b&&(b=!1);var c=a.buffer;null!=c.ng&&xa.Bg(a);if(null!=c.od&&null==c.data)xa.createImageData(a),a.type==ra.kg&&(a.el=!1);else if(a.type==ra.kg&&null!=c.od&&a.el){if(null==c.de)xa.createImageData(a);else{c.de=c.oc.getImageData(0,0,c.width,c.height);var d=c.de.data.buffer,e;null!=d?e=new hb(d):e=null;c.data=e}a.el=!1}b&&(a.buffer.od=null,a.buffer.oc=null);a.type=ra.lk};xa.Wo=function(a,b,c){var d=a.buffer;null==d.od&&(d.od=window.document.createElement("canvas"),
d.od.width=b,d.od.height=c,a.Gj()?d.oc=d.od.getContext("2d"):(a.Gj()||d.od.setAttribute("moz-opaque","true"),d.oc=d.od.getContext("2d",{alpha:!1})),d.oc.IB=!1,d.oc.JB=!1,d.oc.jB=!1)};xa.createImageData=function(a){a=a.buffer;if(null==a.de){null==a.data?a.de=a.oc.getImageData(0,0,a.width,a.height):(a.de=a.oc.createImageData(a.width,a.height),a.de.data.set(a.data));var b=a.de.data.buffer,c;null!=b?c=new hb(b):c=null;a.data=c}};xa.fillRect=function(a,b,c,d){xa.Bg(a);var e,f;1==d?(d=c>>16&255,e=c>>8&
255,f=c&255,c=a.Gj()?c>>24&255:255):(d=c>>24&255,e=c>>16&255,f=c>>8&255,c=a.Gj()?c&255:255);0==b.x&&0==b.y&&b.width==a.width&&b.height==a.height&&a.Gj()&&0==c?a.buffer.od.width=a.buffer.width:(a.buffer.oc.fillStyle="rgba("+d+", "+e+", "+f+", "+c/255+")",a.buffer.oc.fillRect(b.x+a.offsetX,b.y+a.offsetY,b.width+a.offsetX,b.height+a.offsetY),a.el=!0,a.version++)};xa.Rw=function(a,b){null!=a&&(a.type==ra.kg?xa.Bg(a,b):xa.Vo(a,b))};n["lime.graphics.utils.ImageDataUtil"]=Of;Of.h=["lime","graphics","utils",
"ImageDataUtil"];Of.fillRect=function(a,b,c,d){switch(d){case 1:c=(c>>>16&255)<<24|(c>>>8&255)<<16|(c&255)<<8|c>>>24&255;break;case 2:c=(c>>>8&255)<<24|(c>>>16&255)<<16|(c>>>24&255)<<8|c&255;break}a.Gj()||(c=(c>>>24&255)<<24|(c>>>16&255)<<16|(c>>>8&255)<<8|255);d=a.buffer.data;if(null!=d){var e=a.buffer.format;a.buffer.UK&&(0==(c&255)?0!=c&&(c=0):255!=(c&255)&&(ac.au=ac.Xw[c&255],c=((c>>>24&255)*ac.au>>16&255)<<24|((c>>>16&255)*ac.au>>16&255)<<16|((c>>>8&255)*ac.au>>16&255)<<8|c&255));b=new Ue(a,
b);for(var f,g=0,h=b.height;g<h;){f=b.offset+b.Do*g++;for(var k=0,l=b.width;k<l;){var m=f+4*k++;switch(e){case 0:d[m]=c>>>24&255;d[m+1]=c>>>16&255;d[m+2]=c>>>8&255;d[m+3]=c&255;break;case 1:d[m]=c&255;d[m+1]=c>>>24&255;d[m+2]=c>>>16&255;d[m+3]=c>>>8&255;break;case 2:d[m]=c>>>8&255,d[m+1]=c>>>16&255,d[m+2]=c>>>24&255,d[m+3]=c&255}}}a.el=!0;a.version++}};n["lime.graphics.utils._ImageDataUtil.ImageDataView"]=Ue;Ue.h=["lime","graphics","utils","_ImageDataUtil","ImageDataView"];Ue.prototype={l:Ue};n["lime.math.Matrix3"]=
rd;rd.h=["lime","math","Matrix3"];rd.prototype={scale:function(a,b){this.$*=a;this.m*=b;this.Hq*=a;this.d*=b;this.Bc*=a;this.Cc*=b},l:rd};n["lime.math.Rectangle"]=zc;zc.h=["lime","math","Rectangle"];zc.prototype={offset:function(a,b){this.x+=a;this.y+=b},l:zc};n["lime.math.Vector2"]=Gg;Gg.h=["lime","math","Vector2"];var ac={};n["lime.math.color._RGBA.RGBA_Impl_"]=ac;ac.h=["lime","math","color","_RGBA","RGBA_Impl_"];n["lime.net._IHTTPRequest"]=Te;Te.h=["lime","net","_IHTTPRequest"];Te.prototype={l:Te};
n["lime.net._HTTPRequest.AbstractHTTPRequest"]=$c;$c.h=["lime","net","_HTTPRequest","AbstractHTTPRequest"];$c.xb=[Te];$c.prototype={l:$c};n["lime.net._HTTPRequest_Bytes"]=ge;ge.h=["lime","net","_HTTPRequest_Bytes"];ge.V=$c;ge.prototype=S($c.prototype,{ar:function(a){return a},load:function(a){var b=this;null!=a&&(this.uri=a);var c=new cc;a=this.Pz.AJ(this.uri);a.AK(F(c,c.uC));a.Kh(F(c,c.error));a.Tj(function(a){b.uL=b.ar(a);c.complete(b.uL)});return c.ic},l:ge});n["lime.net.HTTPRequestHeader"]=Re;
Re.h=["lime","net","HTTPRequestHeader"];Re.prototype={l:Re};n["lime.system.ThreadPool"]=Qe;Qe.h=["lime","system","ThreadPool"];Qe.prototype={Sv:function(a){this.nA.mf(a)},AL:function(a){this.Tj.mf(a)},BL:function(a){this.Kh.mf(a)},l:Qe};n["lime.utils.Assets"]=Pe;Pe.h=["lime","utils","Assets"];Pe.hN=function(){return!1};Pe.iN=function(){return null};Pe.jN=function(){return null};var bc=K.CAPTURA.Extension.Signal.Signal=function(a){null==a&&(a=[]);this.valueClasses=a;this.Qe=gb.Zb;this.Rv=!1};n["msignal.Signal"]=
bc;bc.h=["msignal","Signal"];bc.prototype={add:function(a){return this.dL(a)},remove:function(a){var b=this.Qe.find(a);if(null==b)return null;this.Qe=this.Qe.sI(a);return b},dL:function(a,b,c){null==c&&(c=0);null==b&&(b=!1);return this.eL(a,b)?(a=this.Pq(a,b,c),this.Rv||0==c||(this.Rv=!0),this.Qe=this.Rv||0!=c?this.Qe.fJ(a):this.Qe.Qv(a),a):this.Qe.find(a)},eL:function(a){return this.Qe.pe&&null!=this.Qe.find(a)?!1:!0},Pq:function(){return null},QI:function(){return this.Qe.sl()},l:bc,F:{QI:"get_numListeners"}};
var ye=K.CAPTURA.Extension.Signal.Signal=function(){bc.call(this)};n["msignal.Signal0"]=ye;ye.h=["msignal","Signal0"];ye.V=bc;ye.prototype=S(bc.prototype,{mf:function(){for(var a=this.Qe;a.pe;)a.head.Kn(),a=a.md},Pq:function(a,b,c){null==c&&(c=0);null==b&&(b=!1);return new Me(this,a,b,c)},l:ye});var Dd=K.CAPTURA.Extension.Signal.Signal=function(a){bc.call(this,[a])};n["msignal.Signal1"]=Dd;Dd.h=["msignal","Signal1"];Dd.V=bc;Dd.prototype=S(bc.prototype,{mf:function(a){for(var b=this.Qe;b.pe;)b.head.Kn(a),
b=b.md},Pq:function(a,b,c){null==c&&(c=0);null==b&&(b=!1);return new Ne(this,a,b,c)},l:Dd});var Mf=K.CAPTURA.Extension.Signal.Signal=function(a,b){bc.call(this,[a,b])};n["msignal.Signal2"]=Mf;Mf.h=["msignal","Signal2"];Mf.V=bc;Mf.prototype=S(bc.prototype,{mf:function(a,b){for(var c=this.Qe;c.pe;)c.head.Kn(a,b),c=c.md},Pq:function(a,b,c){null==c&&(c=0);null==b&&(b=!1);return new Oe(this,a,b,c)},l:Mf});var qb=K.CAPTURA.Extension.Signal.Slot=function(a,b,c,d){null==d&&(d=0);null==c&&(c=!1);this.NL=a;
this.XC(b);this.once=c;this.priority=d;this.enabled=!0};n["msignal.Slot"]=qb;qb.h=["msignal","Slot"];qb.prototype={remove:function(){this.NL.remove(this.listener)},XC:function(a){return this.listener=a},l:qb,F:{XC:"set_listener"}};var Me=K.CAPTURA.Extension.Signal.Slot=function(a,b,c,d){null==d&&(d=0);null==c&&(c=!1);qb.call(this,a,b,c,d)};n["msignal.Slot0"]=Me;Me.h=["msignal","Slot0"];Me.V=qb;Me.prototype=S(qb.prototype,{Kn:function(){this.enabled&&(this.once&&this.remove(),this.listener())},l:Me});
var Ne=K.CAPTURA.Extension.Signal.Slot=function(a,b,c,d){null==d&&(d=0);null==c&&(c=!1);qb.call(this,a,b,c,d)};n["msignal.Slot1"]=Ne;Ne.h=["msignal","Slot1"];Ne.V=qb;Ne.prototype=S(qb.prototype,{Kn:function(a){this.enabled&&(this.once&&this.remove(),null!=this.IK&&(a=this.IK),this.listener(a))},l:Ne});var Oe=K.CAPTURA.Extension.Signal.Slot=function(a,b,c,d){null==d&&(d=0);null==c&&(c=!1);qb.call(this,a,b,c,d)};n["msignal.Slot2"]=Oe;Oe.h=["msignal","Slot2"];Oe.V=qb;Oe.prototype=S(qb.prototype,{Kn:function(a,
b){this.enabled&&(this.once&&this.remove(),null!=this.JK&&(a=this.JK),null!=this.KK&&(b=this.KK),this.listener(a,b))},l:Oe});n["msignal.SlotList"]=gb;gb.h=["msignal","SlotList"];gb.prototype={sl:function(){if(!this.pe)return 0;if(this.md==gb.Zb)return 1;for(var a=0,b=this;b.pe;)++a,b=b.md;return a},Qv:function(a){return new gb(a,this)},fJ:function(a){if(!this.pe)return new gb(a);var b=a.priority;if(b>=this.head.priority)return this.Qv(a);for(var c=new gb(this.head),d=c,e=this.md;e.pe;){if(b>e.head.priority)return d.md=
e.Qv(a),c;d=d.md=new gb(e.head);e=e.md}d.md=new gb(a);return c},sI:function(a){if(!this.pe||null==a)return this;if(jb.Sj(this.head.listener,a))return this.md;for(var b=new gb(this.head),c=b,d=this.md;d.pe;){if(jb.Sj(d.head.listener,a))return c.md=d.md,b;c=c.md=new gb(d.head);d=d.md}return this},find:function(a){if(!this.pe)return null;for(var b=this;b.pe;){if(jb.Sj(b.head.listener,a))return b.head;b=b.md}return null},l:gb,F:{sl:"get_length"}};var hc,Rg=0;n.Math=Math;String.prototype.l=n.String=String;
String.h=["String"];n.Array=Array;Array.h=["Array"];Date.prototype.l=n.Date=Date;Date.h=["Date"];var tg=n.Int={h:["Int"]},Sg=n.Dynamic={h:["Dynamic"]},Fg=n.Float=Number;Fg.h=["Float"];var Eg=Boolean;Eg.Zi=["Bool"];var Tg=n.Class={h:["Class"]},Ug={};window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame;var t={},Lf=Nf.ArrayBuffer||rb;Lf.prototype.slice||(Lf.prototype.slice=
rb.ec);var vb=Nf.Float32Array||Bb.Ag,hb=Nf.Uint8Array||tc.Ag,Vg=new Uint32Array(256);ac.Xw=Vg;for(var Mg=0;256>Mg;){var Ng=Mg++;ac.Xw[Ng]=Math.ceil(257.00392156862745*Ng)}var Wg=new hb(510);ac.Yw=Wg;for(var Og=0;255>Og;){var Pg=Og++;ac.Yw[Pg]=Pg}for(var Qg=255;511>Qg;){var Xg=Qg++;ac.Yw[Xg]=255}gb.Zb=new gb(null,null);ia.cs=Math.PI/180;ia.mC=!1;ia.QB=!1;ia.Oo=!0;Wc.Bb="0.93";oa.Ue={Dg:{name:{T:null},id:{T:null},fg:{T:null},state:{T:null},zr:{T:null}}};Ba.pb={Dg:{position:{wo:null},zf:{wo:null},Lg:{T:null},
Mg:{T:null},Kg:{T:null},Ng:{T:null},Sa:{T:null},Sb:{T:null},Fb:{T:null},tf:{T:null},mode:{T:null},tb:{T:null},Xc:{T:null},Qb:{T:null},Fh:{T:null},NO:{T:null}}};Ba.Ah=0;Ba.xh=1;Ba.ae=0;Ba.Nd=1;Ba.Kj=0;Ba.Pj=10;Ba.zl=11;Ba.Sj=12;Ba.Qj=13;Ba.Cl=20;Ba.Uo=21;p.g=Array(4);la.pb={Dg:{rotation:{wo:null},speed:{wo:null},hd:{yP:["lockedTargetId"]}}};la.kp=new p(0,1,0);la.da=new p(0,0,0);ya.Ma=new X;ya.nc=new X;yb.Bg=.02;yb.jg=.1;Ib.Vz=new Ib;Ib.yE=new Ib;qc.ib=new xb;qc.da=new Ib;Oc.Md={Dg:{volume:{Tv:[0,1]}}};
Oc.nc="//cdn.dashjs.org/latest/dash.all.min.js";Oc.Dc="//cdn.jsdelivr.net/hls.js/latest/hls.min.js";Fa.Hl=[[.5,.25],[.5,.375],[.25,.5],[.375,.5],[.5,.5],[.625,.5],[.75,.5],[.5,.625],[.5,.75]];Fa.qE=[.05,.1,.05,.1,.4,.1,.05,.1,.05];Fa.dN=Math.PI/180;Fa.yL=180/Math.PI;va.pb={Dg:{id:{T:null},name:{T:null},ru:{T:null},Yk:{T:null},alpha:{T:null},un:{T:null},aa:{T:null},Fz:{T:null},fl:{T:null},nf:{T:null},nC:{T:null},WD:{T:null},LM:{T:null},mP:{T:null},hO:{T:null}}};va.Oo=0;va.Ro=1;va.Di=2;va.Dc=0;va.Uc=
1;Rd.Ag=512;Y.D=Math.PI/180;Y.da=180/Math.PI;Y.Ue="cameras";Y.Af="input";ze.Md="layersController";Td.Md="layersController";Td.uh=100;q.ce=36193;q.pb=.001;q.Bb="assets/shaders/";q.g=0;Cb.hB=1;Cb.rB=2;Cb.iB=4;Cb.DE=16;Ma.g=0;Ma.$a=1;Ma.Ta=1E3;Ra.Ta=1E-8;Ra.Ma=1E9;db.Ah=new ca(0,0,0,0);db.IM=2;Ia.Ue={Dg:{Eu:{vo:null},$r:{vo:null},qr:{T:null},Tv:{T:null},Vn:{T:null},Jn:{T:null},pv:{T:null}}};Ia.xh=0;Ia.Ah=1;Ia.yh=2;pd.Ma={Dg:{position:{wo:null},direction:{wo:null},Ad:{T:null},Ku:{T:null}}};Yb.nE=0;Yb.Cz=
1;Yb.pE=2;Yb.Nw=3;hg.sE=!1;z.YH={}.toString;qa.D=0;qa.Af=1;qa.lg=2;qa.jg=4;qa.Md=7;qa.Ma=new X;qa.Di=new p(0,0,0);aa.ce=0;aa.Dc=1;aa.be=2;aa.ae=0;aa.Te=0;aa.Md=1;aa.Zc=2;aa.Uc=3;ha.bE="";ha.ae=(new Date).getTime()/1E3;r.Ma=new X;r.Ba=new p(0,0,0);r.Bb=new p(0,0,0);r.Ta=new p(0,0,0);O.Zc=new p(0,0,0);V.Ue={Dg:{Wc:{Nh:null},Fe:{Nh:null},Zd:{Nh:null},kc:{Nh:null},Dd:{Nh:null},Re:{Nh:null},He:{Nh:null},Sf:{Nh:null},lc:{Nh:null},sn:{vo:["ambient"]},Hn:{vo:["diffuse"]},Co:{vo:["specular"]},Iu:{vo:["emissive"]},
as:{T:null},FD:{T:null},ds:{T:null},CB:{T:null},es:{T:null},gs:{T:null},fs:{T:null},In:{T:null},JD:{T:null},KD:{T:null},jC:{T:null},bw:{T:null},pr:{T:null},tr:{T:null},ID:{T:null},Jf:{Pr:null},Me:{Pr:null},$f:{Pr:null},Ui:{Pr:null},Kf:{Pr:null},HD:{T:null},Rj:{T:null},mB:{T:null},nB:{T:null},yj:{Nh:null},Iq:{xP:null},QP:{T:null}}};V.ib=!0;V.Ta=!0;V.ec=!0;V.nc=!0;V.ae=!0;V.Uc=!0;V.$a=!0;V.pb=!0;V.Ib=!0;V.Dc=!0;V.Nd=!0;Q.to=.45454545454545453;Q.Go=2.2;$b.Zb=0;$b.ib=function(){var a=new r;a.a[0]=0;a.a[1]=
0;a.a[2]=0;a.a[3]=0;a.a[4]=0;a.a[5]=0;a.a[6]=0;a.a[7]=0;a.a[8]=0;a.a[9]=0;a.a[10]=0;a.a[11]=0;a.a[12]=0;a.a[13]=0;a.a[14]=0;a.a[15]=0;return a}(this);Aa.fN={Dg:{gy:{T:null},ey:{T:null},hy:{T:null},fy:{T:null},ly:{T:null},jy:{T:null},my:{T:null},ky:{T:null},Dy:{T:null},By:{T:null},Ey:{T:null},Cy:{T:null}}};ee.pb=function(){var a=new ea;null!=t.bonesDeclaration?a.C("bonesDeclaration","#if NUM_BONE_INFLUENCERS>0\nuniform mat4 mBones[BonesPerMesh];\nattribute vec4 matricesIndices;\nattribute vec4 matricesWeights;\n#if NUM_BONE_INFLUENCERS>4\nattribute vec4 matricesIndicesExtra;\nattribute vec4 matricesWeightsExtra;\n#endif\n#endif"):
a.i.bonesDeclaration="#if NUM_BONE_INFLUENCERS>0\nuniform mat4 mBones[BonesPerMesh];\nattribute vec4 matricesIndices;\nattribute vec4 matricesWeights;\n#if NUM_BONE_INFLUENCERS>4\nattribute vec4 matricesIndicesExtra;\nattribute vec4 matricesWeightsExtra;\n#endif\n#endif";null!=t.bonesVertex?a.C("bonesVertex","#if NUM_BONE_INFLUENCERS>0\nmat4 influence;\ninfluence=mBones[int(matricesIndices[0])]*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\ninfluence+=mBones[int(matricesIndices[1])]*matricesWeights[1];\n#endif \n#if NUM_BONE_INFLUENCERS>2\ninfluence+=mBones[int(matricesIndices[2])]*matricesWeights[2];\n#endif \n#if NUM_BONE_INFLUENCERS>3\ninfluence+=mBones[int(matricesIndices[3])]*matricesWeights[3];\n#endif \n#if NUM_BONE_INFLUENCERS>4\ninfluence+=mBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];\n#endif \n#if NUM_BONE_INFLUENCERS>5\ninfluence+=mBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];\n#endif \n#if NUM_BONE_INFLUENCERS>6\ninfluence+=mBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];\n#endif \n#if NUM_BONE_INFLUENCERS>7\ninfluence+=mBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];\n#endif \nfinalWorld=finalWorld*influence;\n#endif"):
a.i.bonesVertex="#if NUM_BONE_INFLUENCERS>0\nmat4 influence;\ninfluence=mBones[int(matricesIndices[0])]*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\ninfluence+=mBones[int(matricesIndices[1])]*matricesWeights[1];\n#endif \n#if NUM_BONE_INFLUENCERS>2\ninfluence+=mBones[int(matricesIndices[2])]*matricesWeights[2];\n#endif \n#if NUM_BONE_INFLUENCERS>3\ninfluence+=mBones[int(matricesIndices[3])]*matricesWeights[3];\n#endif \n#if NUM_BONE_INFLUENCERS>4\ninfluence+=mBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];\n#endif \n#if NUM_BONE_INFLUENCERS>5\ninfluence+=mBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];\n#endif \n#if NUM_BONE_INFLUENCERS>6\ninfluence+=mBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];\n#endif \n#if NUM_BONE_INFLUENCERS>7\ninfluence+=mBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];\n#endif \nfinalWorld=finalWorld*influence;\n#endif";
null!=t.bumpFragment?a.C("bumpFragment","vec2 uvOffset=vec2(0.0,0.0);\n#if defined(BUMP) || defined(PARALLAX)\nmat3 TBN=cotangent_frame(normalW*vBumpInfos.y,-viewDirectionW,vBumpUV);\n#endif\n#ifdef PARALLAX\nmat3 invTBN=transposeMat3(TBN);\n#ifdef PARALLAXOCCLUSION\nuvOffset=parallaxOcclusion(invTBN*-viewDirectionW,invTBN*normalW,vBumpUV,vBumpInfos.z);\n#else\nuvOffset=parallaxOffset(invTBN*viewDirectionW,vBumpInfos.z);\n#endif\n#endif\n#ifdef BUMP\nnormalW=perturbNormal(viewDirectionW,TBN,vBumpUV+uvOffset);\n#endif"):
a.i.bumpFragment="vec2 uvOffset=vec2(0.0,0.0);\n#if defined(BUMP) || defined(PARALLAX)\nmat3 TBN=cotangent_frame(normalW*vBumpInfos.y,-viewDirectionW,vBumpUV);\n#endif\n#ifdef PARALLAX\nmat3 invTBN=transposeMat3(TBN);\n#ifdef PARALLAXOCCLUSION\nuvOffset=parallaxOcclusion(invTBN*-viewDirectionW,invTBN*normalW,vBumpUV,vBumpInfos.z);\n#else\nuvOffset=parallaxOffset(invTBN*viewDirectionW,vBumpInfos.z);\n#endif\n#endif\n#ifdef BUMP\nnormalW=perturbNormal(viewDirectionW,TBN,vBumpUV+uvOffset);\n#endif";
null!=t.bumpFragmentFunctions?a.C("bumpFragmentFunctions","#ifdef BUMP\nvarying vec2 vBumpUV;\nuniform vec3 vBumpInfos;\nuniform sampler2D bumpSampler;\n\nmat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv)\n{\n\nvec3 dp1=dFdx(p);\nvec3 dp2=dFdy(p);\nvec2 duv1=dFdx(uv);\nvec2 duv2=dFdy(uv);\n\nvec3 dp2perp=cross(dp2,normal);\nvec3 dp1perp=cross(normal,dp1);\nvec3 tangent=dp2perp*duv1.x+dp1perp*duv2.x;\nvec3 binormal=dp2perp*duv1.y+dp1perp*duv2.y;\n\nfloat invmax=inversesqrt(max(dot(tangent,tangent),dot(binormal,binormal)));\nreturn mat3(tangent*invmax,binormal*invmax,normal);\n}\nvec3 perturbNormal(vec3 viewDir,mat3 cotangentFrame,vec2 uv)\n{\nvec3 map=texture2D(bumpSampler,uv).xyz;\n#ifdef INVERTNORMALMAPX\nmap.x=1.0-map.x;\n#endif\n#ifdef INVERTNORMALMAPY\nmap.y=1.0-map.y;\n#endif\nmap=map*255./127.-128./127.;\nreturn normalize(cotangentFrame*map);\n}\n#ifdef PARALLAX\nconst float minSamples=4.;\nconst float maxSamples=15.;\nconst int iMaxSamples=15;\n\nvec2 parallaxOcclusion(vec3 vViewDirCoT,vec3 vNormalCoT,vec2 texCoord,float parallaxScale) {\nfloat parallaxLimit=length(vViewDirCoT.xy)/vViewDirCoT.z;\nparallaxLimit*=parallaxScale;\nvec2 vOffsetDir=normalize(vViewDirCoT.xy);\nvec2 vMaxOffset=vOffsetDir*parallaxLimit;\nfloat numSamples=maxSamples+(dot(vViewDirCoT,vNormalCoT)*(minSamples-maxSamples));\nfloat stepSize=1.0/numSamples;\n\nfloat currRayHeight=1.0;\nvec2 vCurrOffset=vec2(0,0);\nvec2 vLastOffset=vec2(0,0);\nfloat lastSampledHeight=1.0;\nfloat currSampledHeight=1.0;\nfor (int i=0; i<iMaxSamples; i++)\n{\ncurrSampledHeight=texture2D(bumpSampler,vBumpUV+vCurrOffset).w;\n\nif (currSampledHeight>currRayHeight)\n{\nfloat delta1=currSampledHeight-currRayHeight;\nfloat delta2=(currRayHeight+stepSize)-lastSampledHeight;\nfloat ratio=delta1/(delta1+delta2);\nvCurrOffset=(ratio)* vLastOffset+(1.0-ratio)*vCurrOffset;\n\nbreak;\n}\nelse\n{\ncurrRayHeight-=stepSize;\nvLastOffset=vCurrOffset;\nvCurrOffset+=stepSize*vMaxOffset;\nlastSampledHeight=currSampledHeight;\n}\n}\nreturn vCurrOffset;\n}\nvec2 parallaxOffset(vec3 viewDir,float heightScale)\n{\n\nfloat height=texture2D(bumpSampler,vBumpUV).w;\nvec2 texCoordOffset=heightScale*viewDir.xy*height;\nreturn -texCoordOffset;\n}\n#endif\n#endif"):
a.i.bumpFragmentFunctions="#ifdef BUMP\nvarying vec2 vBumpUV;\nuniform vec3 vBumpInfos;\nuniform sampler2D bumpSampler;\n\nmat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv)\n{\n\nvec3 dp1=dFdx(p);\nvec3 dp2=dFdy(p);\nvec2 duv1=dFdx(uv);\nvec2 duv2=dFdy(uv);\n\nvec3 dp2perp=cross(dp2,normal);\nvec3 dp1perp=cross(normal,dp1);\nvec3 tangent=dp2perp*duv1.x+dp1perp*duv2.x;\nvec3 binormal=dp2perp*duv1.y+dp1perp*duv2.y;\n\nfloat invmax=inversesqrt(max(dot(tangent,tangent),dot(binormal,binormal)));\nreturn mat3(tangent*invmax,binormal*invmax,normal);\n}\nvec3 perturbNormal(vec3 viewDir,mat3 cotangentFrame,vec2 uv)\n{\nvec3 map=texture2D(bumpSampler,uv).xyz;\n#ifdef INVERTNORMALMAPX\nmap.x=1.0-map.x;\n#endif\n#ifdef INVERTNORMALMAPY\nmap.y=1.0-map.y;\n#endif\nmap=map*255./127.-128./127.;\nreturn normalize(cotangentFrame*map);\n}\n#ifdef PARALLAX\nconst float minSamples=4.;\nconst float maxSamples=15.;\nconst int iMaxSamples=15;\n\nvec2 parallaxOcclusion(vec3 vViewDirCoT,vec3 vNormalCoT,vec2 texCoord,float parallaxScale) {\nfloat parallaxLimit=length(vViewDirCoT.xy)/vViewDirCoT.z;\nparallaxLimit*=parallaxScale;\nvec2 vOffsetDir=normalize(vViewDirCoT.xy);\nvec2 vMaxOffset=vOffsetDir*parallaxLimit;\nfloat numSamples=maxSamples+(dot(vViewDirCoT,vNormalCoT)*(minSamples-maxSamples));\nfloat stepSize=1.0/numSamples;\n\nfloat currRayHeight=1.0;\nvec2 vCurrOffset=vec2(0,0);\nvec2 vLastOffset=vec2(0,0);\nfloat lastSampledHeight=1.0;\nfloat currSampledHeight=1.0;\nfor (int i=0; i<iMaxSamples; i++)\n{\ncurrSampledHeight=texture2D(bumpSampler,vBumpUV+vCurrOffset).w;\n\nif (currSampledHeight>currRayHeight)\n{\nfloat delta1=currSampledHeight-currRayHeight;\nfloat delta2=(currRayHeight+stepSize)-lastSampledHeight;\nfloat ratio=delta1/(delta1+delta2);\nvCurrOffset=(ratio)* vLastOffset+(1.0-ratio)*vCurrOffset;\n\nbreak;\n}\nelse\n{\ncurrRayHeight-=stepSize;\nvLastOffset=vCurrOffset;\nvCurrOffset+=stepSize*vMaxOffset;\nlastSampledHeight=currSampledHeight;\n}\n}\nreturn vCurrOffset;\n}\nvec2 parallaxOffset(vec3 viewDir,float heightScale)\n{\n\nfloat height=texture2D(bumpSampler,vBumpUV).w;\nvec2 texCoordOffset=heightScale*viewDir.xy*height;\nreturn -texCoordOffset;\n}\n#endif\n#endif";
null!=t.clipPlaneFragment?a.C("clipPlaneFragment","#ifdef CLIPPLANE\nif (fClipDistance>0.0)\n{\ndiscard;\n}\n#endif"):a.i.clipPlaneFragment="#ifdef CLIPPLANE\nif (fClipDistance>0.0)\n{\ndiscard;\n}\n#endif";null!=t.clipPlaneFragmentDeclaration?a.C("clipPlaneFragmentDeclaration","#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif"):a.i.clipPlaneFragmentDeclaration="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif";null!=t.clipPlaneVertex?a.C("clipPlaneVertex","#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif"):
a.i.clipPlaneVertex="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif";null!=t.clipPlaneVertexDeclaration?a.C("clipPlaneVertexDeclaration","#ifdef CLIPPLANE\nuniform vec4 vClipPlane;\nvarying float fClipDistance;\n#endif"):a.i.clipPlaneVertexDeclaration="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;\nvarying float fClipDistance;\n#endif";null!=t.colorCurves?a.C("colorCurves","const vec3 HDTVRec709_RGBLuminanceCoefficients=vec3(0.2126,0.7152,0.0722);\nvec3 applyColorCurves(vec3 original) {\nvec3 result=original;\n\n\n\nfloat luma=dot(result.rgb,HDTVRec709_RGBLuminanceCoefficients);\nvec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0,0.0),vec2(1.0,1.0));\nvec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;\nresult.rgb*=colorCurve.rgb;\nresult.rgb=mix(vec3(luma,luma,luma),result.rgb,colorCurve.a);\nreturn result;\n}"):
a.i.colorCurves="const vec3 HDTVRec709_RGBLuminanceCoefficients=vec3(0.2126,0.7152,0.0722);\nvec3 applyColorCurves(vec3 original) {\nvec3 result=original;\n\n\n\nfloat luma=dot(result.rgb,HDTVRec709_RGBLuminanceCoefficients);\nvec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0,0.0),vec2(1.0,1.0));\nvec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;\nresult.rgb*=colorCurve.rgb;\nresult.rgb=mix(vec3(luma,luma,luma),result.rgb,colorCurve.a);\nreturn result;\n}";
null!=t.colorCurvesDefinition?a.C("colorCurvesDefinition","uniform vec4 vCameraColorCurveNeutral;\nuniform vec4 vCameraColorCurvePositive;\nuniform vec4 vCameraColorCurveNegative;"):a.i.colorCurvesDefinition="uniform vec4 vCameraColorCurveNeutral;\nuniform vec4 vCameraColorCurvePositive;\nuniform vec4 vCameraColorCurveNegative;";null!=t.colorGrading?a.C("colorGrading","vec4 colorGrades(vec4 color) \n{ \n\nfloat sliceContinuous=color.z*vCameraColorGradingInfos.z;\nfloat sliceInteger=floor(sliceContinuous);\n\n\nfloat sliceFraction=sliceContinuous-sliceInteger; \n\nvec2 sliceUV=color.xy*vCameraColorGradingScaleOffset.xy+vCameraColorGradingScaleOffset.zw;\n\n\nsliceUV.x+=sliceInteger*vCameraColorGradingInfos.w;\nvec4 slice0Color=texture2D(cameraColorGrading2DSampler,sliceUV);\nsliceUV.x+=vCameraColorGradingInfos.w;\nvec4 slice1Color=texture2D(cameraColorGrading2DSampler,sliceUV);\nvec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\ncolor.rgb=mix(color.rgb,result,vCameraColorGradingInfos.x);\nreturn color;\n}"):
a.i.colorGrading="vec4 colorGrades(vec4 color) \n{ \n\nfloat sliceContinuous=color.z*vCameraColorGradingInfos.z;\nfloat sliceInteger=floor(sliceContinuous);\n\n\nfloat sliceFraction=sliceContinuous-sliceInteger; \n\nvec2 sliceUV=color.xy*vCameraColorGradingScaleOffset.xy+vCameraColorGradingScaleOffset.zw;\n\n\nsliceUV.x+=sliceInteger*vCameraColorGradingInfos.w;\nvec4 slice0Color=texture2D(cameraColorGrading2DSampler,sliceUV);\nsliceUV.x+=vCameraColorGradingInfos.w;\nvec4 slice1Color=texture2D(cameraColorGrading2DSampler,sliceUV);\nvec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\ncolor.rgb=mix(color.rgb,result,vCameraColorGradingInfos.x);\nreturn color;\n}";
null!=t.colorGradingDefinition?a.C("colorGradingDefinition","uniform sampler2D cameraColorGrading2DSampler;\nuniform vec4 vCameraColorGradingInfos;\nuniform vec4 vCameraColorGradingScaleOffset;"):a.i.colorGradingDefinition="uniform sampler2D cameraColorGrading2DSampler;\nuniform vec4 vCameraColorGradingInfos;\nuniform vec4 vCameraColorGradingScaleOffset;";null!=t.fogFragment?a.C("fogFragment","#ifdef FOG\nfloat fog=CalcFogFactor();\ncolor.rgb=fog*color.rgb+(1.0-fog)*vFogColor;\n#endif"):a.i.fogFragment=
"#ifdef FOG\nfloat fog=CalcFogFactor();\ncolor.rgb=fog*color.rgb+(1.0-fog)*vFogColor;\n#endif";null!=t.fogFragmentDeclaration?a.C("fogFragmentDeclaration","#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;\nuniform vec3 vFogColor;\nvarying float fFogDistance;\nfloat CalcFogFactor()\n{\nfloat fogCoeff=1.0;\nfloat fogStart=vFogInfos.y;\nfloat fogEnd=vFogInfos.z;\nfloat fogDensity=vFogInfos.w;\nif (FOGMODE_LINEAR == vFogInfos.x)\n{\nfogCoeff=(fogEnd-fFogDistance)/(fogEnd-fogStart);\n}\nelse if (FOGMODE_EXP == vFogInfos.x)\n{\nfogCoeff=1.0/pow(E,fFogDistance*fogDensity);\n}\nelse if (FOGMODE_EXP2 == vFogInfos.x)\n{\nfogCoeff=1.0/pow(E,fFogDistance*fFogDistance*fogDensity*fogDensity);\n}\nreturn clamp(fogCoeff,0.0,1.0);\n}\n#endif"):
a.i.fogFragmentDeclaration="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;\nuniform vec3 vFogColor;\nvarying float fFogDistance;\nfloat CalcFogFactor()\n{\nfloat fogCoeff=1.0;\nfloat fogStart=vFogInfos.y;\nfloat fogEnd=vFogInfos.z;\nfloat fogDensity=vFogInfos.w;\nif (FOGMODE_LINEAR == vFogInfos.x)\n{\nfogCoeff=(fogEnd-fFogDistance)/(fogEnd-fogStart);\n}\nelse if (FOGMODE_EXP == vFogInfos.x)\n{\nfogCoeff=1.0/pow(E,fFogDistance*fogDensity);\n}\nelse if (FOGMODE_EXP2 == vFogInfos.x)\n{\nfogCoeff=1.0/pow(E,fFogDistance*fFogDistance*fogDensity*fogDensity);\n}\nreturn clamp(fogCoeff,0.0,1.0);\n}\n#endif";
null!=t.fogVertex?a.C("fogVertex","#ifdef FOG\nfFogDistance=(view*worldPos).z;\n#endif"):a.i.fogVertex="#ifdef FOG\nfFogDistance=(view*worldPos).z;\n#endif";null!=t.fogVertexDeclaration?a.C("fogVertexDeclaration","#ifdef FOG\nvarying float fFogDistance;\n#endif"):a.i.fogVertexDeclaration="#ifdef FOG\nvarying float fFogDistance;\n#endif";null!=t.fresnelFunction?a.C("fresnelFunction","#ifdef FRESNEL\nfloat computeFresnelTerm(vec3 viewDirection,vec3 worldNormal,float bias,float power)\n{\nfloat fresnelTerm=pow(bias+abs(dot(viewDirection,worldNormal)),power);\nreturn clamp(fresnelTerm,0.,1.);\n}\n#endif"):
a.i.fresnelFunction="#ifdef FRESNEL\nfloat computeFresnelTerm(vec3 viewDirection,vec3 worldNormal,float bias,float power)\n{\nfloat fresnelTerm=pow(bias+abs(dot(viewDirection,worldNormal)),power);\nreturn clamp(fresnelTerm,0.,1.);\n}\n#endif";null!=t.harmonicsFunctions?a.C("harmonicsFunctions","#ifdef USESPHERICALFROMREFLECTIONMAP\nuniform vec3 vSphericalX;\nuniform vec3 vSphericalY;\nuniform vec3 vSphericalZ;\nuniform vec3 vSphericalXX;\nuniform vec3 vSphericalYY;\nuniform vec3 vSphericalZZ;\nuniform vec3 vSphericalXY;\nuniform vec3 vSphericalYZ;\nuniform vec3 vSphericalZX;\nvec3 EnvironmentIrradiance(vec3 normal)\n{\n\n\n\nvec3 result =\nvSphericalX*normal.x +\nvSphericalY*normal.y +\nvSphericalZ*normal.z +\nvSphericalXX*normal.x*normal.x +\nvSphericalYY*normal.y*normal.y +\nvSphericalZZ*normal.z*normal.z +\nvSphericalYZ*normal.y*normal.z +\nvSphericalZX*normal.z*normal.x +\nvSphericalXY*normal.x*normal.y;\nreturn result.rgb;\n}\n#endif"):
a.i.harmonicsFunctions="#ifdef USESPHERICALFROMREFLECTIONMAP\nuniform vec3 vSphericalX;\nuniform vec3 vSphericalY;\nuniform vec3 vSphericalZ;\nuniform vec3 vSphericalXX;\nuniform vec3 vSphericalYY;\nuniform vec3 vSphericalZZ;\nuniform vec3 vSphericalXY;\nuniform vec3 vSphericalYZ;\nuniform vec3 vSphericalZX;\nvec3 EnvironmentIrradiance(vec3 normal)\n{\n\n\n\nvec3 result =\nvSphericalX*normal.x +\nvSphericalY*normal.y +\nvSphericalZ*normal.z +\nvSphericalXX*normal.x*normal.x +\nvSphericalYY*normal.y*normal.y +\nvSphericalZZ*normal.z*normal.z +\nvSphericalYZ*normal.y*normal.z +\nvSphericalZX*normal.z*normal.x +\nvSphericalXY*normal.x*normal.y;\nreturn result.rgb;\n}\n#endif";
null!=t.helperFunctions?a.C("helperFunctions","mat3 transposeMat3(mat3 inMatrix) {\nvec3 i0=inMatrix[0];\nvec3 i1=inMatrix[1];\nvec3 i2=inMatrix[2];\nmat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);\nreturn outMatrix;\n}"):a.i.helperFunctions="mat3 transposeMat3(mat3 inMatrix) {\nvec3 i0=inMatrix[0];\nvec3 i1=inMatrix[1];\nvec3 i2=inMatrix[2];\nmat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);\nreturn outMatrix;\n}";
null!=t.instancesDeclaration?a.C("instancesDeclaration","#ifdef INSTANCES\nattribute vec4 world0;\nattribute vec4 world1;\nattribute vec4 world2;\nattribute vec4 world3;\n#else\nuniform mat4 world;\n#endif"):a.i.instancesDeclaration="#ifdef INSTANCES\nattribute vec4 world0;\nattribute vec4 world1;\nattribute vec4 world2;\nattribute vec4 world3;\n#else\nuniform mat4 world;\n#endif";null!=t.instancesVertex?a.C("instancesVertex","#ifdef INSTANCES\nmat4 finalWorld=mat4(world0,world1,world2,world3);\n#else\nmat4 finalWorld=world;\n#endif"):
a.i.instancesVertex="#ifdef INSTANCES\nmat4 finalWorld=mat4(world0,world1,world2,world3);\n#else\nmat4 finalWorld=world;\n#endif";null!=t.lightFragment?a.C("lightFragment","#ifdef LIGHT{X}\n#if defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X}) && defined(LIGHTMAPNOSPECULAR{X})\n\n#else\n#ifndef SPECULARTERM\nvec3 vLightSpecular{X}=vec3(0.);\n#endif\n#ifdef SPOTLIGHT{X}\ninfo=computeSpotLighting(viewDirectionW,normalW,vLightData{X},vLightDirection{X},vLightDiffuse{X}.rgb,vLightSpecular{X},vLightDiffuse{X}.a,glossiness);\n#endif\n#ifdef HEMILIGHT{X}\ninfo=computeHemisphericLighting(viewDirectionW,normalW,vLightData{X},vLightDiffuse{X}.rgb,vLightSpecular{X},vLightGround{X},glossiness);\n#endif\n#if defined(POINTLIGHT{X}) || defined(DIRLIGHT{X})\ninfo=computeLighting(viewDirectionW,normalW,vLightData{X},vLightDiffuse{X}.rgb,vLightSpecular{X},vLightDiffuse{X}.a,glossiness);\n#endif\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWVSM{X}\nshadow=computeShadowWithVSM(vPositionFromLight{X},shadowSampler{X},shadowsInfo{X}.z,shadowsInfo{X}.x);\n#else\n#ifdef SHADOWPCF{X}\n#if defined(POINTLIGHT{X})\nshadow=computeShadowWithPCFCube(vLightData{X}.xyz,shadowSampler{X},shadowsInfo{X}.y,shadowsInfo{X}.z,shadowsInfo{X}.x);\n#else\nshadow=computeShadowWithPCF(vPositionFromLight{X},shadowSampler{X},shadowsInfo{X}.y,shadowsInfo{X}.z,shadowsInfo{X}.x);\n#endif\n#else\n#if defined(POINTLIGHT{X})\nshadow=computeShadowCube(vLightData{X}.xyz,shadowSampler{X},shadowsInfo{X}.x,shadowsInfo{X}.z);\n#else\nshadow=computeShadow(vPositionFromLight{X},shadowSampler{X},shadowsInfo{X}.x,shadowsInfo{X}.z);\n#endif\n#endif\n#endif\n#else\nshadow=1.;\n#endif\n#if defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X})\ndiffuseBase+=lightmapColor*shadow;\n#ifdef SPECULARTERM\n#ifndef LIGHTMAPNOSPECULAR{X}\nspecularBase+=info.specular*shadow*lightmapColor;\n#endif\n#endif\n#else\ndiffuseBase+=info.diffuse*shadow;\n#ifdef SPECULARTERM\nspecularBase+=info.specular*shadow;\n#endif\n#endif\n#endif"):
a.i.lightFragment="#ifdef LIGHT{X}\n#if defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X}) && defined(LIGHTMAPNOSPECULAR{X})\n\n#else\n#ifndef SPECULARTERM\nvec3 vLightSpecular{X}=vec3(0.);\n#endif\n#ifdef SPOTLIGHT{X}\ninfo=computeSpotLighting(viewDirectionW,normalW,vLightData{X},vLightDirection{X},vLightDiffuse{X}.rgb,vLightSpecular{X},vLightDiffuse{X}.a,glossiness);\n#endif\n#ifdef HEMILIGHT{X}\ninfo=computeHemisphericLighting(viewDirectionW,normalW,vLightData{X},vLightDiffuse{X}.rgb,vLightSpecular{X},vLightGround{X},glossiness);\n#endif\n#if defined(POINTLIGHT{X}) || defined(DIRLIGHT{X})\ninfo=computeLighting(viewDirectionW,normalW,vLightData{X},vLightDiffuse{X}.rgb,vLightSpecular{X},vLightDiffuse{X}.a,glossiness);\n#endif\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWVSM{X}\nshadow=computeShadowWithVSM(vPositionFromLight{X},shadowSampler{X},shadowsInfo{X}.z,shadowsInfo{X}.x);\n#else\n#ifdef SHADOWPCF{X}\n#if defined(POINTLIGHT{X})\nshadow=computeShadowWithPCFCube(vLightData{X}.xyz,shadowSampler{X},shadowsInfo{X}.y,shadowsInfo{X}.z,shadowsInfo{X}.x);\n#else\nshadow=computeShadowWithPCF(vPositionFromLight{X},shadowSampler{X},shadowsInfo{X}.y,shadowsInfo{X}.z,shadowsInfo{X}.x);\n#endif\n#else\n#if defined(POINTLIGHT{X})\nshadow=computeShadowCube(vLightData{X}.xyz,shadowSampler{X},shadowsInfo{X}.x,shadowsInfo{X}.z);\n#else\nshadow=computeShadow(vPositionFromLight{X},shadowSampler{X},shadowsInfo{X}.x,shadowsInfo{X}.z);\n#endif\n#endif\n#endif\n#else\nshadow=1.;\n#endif\n#if defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X})\ndiffuseBase+=lightmapColor*shadow;\n#ifdef SPECULARTERM\n#ifndef LIGHTMAPNOSPECULAR{X}\nspecularBase+=info.specular*shadow*lightmapColor;\n#endif\n#endif\n#else\ndiffuseBase+=info.diffuse*shadow;\n#ifdef SPECULARTERM\nspecularBase+=info.specular*shadow;\n#endif\n#endif\n#endif";
null!=t.lightFragmentDeclaration?a.C("lightFragmentDeclaration","#ifdef LIGHT{X}\nuniform vec4 vLightData{X};\nuniform vec4 vLightDiffuse{X};\n#ifdef SPECULARTERM\nuniform vec3 vLightSpecular{X};\n#endif\n#ifdef SHADOW{X}\n#if defined(SPOTLIGHT{X}) || defined(DIRLIGHT{X})\nvarying vec4 vPositionFromLight{X};\nuniform sampler2D shadowSampler{X};\n#else\nuniform samplerCube shadowSampler{X};\n#endif\nuniform vec3 shadowsInfo{X};\n#endif\n#ifdef SPOTLIGHT{X}\nuniform vec4 vLightDirection{X};\n#endif\n#ifdef HEMILIGHT{X}\nuniform vec3 vLightGround{X};\n#endif\n#endif"):
a.i.lightFragmentDeclaration="#ifdef LIGHT{X}\nuniform vec4 vLightData{X};\nuniform vec4 vLightDiffuse{X};\n#ifdef SPECULARTERM\nuniform vec3 vLightSpecular{X};\n#endif\n#ifdef SHADOW{X}\n#if defined(SPOTLIGHT{X}) || defined(DIRLIGHT{X})\nvarying vec4 vPositionFromLight{X};\nuniform sampler2D shadowSampler{X};\n#else\nuniform samplerCube shadowSampler{X};\n#endif\nuniform vec3 shadowsInfo{X};\n#endif\n#ifdef SPOTLIGHT{X}\nuniform vec4 vLightDirection{X};\n#endif\n#ifdef HEMILIGHT{X}\nuniform vec3 vLightGround{X};\n#endif\n#endif";
null!=t.lightsFragmentFunctions?a.C("lightsFragmentFunctions","\nstruct lightingInfo\n{\nvec3 diffuse;\n#ifdef SPECULARTERM\nvec3 specular;\n#endif\n};\nlightingInfo computeLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {\nlightingInfo result;\nvec3 lightVectorW;\nfloat attenuation=1.0;\nif (lightData.w == 0.)\n{\nvec3 direction=lightData.xyz-vPositionW;\nattenuation=max(0.,1.0-length(direction)/range);\nlightVectorW=normalize(direction);\n}\nelse\n{\nlightVectorW=normalize(-lightData.xyz);\n}\n\nfloat ndl=max(0.,dot(vNormal,lightVectorW));\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW+lightVectorW);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;\n}\nlightingInfo computeSpotLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec4 lightDirection,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {\nlightingInfo result;\nvec3 direction=lightData.xyz-vPositionW;\nvec3 lightVectorW=normalize(direction);\nfloat attenuation=max(0.,1.0-length(direction)/range);\n\nfloat cosAngle=max(0.,dot(-lightDirection.xyz,lightVectorW));\nif (cosAngle>=lightDirection.w)\n{\ncosAngle=max(0.,pow(cosAngle,lightData.w));\nattenuation*=cosAngle;\n\nfloat ndl=max(0.,dot(vNormal,-lightDirection.xyz));\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW-lightDirection.xyz);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;\n}\nresult.diffuse=vec3(0.);\n#ifdef SPECULARTERM\nresult.specular=vec3(0.);\n#endif\nreturn result;\n}\nlightingInfo computeHemisphericLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,vec3 groundColor,float glossiness) {\nlightingInfo result;\n\nfloat ndl=dot(vNormal,lightData.xyz)*0.5+0.5;\nresult.diffuse=mix(groundColor,diffuseColor,ndl);\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW+lightData.xyz);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor;\n#endif\nreturn result;\n}\n"):
a.i.lightsFragmentFunctions="\nstruct lightingInfo\n{\nvec3 diffuse;\n#ifdef SPECULARTERM\nvec3 specular;\n#endif\n};\nlightingInfo computeLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {\nlightingInfo result;\nvec3 lightVectorW;\nfloat attenuation=1.0;\nif (lightData.w == 0.)\n{\nvec3 direction=lightData.xyz-vPositionW;\nattenuation=max(0.,1.0-length(direction)/range);\nlightVectorW=normalize(direction);\n}\nelse\n{\nlightVectorW=normalize(-lightData.xyz);\n}\n\nfloat ndl=max(0.,dot(vNormal,lightVectorW));\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW+lightVectorW);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;\n}\nlightingInfo computeSpotLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec4 lightDirection,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {\nlightingInfo result;\nvec3 direction=lightData.xyz-vPositionW;\nvec3 lightVectorW=normalize(direction);\nfloat attenuation=max(0.,1.0-length(direction)/range);\n\nfloat cosAngle=max(0.,dot(-lightDirection.xyz,lightVectorW));\nif (cosAngle>=lightDirection.w)\n{\ncosAngle=max(0.,pow(cosAngle,lightData.w));\nattenuation*=cosAngle;\n\nfloat ndl=max(0.,dot(vNormal,-lightDirection.xyz));\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW-lightDirection.xyz);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;\n}\nresult.diffuse=vec3(0.);\n#ifdef SPECULARTERM\nresult.specular=vec3(0.);\n#endif\nreturn result;\n}\nlightingInfo computeHemisphericLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,vec3 groundColor,float glossiness) {\nlightingInfo result;\n\nfloat ndl=dot(vNormal,lightData.xyz)*0.5+0.5;\nresult.diffuse=mix(groundColor,diffuseColor,ndl);\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW+lightData.xyz);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor;\n#endif\nreturn result;\n}\n";
null!=t.logDepthDeclaration?a.C("logDepthDeclaration","#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;\nvarying float vFragmentDepth;\n#endif"):a.i.logDepthDeclaration="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;\nvarying float vFragmentDepth;\n#endif";null!=t.logDepthFragment?a.C("logDepthFragment","#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif"):a.i.logDepthFragment="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif";
null!=t.logDepthVertex?a.C("logDepthVertex","#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;\ngl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif"):a.i.logDepthVertex="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;\ngl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif";null!=t.pbrFunctions?a.C("pbrFunctions","\n#define RECIPROCAL_PI2 0.15915494\n#define FRESNEL_MAXIMUM_ON_ROUGH 0.25\n\nconst float kPi=3.1415926535897932384626433832795;\nconst float kRougnhessToAlphaScale=0.1;\nconst float kRougnhessToAlphaOffset=0.29248125;\nfloat Square(float value)\n{\nreturn value*value;\n}\nfloat getLuminance(vec3 color)\n{\nreturn clamp(dot(color,vec3(0.2126,0.7152,0.0722)),0.,1.);\n}\nfloat convertRoughnessToAverageSlope(float roughness)\n{\n\nconst float kMinimumVariance=0.0005;\nfloat alphaG=Square(roughness)+kMinimumVariance;\nreturn alphaG;\n}\n\nfloat getMipMapIndexFromAverageSlope(float maxMipLevel,float alpha)\n{\n\n\n\n\n\n\n\nfloat mip=kRougnhessToAlphaOffset+maxMipLevel+(maxMipLevel*kRougnhessToAlphaScale*log2(alpha));\nreturn clamp(mip,0.,maxMipLevel);\n}\nfloat getMipMapIndexFromAverageSlopeWithPMREM(float maxMipLevel,float alphaG)\n{\nfloat specularPower=clamp(2./alphaG-2.,0.000001,2048.);\n\nreturn clamp(- 0.5*log2(specularPower)+5.5,0.,maxMipLevel);\n}\n\nfloat smithVisibilityG1_TrowbridgeReitzGGX(float dot,float alphaG)\n{\nfloat tanSquared=(1.0-dot*dot)/(dot*dot);\nreturn 2.0/(1.0+sqrt(1.0+alphaG*alphaG*tanSquared));\n}\nfloat smithVisibilityG_TrowbridgeReitzGGX_Walter(float NdotL,float NdotV,float alphaG)\n{\nreturn smithVisibilityG1_TrowbridgeReitzGGX(NdotL,alphaG)*smithVisibilityG1_TrowbridgeReitzGGX(NdotV,alphaG);\n}\n\n\nfloat normalDistributionFunction_TrowbridgeReitzGGX(float NdotH,float alphaG)\n{\n\n\n\nfloat a2=Square(alphaG);\nfloat d=NdotH*NdotH*(a2-1.0)+1.0;\nreturn a2/(kPi*d*d);\n}\nvec3 fresnelSchlickGGX(float VdotH,vec3 reflectance0,vec3 reflectance90)\n{\nreturn reflectance0+(reflectance90-reflectance0)*pow(clamp(1.0-VdotH,0.,1.),5.0);\n}\nvec3 FresnelSchlickEnvironmentGGX(float VdotN,vec3 reflectance0,vec3 reflectance90,float smoothness)\n{\n\nfloat weight=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);\nreturn reflectance0+weight*(reflectance90-reflectance0)*pow(clamp(1.0-VdotN,0.,1.),5.0);\n}\n\nvec3 computeSpecularTerm(float NdotH,float NdotL,float NdotV,float VdotH,float roughness,vec3 specularColor,vec3 reflectance90)\n{\nfloat alphaG=convertRoughnessToAverageSlope(roughness);\nfloat distribution=normalDistributionFunction_TrowbridgeReitzGGX(NdotH,alphaG);\nfloat visibility=smithVisibilityG_TrowbridgeReitzGGX_Walter(NdotL,NdotV,alphaG);\nvisibility/=(4.0*NdotL*NdotV); \nvec3 fresnel=fresnelSchlickGGX(VdotH,specularColor,reflectance90);\nfloat specTerm=max(0.,visibility*distribution)*NdotL;\nreturn fresnel*specTerm*kPi; \n}\nfloat computeDiffuseTerm(float NdotL,float NdotV,float VdotH,float roughness)\n{\n\n\nfloat diffuseFresnelNV=pow(clamp(1.0-NdotL,0.000001,1.),5.0);\nfloat diffuseFresnelNL=pow(clamp(1.0-NdotV,0.000001,1.),5.0);\nfloat diffuseFresnel90=0.5+2.0*VdotH*VdotH*roughness;\nfloat diffuseFresnelTerm =\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNL) *\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNV);\nreturn diffuseFresnelTerm*NdotL;\n\n\n}\nfloat adjustRoughnessFromLightProperties(float roughness,float lightRadius,float lightDistance)\n{\n#ifdef USEPHYSICALLIGHTFALLOFF\n\nfloat lightRoughness=lightRadius/lightDistance;\n\nfloat totalRoughness=clamp(lightRoughness+roughness,0.,1.);\nreturn totalRoughness;\n#else\nreturn roughness;\n#endif\n}\nfloat computeDefaultMicroSurface(float microSurface,vec3 reflectivityColor)\n{\nfloat kReflectivityNoAlphaWorkflow_SmoothnessMax=0.95;\nfloat reflectivityLuminance=getLuminance(reflectivityColor);\nfloat reflectivityLuma=sqrt(reflectivityLuminance);\nmicroSurface=reflectivityLuma*kReflectivityNoAlphaWorkflow_SmoothnessMax;\nreturn microSurface;\n}\nvec3 toLinearSpace(vec3 color)\n{\nreturn vec3(pow(color.r,2.2),pow(color.g,2.2),pow(color.b,2.2));\n}\nvec3 toGammaSpace(vec3 color)\n{\nreturn vec3(pow(color.r,1.0/2.2),pow(color.g,1.0/2.2),pow(color.b,1.0/2.2));\n}\n#ifdef CAMERATONEMAP\nvec3 toneMaps(vec3 color)\n{\ncolor=max(color,0.0);\n\ncolor.rgb=color.rgb*vCameraInfos.x;\nfloat tuning=1.5; \n\n\nvec3 tonemapped=1.0-exp2(-color.rgb*tuning); \ncolor.rgb=mix(color.rgb,tonemapped,1.0);\nreturn color;\n}\n#endif\n#ifdef CAMERACONTRAST\nvec4 contrasts(vec4 color)\n{\ncolor=clamp(color,0.0,1.0);\nvec3 resultHighContrast=color.rgb*color.rgb*(3.0-2.0*color.rgb);\nfloat contrast=vCameraInfos.y;\nif (contrast<1.0)\n{\n\ncolor.rgb=mix(vec3(0.5,0.5,0.5),color.rgb,contrast);\n}\nelse\n{\n\ncolor.rgb=mix(color.rgb,resultHighContrast,contrast-1.0);\n}\nreturn color;\n}\n#endif"):
a.i.pbrFunctions="\n#define RECIPROCAL_PI2 0.15915494\n#define FRESNEL_MAXIMUM_ON_ROUGH 0.25\n\nconst float kPi=3.1415926535897932384626433832795;\nconst float kRougnhessToAlphaScale=0.1;\nconst float kRougnhessToAlphaOffset=0.29248125;\nfloat Square(float value)\n{\nreturn value*value;\n}\nfloat getLuminance(vec3 color)\n{\nreturn clamp(dot(color,vec3(0.2126,0.7152,0.0722)),0.,1.);\n}\nfloat convertRoughnessToAverageSlope(float roughness)\n{\n\nconst float kMinimumVariance=0.0005;\nfloat alphaG=Square(roughness)+kMinimumVariance;\nreturn alphaG;\n}\n\nfloat getMipMapIndexFromAverageSlope(float maxMipLevel,float alpha)\n{\n\n\n\n\n\n\n\nfloat mip=kRougnhessToAlphaOffset+maxMipLevel+(maxMipLevel*kRougnhessToAlphaScale*log2(alpha));\nreturn clamp(mip,0.,maxMipLevel);\n}\nfloat getMipMapIndexFromAverageSlopeWithPMREM(float maxMipLevel,float alphaG)\n{\nfloat specularPower=clamp(2./alphaG-2.,0.000001,2048.);\n\nreturn clamp(- 0.5*log2(specularPower)+5.5,0.,maxMipLevel);\n}\n\nfloat smithVisibilityG1_TrowbridgeReitzGGX(float dot,float alphaG)\n{\nfloat tanSquared=(1.0-dot*dot)/(dot*dot);\nreturn 2.0/(1.0+sqrt(1.0+alphaG*alphaG*tanSquared));\n}\nfloat smithVisibilityG_TrowbridgeReitzGGX_Walter(float NdotL,float NdotV,float alphaG)\n{\nreturn smithVisibilityG1_TrowbridgeReitzGGX(NdotL,alphaG)*smithVisibilityG1_TrowbridgeReitzGGX(NdotV,alphaG);\n}\n\n\nfloat normalDistributionFunction_TrowbridgeReitzGGX(float NdotH,float alphaG)\n{\n\n\n\nfloat a2=Square(alphaG);\nfloat d=NdotH*NdotH*(a2-1.0)+1.0;\nreturn a2/(kPi*d*d);\n}\nvec3 fresnelSchlickGGX(float VdotH,vec3 reflectance0,vec3 reflectance90)\n{\nreturn reflectance0+(reflectance90-reflectance0)*pow(clamp(1.0-VdotH,0.,1.),5.0);\n}\nvec3 FresnelSchlickEnvironmentGGX(float VdotN,vec3 reflectance0,vec3 reflectance90,float smoothness)\n{\n\nfloat weight=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);\nreturn reflectance0+weight*(reflectance90-reflectance0)*pow(clamp(1.0-VdotN,0.,1.),5.0);\n}\n\nvec3 computeSpecularTerm(float NdotH,float NdotL,float NdotV,float VdotH,float roughness,vec3 specularColor,vec3 reflectance90)\n{\nfloat alphaG=convertRoughnessToAverageSlope(roughness);\nfloat distribution=normalDistributionFunction_TrowbridgeReitzGGX(NdotH,alphaG);\nfloat visibility=smithVisibilityG_TrowbridgeReitzGGX_Walter(NdotL,NdotV,alphaG);\nvisibility/=(4.0*NdotL*NdotV); \nvec3 fresnel=fresnelSchlickGGX(VdotH,specularColor,reflectance90);\nfloat specTerm=max(0.,visibility*distribution)*NdotL;\nreturn fresnel*specTerm*kPi; \n}\nfloat computeDiffuseTerm(float NdotL,float NdotV,float VdotH,float roughness)\n{\n\n\nfloat diffuseFresnelNV=pow(clamp(1.0-NdotL,0.000001,1.),5.0);\nfloat diffuseFresnelNL=pow(clamp(1.0-NdotV,0.000001,1.),5.0);\nfloat diffuseFresnel90=0.5+2.0*VdotH*VdotH*roughness;\nfloat diffuseFresnelTerm =\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNL) *\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNV);\nreturn diffuseFresnelTerm*NdotL;\n\n\n}\nfloat adjustRoughnessFromLightProperties(float roughness,float lightRadius,float lightDistance)\n{\n#ifdef USEPHYSICALLIGHTFALLOFF\n\nfloat lightRoughness=lightRadius/lightDistance;\n\nfloat totalRoughness=clamp(lightRoughness+roughness,0.,1.);\nreturn totalRoughness;\n#else\nreturn roughness;\n#endif\n}\nfloat computeDefaultMicroSurface(float microSurface,vec3 reflectivityColor)\n{\nfloat kReflectivityNoAlphaWorkflow_SmoothnessMax=0.95;\nfloat reflectivityLuminance=getLuminance(reflectivityColor);\nfloat reflectivityLuma=sqrt(reflectivityLuminance);\nmicroSurface=reflectivityLuma*kReflectivityNoAlphaWorkflow_SmoothnessMax;\nreturn microSurface;\n}\nvec3 toLinearSpace(vec3 color)\n{\nreturn vec3(pow(color.r,2.2),pow(color.g,2.2),pow(color.b,2.2));\n}\nvec3 toGammaSpace(vec3 color)\n{\nreturn vec3(pow(color.r,1.0/2.2),pow(color.g,1.0/2.2),pow(color.b,1.0/2.2));\n}\n#ifdef CAMERATONEMAP\nvec3 toneMaps(vec3 color)\n{\ncolor=max(color,0.0);\n\ncolor.rgb=color.rgb*vCameraInfos.x;\nfloat tuning=1.5; \n\n\nvec3 tonemapped=1.0-exp2(-color.rgb*tuning); \ncolor.rgb=mix(color.rgb,tonemapped,1.0);\nreturn color;\n}\n#endif\n#ifdef CAMERACONTRAST\nvec4 contrasts(vec4 color)\n{\ncolor=clamp(color,0.0,1.0);\nvec3 resultHighContrast=color.rgb*color.rgb*(3.0-2.0*color.rgb);\nfloat contrast=vCameraInfos.y;\nif (contrast<1.0)\n{\n\ncolor.rgb=mix(vec3(0.5,0.5,0.5),color.rgb,contrast);\n}\nelse\n{\n\ncolor.rgb=mix(color.rgb,resultHighContrast,contrast-1.0);\n}\nreturn color;\n}\n#endif";
null!=t.pbrLightFunctions?a.C("pbrLightFunctions","\nstruct lightingInfo\n{\nvec3 diffuse;\n#ifdef SPECULARTERM\nvec3 specular;\n#endif\n};\nfloat computeDistanceLightFalloff(vec3 lightOffset,float lightDistanceSquared,float range)\n{ \n#ifdef USEPHYSICALLIGHTFALLOFF\nfloat lightDistanceFalloff=1.0/((lightDistanceSquared+0.0001));\n#else\nfloat lightDistanceFalloff=max(0.,1.0-length(lightOffset)/range);\n#endif\nreturn lightDistanceFalloff;\n}\nfloat computeDirectionalLightFalloff(vec3 lightDirection,vec3 directionToLightCenterW,float lightAngle,float exponent)\n{\nfloat falloff=0.0;\n#ifdef USEPHYSICALLIGHTFALLOFF\nfloat cosHalfAngle=cos(lightAngle*0.5);\nconst float kMinusLog2ConeAngleIntensityRatio=6.64385618977; \n\n\n\n\n\nfloat concentrationKappa=kMinusLog2ConeAngleIntensityRatio/(1.0-cosHalfAngle);\n\n\nvec4 lightDirectionSpreadSG=vec4(-lightDirection*concentrationKappa,-concentrationKappa);\nfalloff=exp2(dot(vec4(directionToLightCenterW,1.0),lightDirectionSpreadSG));\n#else\nfloat cosAngle=max(0.000000000000001,dot(-lightDirection,directionToLightCenterW));\nif (cosAngle>=lightAngle)\n{\nfalloff=max(0.,pow(cosAngle,exponent));\n}\n#endif\nreturn falloff;\n}\nlightingInfo computeLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,float rangeRadius,float roughness,float NdotV,vec3 reflectance90,out float NdotL) {\nlightingInfo result;\nvec3 lightDirection;\nfloat attenuation=1.0;\nfloat lightDistance;\n\nif (lightData.w == 0.)\n{\nvec3 lightOffset=lightData.xyz-vPositionW;\nfloat lightDistanceSquared=dot(lightOffset,lightOffset);\nattenuation=computeDistanceLightFalloff(lightOffset,lightDistanceSquared,rangeRadius);\nlightDistance=sqrt(lightDistanceSquared);\nlightDirection=normalize(lightOffset);\n}\n\nelse\n{\nlightDistance=length(-lightData.xyz);\nlightDirection=normalize(-lightData.xyz);\n}\n\nroughness=adjustRoughnessFromLightProperties(roughness,rangeRadius,lightDistance);\n\nvec3 H=normalize(viewDirectionW+lightDirection);\nNdotL=max(0.00000000001,dot(vNormal,lightDirection));\nfloat VdotH=clamp(0.00000000001,1.0,dot(viewDirectionW,H));\nfloat diffuseTerm=computeDiffuseTerm(NdotL,NdotV,VdotH,roughness);\nresult.diffuse=diffuseTerm*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nfloat NdotH=max(0.00000000001,dot(vNormal,H));\nvec3 specTerm=computeSpecularTerm(NdotH,NdotL,NdotV,VdotH,roughness,specularColor,reflectance90);\nresult.specular=specTerm*attenuation;\n#endif\nreturn result;\n}\nlightingInfo computeSpotLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec4 lightDirection,vec3 diffuseColor,vec3 specularColor,float rangeRadius,float roughness,float NdotV,vec3 reflectance90,out float NdotL) {\nlightingInfo result;\nvec3 lightOffset=lightData.xyz-vPositionW;\nvec3 directionToLightCenterW=normalize(lightOffset);\n\nfloat lightDistanceSquared=dot(lightOffset,lightOffset);\nfloat attenuation=computeDistanceLightFalloff(lightOffset,lightDistanceSquared,rangeRadius);\n\nfloat directionalAttenuation=computeDirectionalLightFalloff(lightDirection.xyz,directionToLightCenterW,lightDirection.w,lightData.w);\nattenuation*=directionalAttenuation;\n\nfloat lightDistance=sqrt(lightDistanceSquared);\nroughness=adjustRoughnessFromLightProperties(roughness,rangeRadius,lightDistance);\n\nvec3 H=normalize(viewDirectionW-lightDirection.xyz);\nNdotL=max(0.00000000001,dot(vNormal,-lightDirection.xyz));\nfloat VdotH=clamp(dot(viewDirectionW,H),0.00000000001,1.0);\nfloat diffuseTerm=computeDiffuseTerm(NdotL,NdotV,VdotH,roughness);\nresult.diffuse=diffuseTerm*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nfloat NdotH=max(0.00000000001,dot(vNormal,H));\nvec3 specTerm=computeSpecularTerm(NdotH,NdotL,NdotV,VdotH,roughness,specularColor,reflectance90);\nresult.specular=specTerm*attenuation;\n#endif\nreturn result;\n}\nlightingInfo computeHemisphericLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,vec3 groundColor,float roughness,float NdotV,vec3 reflectance90,out float NdotL) {\nlightingInfo result;\n\n\n\nNdotL=dot(vNormal,lightData.xyz)*0.5+0.5;\nresult.diffuse=mix(groundColor,diffuseColor,NdotL);\n#ifdef SPECULARTERM\n\nvec3 lightVectorW=normalize(lightData.xyz);\nvec3 H=normalize(viewDirectionW+lightVectorW);\nfloat NdotH=max(0.00000000001,dot(vNormal,H));\nNdotL=max(0.00000000001,NdotL);\nfloat VdotH=clamp(0.00000000001,1.0,dot(viewDirectionW,H));\nvec3 specTerm=computeSpecularTerm(NdotH,NdotL,NdotV,VdotH,roughness,specularColor,reflectance90);\nresult.specular=specTerm;\n#endif\nreturn result;\n}"):
a.i.pbrLightFunctions="\nstruct lightingInfo\n{\nvec3 diffuse;\n#ifdef SPECULARTERM\nvec3 specular;\n#endif\n};\nfloat computeDistanceLightFalloff(vec3 lightOffset,float lightDistanceSquared,float range)\n{ \n#ifdef USEPHYSICALLIGHTFALLOFF\nfloat lightDistanceFalloff=1.0/((lightDistanceSquared+0.0001));\n#else\nfloat lightDistanceFalloff=max(0.,1.0-length(lightOffset)/range);\n#endif\nreturn lightDistanceFalloff;\n}\nfloat computeDirectionalLightFalloff(vec3 lightDirection,vec3 directionToLightCenterW,float lightAngle,float exponent)\n{\nfloat falloff=0.0;\n#ifdef USEPHYSICALLIGHTFALLOFF\nfloat cosHalfAngle=cos(lightAngle*0.5);\nconst float kMinusLog2ConeAngleIntensityRatio=6.64385618977; \n\n\n\n\n\nfloat concentrationKappa=kMinusLog2ConeAngleIntensityRatio/(1.0-cosHalfAngle);\n\n\nvec4 lightDirectionSpreadSG=vec4(-lightDirection*concentrationKappa,-concentrationKappa);\nfalloff=exp2(dot(vec4(directionToLightCenterW,1.0),lightDirectionSpreadSG));\n#else\nfloat cosAngle=max(0.000000000000001,dot(-lightDirection,directionToLightCenterW));\nif (cosAngle>=lightAngle)\n{\nfalloff=max(0.,pow(cosAngle,exponent));\n}\n#endif\nreturn falloff;\n}\nlightingInfo computeLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,float rangeRadius,float roughness,float NdotV,vec3 reflectance90,out float NdotL) {\nlightingInfo result;\nvec3 lightDirection;\nfloat attenuation=1.0;\nfloat lightDistance;\n\nif (lightData.w == 0.)\n{\nvec3 lightOffset=lightData.xyz-vPositionW;\nfloat lightDistanceSquared=dot(lightOffset,lightOffset);\nattenuation=computeDistanceLightFalloff(lightOffset,lightDistanceSquared,rangeRadius);\nlightDistance=sqrt(lightDistanceSquared);\nlightDirection=normalize(lightOffset);\n}\n\nelse\n{\nlightDistance=length(-lightData.xyz);\nlightDirection=normalize(-lightData.xyz);\n}\n\nroughness=adjustRoughnessFromLightProperties(roughness,rangeRadius,lightDistance);\n\nvec3 H=normalize(viewDirectionW+lightDirection);\nNdotL=max(0.00000000001,dot(vNormal,lightDirection));\nfloat VdotH=clamp(0.00000000001,1.0,dot(viewDirectionW,H));\nfloat diffuseTerm=computeDiffuseTerm(NdotL,NdotV,VdotH,roughness);\nresult.diffuse=diffuseTerm*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nfloat NdotH=max(0.00000000001,dot(vNormal,H));\nvec3 specTerm=computeSpecularTerm(NdotH,NdotL,NdotV,VdotH,roughness,specularColor,reflectance90);\nresult.specular=specTerm*attenuation;\n#endif\nreturn result;\n}\nlightingInfo computeSpotLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec4 lightDirection,vec3 diffuseColor,vec3 specularColor,float rangeRadius,float roughness,float NdotV,vec3 reflectance90,out float NdotL) {\nlightingInfo result;\nvec3 lightOffset=lightData.xyz-vPositionW;\nvec3 directionToLightCenterW=normalize(lightOffset);\n\nfloat lightDistanceSquared=dot(lightOffset,lightOffset);\nfloat attenuation=computeDistanceLightFalloff(lightOffset,lightDistanceSquared,rangeRadius);\n\nfloat directionalAttenuation=computeDirectionalLightFalloff(lightDirection.xyz,directionToLightCenterW,lightDirection.w,lightData.w);\nattenuation*=directionalAttenuation;\n\nfloat lightDistance=sqrt(lightDistanceSquared);\nroughness=adjustRoughnessFromLightProperties(roughness,rangeRadius,lightDistance);\n\nvec3 H=normalize(viewDirectionW-lightDirection.xyz);\nNdotL=max(0.00000000001,dot(vNormal,-lightDirection.xyz));\nfloat VdotH=clamp(dot(viewDirectionW,H),0.00000000001,1.0);\nfloat diffuseTerm=computeDiffuseTerm(NdotL,NdotV,VdotH,roughness);\nresult.diffuse=diffuseTerm*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nfloat NdotH=max(0.00000000001,dot(vNormal,H));\nvec3 specTerm=computeSpecularTerm(NdotH,NdotL,NdotV,VdotH,roughness,specularColor,reflectance90);\nresult.specular=specTerm*attenuation;\n#endif\nreturn result;\n}\nlightingInfo computeHemisphericLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,vec3 groundColor,float roughness,float NdotV,vec3 reflectance90,out float NdotL) {\nlightingInfo result;\n\n\n\nNdotL=dot(vNormal,lightData.xyz)*0.5+0.5;\nresult.diffuse=mix(groundColor,diffuseColor,NdotL);\n#ifdef SPECULARTERM\n\nvec3 lightVectorW=normalize(lightData.xyz);\nvec3 H=normalize(viewDirectionW+lightVectorW);\nfloat NdotH=max(0.00000000001,dot(vNormal,H));\nNdotL=max(0.00000000001,NdotL);\nfloat VdotH=clamp(0.00000000001,1.0,dot(viewDirectionW,H));\nvec3 specTerm=computeSpecularTerm(NdotH,NdotL,NdotV,VdotH,roughness,specularColor,reflectance90);\nresult.specular=specTerm;\n#endif\nreturn result;\n}";
null!=t.pbrLightFunctionsCall?a.C("pbrLightFunctionsCall","#ifdef LIGHT{X}\n#if defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X}) && defined(LIGHTMAPNOSPECULAR{X})\n\n#else\n#ifndef SPECULARTERM\nvec3 vLightSpecular{X}=vec3(0.0);\n#endif\n#ifdef SPOTLIGHT{X}\ninfo=computeSpotLighting(viewDirectionW,normalW,vLightData{X},vLightDirection{X},vLightDiffuse{X}.rgb,vLightSpecular{X},vLightDiffuse{X}.a,roughness,NdotV,specularEnvironmentR90,NdotL);\n#endif\n#ifdef HEMILIGHT{X}\ninfo=computeHemisphericLighting(viewDirectionW,normalW,vLightData{X},vLightDiffuse{X}.rgb,vLightSpecular{X},vLightGround{X},roughness,NdotV,specularEnvironmentR90,NdotL);\n#endif\n#if defined(POINTLIGHT{X}) || defined(DIRLIGHT{X})\ninfo=computeLighting(viewDirectionW,normalW,vLightData{X},vLightDiffuse{X}.rgb,vLightSpecular{X},vLightDiffuse{X}.a,roughness,NdotV,specularEnvironmentR90,NdotL);\n#endif\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWVSM{X}\nnotShadowLevel=computeShadowWithVSM(vPositionFromLight{X},shadowSampler{X},shadowsInfo{X}.z,shadowsInfo{X}.x);\n#else\n#ifdef SHADOWPCF{X}\n#if defined(POINTLIGHT{X})\nnotShadowLevel=computeShadowWithPCFCube(vLightData{X}.xyz,shadowSampler{X},shadowsInfo{X}.y,shadowsInfo{X}.z,shadowsInfo{X}.x);\n#else\nnotShadowLevel=computeShadowWithPCF(vPositionFromLight{X},shadowSampler{X},shadowsInfo{X}.y,shadowsInfo{X}.z,shadowsInfo{X}.x);\n#endif\n#else\n#if defined(POINTLIGHT{X})\nnotShadowLevel=computeShadowCube(vLightData{X}.xyz,shadowSampler{X},shadowsInfo{X}.x,shadowsInfo{X}.z);\n#else\nnotShadowLevel=computeShadow(vPositionFromLight{X},shadowSampler{X},shadowsInfo{X}.x,shadowsInfo{X}.z);\n#endif\n#endif\n#endif\n#else\nnotShadowLevel=1.;\n#endif\n#if defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X})\nlightDiffuseContribution+=lightmapColor*notShadowLevel;\n#ifdef SPECULARTERM\n#ifndef LIGHTMAPNOSPECULAR{X}\nlightSpecularContribution+=info.specular*notShadowLevel*lightmapColor;\n#endif\n#endif\n#else\nlightDiffuseContribution+=info.diffuse*notShadowLevel;\n#ifdef OVERLOADEDSHADOWVALUES\nif (NdotL<0.000000000011)\n{\nnotShadowLevel=1.;\n}\nshadowedOnlyLightDiffuseContribution*=notShadowLevel;\n#endif\n#ifdef SPECULARTERM\nlightSpecularContribution+=info.specular*notShadowLevel;\n#endif\n#endif\n#endif"):
a.i.pbrLightFunctionsCall="#ifdef LIGHT{X}\n#if defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X}) && defined(LIGHTMAPNOSPECULAR{X})\n\n#else\n#ifndef SPECULARTERM\nvec3 vLightSpecular{X}=vec3(0.0);\n#endif\n#ifdef SPOTLIGHT{X}\ninfo=computeSpotLighting(viewDirectionW,normalW,vLightData{X},vLightDirection{X},vLightDiffuse{X}.rgb,vLightSpecular{X},vLightDiffuse{X}.a,roughness,NdotV,specularEnvironmentR90,NdotL);\n#endif\n#ifdef HEMILIGHT{X}\ninfo=computeHemisphericLighting(viewDirectionW,normalW,vLightData{X},vLightDiffuse{X}.rgb,vLightSpecular{X},vLightGround{X},roughness,NdotV,specularEnvironmentR90,NdotL);\n#endif\n#if defined(POINTLIGHT{X}) || defined(DIRLIGHT{X})\ninfo=computeLighting(viewDirectionW,normalW,vLightData{X},vLightDiffuse{X}.rgb,vLightSpecular{X},vLightDiffuse{X}.a,roughness,NdotV,specularEnvironmentR90,NdotL);\n#endif\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWVSM{X}\nnotShadowLevel=computeShadowWithVSM(vPositionFromLight{X},shadowSampler{X},shadowsInfo{X}.z,shadowsInfo{X}.x);\n#else\n#ifdef SHADOWPCF{X}\n#if defined(POINTLIGHT{X})\nnotShadowLevel=computeShadowWithPCFCube(vLightData{X}.xyz,shadowSampler{X},shadowsInfo{X}.y,shadowsInfo{X}.z,shadowsInfo{X}.x);\n#else\nnotShadowLevel=computeShadowWithPCF(vPositionFromLight{X},shadowSampler{X},shadowsInfo{X}.y,shadowsInfo{X}.z,shadowsInfo{X}.x);\n#endif\n#else\n#if defined(POINTLIGHT{X})\nnotShadowLevel=computeShadowCube(vLightData{X}.xyz,shadowSampler{X},shadowsInfo{X}.x,shadowsInfo{X}.z);\n#else\nnotShadowLevel=computeShadow(vPositionFromLight{X},shadowSampler{X},shadowsInfo{X}.x,shadowsInfo{X}.z);\n#endif\n#endif\n#endif\n#else\nnotShadowLevel=1.;\n#endif\n#if defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X})\nlightDiffuseContribution+=lightmapColor*notShadowLevel;\n#ifdef SPECULARTERM\n#ifndef LIGHTMAPNOSPECULAR{X}\nlightSpecularContribution+=info.specular*notShadowLevel*lightmapColor;\n#endif\n#endif\n#else\nlightDiffuseContribution+=info.diffuse*notShadowLevel;\n#ifdef OVERLOADEDSHADOWVALUES\nif (NdotL<0.000000000011)\n{\nnotShadowLevel=1.;\n}\nshadowedOnlyLightDiffuseContribution*=notShadowLevel;\n#endif\n#ifdef SPECULARTERM\nlightSpecularContribution+=info.specular*notShadowLevel;\n#endif\n#endif\n#endif";
null!=t.pbrShadowFunctions?a.C("pbrShadowFunctions","\n#ifdef SHADOWS\n#ifndef SHADOWFULLFLOAT\nfloat unpack(vec4 color)\n{\nconst vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\nreturn dot(color,bit_shift);\n}\n#endif\nuniform vec2 depthValues;\nfloat computeShadowCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float bias)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y =-directionToLight.y;\n#ifndef SHADOWFULLFLOAT\nfloat shadow=unpack(textureCube(shadowSampler,directionToLight))+bias;\n#else\nfloat shadow=textureCube(shadowSampler,directionToLight).x+bias;\n#endif\nif (depth>shadow)\n{\n#ifdef OVERLOADEDSHADOWVALUES\nreturn mix(1.0,darkness,vOverloadedShadowIntensity.x);\n#else\nreturn darkness;\n#endif\n}\nreturn 1.0;\n}\nfloat computeShadowWithPCFCube(vec3 lightPosition,samplerCube shadowSampler,float mapSize,float bias,float darkness)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth-depthValues.x)/(depthValues.y-depthValues.x);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\nfloat visibility=1.;\nvec3 poissonDisk[4];\npoissonDisk[0]=vec3(-1.0,1.0,-1.0);\npoissonDisk[1]=vec3(1.0,-1.0,-1.0);\npoissonDisk[2]=vec3(-1.0,-1.0,-1.0);\npoissonDisk[3]=vec3(1.0,-1.0,1.0);\n\nfloat biasedDepth=depth-bias;\n#ifndef SHADOWFULLFLOAT\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize))<biasedDepth) visibility-=0.25;\n#else\nif (textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize).x<biasedDepth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize).x<biasedDepth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize).x<biasedDepth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize).x<biasedDepth) visibility-=0.25;\n#endif\n#ifdef OVERLOADEDSHADOWVALUES\nreturn min(1.0,mix(1.0,visibility+darkness,vOverloadedShadowIntensity.x));\n#else\nreturn min(1.0,visibility+darkness);\n#endif\n}\nfloat computeShadow(vec4 vPositionFromLight,sampler2D shadowSampler,float darkness,float bias)\n{\nvec3 depth=vPositionFromLight.xyz/vPositionFromLight.w;\ndepth=0.5*depth+vec3(0.5);\nvec2 uv=depth.xy;\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\n#ifndef SHADOWFULLFLOAT\nfloat shadow=unpack(texture2D(shadowSampler,uv))+bias;\n#else\nfloat shadow=texture2D(shadowSampler,uv).x+bias;\n#endif\nif (depth.z>shadow)\n{\n#ifdef OVERLOADEDSHADOWVALUES\nreturn mix(1.0,darkness,vOverloadedShadowIntensity.x);\n#else\nreturn darkness;\n#endif\n}\nreturn 1.;\n}\nfloat computeShadowWithPCF(vec4 vPositionFromLight,sampler2D shadowSampler,float mapSize,float bias,float darkness)\n{\nvec3 depth=vPositionFromLight.xyz/vPositionFromLight.w;\ndepth=0.5*depth+vec3(0.5);\nvec2 uv=depth.xy;\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat visibility=1.;\nvec2 poissonDisk[4];\npoissonDisk[0]=vec2(-0.94201624,-0.39906216);\npoissonDisk[1]=vec2(0.94558609,-0.76890725);\npoissonDisk[2]=vec2(-0.094184101,-0.92938870);\npoissonDisk[3]=vec2(0.34495938,0.29387760);\n\nfloat biasedDepth=depth.z-bias;\n#ifndef SHADOWFULLFLOAT\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[0]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[1]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[2]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[3]*mapSize))<biasedDepth) visibility-=0.25;\n#else\nif (texture2D(shadowSampler,uv+poissonDisk[0]*mapSize).x<biasedDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[1]*mapSize).x<biasedDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[2]*mapSize).x<biasedDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[3]*mapSize).x<biasedDepth) visibility-=0.25;\n#endif\n#ifdef OVERLOADEDSHADOWVALUES\nreturn min(1.0,mix(1.0,visibility+darkness,vOverloadedShadowIntensity.x));\n#else\nreturn min(1.0,visibility+darkness);\n#endif\n}\n#ifndef SHADOWFULLFLOAT\n\nfloat unpackHalf(vec2 color)\n{\nreturn color.x+(color.y/255.0);\n}\n#endif\nfloat linstep(float low,float high,float v) {\nreturn clamp((v-low)/(high-low),0.0,1.0);\n}\nfloat ChebychevInequality(vec2 moments,float compare,float bias)\n{\nfloat p=smoothstep(compare-bias,compare,moments.x);\nfloat variance=max(moments.y-moments.x*moments.x,0.02);\nfloat d=compare-moments.x;\nfloat p_max=linstep(0.2,1.0,variance/(variance+d*d));\nreturn clamp(max(p,p_max),0.0,1.0);\n}\nfloat computeShadowWithVSM(vec4 vPositionFromLight,sampler2D shadowSampler,float bias,float darkness)\n{\nvec3 depth=vPositionFromLight.xyz/vPositionFromLight.w;\ndepth=0.5*depth+vec3(0.5);\nvec2 uv=depth.xy;\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0 || depth.z>=1.0)\n{\nreturn 1.0;\n}\nvec4 texel=texture2D(shadowSampler,uv);\n#ifndef SHADOWFULLFLOAT\nvec2 moments=vec2(unpackHalf(texel.xy),unpackHalf(texel.zw));\n#else\nvec2 moments=texel.xy;\n#endif\n#ifdef OVERLOADEDSHADOWVALUES\nreturn min(1.0,mix(1.0,1.0-ChebychevInequality(moments,depth.z,bias)+darkness,vOverloadedShadowIntensity.x));\n#else\nreturn min(1.0,1.0-ChebychevInequality(moments,depth.z,bias)+darkness);\n#endif\n}\n#endif"):
a.i.pbrShadowFunctions="\n#ifdef SHADOWS\n#ifndef SHADOWFULLFLOAT\nfloat unpack(vec4 color)\n{\nconst vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\nreturn dot(color,bit_shift);\n}\n#endif\nuniform vec2 depthValues;\nfloat computeShadowCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float bias)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y =-directionToLight.y;\n#ifndef SHADOWFULLFLOAT\nfloat shadow=unpack(textureCube(shadowSampler,directionToLight))+bias;\n#else\nfloat shadow=textureCube(shadowSampler,directionToLight).x+bias;\n#endif\nif (depth>shadow)\n{\n#ifdef OVERLOADEDSHADOWVALUES\nreturn mix(1.0,darkness,vOverloadedShadowIntensity.x);\n#else\nreturn darkness;\n#endif\n}\nreturn 1.0;\n}\nfloat computeShadowWithPCFCube(vec3 lightPosition,samplerCube shadowSampler,float mapSize,float bias,float darkness)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth-depthValues.x)/(depthValues.y-depthValues.x);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\nfloat visibility=1.;\nvec3 poissonDisk[4];\npoissonDisk[0]=vec3(-1.0,1.0,-1.0);\npoissonDisk[1]=vec3(1.0,-1.0,-1.0);\npoissonDisk[2]=vec3(-1.0,-1.0,-1.0);\npoissonDisk[3]=vec3(1.0,-1.0,1.0);\n\nfloat biasedDepth=depth-bias;\n#ifndef SHADOWFULLFLOAT\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize))<biasedDepth) visibility-=0.25;\n#else\nif (textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize).x<biasedDepth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize).x<biasedDepth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize).x<biasedDepth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize).x<biasedDepth) visibility-=0.25;\n#endif\n#ifdef OVERLOADEDSHADOWVALUES\nreturn min(1.0,mix(1.0,visibility+darkness,vOverloadedShadowIntensity.x));\n#else\nreturn min(1.0,visibility+darkness);\n#endif\n}\nfloat computeShadow(vec4 vPositionFromLight,sampler2D shadowSampler,float darkness,float bias)\n{\nvec3 depth=vPositionFromLight.xyz/vPositionFromLight.w;\ndepth=0.5*depth+vec3(0.5);\nvec2 uv=depth.xy;\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\n#ifndef SHADOWFULLFLOAT\nfloat shadow=unpack(texture2D(shadowSampler,uv))+bias;\n#else\nfloat shadow=texture2D(shadowSampler,uv).x+bias;\n#endif\nif (depth.z>shadow)\n{\n#ifdef OVERLOADEDSHADOWVALUES\nreturn mix(1.0,darkness,vOverloadedShadowIntensity.x);\n#else\nreturn darkness;\n#endif\n}\nreturn 1.;\n}\nfloat computeShadowWithPCF(vec4 vPositionFromLight,sampler2D shadowSampler,float mapSize,float bias,float darkness)\n{\nvec3 depth=vPositionFromLight.xyz/vPositionFromLight.w;\ndepth=0.5*depth+vec3(0.5);\nvec2 uv=depth.xy;\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat visibility=1.;\nvec2 poissonDisk[4];\npoissonDisk[0]=vec2(-0.94201624,-0.39906216);\npoissonDisk[1]=vec2(0.94558609,-0.76890725);\npoissonDisk[2]=vec2(-0.094184101,-0.92938870);\npoissonDisk[3]=vec2(0.34495938,0.29387760);\n\nfloat biasedDepth=depth.z-bias;\n#ifndef SHADOWFULLFLOAT\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[0]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[1]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[2]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[3]*mapSize))<biasedDepth) visibility-=0.25;\n#else\nif (texture2D(shadowSampler,uv+poissonDisk[0]*mapSize).x<biasedDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[1]*mapSize).x<biasedDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[2]*mapSize).x<biasedDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[3]*mapSize).x<biasedDepth) visibility-=0.25;\n#endif\n#ifdef OVERLOADEDSHADOWVALUES\nreturn min(1.0,mix(1.0,visibility+darkness,vOverloadedShadowIntensity.x));\n#else\nreturn min(1.0,visibility+darkness);\n#endif\n}\n#ifndef SHADOWFULLFLOAT\n\nfloat unpackHalf(vec2 color)\n{\nreturn color.x+(color.y/255.0);\n}\n#endif\nfloat linstep(float low,float high,float v) {\nreturn clamp((v-low)/(high-low),0.0,1.0);\n}\nfloat ChebychevInequality(vec2 moments,float compare,float bias)\n{\nfloat p=smoothstep(compare-bias,compare,moments.x);\nfloat variance=max(moments.y-moments.x*moments.x,0.02);\nfloat d=compare-moments.x;\nfloat p_max=linstep(0.2,1.0,variance/(variance+d*d));\nreturn clamp(max(p,p_max),0.0,1.0);\n}\nfloat computeShadowWithVSM(vec4 vPositionFromLight,sampler2D shadowSampler,float bias,float darkness)\n{\nvec3 depth=vPositionFromLight.xyz/vPositionFromLight.w;\ndepth=0.5*depth+vec3(0.5);\nvec2 uv=depth.xy;\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0 || depth.z>=1.0)\n{\nreturn 1.0;\n}\nvec4 texel=texture2D(shadowSampler,uv);\n#ifndef SHADOWFULLFLOAT\nvec2 moments=vec2(unpackHalf(texel.xy),unpackHalf(texel.zw));\n#else\nvec2 moments=texel.xy;\n#endif\n#ifdef OVERLOADEDSHADOWVALUES\nreturn min(1.0,mix(1.0,1.0-ChebychevInequality(moments,depth.z,bias)+darkness,vOverloadedShadowIntensity.x));\n#else\nreturn min(1.0,1.0-ChebychevInequality(moments,depth.z,bias)+darkness);\n#endif\n}\n#endif";
null!=t.pointCloudVertex?a.C("pointCloudVertex","#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif"):a.i.pointCloudVertex="#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif";null!=t.pointCloudVertexDeclaration?a.C("pointCloudVertexDeclaration","#ifdef POINTSIZE\nuniform float pointSize;\n#endif"):a.i.pointCloudVertexDeclaration="#ifdef POINTSIZE\nuniform float pointSize;\n#endif";null!=t.reflectionFunction?a.C("reflectionFunction","vec3 computeReflectionCoords(vec4 worldPos,vec3 worldNormal)\n{\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvec3 direction=normalize(vDirectionW);\nfloat t=clamp(direction.y*-0.5+0.5,0.,1.0);\nfloat s=atan(direction.z,direction.x)*RECIPROCAL_PI2+0.5;\nreturn vec3(s,t,0);\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR\nvec3 cameraToVertex=normalize(worldPos.xyz-vEyePosition);\nvec3 r=reflect(cameraToVertex,worldNormal);\nfloat t=clamp(r.y*-0.5+0.5,0.,1.0);\nfloat s=atan(r.z,r.x)*RECIPROCAL_PI2+0.5;\nreturn vec3(s,t,0);\n#endif\n#ifdef REFLECTIONMAP_SPHERICAL\nvec3 viewDir=normalize(vec3(view*worldPos));\nvec3 viewNormal=normalize(vec3(view*vec4(worldNormal,0.0)));\nvec3 r=reflect(viewDir,viewNormal);\nr.z=r.z-1.0;\nfloat m=2.0*length(r);\nreturn vec3(r.x/m+0.5,1.0-r.y/m-0.5,0);\n#endif\n#ifdef REFLECTIONMAP_PLANAR\nvec3 viewDir=worldPos.xyz-vEyePosition;\nvec3 coords=normalize(reflect(viewDir,worldNormal));\nreturn vec3(reflectionMatrix*vec4(coords,1));\n#endif\n#ifdef REFLECTIONMAP_CUBIC\nvec3 viewDir=worldPos.xyz-vEyePosition;\nvec3 coords=reflect(viewDir,worldNormal);\n#ifdef INVERTCUBICMAP\ncoords.y=1.0-coords.y;\n#endif\nreturn vec3(reflectionMatrix*vec4(coords,0));\n#endif\n#ifdef REFLECTIONMAP_PROJECTION\nreturn vec3(reflectionMatrix*(view*worldPos));\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nreturn vPositionUVW;\n#endif\n#ifdef REFLECTIONMAP_EXPLICIT\nreturn vec3(0,0,0);\n#endif\n}"):
a.i.reflectionFunction="vec3 computeReflectionCoords(vec4 worldPos,vec3 worldNormal)\n{\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvec3 direction=normalize(vDirectionW);\nfloat t=clamp(direction.y*-0.5+0.5,0.,1.0);\nfloat s=atan(direction.z,direction.x)*RECIPROCAL_PI2+0.5;\nreturn vec3(s,t,0);\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR\nvec3 cameraToVertex=normalize(worldPos.xyz-vEyePosition);\nvec3 r=reflect(cameraToVertex,worldNormal);\nfloat t=clamp(r.y*-0.5+0.5,0.,1.0);\nfloat s=atan(r.z,r.x)*RECIPROCAL_PI2+0.5;\nreturn vec3(s,t,0);\n#endif\n#ifdef REFLECTIONMAP_SPHERICAL\nvec3 viewDir=normalize(vec3(view*worldPos));\nvec3 viewNormal=normalize(vec3(view*vec4(worldNormal,0.0)));\nvec3 r=reflect(viewDir,viewNormal);\nr.z=r.z-1.0;\nfloat m=2.0*length(r);\nreturn vec3(r.x/m+0.5,1.0-r.y/m-0.5,0);\n#endif\n#ifdef REFLECTIONMAP_PLANAR\nvec3 viewDir=worldPos.xyz-vEyePosition;\nvec3 coords=normalize(reflect(viewDir,worldNormal));\nreturn vec3(reflectionMatrix*vec4(coords,1));\n#endif\n#ifdef REFLECTIONMAP_CUBIC\nvec3 viewDir=worldPos.xyz-vEyePosition;\nvec3 coords=reflect(viewDir,worldNormal);\n#ifdef INVERTCUBICMAP\ncoords.y=1.0-coords.y;\n#endif\nreturn vec3(reflectionMatrix*vec4(coords,0));\n#endif\n#ifdef REFLECTIONMAP_PROJECTION\nreturn vec3(reflectionMatrix*(view*worldPos));\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nreturn vPositionUVW;\n#endif\n#ifdef REFLECTIONMAP_EXPLICIT\nreturn vec3(0,0,0);\n#endif\n}";
null!=t.shadowsFragmentFunctions?a.C("shadowsFragmentFunctions","#ifdef SHADOWS\n#ifndef SHADOWFULLFLOAT\nfloat unpack(vec4 color)\n{\nconst vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\nreturn dot(color,bit_shift);\n}\n#endif\nuniform vec2 depthValues;\nfloat computeShadowCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float bias)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth-depthValues.x)/(depthValues.y-depthValues.x);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFULLFLOAT\nfloat shadow=unpack(textureCube(shadowSampler,directionToLight))+bias;\n#else\nfloat shadow=textureCube(shadowSampler,directionToLight).x+bias;\n#endif\nif (depth>shadow)\n{\nreturn darkness;\n}\nreturn 1.0;\n}\nfloat computeShadowWithPCFCube(vec3 lightPosition,samplerCube shadowSampler,float mapSize,float bias,float darkness)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth-depthValues.x)/(depthValues.y-depthValues.x);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\nfloat visibility=1.;\nvec3 poissonDisk[4];\npoissonDisk[0]=vec3(-1.0,1.0,-1.0);\npoissonDisk[1]=vec3(1.0,-1.0,-1.0);\npoissonDisk[2]=vec3(-1.0,-1.0,-1.0);\npoissonDisk[3]=vec3(1.0,-1.0,1.0);\n\nfloat biasedDepth=depth-bias;\n#ifndef SHADOWFULLFLOAT\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize))<biasedDepth) visibility-=0.25;\n#else\nif (textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize).x<biasedDepth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize).x<biasedDepth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize).x<biasedDepth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize).x<biasedDepth) visibility-=0.25;\n#endif\nreturn min(1.0,visibility+darkness);\n}\nfloat computeShadow(vec4 vPositionFromLight,sampler2D shadowSampler,float darkness,float bias)\n{\nvec3 depth=vPositionFromLight.xyz/vPositionFromLight.w;\ndepth=0.5*depth+vec3(0.5);\nvec2 uv=depth.xy;\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\n#ifndef SHADOWFULLFLOAT\nfloat shadow=unpack(texture2D(shadowSampler,uv))+bias;\n#else\nfloat shadow=texture2D(shadowSampler,uv).x+bias;\n#endif\nif (depth.z>shadow)\n{\nreturn darkness;\n}\nreturn 1.;\n}\nfloat computeShadowWithPCF(vec4 vPositionFromLight,sampler2D shadowSampler,float mapSize,float bias,float darkness)\n{\nvec3 depth=vPositionFromLight.xyz/vPositionFromLight.w;\ndepth=0.5*depth+vec3(0.5);\nvec2 uv=depth.xy;\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat visibility=1.;\nvec2 poissonDisk[4];\npoissonDisk[0]=vec2(-0.94201624,-0.39906216);\npoissonDisk[1]=vec2(0.94558609,-0.76890725);\npoissonDisk[2]=vec2(-0.094184101,-0.92938870);\npoissonDisk[3]=vec2(0.34495938,0.29387760);\n\nfloat biasedDepth=depth.z-bias;\n#ifndef SHADOWFULLFLOAT\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[0]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[1]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[2]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[3]*mapSize))<biasedDepth) visibility-=0.25;\n#else\nif (texture2D(shadowSampler,uv+poissonDisk[0]*mapSize).x<biasedDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[1]*mapSize).x<biasedDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[2]*mapSize).x<biasedDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[3]*mapSize).x<biasedDepth) visibility-=0.25;\n#endif\nreturn min(1.0,visibility+darkness);\n}\n#ifndef SHADOWFULLFLOAT\n\nfloat unpackHalf(vec2 color)\n{\nreturn color.x+(color.y/255.0);\n}\n#endif\nfloat linstep(float low,float high,float v) {\nreturn clamp((v-low)/(high-low),0.0,1.0);\n}\nfloat ChebychevInequality(vec2 moments,float compare,float bias)\n{\nfloat p=smoothstep(compare-bias,compare,moments.x);\nfloat variance=max(moments.y-moments.x*moments.x,0.02);\nfloat d=compare-moments.x;\nfloat p_max=linstep(0.2,1.0,variance/(variance+d*d));\nreturn clamp(max(p,p_max),0.0,1.0);\n}\nfloat computeShadowWithVSM(vec4 vPositionFromLight,sampler2D shadowSampler,float bias,float darkness)\n{\nvec3 depth=vPositionFromLight.xyz/vPositionFromLight.w;\ndepth=0.5*depth+vec3(0.5);\nvec2 uv=depth.xy;\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0 || depth.z>=1.0)\n{\nreturn 1.0;\n}\nvec4 texel=texture2D(shadowSampler,uv);\n#ifndef SHADOWFULLFLOAT\nvec2 moments=vec2(unpackHalf(texel.xy),unpackHalf(texel.zw));\n#else\nvec2 moments=texel.xy;\n#endif\nreturn min(1.0,1.0-ChebychevInequality(moments,depth.z,bias)+darkness);\n}\n#endif"):
a.i.shadowsFragmentFunctions="#ifdef SHADOWS\n#ifndef SHADOWFULLFLOAT\nfloat unpack(vec4 color)\n{\nconst vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\nreturn dot(color,bit_shift);\n}\n#endif\nuniform vec2 depthValues;\nfloat computeShadowCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float bias)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth-depthValues.x)/(depthValues.y-depthValues.x);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFULLFLOAT\nfloat shadow=unpack(textureCube(shadowSampler,directionToLight))+bias;\n#else\nfloat shadow=textureCube(shadowSampler,directionToLight).x+bias;\n#endif\nif (depth>shadow)\n{\nreturn darkness;\n}\nreturn 1.0;\n}\nfloat computeShadowWithPCFCube(vec3 lightPosition,samplerCube shadowSampler,float mapSize,float bias,float darkness)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth-depthValues.x)/(depthValues.y-depthValues.x);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\nfloat visibility=1.;\nvec3 poissonDisk[4];\npoissonDisk[0]=vec3(-1.0,1.0,-1.0);\npoissonDisk[1]=vec3(1.0,-1.0,-1.0);\npoissonDisk[2]=vec3(-1.0,-1.0,-1.0);\npoissonDisk[3]=vec3(1.0,-1.0,1.0);\n\nfloat biasedDepth=depth-bias;\n#ifndef SHADOWFULLFLOAT\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize))<biasedDepth) visibility-=0.25;\n#else\nif (textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize).x<biasedDepth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize).x<biasedDepth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize).x<biasedDepth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize).x<biasedDepth) visibility-=0.25;\n#endif\nreturn min(1.0,visibility+darkness);\n}\nfloat computeShadow(vec4 vPositionFromLight,sampler2D shadowSampler,float darkness,float bias)\n{\nvec3 depth=vPositionFromLight.xyz/vPositionFromLight.w;\ndepth=0.5*depth+vec3(0.5);\nvec2 uv=depth.xy;\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\n#ifndef SHADOWFULLFLOAT\nfloat shadow=unpack(texture2D(shadowSampler,uv))+bias;\n#else\nfloat shadow=texture2D(shadowSampler,uv).x+bias;\n#endif\nif (depth.z>shadow)\n{\nreturn darkness;\n}\nreturn 1.;\n}\nfloat computeShadowWithPCF(vec4 vPositionFromLight,sampler2D shadowSampler,float mapSize,float bias,float darkness)\n{\nvec3 depth=vPositionFromLight.xyz/vPositionFromLight.w;\ndepth=0.5*depth+vec3(0.5);\nvec2 uv=depth.xy;\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat visibility=1.;\nvec2 poissonDisk[4];\npoissonDisk[0]=vec2(-0.94201624,-0.39906216);\npoissonDisk[1]=vec2(0.94558609,-0.76890725);\npoissonDisk[2]=vec2(-0.094184101,-0.92938870);\npoissonDisk[3]=vec2(0.34495938,0.29387760);\n\nfloat biasedDepth=depth.z-bias;\n#ifndef SHADOWFULLFLOAT\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[0]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[1]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[2]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[3]*mapSize))<biasedDepth) visibility-=0.25;\n#else\nif (texture2D(shadowSampler,uv+poissonDisk[0]*mapSize).x<biasedDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[1]*mapSize).x<biasedDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[2]*mapSize).x<biasedDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[3]*mapSize).x<biasedDepth) visibility-=0.25;\n#endif\nreturn min(1.0,visibility+darkness);\n}\n#ifndef SHADOWFULLFLOAT\n\nfloat unpackHalf(vec2 color)\n{\nreturn color.x+(color.y/255.0);\n}\n#endif\nfloat linstep(float low,float high,float v) {\nreturn clamp((v-low)/(high-low),0.0,1.0);\n}\nfloat ChebychevInequality(vec2 moments,float compare,float bias)\n{\nfloat p=smoothstep(compare-bias,compare,moments.x);\nfloat variance=max(moments.y-moments.x*moments.x,0.02);\nfloat d=compare-moments.x;\nfloat p_max=linstep(0.2,1.0,variance/(variance+d*d));\nreturn clamp(max(p,p_max),0.0,1.0);\n}\nfloat computeShadowWithVSM(vec4 vPositionFromLight,sampler2D shadowSampler,float bias,float darkness)\n{\nvec3 depth=vPositionFromLight.xyz/vPositionFromLight.w;\ndepth=0.5*depth+vec3(0.5);\nvec2 uv=depth.xy;\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0 || depth.z>=1.0)\n{\nreturn 1.0;\n}\nvec4 texel=texture2D(shadowSampler,uv);\n#ifndef SHADOWFULLFLOAT\nvec2 moments=vec2(unpackHalf(texel.xy),unpackHalf(texel.zw));\n#else\nvec2 moments=texel.xy;\n#endif\nreturn min(1.0,1.0-ChebychevInequality(moments,depth.z,bias)+darkness);\n}\n#endif";
null!=t.shadowsVertex?a.C("shadowsVertex","#ifdef SHADOWS\n#if defined(SPOTLIGHT{X}) || defined(DIRLIGHT{X})\nvPositionFromLight{X}=lightMatrix{X}*worldPos;\n#endif\n#endif"):a.i.shadowsVertex="#ifdef SHADOWS\n#if defined(SPOTLIGHT{X}) || defined(DIRLIGHT{X})\nvPositionFromLight{X}=lightMatrix{X}*worldPos;\n#endif\n#endif";null!=t.shadowsVertexDeclaration?a.C("shadowsVertexDeclaration","#ifdef SHADOWS\n#if defined(SPOTLIGHT{X}) || defined(DIRLIGHT{X})\nuniform mat4 lightMatrix{X};\nvarying vec4 vPositionFromLight{X};\n#endif\n#endif\n"):
a.i.shadowsVertexDeclaration="#ifdef SHADOWS\n#if defined(SPOTLIGHT{X}) || defined(DIRLIGHT{X})\nuniform mat4 lightMatrix{X};\nvarying vec4 vPositionFromLight{X};\n#endif\n#endif\n";return a}(this);wb.pb=function(){var a=new ea;null!=t["anaglyph.fragment"]?a.C("anaglyph.fragment","\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D leftSampler;\nvoid main(void)\n{\nvec4 leftFrag=texture2D(leftSampler,vUV);\nleftFrag=vec4(1.0,leftFrag.g,leftFrag.b,1.0);\nvec4 rightFrag=texture2D(textureSampler,vUV);\nrightFrag=vec4(rightFrag.r,1.0,1.0,1.0);\ngl_FragColor=vec4(rightFrag.rgb*leftFrag.rgb,1.0);\n}"):
a.i["anaglyph.fragment"]="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D leftSampler;\nvoid main(void)\n{\nvec4 leftFrag=texture2D(leftSampler,vUV);\nleftFrag=vec4(1.0,leftFrag.g,leftFrag.b,1.0);\nvec4 rightFrag=texture2D(textureSampler,vUV);\nrightFrag=vec4(rightFrag.r,1.0,1.0,1.0);\ngl_FragColor=vec4(rightFrag.rgb*leftFrag.rgb,1.0);\n}";null!=t["blackAndWhite.fragment"]?a.C("blackAndWhite.fragment","\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nvoid main(void) \n{\nfloat luminance=dot(texture2D(textureSampler,vUV).rgb,vec3(0.3,0.59,0.11));\ngl_FragColor=vec4(luminance,luminance,luminance,1.0);\n}"):
a.i["blackAndWhite.fragment"]="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nvoid main(void) \n{\nfloat luminance=dot(texture2D(textureSampler,vUV).rgb,vec3(0.3,0.59,0.11));\ngl_FragColor=vec4(luminance,luminance,luminance,1.0);\n}";null!=t["blur.fragment"]?a.C("blur.fragment","\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec2 screenSize;\nuniform vec2 direction;\nuniform float blurWidth;\nvoid main(void)\n{\nfloat weights[7];\nweights[0]=0.05;\nweights[1]=0.1;\nweights[2]=0.2;\nweights[3]=0.3;\nweights[4]=0.2;\nweights[5]=0.1;\nweights[6]=0.05;\nvec2 texelSize=vec2(1.0/screenSize.x,1.0/screenSize.y);\nvec2 texelStep=texelSize*direction*blurWidth;\nvec2 start=vUV-3.0*texelStep;\nvec4 baseColor=vec4(0.,0.,0.,0.);\nvec2 texelOffset=vec2(0.,0.);\nfor (int i=0; i<7; i++)\n{\nbaseColor+=texture2D(textureSampler,start+texelOffset)*weights[i];\ntexelOffset+=texelStep;\n}\ngl_FragColor=baseColor;\n}"):
a.i["blur.fragment"]="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec2 screenSize;\nuniform vec2 direction;\nuniform float blurWidth;\nvoid main(void)\n{\nfloat weights[7];\nweights[0]=0.05;\nweights[1]=0.1;\nweights[2]=0.2;\nweights[3]=0.3;\nweights[4]=0.2;\nweights[5]=0.1;\nweights[6]=0.05;\nvec2 texelSize=vec2(1.0/screenSize.x,1.0/screenSize.y);\nvec2 texelStep=texelSize*direction*blurWidth;\nvec2 start=vUV-3.0*texelStep;\nvec4 baseColor=vec4(0.,0.,0.,0.);\nvec2 texelOffset=vec2(0.,0.);\nfor (int i=0; i<7; i++)\n{\nbaseColor+=texture2D(textureSampler,start+texelOffset)*weights[i];\ntexelOffset+=texelStep;\n}\ngl_FragColor=baseColor;\n}";
null!=t["chromaticAberration.fragment"]?a.C("chromaticAberration.fragment","\nuniform sampler2D textureSampler; \n\nuniform float chromatic_aberration;\nuniform float screen_width;\nuniform float screen_height;\n\nvarying vec2 vUV;\nvoid main(void)\n{\nvec2 centered_screen_pos=vec2(vUV.x-0.5,vUV.y-0.5);\nfloat radius2=centered_screen_pos.x*centered_screen_pos.x\n+centered_screen_pos.y*centered_screen_pos.y;\nfloat radius=sqrt(radius2);\nvec4 original=texture2D(textureSampler,vUV);\nif (chromatic_aberration>0.0) {\n\nvec3 ref_indices=vec3(-0.3,0.0,0.3);\nfloat ref_shiftX=chromatic_aberration*radius*17.0/screen_width;\nfloat ref_shiftY=chromatic_aberration*radius*17.0/screen_height;\n\nvec2 ref_coords_r=vec2(vUV.x+ref_indices.r*ref_shiftX,vUV.y+ref_indices.r*ref_shiftY*0.5);\nvec2 ref_coords_g=vec2(vUV.x+ref_indices.g*ref_shiftX,vUV.y+ref_indices.g*ref_shiftY*0.5);\nvec2 ref_coords_b=vec2(vUV.x+ref_indices.b*ref_shiftX,vUV.y+ref_indices.b*ref_shiftY*0.5);\noriginal.r=texture2D(textureSampler,ref_coords_r).r;\noriginal.g=texture2D(textureSampler,ref_coords_g).g;\noriginal.b=texture2D(textureSampler,ref_coords_b).b;\n}\ngl_FragColor=original;\n}"):
a.i["chromaticAberration.fragment"]="\nuniform sampler2D textureSampler; \n\nuniform float chromatic_aberration;\nuniform float screen_width;\nuniform float screen_height;\n\nvarying vec2 vUV;\nvoid main(void)\n{\nvec2 centered_screen_pos=vec2(vUV.x-0.5,vUV.y-0.5);\nfloat radius2=centered_screen_pos.x*centered_screen_pos.x\n+centered_screen_pos.y*centered_screen_pos.y;\nfloat radius=sqrt(radius2);\nvec4 original=texture2D(textureSampler,vUV);\nif (chromatic_aberration>0.0) {\n\nvec3 ref_indices=vec3(-0.3,0.0,0.3);\nfloat ref_shiftX=chromatic_aberration*radius*17.0/screen_width;\nfloat ref_shiftY=chromatic_aberration*radius*17.0/screen_height;\n\nvec2 ref_coords_r=vec2(vUV.x+ref_indices.r*ref_shiftX,vUV.y+ref_indices.r*ref_shiftY*0.5);\nvec2 ref_coords_g=vec2(vUV.x+ref_indices.g*ref_shiftX,vUV.y+ref_indices.g*ref_shiftY*0.5);\nvec2 ref_coords_b=vec2(vUV.x+ref_indices.b*ref_shiftX,vUV.y+ref_indices.b*ref_shiftY*0.5);\noriginal.r=texture2D(textureSampler,ref_coords_r).r;\noriginal.g=texture2D(textureSampler,ref_coords_g).g;\noriginal.b=texture2D(textureSampler,ref_coords_b).b;\n}\ngl_FragColor=original;\n}";
null!=t["color.fragment"]?a.C("color.fragment","uniform vec4 color;\nvoid main(void) {\ngl_FragColor=color;\n}"):a.i["color.fragment"]="uniform vec4 color;\nvoid main(void) {\ngl_FragColor=color;\n}";null!=t["color.vertex"]?a.C("color.vertex","\nattribute vec3 position;\n\nuniform mat4 worldViewProjection;\nvoid main(void) {\ngl_Position=worldViewProjection*vec4(position,1.0);\n}"):a.i["color.vertex"]="\nattribute vec3 position;\n\nuniform mat4 worldViewProjection;\nvoid main(void) {\ngl_Position=worldViewProjection*vec4(position,1.0);\n}";
null!=t["colorCorrection.fragment"]?a.C("colorCorrection.fragment","\nuniform sampler2D textureSampler; \nuniform sampler2D colorTable; \n\nvarying vec2 vUV;\n\nconst float SLICE_COUNT=16.0; \n\nvec4 sampleAs3DTexture(sampler2D texture,vec3 uv,float width) {\nfloat sliceSize=1.0/width; \nfloat slicePixelSize=sliceSize/width; \nfloat sliceInnerSize=slicePixelSize*(width-1.0); \nfloat zSlice0=min(floor(uv.z*width),width-1.0);\nfloat zSlice1=min(zSlice0+1.0,width-1.0);\nfloat xOffset=slicePixelSize*0.5+uv.x*sliceInnerSize;\nfloat s0=xOffset+(zSlice0*sliceSize);\nfloat s1=xOffset+(zSlice1*sliceSize);\nvec4 slice0Color=texture2D(texture,vec2(s0,uv.y));\nvec4 slice1Color=texture2D(texture,vec2(s1,uv.y));\nfloat zOffset=mod(uv.z*width,1.0);\nvec4 result=mix(slice0Color,slice1Color,zOffset);\nreturn result;\n}\nvoid main(void)\n{\nvec4 screen_color=texture2D(textureSampler,vUV);\ngl_FragColor=sampleAs3DTexture(colorTable,screen_color.rgb,SLICE_COUNT);\n}"):
a.i["colorCorrection.fragment"]="\nuniform sampler2D textureSampler; \nuniform sampler2D colorTable; \n\nvarying vec2 vUV;\n\nconst float SLICE_COUNT=16.0; \n\nvec4 sampleAs3DTexture(sampler2D texture,vec3 uv,float width) {\nfloat sliceSize=1.0/width; \nfloat slicePixelSize=sliceSize/width; \nfloat sliceInnerSize=slicePixelSize*(width-1.0); \nfloat zSlice0=min(floor(uv.z*width),width-1.0);\nfloat zSlice1=min(zSlice0+1.0,width-1.0);\nfloat xOffset=slicePixelSize*0.5+uv.x*sliceInnerSize;\nfloat s0=xOffset+(zSlice0*sliceSize);\nfloat s1=xOffset+(zSlice1*sliceSize);\nvec4 slice0Color=texture2D(texture,vec2(s0,uv.y));\nvec4 slice1Color=texture2D(texture,vec2(s1,uv.y));\nfloat zOffset=mod(uv.z*width,1.0);\nvec4 result=mix(slice0Color,slice1Color,zOffset);\nreturn result;\n}\nvoid main(void)\n{\nvec4 screen_color=texture2D(textureSampler,vUV);\ngl_FragColor=sampleAs3DTexture(colorTable,screen_color.rgb,SLICE_COUNT);\n}";
null!=t["convolution.fragment"]?a.C("convolution.fragment","\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform vec2 screenSize;\nuniform float kernel[9];\nvoid main(void)\n{\nvec2 onePixel=vec2(1.0,1.0)/screenSize;\nvec4 colorSum =\ntexture2D(textureSampler,vUV+onePixel*vec2(-1,-1))*kernel[0] +\ntexture2D(textureSampler,vUV+onePixel*vec2(0,-1))*kernel[1] +\ntexture2D(textureSampler,vUV+onePixel*vec2(1,-1))*kernel[2] +\ntexture2D(textureSampler,vUV+onePixel*vec2(-1,0))*kernel[3] +\ntexture2D(textureSampler,vUV+onePixel*vec2(0,0))*kernel[4] +\ntexture2D(textureSampler,vUV+onePixel*vec2(1,0))*kernel[5] +\ntexture2D(textureSampler,vUV+onePixel*vec2(-1,1))*kernel[6] +\ntexture2D(textureSampler,vUV+onePixel*vec2(0,1))*kernel[7] +\ntexture2D(textureSampler,vUV+onePixel*vec2(1,1))*kernel[8];\nfloat kernelWeight =\nkernel[0] +\nkernel[1] +\nkernel[2] +\nkernel[3] +\nkernel[4] +\nkernel[5] +\nkernel[6] +\nkernel[7] +\nkernel[8];\nif (kernelWeight<=0.0) {\nkernelWeight=1.0;\n}\ngl_FragColor=vec4((colorSum/kernelWeight).rgb,1);\n}"):
a.i["convolution.fragment"]="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform vec2 screenSize;\nuniform float kernel[9];\nvoid main(void)\n{\nvec2 onePixel=vec2(1.0,1.0)/screenSize;\nvec4 colorSum =\ntexture2D(textureSampler,vUV+onePixel*vec2(-1,-1))*kernel[0] +\ntexture2D(textureSampler,vUV+onePixel*vec2(0,-1))*kernel[1] +\ntexture2D(textureSampler,vUV+onePixel*vec2(1,-1))*kernel[2] +\ntexture2D(textureSampler,vUV+onePixel*vec2(-1,0))*kernel[3] +\ntexture2D(textureSampler,vUV+onePixel*vec2(0,0))*kernel[4] +\ntexture2D(textureSampler,vUV+onePixel*vec2(1,0))*kernel[5] +\ntexture2D(textureSampler,vUV+onePixel*vec2(-1,1))*kernel[6] +\ntexture2D(textureSampler,vUV+onePixel*vec2(0,1))*kernel[7] +\ntexture2D(textureSampler,vUV+onePixel*vec2(1,1))*kernel[8];\nfloat kernelWeight =\nkernel[0] +\nkernel[1] +\nkernel[2] +\nkernel[3] +\nkernel[4] +\nkernel[5] +\nkernel[6] +\nkernel[7] +\nkernel[8];\nif (kernelWeight<=0.0) {\nkernelWeight=1.0;\n}\ngl_FragColor=vec4((colorSum/kernelWeight).rgb,1);\n}";
null!=t["default.fragment"]?a.C("default.fragment","#ifdef BUMP\n#extension GL_OES_standard_derivatives : enable\n#endif\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n\n#define RECIPROCAL_PI2 0.15915494\nuniform vec3 vEyePosition;\nuniform vec3 vAmbientColor;\nuniform vec4 vDiffuseColor;\n#ifdef SPECULARTERM\nuniform vec4 vSpecularColor;\n#endif\nuniform vec3 vEmissiveColor;\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<helperFunctions>\n\n#include<lightFragmentDeclaration>[0..maxSimultaneousLights]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform sampler2D diffuseSampler;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform sampler2D ambientSampler;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY \nvarying vec2 vOpacityUV;\nuniform sampler2D opacitySampler;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform sampler2D emissiveSampler;\n#endif\n#ifdef LIGHTMAP\nvarying vec2 vLightmapUV;\nuniform vec2 vLightmapInfos;\nuniform sampler2D lightmapSampler;\n#endif\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)\nuniform mat4 view;\n#endif\n#ifdef REFRACTION\nuniform vec4 vRefractionInfos;\n#ifdef REFRACTIONMAP_3D\nuniform samplerCube refractionCubeSampler;\n#else\nuniform sampler2D refraction2DSampler;\nuniform mat4 refractionMatrix;\n#endif\n#ifdef REFRACTIONFRESNEL\nuniform vec4 refractionLeftColor;\nuniform vec4 refractionRightColor;\n#endif\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nvarying vec2 vSpecularUV;\nuniform vec2 vSpecularInfos;\nuniform sampler2D specularSampler;\n#endif\n\n#include<fresnelFunction>\n#ifdef DIFFUSEFRESNEL\nuniform vec4 diffuseLeftColor;\nuniform vec4 diffuseRightColor;\n#endif\n#ifdef OPACITYFRESNEL\nuniform vec4 opacityParts;\n#endif\n#ifdef EMISSIVEFRESNEL\nuniform vec4 emissiveLeftColor;\nuniform vec4 emissiveRightColor;\n#endif\n\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\n#ifdef REFLECTIONMAP_3D\nuniform samplerCube reflectionCubeSampler;\n#else\nuniform sampler2D reflection2DSampler;\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvarying vec3 vDirectionW;\n#endif\n#if defined(REFLECTIONMAP_PLANAR) || defined(REFLECTIONMAP_CUBIC) || defined(REFLECTIONMAP_PROJECTION)\nuniform mat4 reflectionMatrix;\n#endif\n#endif\n#include<reflectionFunction>\n#ifdef REFLECTIONFRESNEL\nuniform vec4 reflectionLeftColor;\nuniform vec4 reflectionRightColor;\n#endif\n#endif\n#ifdef CAMERACOLORGRADING\n#include<colorGradingDefinition> \n#include<colorGrading>\n#endif\n#ifdef CAMERACOLORCURVES\n#include<colorCurvesDefinition>\n#include<colorCurves>\n#endif\n#include<bumpFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n\nfloat alpha=vDiffuseColor.a;\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n#include<bumpFragment>\n#ifdef DIFFUSE\nbaseColor=texture2D(diffuseSampler,vDiffuseUV+uvOffset);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#ifdef ALPHAFROMDIFFUSE\nalpha*=baseColor.a;\n#endif\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n\nvec3 baseAmbientColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nbaseAmbientColor=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb*vAmbientInfos.y;\n#endif\n\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;\nvec3 specularColor=vSpecularColor.rgb;\n#ifdef SPECULAR\nvec4 specularMapColor=texture2D(specularSampler,vSpecularUV+uvOffset);\nspecularColor=specularMapColor.rgb;\n#ifdef GLOSSINESS\nglossiness=glossiness*specularMapColor.a;\n#endif\n#endif\n#else\nfloat glossiness=0.;\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\nfloat shadow=1.;\n#ifdef LIGHTMAP\nvec3 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset).rgb*vLightmapInfos.y;\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\n\nvec3 refractionColor=vec3(0.,0.,0.);\n#ifdef REFRACTION\nvec3 refractionVector=normalize(refract(-viewDirectionW,normalW,vRefractionInfos.y));\n#ifdef REFRACTIONMAP_3D\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;\nif (dot(refractionVector,viewDirectionW)<1.0)\n{\nrefractionColor=textureCube(refractionCubeSampler,refractionVector).rgb*vRefractionInfos.x;\n}\n#else\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));\nvec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;\nrefractionCoords.y=1.0-refractionCoords.y;\nrefractionColor=texture2D(refraction2DSampler,refractionCoords).rgb*vRefractionInfos.x;\n#endif\n#endif\n\nvec3 reflectionColor=vec3(0.,0.,0.);\n#ifdef REFLECTION\nvec3 vReflectionUVW=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#ifdef REFLECTIONMAP_3D\n#ifdef ROUGHNESS\nfloat bias=vReflectionInfos.y;\n#ifdef SPECULARTERM\n#ifdef SPECULAR\n#ifdef GLOSSINESS\nbias*=(1.0-specularMapColor.a);\n#endif\n#endif\n#endif\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW,bias).rgb*vReflectionInfos.x;\n#else\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW).rgb*vReflectionInfos.x;\n#endif\n#else\nvec2 coords=vReflectionUVW.xy;\n#ifdef REFLECTIONMAP_PROJECTION\ncoords/=vReflectionUVW.z;\n#endif\ncoords.y=1.0-coords.y;\nreflectionColor=texture2D(reflection2DSampler,coords).rgb*vReflectionInfos.x;\n#endif\n#ifdef REFLECTIONFRESNEL\nfloat reflectionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,reflectionRightColor.a,reflectionLeftColor.a);\n#ifdef REFLECTIONFRESNELFROMSPECULAR\n#ifdef SPECULARTERM\nreflectionColor*=specularColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#else\nreflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#else\nreflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#endif\n#endif\n#ifdef REFRACTIONFRESNEL\nfloat refractionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,refractionRightColor.a,refractionLeftColor.a);\nrefractionColor*=refractionLeftColor.rgb*(1.0-refractionFresnelTerm)+refractionFresnelTerm*refractionRightColor.rgb;\n#endif\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);\n#ifdef OPACITYRGB\nopacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);\nalpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;\n#else\nalpha*=opacityMap.a*vOpacityInfos.y;\n#endif\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#ifdef OPACITYFRESNEL\nfloat opacityFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,opacityParts.z,opacityParts.w);\nalpha+=opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*opacityParts.y;\n#endif\n\nvec3 emissiveColor=vEmissiveColor;\n#ifdef EMISSIVE\nemissiveColor+=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb*vEmissiveInfos.y;\n#endif\n#ifdef EMISSIVEFRESNEL\nfloat emissiveFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,emissiveRightColor.a,emissiveLeftColor.a);\nemissiveColor*=emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*emissiveRightColor.rgb;\n#endif\n\n#ifdef DIFFUSEFRESNEL\nfloat diffuseFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,diffuseRightColor.a,diffuseLeftColor.a);\ndiffuseBase*=diffuseLeftColor.rgb*(1.0-diffuseFresnelTerm)+diffuseFresnelTerm*diffuseRightColor.rgb;\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\n#ifdef LINKEMISSIVEWITHDIFFUSE\nvec3 finalDiffuse=clamp((diffuseBase+emissiveColor)*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+emissiveColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#endif\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\n#ifdef SPECULAROVERALPHA\nalpha=clamp(alpha+dot(finalSpecular,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n#ifdef REFLECTIONOVERALPHA\nalpha=clamp(alpha+dot(reflectionColor,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec4 color=vec4(clamp(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor+emissiveColor+refractionColor,0.0,1.0),alpha);\n#else\nvec4 color=vec4(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor+refractionColor,alpha);\n#endif\n\n#ifdef LIGHTMAP\n#ifndef LIGHTMAPEXCLUDED\n#ifdef USELIGHTMAPASSHADOWMAP\ncolor.rgb*=lightmapColor;\n#else\ncolor.rgb+=lightmapColor;\n#endif\n#endif\n#endif\n#include<logDepthFragment>\n#include<fogFragment>\n#ifdef CAMERACOLORGRADING\ncolor=colorGrades(color);\n#endif\n#ifdef CAMERACOLORCURVES\ncolor.rgb=applyColorCurves(color.rgb);\n#endif\ngl_FragColor=color;\n}"):
a.i["default.fragment"]="#ifdef BUMP\n#extension GL_OES_standard_derivatives : enable\n#endif\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n\n#define RECIPROCAL_PI2 0.15915494\nuniform vec3 vEyePosition;\nuniform vec3 vAmbientColor;\nuniform vec4 vDiffuseColor;\n#ifdef SPECULARTERM\nuniform vec4 vSpecularColor;\n#endif\nuniform vec3 vEmissiveColor;\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<helperFunctions>\n\n#include<lightFragmentDeclaration>[0..maxSimultaneousLights]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform sampler2D diffuseSampler;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform sampler2D ambientSampler;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY \nvarying vec2 vOpacityUV;\nuniform sampler2D opacitySampler;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform sampler2D emissiveSampler;\n#endif\n#ifdef LIGHTMAP\nvarying vec2 vLightmapUV;\nuniform vec2 vLightmapInfos;\nuniform sampler2D lightmapSampler;\n#endif\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)\nuniform mat4 view;\n#endif\n#ifdef REFRACTION\nuniform vec4 vRefractionInfos;\n#ifdef REFRACTIONMAP_3D\nuniform samplerCube refractionCubeSampler;\n#else\nuniform sampler2D refraction2DSampler;\nuniform mat4 refractionMatrix;\n#endif\n#ifdef REFRACTIONFRESNEL\nuniform vec4 refractionLeftColor;\nuniform vec4 refractionRightColor;\n#endif\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nvarying vec2 vSpecularUV;\nuniform vec2 vSpecularInfos;\nuniform sampler2D specularSampler;\n#endif\n\n#include<fresnelFunction>\n#ifdef DIFFUSEFRESNEL\nuniform vec4 diffuseLeftColor;\nuniform vec4 diffuseRightColor;\n#endif\n#ifdef OPACITYFRESNEL\nuniform vec4 opacityParts;\n#endif\n#ifdef EMISSIVEFRESNEL\nuniform vec4 emissiveLeftColor;\nuniform vec4 emissiveRightColor;\n#endif\n\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\n#ifdef REFLECTIONMAP_3D\nuniform samplerCube reflectionCubeSampler;\n#else\nuniform sampler2D reflection2DSampler;\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvarying vec3 vDirectionW;\n#endif\n#if defined(REFLECTIONMAP_PLANAR) || defined(REFLECTIONMAP_CUBIC) || defined(REFLECTIONMAP_PROJECTION)\nuniform mat4 reflectionMatrix;\n#endif\n#endif\n#include<reflectionFunction>\n#ifdef REFLECTIONFRESNEL\nuniform vec4 reflectionLeftColor;\nuniform vec4 reflectionRightColor;\n#endif\n#endif\n#ifdef CAMERACOLORGRADING\n#include<colorGradingDefinition> \n#include<colorGrading>\n#endif\n#ifdef CAMERACOLORCURVES\n#include<colorCurvesDefinition>\n#include<colorCurves>\n#endif\n#include<bumpFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n\nfloat alpha=vDiffuseColor.a;\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n#include<bumpFragment>\n#ifdef DIFFUSE\nbaseColor=texture2D(diffuseSampler,vDiffuseUV+uvOffset);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#ifdef ALPHAFROMDIFFUSE\nalpha*=baseColor.a;\n#endif\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n\nvec3 baseAmbientColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nbaseAmbientColor=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb*vAmbientInfos.y;\n#endif\n\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;\nvec3 specularColor=vSpecularColor.rgb;\n#ifdef SPECULAR\nvec4 specularMapColor=texture2D(specularSampler,vSpecularUV+uvOffset);\nspecularColor=specularMapColor.rgb;\n#ifdef GLOSSINESS\nglossiness=glossiness*specularMapColor.a;\n#endif\n#endif\n#else\nfloat glossiness=0.;\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\nfloat shadow=1.;\n#ifdef LIGHTMAP\nvec3 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset).rgb*vLightmapInfos.y;\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\n\nvec3 refractionColor=vec3(0.,0.,0.);\n#ifdef REFRACTION\nvec3 refractionVector=normalize(refract(-viewDirectionW,normalW,vRefractionInfos.y));\n#ifdef REFRACTIONMAP_3D\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;\nif (dot(refractionVector,viewDirectionW)<1.0)\n{\nrefractionColor=textureCube(refractionCubeSampler,refractionVector).rgb*vRefractionInfos.x;\n}\n#else\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));\nvec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;\nrefractionCoords.y=1.0-refractionCoords.y;\nrefractionColor=texture2D(refraction2DSampler,refractionCoords).rgb*vRefractionInfos.x;\n#endif\n#endif\n\nvec3 reflectionColor=vec3(0.,0.,0.);\n#ifdef REFLECTION\nvec3 vReflectionUVW=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#ifdef REFLECTIONMAP_3D\n#ifdef ROUGHNESS\nfloat bias=vReflectionInfos.y;\n#ifdef SPECULARTERM\n#ifdef SPECULAR\n#ifdef GLOSSINESS\nbias*=(1.0-specularMapColor.a);\n#endif\n#endif\n#endif\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW,bias).rgb*vReflectionInfos.x;\n#else\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW).rgb*vReflectionInfos.x;\n#endif\n#else\nvec2 coords=vReflectionUVW.xy;\n#ifdef REFLECTIONMAP_PROJECTION\ncoords/=vReflectionUVW.z;\n#endif\ncoords.y=1.0-coords.y;\nreflectionColor=texture2D(reflection2DSampler,coords).rgb*vReflectionInfos.x;\n#endif\n#ifdef REFLECTIONFRESNEL\nfloat reflectionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,reflectionRightColor.a,reflectionLeftColor.a);\n#ifdef REFLECTIONFRESNELFROMSPECULAR\n#ifdef SPECULARTERM\nreflectionColor*=specularColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#else\nreflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#else\nreflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#endif\n#endif\n#ifdef REFRACTIONFRESNEL\nfloat refractionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,refractionRightColor.a,refractionLeftColor.a);\nrefractionColor*=refractionLeftColor.rgb*(1.0-refractionFresnelTerm)+refractionFresnelTerm*refractionRightColor.rgb;\n#endif\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);\n#ifdef OPACITYRGB\nopacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);\nalpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;\n#else\nalpha*=opacityMap.a*vOpacityInfos.y;\n#endif\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#ifdef OPACITYFRESNEL\nfloat opacityFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,opacityParts.z,opacityParts.w);\nalpha+=opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*opacityParts.y;\n#endif\n\nvec3 emissiveColor=vEmissiveColor;\n#ifdef EMISSIVE\nemissiveColor+=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb*vEmissiveInfos.y;\n#endif\n#ifdef EMISSIVEFRESNEL\nfloat emissiveFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,emissiveRightColor.a,emissiveLeftColor.a);\nemissiveColor*=emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*emissiveRightColor.rgb;\n#endif\n\n#ifdef DIFFUSEFRESNEL\nfloat diffuseFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,diffuseRightColor.a,diffuseLeftColor.a);\ndiffuseBase*=diffuseLeftColor.rgb*(1.0-diffuseFresnelTerm)+diffuseFresnelTerm*diffuseRightColor.rgb;\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\n#ifdef LINKEMISSIVEWITHDIFFUSE\nvec3 finalDiffuse=clamp((diffuseBase+emissiveColor)*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+emissiveColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#endif\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\n#ifdef SPECULAROVERALPHA\nalpha=clamp(alpha+dot(finalSpecular,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n#ifdef REFLECTIONOVERALPHA\nalpha=clamp(alpha+dot(reflectionColor,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec4 color=vec4(clamp(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor+emissiveColor+refractionColor,0.0,1.0),alpha);\n#else\nvec4 color=vec4(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor+refractionColor,alpha);\n#endif\n\n#ifdef LIGHTMAP\n#ifndef LIGHTMAPEXCLUDED\n#ifdef USELIGHTMAPASSHADOWMAP\ncolor.rgb*=lightmapColor;\n#else\ncolor.rgb+=lightmapColor;\n#endif\n#endif\n#endif\n#include<logDepthFragment>\n#include<fogFragment>\n#ifdef CAMERACOLORGRADING\ncolor=colorGrades(color);\n#endif\n#ifdef CAMERACOLORCURVES\ncolor.rgb=applyColorCurves(color.rgb);\n#endif\ngl_FragColor=color;\n}";
null!=t["default.vertex"]?a.C("default.vertex","\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform mat4 ambientMatrix;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY\nvarying vec2 vOpacityUV;\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#ifdef LIGHTMAP\nvarying vec2 vLightmapUV;\nuniform vec2 vLightmapInfos;\nuniform mat4 lightmapMatrix;\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nvarying vec2 vSpecularUV;\nuniform vec2 vSpecularInfos;\nuniform mat4 specularMatrix;\n#endif\n#ifdef BUMP\nvarying vec2 vBumpUV;\nuniform vec3 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n#include<pointCloudVertexDeclaration>\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<shadowsVertexDeclaration>[0..maxSimultaneousLights]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvarying vec3 vDirectionW;\n#endif\n#include<logDepthDeclaration>\nvoid main(void) {\n#ifdef REFLECTIONMAP_SKYBOX\nvPositionUVW=position;\n#endif \n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\nvec4 worldPos=finalWorld*vec4(position,1.0);\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvDirectionW=normalize(vec3(finalWorld*vec4(position,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef DIFFUSE\nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef AMBIENT\nif (vAmbientInfos.x == 0.)\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef OPACITY\nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef EMISSIVE\nif (vEmissiveInfos.x == 0.)\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef LIGHTMAP\nif (vLightmapInfos.x == 0.)\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nif (vSpecularInfos.x == 0.)\n{\nvSpecularUV=vec2(specularMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvSpecularUV=vec2(specularMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef BUMP\nif (vBumpInfos.x == 0.)\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n#ifdef VERTEXCOLOR\n\nvColor=color;\n#endif\n#include<pointCloudVertex>\n#include<logDepthVertex>\n}"):
a.i["default.vertex"]="\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform mat4 ambientMatrix;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY\nvarying vec2 vOpacityUV;\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#ifdef LIGHTMAP\nvarying vec2 vLightmapUV;\nuniform vec2 vLightmapInfos;\nuniform mat4 lightmapMatrix;\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nvarying vec2 vSpecularUV;\nuniform vec2 vSpecularInfos;\nuniform mat4 specularMatrix;\n#endif\n#ifdef BUMP\nvarying vec2 vBumpUV;\nuniform vec3 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n#include<pointCloudVertexDeclaration>\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<shadowsVertexDeclaration>[0..maxSimultaneousLights]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvarying vec3 vDirectionW;\n#endif\n#include<logDepthDeclaration>\nvoid main(void) {\n#ifdef REFLECTIONMAP_SKYBOX\nvPositionUVW=position;\n#endif \n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\nvec4 worldPos=finalWorld*vec4(position,1.0);\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvDirectionW=normalize(vec3(finalWorld*vec4(position,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef DIFFUSE\nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef AMBIENT\nif (vAmbientInfos.x == 0.)\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef OPACITY\nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef EMISSIVE\nif (vEmissiveInfos.x == 0.)\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef LIGHTMAP\nif (vLightmapInfos.x == 0.)\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nif (vSpecularInfos.x == 0.)\n{\nvSpecularUV=vec2(specularMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvSpecularUV=vec2(specularMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef BUMP\nif (vBumpInfos.x == 0.)\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n#ifdef VERTEXCOLOR\n\nvColor=color;\n#endif\n#include<pointCloudVertex>\n#include<logDepthVertex>\n}";
null!=t["depth.fragment"]?a.C("depth.fragment","#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\nuniform float far;\nvoid main(void)\n{\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\nfloat depth=(gl_FragCoord.z/gl_FragCoord.w)/far;\ngl_FragColor=vec4(depth,depth*depth,0.0,1.0);\n}"):a.i["depth.fragment"]="#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\nuniform float far;\nvoid main(void)\n{\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\nfloat depth=(gl_FragCoord.z/gl_FragCoord.w)/far;\ngl_FragColor=vec4(depth,depth*depth,0.0,1.0);\n}";
null!=t["depth.vertex"]?a.C("depth.vertex","\nattribute vec3 position;\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\n#if defined(ALPHATEST) || defined(NEED_UV)\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\nvoid main(void)\n{\n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n}"):
a.i["depth.vertex"]="\nattribute vec3 position;\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\n#if defined(ALPHATEST) || defined(NEED_UV)\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\nvoid main(void)\n{\n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n}";
null!=t["depthBoxBlur.fragment"]?a.C("depthBoxBlur.fragment","\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec2 screenSize;\nvoid main(void)\n{\nvec4 colorDepth=vec4(0.0);\nfor (int x=-OFFSET; x<=OFFSET; x++)\nfor (int y=-OFFSET; y<=OFFSET; y++)\ncolorDepth+=texture2D(textureSampler,vUV+vec2(x,y)/screenSize);\ngl_FragColor=(colorDepth/float((OFFSET*2+1)*(OFFSET*2+1)));\n}"):a.i["depthBoxBlur.fragment"]="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec2 screenSize;\nvoid main(void)\n{\nvec4 colorDepth=vec4(0.0);\nfor (int x=-OFFSET; x<=OFFSET; x++)\nfor (int y=-OFFSET; y<=OFFSET; y++)\ncolorDepth+=texture2D(textureSampler,vUV+vec2(x,y)/screenSize);\ngl_FragColor=(colorDepth/float((OFFSET*2+1)*(OFFSET*2+1)));\n}";
null!=t["depthOfField.fragment"]?a.C("depthOfField.fragment","\n\n\n\n\nuniform sampler2D textureSampler;\nuniform sampler2D highlightsSampler;\nuniform sampler2D depthSampler;\nuniform sampler2D grainSampler;\n\nuniform float grain_amount;\nuniform bool blur_noise;\nuniform float screen_width;\nuniform float screen_height;\nuniform float distortion;\nuniform bool dof_enabled;\n\nuniform float screen_distance; \nuniform float aperture;\nuniform float darken;\nuniform float edge_blur;\nuniform bool highlights;\n\nuniform float near;\nuniform float far;\n\nvarying vec2 vUV;\n\n#define PI 3.14159265\n#define TWOPI 6.28318530\n#define inverse_focal_length 0.1 \n\nvec2 centered_screen_pos;\nvec2 distorted_coords;\nfloat radius2;\nfloat radius;\n\nvec2 rand(vec2 co)\n{\nfloat noise1=(fract(sin(dot(co,vec2(12.9898,78.233)))*43758.5453));\nfloat noise2=(fract(sin(dot(co,vec2(12.9898,78.233)*2.0))*43758.5453));\nreturn clamp(vec2(noise1,noise2),0.0,1.0);\n}\n\nvec2 getDistortedCoords(vec2 coords) {\nif (distortion == 0.0) { return coords; }\nvec2 direction=1.0*normalize(centered_screen_pos);\nvec2 dist_coords=vec2(0.5,0.5);\ndist_coords.x=0.5+direction.x*radius2*1.0;\ndist_coords.y=0.5+direction.y*radius2*1.0;\nfloat dist_amount=clamp(distortion*0.23,0.0,1.0);\ndist_coords=mix(coords,dist_coords,dist_amount);\nreturn dist_coords;\n}\n\nfloat sampleScreen(inout vec4 color,const in vec2 offset,const in float weight) {\n\nvec2 coords=distorted_coords;\nfloat angle=rand(coords*100.0).x*TWOPI;\ncoords+=vec2(offset.x*cos(angle)-offset.y*sin(angle),offset.x*sin(angle)+offset.y*cos(angle));\ncolor+=texture2D(textureSampler,coords)*weight;\nreturn weight;\n}\n\nfloat getBlurLevel(float size) {\nreturn min(3.0,ceil(size/1.0));\n}\n\nvec4 getBlurColor(float size) {\nvec4 col=texture2D(textureSampler,distorted_coords);\nif (size == 0.0) { return col; }\n\n\nfloat blur_level=getBlurLevel(size);\nfloat w=(size/screen_width);\nfloat h=(size/screen_height);\nfloat total_weight=1.0;\nvec2 sample_coords;\ntotal_weight+=sampleScreen(col,vec2(-0.50*w,0.24*h),0.93);\ntotal_weight+=sampleScreen(col,vec2(0.30*w,-0.75*h),0.90);\ntotal_weight+=sampleScreen(col,vec2(0.36*w,0.96*h),0.87);\ntotal_weight+=sampleScreen(col,vec2(-1.08*w,-0.55*h),0.85);\ntotal_weight+=sampleScreen(col,vec2(1.33*w,-0.37*h),0.83);\ntotal_weight+=sampleScreen(col,vec2(-0.82*w,1.31*h),0.80);\ntotal_weight+=sampleScreen(col,vec2(-0.31*w,-1.67*h),0.78);\ntotal_weight+=sampleScreen(col,vec2(1.47*w,1.11*h),0.76);\ntotal_weight+=sampleScreen(col,vec2(-1.97*w,0.19*h),0.74);\ntotal_weight+=sampleScreen(col,vec2(1.42*w,-1.57*h),0.72);\nif (blur_level>1.0) {\ntotal_weight+=sampleScreen(col,vec2(0.01*w,2.25*h),0.70);\ntotal_weight+=sampleScreen(col,vec2(-1.62*w,-1.74*h),0.67);\ntotal_weight+=sampleScreen(col,vec2(2.49*w,0.20*h),0.65);\ntotal_weight+=sampleScreen(col,vec2(-2.07*w,1.61*h),0.63);\ntotal_weight+=sampleScreen(col,vec2(0.46*w,-2.70*h),0.61);\ntotal_weight+=sampleScreen(col,vec2(1.55*w,2.40*h),0.59);\ntotal_weight+=sampleScreen(col,vec2(-2.88*w,-0.75*h),0.56);\ntotal_weight+=sampleScreen(col,vec2(2.73*w,-1.44*h),0.54);\ntotal_weight+=sampleScreen(col,vec2(-1.08*w,3.02*h),0.52);\ntotal_weight+=sampleScreen(col,vec2(-1.28*w,-3.05*h),0.49);\n}\nif (blur_level>2.0) {\ntotal_weight+=sampleScreen(col,vec2(3.11*w,1.43*h),0.46);\ntotal_weight+=sampleScreen(col,vec2(-3.36*w,1.08*h),0.44);\ntotal_weight+=sampleScreen(col,vec2(1.80*w,-3.16*h),0.41);\ntotal_weight+=sampleScreen(col,vec2(0.83*w,3.65*h),0.38);\ntotal_weight+=sampleScreen(col,vec2(-3.16*w,-2.19*h),0.34);\ntotal_weight+=sampleScreen(col,vec2(3.92*w,-0.53*h),0.31);\ntotal_weight+=sampleScreen(col,vec2(-2.59*w,3.12*h),0.26);\ntotal_weight+=sampleScreen(col,vec2(-0.20*w,-4.15*h),0.22);\ntotal_weight+=sampleScreen(col,vec2(3.02*w,3.00*h),0.15);\n}\ncol/=total_weight; \n\nif (darken>0.0) {\ncol.rgb*=clamp(0.3,1.0,1.05-size*0.5*darken);\n}\n\n\n\n\nreturn col;\n}\nvoid main(void)\n{\n\ncentered_screen_pos=vec2(vUV.x-0.5,vUV.y-0.5);\nradius2=centered_screen_pos.x*centered_screen_pos.x+centered_screen_pos.y*centered_screen_pos.y;\nradius=sqrt(radius2);\ndistorted_coords=getDistortedCoords(vUV); \nvec2 texels_coords=vec2(vUV.x*screen_width,vUV.y*screen_height); \nfloat depth=texture2D(depthSampler,distorted_coords).r; \nfloat distance=near+(far-near)*depth; \nvec4 color=texture2D(textureSampler,vUV); \n\n\nfloat coc=abs(aperture*(screen_distance*(inverse_focal_length-1.0/distance)-1.0));\n\nif (dof_enabled == false || coc<0.07) { coc=0.0; }\n\nfloat edge_blur_amount=0.0;\nif (edge_blur>0.0) {\nedge_blur_amount=clamp((radius*2.0-1.0+0.15*edge_blur)*1.5,0.0,1.0)*1.3;\n}\n\nfloat blur_amount=max(edge_blur_amount,coc);\n\nif (blur_amount == 0.0) {\ngl_FragColor=texture2D(textureSampler,distorted_coords);\n}\nelse {\n\ngl_FragColor=getBlurColor(blur_amount*1.7);\n\nif (highlights) {\ngl_FragColor.rgb+=clamp(coc,0.0,1.0)*texture2D(highlightsSampler,distorted_coords).rgb;\n}\nif (blur_noise) {\n\nvec2 noise=rand(distorted_coords)*0.01*blur_amount;\nvec2 blurred_coord=vec2(distorted_coords.x+noise.x,distorted_coords.y+noise.y);\ngl_FragColor=0.04*texture2D(textureSampler,blurred_coord)+0.96*gl_FragColor;\n}\n}\n\nif (grain_amount>0.0) {\nvec4 grain_color=texture2D(grainSampler,texels_coords*0.003);\ngl_FragColor.rgb+=(-0.5+grain_color.rgb)*0.30*grain_amount;\n}\n}\n"):
a.i["depthOfField.fragment"]="\n\n\n\n\nuniform sampler2D textureSampler;\nuniform sampler2D highlightsSampler;\nuniform sampler2D depthSampler;\nuniform sampler2D grainSampler;\n\nuniform float grain_amount;\nuniform bool blur_noise;\nuniform float screen_width;\nuniform float screen_height;\nuniform float distortion;\nuniform bool dof_enabled;\n\nuniform float screen_distance; \nuniform float aperture;\nuniform float darken;\nuniform float edge_blur;\nuniform bool highlights;\n\nuniform float near;\nuniform float far;\n\nvarying vec2 vUV;\n\n#define PI 3.14159265\n#define TWOPI 6.28318530\n#define inverse_focal_length 0.1 \n\nvec2 centered_screen_pos;\nvec2 distorted_coords;\nfloat radius2;\nfloat radius;\n\nvec2 rand(vec2 co)\n{\nfloat noise1=(fract(sin(dot(co,vec2(12.9898,78.233)))*43758.5453));\nfloat noise2=(fract(sin(dot(co,vec2(12.9898,78.233)*2.0))*43758.5453));\nreturn clamp(vec2(noise1,noise2),0.0,1.0);\n}\n\nvec2 getDistortedCoords(vec2 coords) {\nif (distortion == 0.0) { return coords; }\nvec2 direction=1.0*normalize(centered_screen_pos);\nvec2 dist_coords=vec2(0.5,0.5);\ndist_coords.x=0.5+direction.x*radius2*1.0;\ndist_coords.y=0.5+direction.y*radius2*1.0;\nfloat dist_amount=clamp(distortion*0.23,0.0,1.0);\ndist_coords=mix(coords,dist_coords,dist_amount);\nreturn dist_coords;\n}\n\nfloat sampleScreen(inout vec4 color,const in vec2 offset,const in float weight) {\n\nvec2 coords=distorted_coords;\nfloat angle=rand(coords*100.0).x*TWOPI;\ncoords+=vec2(offset.x*cos(angle)-offset.y*sin(angle),offset.x*sin(angle)+offset.y*cos(angle));\ncolor+=texture2D(textureSampler,coords)*weight;\nreturn weight;\n}\n\nfloat getBlurLevel(float size) {\nreturn min(3.0,ceil(size/1.0));\n}\n\nvec4 getBlurColor(float size) {\nvec4 col=texture2D(textureSampler,distorted_coords);\nif (size == 0.0) { return col; }\n\n\nfloat blur_level=getBlurLevel(size);\nfloat w=(size/screen_width);\nfloat h=(size/screen_height);\nfloat total_weight=1.0;\nvec2 sample_coords;\ntotal_weight+=sampleScreen(col,vec2(-0.50*w,0.24*h),0.93);\ntotal_weight+=sampleScreen(col,vec2(0.30*w,-0.75*h),0.90);\ntotal_weight+=sampleScreen(col,vec2(0.36*w,0.96*h),0.87);\ntotal_weight+=sampleScreen(col,vec2(-1.08*w,-0.55*h),0.85);\ntotal_weight+=sampleScreen(col,vec2(1.33*w,-0.37*h),0.83);\ntotal_weight+=sampleScreen(col,vec2(-0.82*w,1.31*h),0.80);\ntotal_weight+=sampleScreen(col,vec2(-0.31*w,-1.67*h),0.78);\ntotal_weight+=sampleScreen(col,vec2(1.47*w,1.11*h),0.76);\ntotal_weight+=sampleScreen(col,vec2(-1.97*w,0.19*h),0.74);\ntotal_weight+=sampleScreen(col,vec2(1.42*w,-1.57*h),0.72);\nif (blur_level>1.0) {\ntotal_weight+=sampleScreen(col,vec2(0.01*w,2.25*h),0.70);\ntotal_weight+=sampleScreen(col,vec2(-1.62*w,-1.74*h),0.67);\ntotal_weight+=sampleScreen(col,vec2(2.49*w,0.20*h),0.65);\ntotal_weight+=sampleScreen(col,vec2(-2.07*w,1.61*h),0.63);\ntotal_weight+=sampleScreen(col,vec2(0.46*w,-2.70*h),0.61);\ntotal_weight+=sampleScreen(col,vec2(1.55*w,2.40*h),0.59);\ntotal_weight+=sampleScreen(col,vec2(-2.88*w,-0.75*h),0.56);\ntotal_weight+=sampleScreen(col,vec2(2.73*w,-1.44*h),0.54);\ntotal_weight+=sampleScreen(col,vec2(-1.08*w,3.02*h),0.52);\ntotal_weight+=sampleScreen(col,vec2(-1.28*w,-3.05*h),0.49);\n}\nif (blur_level>2.0) {\ntotal_weight+=sampleScreen(col,vec2(3.11*w,1.43*h),0.46);\ntotal_weight+=sampleScreen(col,vec2(-3.36*w,1.08*h),0.44);\ntotal_weight+=sampleScreen(col,vec2(1.80*w,-3.16*h),0.41);\ntotal_weight+=sampleScreen(col,vec2(0.83*w,3.65*h),0.38);\ntotal_weight+=sampleScreen(col,vec2(-3.16*w,-2.19*h),0.34);\ntotal_weight+=sampleScreen(col,vec2(3.92*w,-0.53*h),0.31);\ntotal_weight+=sampleScreen(col,vec2(-2.59*w,3.12*h),0.26);\ntotal_weight+=sampleScreen(col,vec2(-0.20*w,-4.15*h),0.22);\ntotal_weight+=sampleScreen(col,vec2(3.02*w,3.00*h),0.15);\n}\ncol/=total_weight; \n\nif (darken>0.0) {\ncol.rgb*=clamp(0.3,1.0,1.05-size*0.5*darken);\n}\n\n\n\n\nreturn col;\n}\nvoid main(void)\n{\n\ncentered_screen_pos=vec2(vUV.x-0.5,vUV.y-0.5);\nradius2=centered_screen_pos.x*centered_screen_pos.x+centered_screen_pos.y*centered_screen_pos.y;\nradius=sqrt(radius2);\ndistorted_coords=getDistortedCoords(vUV); \nvec2 texels_coords=vec2(vUV.x*screen_width,vUV.y*screen_height); \nfloat depth=texture2D(depthSampler,distorted_coords).r; \nfloat distance=near+(far-near)*depth; \nvec4 color=texture2D(textureSampler,vUV); \n\n\nfloat coc=abs(aperture*(screen_distance*(inverse_focal_length-1.0/distance)-1.0));\n\nif (dof_enabled == false || coc<0.07) { coc=0.0; }\n\nfloat edge_blur_amount=0.0;\nif (edge_blur>0.0) {\nedge_blur_amount=clamp((radius*2.0-1.0+0.15*edge_blur)*1.5,0.0,1.0)*1.3;\n}\n\nfloat blur_amount=max(edge_blur_amount,coc);\n\nif (blur_amount == 0.0) {\ngl_FragColor=texture2D(textureSampler,distorted_coords);\n}\nelse {\n\ngl_FragColor=getBlurColor(blur_amount*1.7);\n\nif (highlights) {\ngl_FragColor.rgb+=clamp(coc,0.0,1.0)*texture2D(highlightsSampler,distorted_coords).rgb;\n}\nif (blur_noise) {\n\nvec2 noise=rand(distorted_coords)*0.01*blur_amount;\nvec2 blurred_coord=vec2(distorted_coords.x+noise.x,distorted_coords.y+noise.y);\ngl_FragColor=0.04*texture2D(textureSampler,blurred_coord)+0.96*gl_FragColor;\n}\n}\n\nif (grain_amount>0.0) {\nvec4 grain_color=texture2D(grainSampler,texels_coords*0.003);\ngl_FragColor.rgb+=(-0.5+grain_color.rgb)*0.30*grain_amount;\n}\n}\n";
null!=t["displayPass.fragment"]?a.C("displayPass.fragment","\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D passSampler;\nvoid main(void)\n{\ngl_FragColor=texture2D(passSampler,vUV);\n}"):a.i["displayPass.fragment"]="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D passSampler;\nvoid main(void)\n{\ngl_FragColor=texture2D(passSampler,vUV);\n}";null!=t["filter.fragment"]?a.C("filter.fragment","\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform mat4 kernelMatrix;\nvoid main(void)\n{\nvec3 baseColor=texture2D(textureSampler,vUV).rgb;\nvec3 updatedColor=(kernelMatrix*vec4(baseColor,1.0)).rgb;\ngl_FragColor=vec4(updatedColor,1.0);\n}"):
a.i["filter.fragment"]="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform mat4 kernelMatrix;\nvoid main(void)\n{\nvec3 baseColor=texture2D(textureSampler,vUV).rgb;\nvec3 updatedColor=(kernelMatrix*vec4(baseColor,1.0)).rgb;\ngl_FragColor=vec4(updatedColor,1.0);\n}";null!=t["fxaa.fragment"]?a.C("fxaa.fragment","#define FXAA_REDUCE_MIN (1.0/128.0)\n#define FXAA_REDUCE_MUL (1.0/8.0)\n#define FXAA_SPAN_MAX 8.0\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform vec2 texelSize;\nvoid main(){\nvec2 localTexelSize=texelSize;\nvec4 rgbNW=texture2D(textureSampler,(vUV+vec2(-1.0,-1.0)*localTexelSize));\nvec4 rgbNE=texture2D(textureSampler,(vUV+vec2(1.0,-1.0)*localTexelSize));\nvec4 rgbSW=texture2D(textureSampler,(vUV+vec2(-1.0,1.0)*localTexelSize));\nvec4 rgbSE=texture2D(textureSampler,(vUV+vec2(1.0,1.0)*localTexelSize));\nvec4 rgbM=texture2D(textureSampler,vUV);\nvec4 luma=vec4(0.299,0.587,0.114,1.0);\nfloat lumaNW=dot(rgbNW,luma);\nfloat lumaNE=dot(rgbNE,luma);\nfloat lumaSW=dot(rgbSW,luma);\nfloat lumaSE=dot(rgbSE,luma);\nfloat lumaM=dot(rgbM,luma);\nfloat lumaMin=min(lumaM,min(min(lumaNW,lumaNE),min(lumaSW,lumaSE)));\nfloat lumaMax=max(lumaM,max(max(lumaNW,lumaNE),max(lumaSW,lumaSE)));\nvec2 dir=vec2(-((lumaNW+lumaNE)-(lumaSW+lumaSE)),((lumaNW+lumaSW)-(lumaNE+lumaSE)));\nfloat dirReduce=max(\n(lumaNW+lumaNE+lumaSW+lumaSE)*(0.25*FXAA_REDUCE_MUL),\nFXAA_REDUCE_MIN);\nfloat rcpDirMin=1.0/(min(abs(dir.x),abs(dir.y))+dirReduce);\ndir=min(vec2(FXAA_SPAN_MAX,FXAA_SPAN_MAX),\nmax(vec2(-FXAA_SPAN_MAX,-FXAA_SPAN_MAX),\ndir*rcpDirMin))*localTexelSize;\nvec4 rgbA=0.5*(\ntexture2D(textureSampler,vUV+dir*(1.0/3.0-0.5)) +\ntexture2D(textureSampler,vUV+dir*(2.0/3.0-0.5)));\nvec4 rgbB=rgbA*0.5+0.25*(\ntexture2D(textureSampler,vUV+dir*-0.5) +\ntexture2D(textureSampler,vUV+dir*0.5));\nfloat lumaB=dot(rgbB,luma);\nif ((lumaB<lumaMin) || (lumaB>lumaMax)) {\ngl_FragColor=rgbA;\n}\nelse {\ngl_FragColor=rgbB;\n}\n}"):
a.i["fxaa.fragment"]="#define FXAA_REDUCE_MIN (1.0/128.0)\n#define FXAA_REDUCE_MUL (1.0/8.0)\n#define FXAA_SPAN_MAX 8.0\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform vec2 texelSize;\nvoid main(){\nvec2 localTexelSize=texelSize;\nvec4 rgbNW=texture2D(textureSampler,(vUV+vec2(-1.0,-1.0)*localTexelSize));\nvec4 rgbNE=texture2D(textureSampler,(vUV+vec2(1.0,-1.0)*localTexelSize));\nvec4 rgbSW=texture2D(textureSampler,(vUV+vec2(-1.0,1.0)*localTexelSize));\nvec4 rgbSE=texture2D(textureSampler,(vUV+vec2(1.0,1.0)*localTexelSize));\nvec4 rgbM=texture2D(textureSampler,vUV);\nvec4 luma=vec4(0.299,0.587,0.114,1.0);\nfloat lumaNW=dot(rgbNW,luma);\nfloat lumaNE=dot(rgbNE,luma);\nfloat lumaSW=dot(rgbSW,luma);\nfloat lumaSE=dot(rgbSE,luma);\nfloat lumaM=dot(rgbM,luma);\nfloat lumaMin=min(lumaM,min(min(lumaNW,lumaNE),min(lumaSW,lumaSE)));\nfloat lumaMax=max(lumaM,max(max(lumaNW,lumaNE),max(lumaSW,lumaSE)));\nvec2 dir=vec2(-((lumaNW+lumaNE)-(lumaSW+lumaSE)),((lumaNW+lumaSW)-(lumaNE+lumaSE)));\nfloat dirReduce=max(\n(lumaNW+lumaNE+lumaSW+lumaSE)*(0.25*FXAA_REDUCE_MUL),\nFXAA_REDUCE_MIN);\nfloat rcpDirMin=1.0/(min(abs(dir.x),abs(dir.y))+dirReduce);\ndir=min(vec2(FXAA_SPAN_MAX,FXAA_SPAN_MAX),\nmax(vec2(-FXAA_SPAN_MAX,-FXAA_SPAN_MAX),\ndir*rcpDirMin))*localTexelSize;\nvec4 rgbA=0.5*(\ntexture2D(textureSampler,vUV+dir*(1.0/3.0-0.5)) +\ntexture2D(textureSampler,vUV+dir*(2.0/3.0-0.5)));\nvec4 rgbB=rgbA*0.5+0.25*(\ntexture2D(textureSampler,vUV+dir*-0.5) +\ntexture2D(textureSampler,vUV+dir*0.5));\nfloat lumaB=dot(rgbB,luma);\nif ((lumaB<lumaMin) || (lumaB>lumaMax)) {\ngl_FragColor=rgbA;\n}\nelse {\ngl_FragColor=rgbB;\n}\n}";
null!=t["glowBlurPostProcess.fragment"]?a.C("glowBlurPostProcess.fragment","\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec2 screenSize;\nuniform vec2 direction;\nuniform float blurWidth;\n\nfloat getLuminance(vec3 color)\n{\nreturn dot(color,vec3(0.2126,0.7152,0.0722));\n}\nvoid main(void)\n{\nfloat weights[7];\nweights[0]=0.05;\nweights[1]=0.1;\nweights[2]=0.2;\nweights[3]=0.3;\nweights[4]=0.2;\nweights[5]=0.1;\nweights[6]=0.05;\nvec2 texelSize=vec2(1.0/screenSize.x,1.0/screenSize.y);\nvec2 texelStep=texelSize*direction*blurWidth;\nvec2 start=vUV-3.0*texelStep;\nvec4 baseColor=vec4(0.,0.,0.,0.);\nvec2 texelOffset=vec2(0.,0.);\nfor (int i=0; i<7; i++)\n{\n\nvec4 texel=texture2D(textureSampler,start+texelOffset);\nbaseColor.a+=texel.a*weights[i];\n\nfloat luminance=getLuminance(baseColor.rgb);\nfloat luminanceTexel=getLuminance(texel.rgb);\nfloat choice=step(luminanceTexel,luminance);\nbaseColor.rgb=choice*baseColor.rgb+(1.0-choice)*texel.rgb;\ntexelOffset+=texelStep;\n}\ngl_FragColor=baseColor;\n}"):
a.i["glowBlurPostProcess.fragment"]="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec2 screenSize;\nuniform vec2 direction;\nuniform float blurWidth;\n\nfloat getLuminance(vec3 color)\n{\nreturn dot(color,vec3(0.2126,0.7152,0.0722));\n}\nvoid main(void)\n{\nfloat weights[7];\nweights[0]=0.05;\nweights[1]=0.1;\nweights[2]=0.2;\nweights[3]=0.3;\nweights[4]=0.2;\nweights[5]=0.1;\nweights[6]=0.05;\nvec2 texelSize=vec2(1.0/screenSize.x,1.0/screenSize.y);\nvec2 texelStep=texelSize*direction*blurWidth;\nvec2 start=vUV-3.0*texelStep;\nvec4 baseColor=vec4(0.,0.,0.,0.);\nvec2 texelOffset=vec2(0.,0.);\nfor (int i=0; i<7; i++)\n{\n\nvec4 texel=texture2D(textureSampler,start+texelOffset);\nbaseColor.a+=texel.a*weights[i];\n\nfloat luminance=getLuminance(baseColor.rgb);\nfloat luminanceTexel=getLuminance(texel.rgb);\nfloat choice=step(luminanceTexel,luminance);\nbaseColor.rgb=choice*baseColor.rgb+(1.0-choice)*texel.rgb;\ntexelOffset+=texelStep;\n}\ngl_FragColor=baseColor;\n}";
null!=t["glowMapGeneration.fragment"]?a.C("glowMapGeneration.fragment","#ifdef ALPHATEST\nvarying vec2 vUVDiffuse;\nuniform sampler2D diffuseSampler;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vUVEmissive;\nuniform sampler2D emissiveSampler;\n#endif\nuniform vec4 color;\nvoid main(void)\n{\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUVDiffuse).a<0.4)\ndiscard;\n#endif\n#ifdef EMISSIVE\ngl_FragColor=texture2D(emissiveSampler,vUVEmissive);\n#else\ngl_FragColor=color;\n#endif\n}"):a.i["glowMapGeneration.fragment"]=
"#ifdef ALPHATEST\nvarying vec2 vUVDiffuse;\nuniform sampler2D diffuseSampler;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vUVEmissive;\nuniform sampler2D emissiveSampler;\n#endif\nuniform vec4 color;\nvoid main(void)\n{\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUVDiffuse).a<0.4)\ndiscard;\n#endif\n#ifdef EMISSIVE\ngl_FragColor=texture2D(emissiveSampler,vUVEmissive);\n#else\ngl_FragColor=color;\n#endif\n}";null!=t["glowMapGeneration.vertex"]?a.C("glowMapGeneration.vertex","\nattribute vec3 position;\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\nvarying vec4 vPosition;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef ALPHATEST\nvarying vec2 vUVDiffuse;\nuniform mat4 diffuseMatrix;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vUVEmissive;\nuniform mat4 emissiveMatrix;\n#endif\nvoid main(void)\n{\n#include<instancesVertex>\n#include<bonesVertex>\n#ifdef CUBEMAP\nvPosition=finalWorld*vec4(position,1.0);\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\n#else\nvPosition=viewProjection*finalWorld*vec4(position,1.0);\ngl_Position=vPosition;\n#endif\n#ifdef ALPHATEST\n#ifdef DIFFUSEUV1\nvUVDiffuse=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef DIFFUSEUV2\nvUVDiffuse=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n#ifdef EMISSIVE\n#ifdef EMISSIVEUV1\nvUVEmissive=vec2(emissiveMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef EMISSIVEUV2\nvUVEmissive=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n}"):
a.i["glowMapGeneration.vertex"]="\nattribute vec3 position;\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\nvarying vec4 vPosition;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef ALPHATEST\nvarying vec2 vUVDiffuse;\nuniform mat4 diffuseMatrix;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vUVEmissive;\nuniform mat4 emissiveMatrix;\n#endif\nvoid main(void)\n{\n#include<instancesVertex>\n#include<bonesVertex>\n#ifdef CUBEMAP\nvPosition=finalWorld*vec4(position,1.0);\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\n#else\nvPosition=viewProjection*finalWorld*vec4(position,1.0);\ngl_Position=vPosition;\n#endif\n#ifdef ALPHATEST\n#ifdef DIFFUSEUV1\nvUVDiffuse=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef DIFFUSEUV2\nvUVDiffuse=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n#ifdef EMISSIVE\n#ifdef EMISSIVEUV1\nvUVEmissive=vec2(emissiveMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef EMISSIVEUV2\nvUVEmissive=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n}";
null!=t["glowMapMerge.fragment"]?a.C("glowMapMerge.fragment","\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform float offset;\nvoid main(void) {\nvec4 baseColor=texture2D(textureSampler,vUV);\nbaseColor.a=abs(offset-baseColor.a);\ngl_FragColor=baseColor;\n}"):a.i["glowMapMerge.fragment"]="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform float offset;\nvoid main(void) {\nvec4 baseColor=texture2D(textureSampler,vUV);\nbaseColor.a=abs(offset-baseColor.a);\ngl_FragColor=baseColor;\n}";
null!=t["glowMapMerge.vertex"]?a.C("glowMapMerge.vertex","\nattribute vec2 position;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) {\nvUV=position*madd+madd;\ngl_Position=vec4(position,0.0,1.0);\n}"):a.i["glowMapMerge.vertex"]="\nattribute vec2 position;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) {\nvUV=position*madd+madd;\ngl_Position=vec4(position,0.0,1.0);\n}";null!=t["hdr.fragment"]?a.C("hdr.fragment","uniform sampler2D textureSampler;\nvarying vec2 vUV;\n#if defined(GAUSSIAN_BLUR_H) || defined(GAUSSIAN_BLUR_V)\nuniform float blurOffsets[9];\nuniform float blurWeights[9];\nuniform float multiplier;\nvoid main(void) {\nvec4 color=vec4(0.0,0.0,0.0,0.0);\nfor (int i=0; i<9; i++) {\n#ifdef GAUSSIAN_BLUR_H\ncolor+=(texture2D(textureSampler,vUV+vec2(blurOffsets[i]*multiplier,0.0))*blurWeights[i]);\n#else\ncolor+=(texture2D(textureSampler,vUV+vec2(0.0,blurOffsets[i]*multiplier))*blurWeights[i]);\n#endif\n}\ncolor.a=1.0;\ngl_FragColor=color;\n}\n#endif\n#if defined(TEXTURE_ADDER)\nuniform sampler2D otherSampler;\nvoid main() {\nvec4 sum=texture2D(textureSampler,vUV)+texture2D(otherSampler,vUV);\nsum.a=clamp(sum.a,0.0,1.0);\ngl_FragColor=sum;\n}\n#endif\n#if defined(LUMINANCE_GENERATOR)\nuniform vec2 lumOffsets[4];\nvoid main() {\nfloat average=0.0;\nvec4 color=vec4(0.0,0.0,0.0,0.0);\nfloat maximum=-1e20;\nfor (int i=0; i<4; i++) {\ncolor=texture2D(textureSampler,vUV+lumOffsets[i]);\nfloat GreyValue=length(color.rgb);\nmaximum=max(maximum,GreyValue);\naverage+=(0.25*log(1e-5+GreyValue));\n}\naverage=exp(average);\ngl_FragColor=vec4(average,maximum,0.0,1.0);\n}\n#endif\n#if defined(DOWN_SAMPLE)\nuniform vec2 dsOffsets[9];\nuniform float halfDestPixelSize;\n#ifdef FINAL_DOWN_SAMPLE\nvec4 pack(float value) {\nconst vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);\nconst vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);\nvec4 res=fract(value*bit_shift);\nres-=res.xxyz*bit_mask;\nreturn res;\n}\n#endif\nvoid main() {\nvec4 color=vec4(0.0,0.0,0.0,0.0);\nfloat average=0.0;\nfor (int i=0; i<9; i++) {\ncolor=texture2D(textureSampler,vUV+vec2(halfDestPixelSize,halfDestPixelSize)+dsOffsets[i]);\naverage+=color.r;\n}\naverage/=9.0;\n#ifndef FINAL_DOWN_SAMPLE\ngl_FragColor=vec4(average,average,0.0,1.0);\n#else\ngl_FragColor=pack(average);\n#endif\n}\n#endif\n#if defined(BRIGHT_PASS)\nuniform vec2 dsOffsets[4];\nuniform float brightThreshold;\nvoid main() {\nvec4 average=vec4(0.0,0.0,0.0,0.0);\naverage=texture2D(textureSampler,vUV+vec2(dsOffsets[0].x,dsOffsets[0].y));\naverage+=texture2D(textureSampler,vUV+vec2(dsOffsets[1].x,dsOffsets[1].y));\naverage+=texture2D(textureSampler,vUV+vec2(dsOffsets[2].x,dsOffsets[2].y));\naverage+=texture2D(textureSampler,vUV+vec2(dsOffsets[3].x,dsOffsets[3].y));\naverage*=0.25;\nfloat luminance=length(average.rgb);\nif (luminance<brightThreshold) {\naverage=vec4(0.0,0.0,0.0,1.0);\n}\ngl_FragColor=average;\n}\n#endif\n#if defined(DOWN_SAMPLE_X4)\nuniform vec2 dsOffsets[16];\nvoid main() {\nvec4 average=vec4(0.0,0.0,0.0,0.0);\naverage=texture2D(textureSampler,vUV+dsOffsets[0]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[1]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[2]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[3]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[4]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[5]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[6]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[7]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[8]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[9]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[10]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[11]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[12]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[13]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[14]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[15]);\naverage/=16.0;\ngl_FragColor=average;\n}\n#endif\n#if defined(HDR)\nuniform sampler2D otherSampler;\nuniform float exposure;\nuniform float avgLuminance;\nvoid main() {\nvec4 color=texture2D(textureSampler,vUV)+texture2D(otherSampler,vUV);\nvec4 adjustedColor=color/avgLuminance*exposure;\ncolor=adjustedColor;\ncolor.a=1.0;\ngl_FragColor=color;\n}\n#endif\n"):
a.i["hdr.fragment"]="uniform sampler2D textureSampler;\nvarying vec2 vUV;\n#if defined(GAUSSIAN_BLUR_H) || defined(GAUSSIAN_BLUR_V)\nuniform float blurOffsets[9];\nuniform float blurWeights[9];\nuniform float multiplier;\nvoid main(void) {\nvec4 color=vec4(0.0,0.0,0.0,0.0);\nfor (int i=0; i<9; i++) {\n#ifdef GAUSSIAN_BLUR_H\ncolor+=(texture2D(textureSampler,vUV+vec2(blurOffsets[i]*multiplier,0.0))*blurWeights[i]);\n#else\ncolor+=(texture2D(textureSampler,vUV+vec2(0.0,blurOffsets[i]*multiplier))*blurWeights[i]);\n#endif\n}\ncolor.a=1.0;\ngl_FragColor=color;\n}\n#endif\n#if defined(TEXTURE_ADDER)\nuniform sampler2D otherSampler;\nvoid main() {\nvec4 sum=texture2D(textureSampler,vUV)+texture2D(otherSampler,vUV);\nsum.a=clamp(sum.a,0.0,1.0);\ngl_FragColor=sum;\n}\n#endif\n#if defined(LUMINANCE_GENERATOR)\nuniform vec2 lumOffsets[4];\nvoid main() {\nfloat average=0.0;\nvec4 color=vec4(0.0,0.0,0.0,0.0);\nfloat maximum=-1e20;\nfor (int i=0; i<4; i++) {\ncolor=texture2D(textureSampler,vUV+lumOffsets[i]);\nfloat GreyValue=length(color.rgb);\nmaximum=max(maximum,GreyValue);\naverage+=(0.25*log(1e-5+GreyValue));\n}\naverage=exp(average);\ngl_FragColor=vec4(average,maximum,0.0,1.0);\n}\n#endif\n#if defined(DOWN_SAMPLE)\nuniform vec2 dsOffsets[9];\nuniform float halfDestPixelSize;\n#ifdef FINAL_DOWN_SAMPLE\nvec4 pack(float value) {\nconst vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);\nconst vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);\nvec4 res=fract(value*bit_shift);\nres-=res.xxyz*bit_mask;\nreturn res;\n}\n#endif\nvoid main() {\nvec4 color=vec4(0.0,0.0,0.0,0.0);\nfloat average=0.0;\nfor (int i=0; i<9; i++) {\ncolor=texture2D(textureSampler,vUV+vec2(halfDestPixelSize,halfDestPixelSize)+dsOffsets[i]);\naverage+=color.r;\n}\naverage/=9.0;\n#ifndef FINAL_DOWN_SAMPLE\ngl_FragColor=vec4(average,average,0.0,1.0);\n#else\ngl_FragColor=pack(average);\n#endif\n}\n#endif\n#if defined(BRIGHT_PASS)\nuniform vec2 dsOffsets[4];\nuniform float brightThreshold;\nvoid main() {\nvec4 average=vec4(0.0,0.0,0.0,0.0);\naverage=texture2D(textureSampler,vUV+vec2(dsOffsets[0].x,dsOffsets[0].y));\naverage+=texture2D(textureSampler,vUV+vec2(dsOffsets[1].x,dsOffsets[1].y));\naverage+=texture2D(textureSampler,vUV+vec2(dsOffsets[2].x,dsOffsets[2].y));\naverage+=texture2D(textureSampler,vUV+vec2(dsOffsets[3].x,dsOffsets[3].y));\naverage*=0.25;\nfloat luminance=length(average.rgb);\nif (luminance<brightThreshold) {\naverage=vec4(0.0,0.0,0.0,1.0);\n}\ngl_FragColor=average;\n}\n#endif\n#if defined(DOWN_SAMPLE_X4)\nuniform vec2 dsOffsets[16];\nvoid main() {\nvec4 average=vec4(0.0,0.0,0.0,0.0);\naverage=texture2D(textureSampler,vUV+dsOffsets[0]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[1]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[2]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[3]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[4]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[5]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[6]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[7]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[8]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[9]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[10]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[11]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[12]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[13]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[14]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[15]);\naverage/=16.0;\ngl_FragColor=average;\n}\n#endif\n#if defined(HDR)\nuniform sampler2D otherSampler;\nuniform float exposure;\nuniform float avgLuminance;\nvoid main() {\nvec4 color=texture2D(textureSampler,vUV)+texture2D(otherSampler,vUV);\nvec4 adjustedColor=color/avgLuminance*exposure;\ncolor=adjustedColor;\ncolor.a=1.0;\ngl_FragColor=color;\n}\n#endif\n";
null!=t["layer.fragment"]?a.C("layer.fragment","\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec4 color;\nvoid main(void) {\nvec4 baseColor=texture2D(textureSampler,vUV);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\ngl_FragColor=baseColor*color;\n}"):a.i["layer.fragment"]="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec4 color;\nvoid main(void) {\nvec4 baseColor=texture2D(textureSampler,vUV);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\ngl_FragColor=baseColor*color;\n}";
null!=t["layer.vertex"]?a.C("layer.vertex","\nattribute vec2 position;\n\nuniform vec2 scale;\nuniform vec2 offset;\nuniform mat4 textureMatrix;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) { \nvec2 shiftedPosition=position*scale+offset;\nvUV=vec2(textureMatrix*vec4(shiftedPosition*madd+madd,1.0,0.0));\ngl_Position=vec4(shiftedPosition,0.0,1.0);\n}"):a.i["layer.vertex"]="\nattribute vec2 position;\n\nuniform vec2 scale;\nuniform vec2 offset;\nuniform mat4 textureMatrix;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) { \nvec2 shiftedPosition=position*scale+offset;\nvUV=vec2(textureMatrix*vec4(shiftedPosition*madd+madd,1.0,0.0));\ngl_Position=vec4(shiftedPosition,0.0,1.0);\n}";
null!=t["lensFlare.fragment"]?a.C("lensFlare.fragment","\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec4 color;\nvoid main(void) {\nvec4 baseColor=texture2D(textureSampler,vUV);\ngl_FragColor=baseColor*color;\n}"):a.i["lensFlare.fragment"]="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec4 color;\nvoid main(void) {\nvec4 baseColor=texture2D(textureSampler,vUV);\ngl_FragColor=baseColor*color;\n}";null!=t["lensFlare.vertex"]?a.C("lensFlare.vertex","\nattribute vec2 position;\n\nuniform mat4 viewportMatrix;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) { \nvUV=position*madd+madd;\ngl_Position=viewportMatrix*vec4(position,0.0,1.0);\n}"):
a.i["lensFlare.vertex"]="\nattribute vec2 position;\n\nuniform mat4 viewportMatrix;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) { \nvUV=position*madd+madd;\ngl_Position=viewportMatrix*vec4(position,0.0,1.0);\n}";null!=t["lensHighlights.fragment"]?a.C("lensHighlights.fragment","\nuniform sampler2D textureSampler; \n\nuniform float gain;\nuniform float threshold;\nuniform float screen_width;\nuniform float screen_height;\n\nvarying vec2 vUV;\n\nvec4 highlightColor(vec4 color) {\nvec4 highlight=color;\nfloat luminance=dot(highlight.rgb,vec3(0.2125,0.7154,0.0721));\nfloat lum_threshold;\nif (threshold>1.0) { lum_threshold=0.94+0.01*threshold; }\nelse { lum_threshold=0.5+0.44*threshold; }\nluminance=clamp((luminance-lum_threshold)*(1.0/(1.0-lum_threshold)),0.0,1.0);\nhighlight*=luminance*gain;\nhighlight.a=1.0;\nreturn highlight;\n}\nvoid main(void)\n{\nvec4 original=texture2D(textureSampler,vUV);\n\nif (gain == -1.0) {\ngl_FragColor=vec4(0.0,0.0,0.0,1.0);\nreturn;\n}\nfloat w=2.0/screen_width;\nfloat h=2.0/screen_height;\nfloat weight=1.0;\n\nvec4 blurred=vec4(0.0,0.0,0.0,0.0);\n#ifdef PENTAGON\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.84*w,0.43*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.48*w,-1.29*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.61*w,1.51*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.55*w,-0.74*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.71*w,-0.52*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.94*w,1.59*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.40*w,-1.87*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.62*w,1.16*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.09*w,0.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.46*w,-1.71*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.08*w,2.42*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.85*w,-1.89*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.89*w,0.16*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.29*w,1.88*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.40*w,-2.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.54*w,2.26*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.60*w,-0.61*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.31*w,-1.30*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.83*w,2.53*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.12*w,-2.48*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.60*w,1.11*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.82*w,0.99*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.50*w,-2.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.85*w,3.33*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.94*w,-1.92*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.27*w,-0.53*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.95*w,2.48*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.23*w,-3.04*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.17*w,2.05*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.97*w,-0.04*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.25*w,-2.00*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.31*w,3.08*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.94*w,-2.59*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.37*w,0.64*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.13*w,1.93*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.03*w,-3.65*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.60*w,3.17*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.14*w,-1.19*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.00*w,-1.19*h)));\n#else\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.85*w,0.36*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.52*w,-1.14*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.46*w,1.42*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.46*w,-0.83*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.79*w,-0.42*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.11*w,1.62*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.29*w,-2.07*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.69*w,1.39*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.28*w,0.12*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.65*w,-1.69*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.08*w,2.44*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.63*w,-1.90*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.55*w,0.31*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.13*w,1.52*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.56*w,-2.61*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.38*w,2.34*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.64*w,-0.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.53*w,-1.21*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.06*w,2.63*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.00*w,-2.69*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.59*w,1.32*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.82*w,0.78*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.57*w,-2.50*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.54*w,2.93*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.39*w,-1.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.01*w,-0.28*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.04*w,2.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.02*w,-3.05*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.09*w,2.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.07*w,-0.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.44*w,-1.90*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.52*w,3.05*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.68*w,-2.61*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.01*w,0.79*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.76*w,1.46*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.05*w,-2.94*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.21*w,2.88*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.84*w,-1.30*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.98*w,-0.96*h)));\n#endif\nblurred/=39.0;\ngl_FragColor=blurred;\n\n}"):
a.i["lensHighlights.fragment"]="\nuniform sampler2D textureSampler; \n\nuniform float gain;\nuniform float threshold;\nuniform float screen_width;\nuniform float screen_height;\n\nvarying vec2 vUV;\n\nvec4 highlightColor(vec4 color) {\nvec4 highlight=color;\nfloat luminance=dot(highlight.rgb,vec3(0.2125,0.7154,0.0721));\nfloat lum_threshold;\nif (threshold>1.0) { lum_threshold=0.94+0.01*threshold; }\nelse { lum_threshold=0.5+0.44*threshold; }\nluminance=clamp((luminance-lum_threshold)*(1.0/(1.0-lum_threshold)),0.0,1.0);\nhighlight*=luminance*gain;\nhighlight.a=1.0;\nreturn highlight;\n}\nvoid main(void)\n{\nvec4 original=texture2D(textureSampler,vUV);\n\nif (gain == -1.0) {\ngl_FragColor=vec4(0.0,0.0,0.0,1.0);\nreturn;\n}\nfloat w=2.0/screen_width;\nfloat h=2.0/screen_height;\nfloat weight=1.0;\n\nvec4 blurred=vec4(0.0,0.0,0.0,0.0);\n#ifdef PENTAGON\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.84*w,0.43*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.48*w,-1.29*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.61*w,1.51*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.55*w,-0.74*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.71*w,-0.52*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.94*w,1.59*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.40*w,-1.87*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.62*w,1.16*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.09*w,0.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.46*w,-1.71*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.08*w,2.42*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.85*w,-1.89*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.89*w,0.16*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.29*w,1.88*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.40*w,-2.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.54*w,2.26*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.60*w,-0.61*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.31*w,-1.30*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.83*w,2.53*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.12*w,-2.48*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.60*w,1.11*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.82*w,0.99*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.50*w,-2.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.85*w,3.33*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.94*w,-1.92*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.27*w,-0.53*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.95*w,2.48*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.23*w,-3.04*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.17*w,2.05*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.97*w,-0.04*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.25*w,-2.00*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.31*w,3.08*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.94*w,-2.59*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.37*w,0.64*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.13*w,1.93*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.03*w,-3.65*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.60*w,3.17*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.14*w,-1.19*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.00*w,-1.19*h)));\n#else\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.85*w,0.36*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.52*w,-1.14*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.46*w,1.42*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.46*w,-0.83*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.79*w,-0.42*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.11*w,1.62*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.29*w,-2.07*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.69*w,1.39*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.28*w,0.12*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.65*w,-1.69*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.08*w,2.44*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.63*w,-1.90*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.55*w,0.31*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.13*w,1.52*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.56*w,-2.61*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.38*w,2.34*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.64*w,-0.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.53*w,-1.21*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.06*w,2.63*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.00*w,-2.69*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.59*w,1.32*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.82*w,0.78*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.57*w,-2.50*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.54*w,2.93*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.39*w,-1.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.01*w,-0.28*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.04*w,2.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.02*w,-3.05*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.09*w,2.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.07*w,-0.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.44*w,-1.90*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.52*w,3.05*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.68*w,-2.61*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.01*w,0.79*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.76*w,1.46*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.05*w,-2.94*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.21*w,2.88*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.84*w,-1.30*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.98*w,-0.96*h)));\n#endif\nblurred/=39.0;\ngl_FragColor=blurred;\n\n}";
null!=t["line.fragment"]?a.C("line.fragment","uniform vec4 color;\nvoid main(void) {\ngl_FragColor=color;\n}"):a.i["line.fragment"]="uniform vec4 color;\nvoid main(void) {\ngl_FragColor=color;\n}";null!=t["line.vertex"]?a.C("line.vertex","\nattribute vec3 position;\nattribute vec4 normal;\n\nuniform mat4 worldViewProjection;\nuniform float width;\nuniform float aspectRatio;\nvoid main(void) {\nvec4 viewPosition=worldViewProjection*vec4(position,1.0);\nvec4 viewPositionNext=worldViewProjection*vec4(normal.xyz,1.0);\nvec2 currentScreen=viewPosition.xy/viewPosition.w;\nvec2 nextScreen=viewPositionNext.xy/viewPositionNext.w;\ncurrentScreen.x*=aspectRatio;\nnextScreen.x*=aspectRatio;\nvec2 dir=normalize(nextScreen-currentScreen);\nvec2 normalDir=vec2(-dir.y,dir.x);\nnormalDir*=width/2.0;\nnormalDir.x/=aspectRatio;\nvec4 offset=vec4(normalDir*normal.w,0.0,0.0);\ngl_Position=viewPosition+offset;\n}"):
a.i["line.vertex"]="\nattribute vec3 position;\nattribute vec4 normal;\n\nuniform mat4 worldViewProjection;\nuniform float width;\nuniform float aspectRatio;\nvoid main(void) {\nvec4 viewPosition=worldViewProjection*vec4(position,1.0);\nvec4 viewPositionNext=worldViewProjection*vec4(normal.xyz,1.0);\nvec2 currentScreen=viewPosition.xy/viewPosition.w;\nvec2 nextScreen=viewPositionNext.xy/viewPositionNext.w;\ncurrentScreen.x*=aspectRatio;\nnextScreen.x*=aspectRatio;\nvec2 dir=normalize(nextScreen-currentScreen);\nvec2 normalDir=vec2(-dir.y,dir.x);\nnormalDir*=width/2.0;\nnormalDir.x/=aspectRatio;\nvec4 offset=vec4(normalDir*normal.w,0.0,0.0);\ngl_Position=viewPosition+offset;\n}";
null!=t["outline.fragment"]?a.C("outline.fragment","uniform vec4 color;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\nvoid main(void) {\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\ngl_FragColor=color;\n}"):a.i["outline.fragment"]="uniform vec4 color;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\nvoid main(void) {\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\ngl_FragColor=color;\n}";
null!=t["outline.vertex"]?a.C("outline.vertex","\nattribute vec3 position;\nattribute vec3 normal;\n#include<bonesDeclaration>\n\nuniform float offset;\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\nvoid main(void)\n{\nvec3 offsetPosition=position+normal*offset;\n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(offsetPosition,1.0);\n#ifdef ALPHATEST\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n}\n"):
a.i["outline.vertex"]="\nattribute vec3 position;\nattribute vec3 normal;\n#include<bonesDeclaration>\n\nuniform float offset;\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\nvoid main(void)\n{\nvec3 offsetPosition=position+normal*offset;\n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(offsetPosition,1.0);\n#ifdef ALPHATEST\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n}\n";
null!=t["particles.fragment"]?a.C("particles.fragment","\nvarying vec2 vUV;\nvarying vec4 vColor;\nuniform vec4 textureMask;\nuniform sampler2D diffuseSampler;\n#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\nvoid main(void) {\n#ifdef CLIPPLANE\nif (fClipDistance>0.0)\ndiscard;\n#endif\nvec4 baseColor=texture2D(diffuseSampler,vUV);\ngl_FragColor=(baseColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n}"):a.i["particles.fragment"]="\nvarying vec2 vUV;\nvarying vec4 vColor;\nuniform vec4 textureMask;\nuniform sampler2D diffuseSampler;\n#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\nvoid main(void) {\n#ifdef CLIPPLANE\nif (fClipDistance>0.0)\ndiscard;\n#endif\nvec4 baseColor=texture2D(diffuseSampler,vUV);\ngl_FragColor=(baseColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n}";
null!=t["particles.vertex"]?a.C("particles.vertex","\nattribute vec3 position;\nattribute vec4 color;\nattribute vec4 options;\n\nuniform mat4 view;\nuniform mat4 projection;\n\nvarying vec2 vUV;\nvarying vec4 vColor;\n#ifdef CLIPPLANE\nuniform vec4 vClipPlane;\nuniform mat4 invView;\nvarying float fClipDistance;\n#endif\nvoid main(void) { \nvec3 viewPos=(view*vec4(position,1.0)).xyz; \nvec3 cornerPos;\nfloat size=options.y;\nfloat angle=options.x;\nvec2 offset=options.zw;\ncornerPos=vec3(offset.x-0.5,offset.y-0.5,0.)*size;\n\nvec3 rotatedCorner;\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\n\nviewPos+=rotatedCorner;\ngl_Position=projection*vec4(viewPos,1.0); \nvColor=color;\nvUV=offset;\n\n#ifdef CLIPPLANE\nvec4 worldPos=invView*vec4(viewPos,1.0);\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n}"):
a.i["particles.vertex"]="\nattribute vec3 position;\nattribute vec4 color;\nattribute vec4 options;\n\nuniform mat4 view;\nuniform mat4 projection;\n\nvarying vec2 vUV;\nvarying vec4 vColor;\n#ifdef CLIPPLANE\nuniform vec4 vClipPlane;\nuniform mat4 invView;\nvarying float fClipDistance;\n#endif\nvoid main(void) { \nvec3 viewPos=(view*vec4(position,1.0)).xyz; \nvec3 cornerPos;\nfloat size=options.y;\nfloat angle=options.x;\nvec2 offset=options.zw;\ncornerPos=vec3(offset.x-0.5,offset.y-0.5,0.)*size;\n\nvec3 rotatedCorner;\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\n\nviewPos+=rotatedCorner;\ngl_Position=projection*vec4(viewPos,1.0); \nvColor=color;\nvUV=offset;\n\n#ifdef CLIPPLANE\nvec4 worldPos=invView*vec4(viewPos,1.0);\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n}";
null!=t["pass.fragment"]?a.C("pass.fragment","\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nvoid main(void) \n{\ngl_FragColor=texture2D(textureSampler,vUV);\n}"):a.i["pass.fragment"]="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nvoid main(void) \n{\ngl_FragColor=texture2D(textureSampler,vUV);\n}";null!=t["pbr.fragment"]?a.C("pbr.fragment","#ifdef BUMP\n#extension GL_OES_standard_derivatives : enable\n#endif\n#ifdef LODBASEDMICROSFURACE\n#extension GL_EXT_shader_texture_lod : enable\n#endif\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nprecision highp float;\nuniform vec3 vEyePosition;\nuniform vec3 vAmbientColor;\nuniform vec3 vReflectionColor;\nuniform vec4 vAlbedoColor;\n\nuniform vec4 vLightingIntensity;\nuniform vec4 vCameraInfos;\n#ifdef OVERLOADEDVALUES\nuniform vec4 vOverloadedIntensity;\nuniform vec3 vOverloadedAmbient;\nuniform vec3 vOverloadedAlbedo;\nuniform vec3 vOverloadedReflectivity;\nuniform vec3 vOverloadedEmissive;\nuniform vec3 vOverloadedReflection;\nuniform vec3 vOverloadedMicroSurface;\n#endif\n#ifdef OVERLOADEDSHADOWVALUES\nuniform vec4 vOverloadedShadowIntensity;\n#endif\n#if defined(REFLECTION) || defined(REFRACTION)\nuniform vec2 vMicrosurfaceTextureLods;\n#endif\nuniform vec4 vReflectivityColor;\nuniform vec3 vEmissiveColor;\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<lightFragmentDeclaration>[0..maxSimultaneousLights]\n\n#ifdef ALBEDO\nvarying vec2 vAlbedoUV;\nuniform sampler2D albedoSampler;\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform sampler2D ambientSampler;\nuniform vec3 vAmbientInfos;\n#endif\n#ifdef OPACITY \nvarying vec2 vOpacityUV;\nuniform sampler2D opacitySampler;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform sampler2D emissiveSampler;\n#endif\n#ifdef LIGHTMAP\nvarying vec2 vLightmapUV;\nuniform vec2 vLightmapInfos;\nuniform sampler2D lightmapSampler;\n#endif\n#if defined(REFLECTIVITY) || defined(METALLICWORKFLOW) \nvarying vec2 vReflectivityUV;\nuniform vec2 vReflectivityInfos;\nuniform sampler2D reflectivitySampler;\n#endif\n\n#include<fresnelFunction>\n#ifdef OPACITYFRESNEL\nuniform vec4 opacityParts;\n#endif\n#ifdef EMISSIVEFRESNEL\nuniform vec4 emissiveLeftColor;\nuniform vec4 emissiveRightColor;\n#endif\n\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)\nuniform mat4 view;\n#endif\n\n#ifdef REFRACTION\nuniform vec4 vRefractionInfos;\n#ifdef REFRACTIONMAP_3D\nuniform samplerCube refractionCubeSampler;\n#else\nuniform sampler2D refraction2DSampler;\nuniform mat4 refractionMatrix;\n#endif\n#endif\n\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\n#ifdef REFLECTIONMAP_3D\nuniform samplerCube reflectionCubeSampler;\n#else\nuniform sampler2D reflection2DSampler;\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvarying vec3 vDirectionW;\n#endif\n#if defined(REFLECTIONMAP_PLANAR) || defined(REFLECTIONMAP_CUBIC) || defined(REFLECTIONMAP_PROJECTION)\nuniform mat4 reflectionMatrix;\n#endif\n#endif\n#include<reflectionFunction>\n#endif\n#ifdef CAMERACOLORGRADING\n#include<colorGradingDefinition>\n#endif\n#ifdef CAMERACOLORCURVES\n#include<colorCurvesDefinition>\n#endif\n\n#include<pbrShadowFunctions>\n#include<pbrFunctions>\n#ifdef CAMERACOLORGRADING\n#include<colorGrading>\n#endif\n#ifdef CAMERACOLORCURVES\n#include<colorCurves>\n#endif\n#include<harmonicsFunctions>\n#include<pbrLightFunctions>\n#include<helperFunctions>\n#include<bumpFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n\n#include<fogFragmentDeclaration>\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n#include<bumpFragment>\n\nvec4 surfaceAlbedo=vec4(1.,1.,1.,1.);\nvec3 surfaceAlbedoContribution=vAlbedoColor.rgb;\n\nfloat alpha=vAlbedoColor.a;\n#ifdef ALBEDO\nsurfaceAlbedo=texture2D(albedoSampler,vAlbedoUV+uvOffset);\nsurfaceAlbedo=vec4(toLinearSpace(surfaceAlbedo.rgb),surfaceAlbedo.a);\n#ifndef LINKREFRACTIONTOTRANSPARENCY\n#ifdef ALPHATEST\nif (surfaceAlbedo.a<0.4)\ndiscard;\n#endif\n#endif\n#ifdef ALPHAFROMALBEDO\nalpha*=surfaceAlbedo.a;\n#endif\nsurfaceAlbedo.rgb*=vAlbedoInfos.y;\n#else\n\nsurfaceAlbedo.rgb=surfaceAlbedoContribution;\nsurfaceAlbedoContribution=vec3(1.,1.,1.);\n#endif\n#ifdef VERTEXCOLOR\nsurfaceAlbedo.rgb*=vColor.rgb;\n#endif\n#ifdef OVERLOADEDVALUES\nsurfaceAlbedo.rgb=mix(surfaceAlbedo.rgb,vOverloadedAlbedo,vOverloadedIntensity.y);\n#endif\n\nvec3 ambientColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nambientColor=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb*vAmbientInfos.y;\nambientColor=vec3(1.,1.,1.)-((vec3(1.,1.,1.)-ambientColor)*vAmbientInfos.z);\n#ifdef OVERLOADEDVALUES\nambientColor.rgb=mix(ambientColor.rgb,vOverloadedAmbient,vOverloadedIntensity.x);\n#endif\n#endif\n\nfloat microSurface=vReflectivityColor.a;\nvec3 surfaceReflectivityColor=vReflectivityColor.rgb;\n#ifdef OVERLOADEDVALUES\nsurfaceReflectivityColor.rgb=mix(surfaceReflectivityColor.rgb,vOverloadedReflectivity,vOverloadedIntensity.z);\n#endif\n#ifdef REFLECTIVITY\nvec4 surfaceReflectivityColorMap=texture2D(reflectivitySampler,vReflectivityUV+uvOffset);\nsurfaceReflectivityColor=surfaceReflectivityColorMap.rgb;\nsurfaceReflectivityColor=toLinearSpace(surfaceReflectivityColor);\n#ifdef OVERLOADEDVALUES\nsurfaceReflectivityColor=mix(surfaceReflectivityColor,vOverloadedReflectivity,vOverloadedIntensity.z);\n#endif\n#ifdef MICROSURFACEFROMREFLECTIVITYMAP\nmicroSurface=surfaceReflectivityColorMap.a;\n#else\n#ifdef MICROSURFACEAUTOMATIC\nmicroSurface=computeDefaultMicroSurface(microSurface,surfaceReflectivityColor);\n#endif\n#endif\n#endif\n#ifdef METALLICWORKFLOW\nvec4 surfaceMetallicColorMap=texture2D(reflectivitySampler,vReflectivityUV+uvOffset);\n\nfloat metallic=surfaceMetallicColorMap.r; \n\nvec3 baseColor=surfaceAlbedo.rgb;\n\nsurfaceAlbedo.rgb*=(1.0-metallic);\n\n\nconst vec3 DefaultSpecularReflectanceDielectric=vec3(0.04,0.04,0.04);\n\nsurfaceReflectivityColor=mix(DefaultSpecularReflectanceDielectric,baseColor,metallic);\n#ifdef OVERLOADEDVALUES\nsurfaceReflectivityColor=mix(surfaceReflectivityColor,vOverloadedReflectivity,vOverloadedIntensity.z);\n#endif\n#ifdef METALLICROUGHNESSGSTOREINALPHA\nmicroSurface=1.0-surfaceMetallicColorMap.a;\n#else\n#ifdef METALLICROUGHNESSGSTOREINGREEN\nmicroSurface=1.0-surfaceMetallicColorMap.g;\n#endif\n#endif\n#endif\n#ifdef OVERLOADEDVALUES\nmicroSurface=mix(microSurface,vOverloadedMicroSurface.x,vOverloadedMicroSurface.y);\n#endif\n\nfloat NdotV=max(0.00000000001,dot(normalW,viewDirectionW));\n\nmicroSurface=clamp(microSurface,0.,1.)*0.98;\n\nfloat roughness=clamp(1.-microSurface,0.000001,1.0);\n\nvec3 lightDiffuseContribution=vec3(0.,0.,0.);\n#ifdef OVERLOADEDSHADOWVALUES\nvec3 shadowedOnlyLightDiffuseContribution=vec3(1.,1.,1.);\n#endif\n#ifdef SPECULARTERM\nvec3 lightSpecularContribution=vec3(0.,0.,0.);\n#endif\nfloat notShadowLevel=1.; \n#ifdef LIGHTMAP\nvec3 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset).rgb*vLightmapInfos.y;\n#endif\nfloat NdotL=-1.;\nlightingInfo info;\n\nfloat reflectance=max(max(surfaceReflectivityColor.r,surfaceReflectivityColor.g),surfaceReflectivityColor.b);\n\n\nfloat reflectance90=clamp(reflectance*25.0,0.0,1.0);\nvec3 specularEnvironmentR0=surfaceReflectivityColor.rgb;\nvec3 specularEnvironmentR90=vec3(1.0,1.0,1.0)*reflectance90;\n#include<pbrLightFunctionsCall>[0..maxSimultaneousLights]\n#ifdef SPECULARTERM\nlightSpecularContribution*=vLightingIntensity.w;\n#endif\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);\n#ifdef OPACITYRGB\nopacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);\nalpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;\n#else\nalpha*=opacityMap.a*vOpacityInfos.y;\n#endif\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#ifdef OPACITYFRESNEL\nfloat opacityFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,opacityParts.z,opacityParts.w);\nalpha+=opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*opacityParts.y;\n#endif\n\nvec3 surfaceRefractionColor=vec3(0.,0.,0.);\n\n#ifdef LODBASEDMICROSFURACE\nfloat alphaG=convertRoughnessToAverageSlope(roughness);\n#endif\n#ifdef REFRACTION\nvec3 refractionVector=refract(-viewDirectionW,normalW,vRefractionInfos.y);\n#ifdef LODBASEDMICROSFURACE\n#ifdef USEPMREMREFRACTION\nfloat lodRefraction=getMipMapIndexFromAverageSlopeWithPMREM(vMicrosurfaceTextureLods.y,alphaG);\n#else\nfloat lodRefraction=getMipMapIndexFromAverageSlope(vMicrosurfaceTextureLods.y,alphaG);\n#endif\n#else\nfloat biasRefraction=(vMicrosurfaceTextureLods.y+2.)*(1.0-microSurface);\n#endif\n#ifdef REFRACTIONMAP_3D\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;\nif (dot(refractionVector,viewDirectionW)<1.0)\n{\n#ifdef LODBASEDMICROSFURACE\n#ifdef USEPMREMREFRACTION\n\nif ((vMicrosurfaceTextureLods.y-lodRefraction)>4.0)\n{\n\nfloat scaleRefraction=1.-exp2(lodRefraction)/exp2(vMicrosurfaceTextureLods.y); \nfloat maxRefraction=max(max(abs(refractionVector.x),abs(refractionVector.y)),abs(refractionVector.z));\nif (abs(refractionVector.x) != maxRefraction) refractionVector.x*=scaleRefraction;\nif (abs(refractionVector.y) != maxRefraction) refractionVector.y*=scaleRefraction;\nif (abs(refractionVector.z) != maxRefraction) refractionVector.z*=scaleRefraction;\n}\n#endif\nsurfaceRefractionColor=textureCubeLodEXT(refractionCubeSampler,refractionVector,lodRefraction).rgb*vRefractionInfos.x;\n#else\nsurfaceRefractionColor=textureCube(refractionCubeSampler,refractionVector,biasRefraction).rgb*vRefractionInfos.x;\n#endif\n}\n#ifndef REFRACTIONMAPINLINEARSPACE\nsurfaceRefractionColor=toLinearSpace(surfaceRefractionColor.rgb);\n#endif\n#else\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));\nvec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;\nrefractionCoords.y=1.0-refractionCoords.y;\n#ifdef LODBASEDMICROSFURACE\nsurfaceRefractionColor=texture2DLodEXT(refraction2DSampler,refractionCoords,lodRefraction).rgb*vRefractionInfos.x;\n#else\nsurfaceRefractionColor=texture2D(refraction2DSampler,refractionCoords,biasRefraction).rgb*vRefractionInfos.x;\n#endif \nsurfaceRefractionColor=toLinearSpace(surfaceRefractionColor.rgb);\n#endif\n#endif\n\nvec3 environmentRadiance=vReflectionColor.rgb;\nvec3 environmentIrradiance=vReflectionColor.rgb;\n#ifdef REFLECTION\nvec3 vReflectionUVW=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#ifdef LODBASEDMICROSFURACE\n#ifdef USEPMREMREFLECTION\nfloat lodReflection=getMipMapIndexFromAverageSlopeWithPMREM(vMicrosurfaceTextureLods.x,alphaG);\n#else\nfloat lodReflection=getMipMapIndexFromAverageSlope(vMicrosurfaceTextureLods.x,alphaG);\n#endif\n#else\nfloat biasReflection=(vMicrosurfaceTextureLods.x+2.)*(1.0-microSurface);\n#endif\n#ifdef REFLECTIONMAP_3D\n#ifdef LODBASEDMICROSFURACE\n#ifdef USEPMREMREFLECTION\n\nif ((vMicrosurfaceTextureLods.y-lodReflection)>4.0)\n{\n\nfloat scaleReflection=1.-exp2(lodReflection)/exp2(vMicrosurfaceTextureLods.x); \nfloat maxReflection=max(max(abs(vReflectionUVW.x),abs(vReflectionUVW.y)),abs(vReflectionUVW.z));\nif (abs(vReflectionUVW.x) != maxReflection) vReflectionUVW.x*=scaleReflection;\nif (abs(vReflectionUVW.y) != maxReflection) vReflectionUVW.y*=scaleReflection;\nif (abs(vReflectionUVW.z) != maxReflection) vReflectionUVW.z*=scaleReflection;\n}\n#endif\nenvironmentRadiance=textureCubeLodEXT(reflectionCubeSampler,vReflectionUVW,lodReflection).rgb*vReflectionInfos.x;\n#else\nenvironmentRadiance=textureCube(reflectionCubeSampler,vReflectionUVW,biasReflection).rgb*vReflectionInfos.x;\n#endif\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#ifndef REFLECTIONMAP_SKYBOX\nvec3 normalEnvironmentSpace=(reflectionMatrix*vec4(normalW,1)).xyz;\nenvironmentIrradiance=EnvironmentIrradiance(normalEnvironmentSpace);\n#endif\n#else\nenvironmentRadiance=toLinearSpace(environmentRadiance.rgb);\nenvironmentIrradiance=textureCube(reflectionCubeSampler,normalW,20.).rgb*vReflectionInfos.x;\nenvironmentIrradiance=toLinearSpace(environmentIrradiance.rgb);\nenvironmentIrradiance*=0.2; \n#endif\n#else\nvec2 coords=vReflectionUVW.xy;\n#ifdef REFLECTIONMAP_PROJECTION\ncoords/=vReflectionUVW.z;\n#endif\ncoords.y=1.0-coords.y;\n#ifdef LODBASEDMICROSFURACE\nenvironmentRadiance=texture2DLodEXT(reflection2DSampler,coords,lodReflection).rgb*vReflectionInfos.x;\n#else\nenvironmentRadiance=texture2D(reflection2DSampler,coords,biasReflection).rgb*vReflectionInfos.x;\n#endif\nenvironmentRadiance=toLinearSpace(environmentRadiance.rgb);\nenvironmentIrradiance=texture2D(reflection2DSampler,coords,20.).rgb*vReflectionInfos.x;\nenvironmentIrradiance=toLinearSpace(environmentIrradiance.rgb);\n#endif\n#endif\n#ifdef OVERLOADEDVALUES\nenvironmentIrradiance=mix(environmentIrradiance,vOverloadedReflection,vOverloadedMicroSurface.z);\nenvironmentRadiance=mix(environmentRadiance,vOverloadedReflection,vOverloadedMicroSurface.z);\n#endif\nenvironmentRadiance*=vLightingIntensity.z;\nenvironmentIrradiance*=vLightingIntensity.z;\n\nvec3 specularEnvironmentReflectance=FresnelSchlickEnvironmentGGX(clamp(NdotV,0.,1.),specularEnvironmentR0,specularEnvironmentR90,sqrt(microSurface));\n\nvec3 refractance=vec3(0.0,0.0,0.0);\n#ifdef REFRACTION\nvec3 transmission=vec3(1.0,1.0,1.0);\n#ifdef LINKREFRACTIONTOTRANSPARENCY\n\ntransmission*=(1.0-alpha);\n\n\nvec3 mixedAlbedo=surfaceAlbedoContribution.rgb*surfaceAlbedo.rgb;\nfloat maxChannel=max(max(mixedAlbedo.r,mixedAlbedo.g),mixedAlbedo.b);\nvec3 tint=clamp(maxChannel*mixedAlbedo,0.0,1.0);\n\nsurfaceAlbedoContribution*=alpha;\n\nenvironmentIrradiance*=alpha;\n\nsurfaceRefractionColor*=tint;\n\nalpha=1.0;\n#endif\n\nvec3 bounceSpecularEnvironmentReflectance=(2.0*specularEnvironmentReflectance)/(1.0+specularEnvironmentReflectance);\nspecularEnvironmentReflectance=mix(bounceSpecularEnvironmentReflectance,specularEnvironmentReflectance,alpha);\n\ntransmission*=1.0-specularEnvironmentReflectance;\n\nrefractance=surfaceRefractionColor*transmission;\n#endif\n\nsurfaceAlbedo.rgb=(1.-reflectance)*surfaceAlbedo.rgb;\nrefractance*=vLightingIntensity.z;\nenvironmentRadiance*=specularEnvironmentReflectance;\n\nvec3 surfaceEmissiveColor=vEmissiveColor;\n#ifdef EMISSIVE\nvec3 emissiveColorTex=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb;\nsurfaceEmissiveColor=toLinearSpace(emissiveColorTex.rgb)*surfaceEmissiveColor*vEmissiveInfos.y;\n#endif\n#ifdef OVERLOADEDVALUES\nsurfaceEmissiveColor=mix(surfaceEmissiveColor,vOverloadedEmissive,vOverloadedIntensity.w);\n#endif\n#ifdef EMISSIVEFRESNEL\nfloat emissiveFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,emissiveRightColor.a,emissiveLeftColor.a);\nsurfaceEmissiveColor*=emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*emissiveRightColor.rgb;\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec3 finalDiffuse=max(lightDiffuseContribution*surfaceAlbedoContribution+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#ifdef OVERLOADEDSHADOWVALUES\nshadowedOnlyLightDiffuseContribution=max(shadowedOnlyLightDiffuseContribution*surfaceAlbedoContribution+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#endif\n#else\n#ifdef LINKEMISSIVEWITHALBEDO\nvec3 finalDiffuse=max((lightDiffuseContribution+surfaceEmissiveColor)*surfaceAlbedoContribution+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#ifdef OVERLOADEDSHADOWVALUES\nshadowedOnlyLightDiffuseContribution=max((shadowedOnlyLightDiffuseContribution+surfaceEmissiveColor)*surfaceAlbedoContribution+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#endif\n#else\nvec3 finalDiffuse=max(lightDiffuseContribution*surfaceAlbedoContribution+surfaceEmissiveColor+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#ifdef OVERLOADEDSHADOWVALUES\nshadowedOnlyLightDiffuseContribution=max(shadowedOnlyLightDiffuseContribution*surfaceAlbedoContribution+surfaceEmissiveColor+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#endif\n#endif\n#endif\n#ifdef OVERLOADEDSHADOWVALUES\nfinalDiffuse=mix(finalDiffuse,shadowedOnlyLightDiffuseContribution,(1.0-vOverloadedShadowIntensity.y));\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=lightSpecularContribution*surfaceReflectivityColor;\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\n#ifdef SPECULAROVERALPHA\nalpha=clamp(alpha+getLuminance(finalSpecular),0.,1.);\n#endif\n#ifdef RADIANCEOVERALPHA\nalpha=clamp(alpha+getLuminance(environmentRadiance),0.,1.);\n#endif\n\n\n#ifdef EMISSIVEASILLUMINATION\nvec4 finalColor=vec4(finalDiffuse*ambientColor*vLightingIntensity.x+surfaceAlbedo.rgb*environmentIrradiance+finalSpecular*vLightingIntensity.x+environmentRadiance+surfaceEmissiveColor*vLightingIntensity.y+refractance,alpha);\n#else\nvec4 finalColor=vec4(finalDiffuse*ambientColor*vLightingIntensity.x+surfaceAlbedo.rgb*environmentIrradiance+finalSpecular*vLightingIntensity.x+environmentRadiance+refractance,alpha);\n#endif\n#ifdef LIGHTMAP\n#ifndef LIGHTMAPEXCLUDED\n#ifdef USELIGHTMAPASSHADOWMAP\nfinalColor.rgb*=lightmapColor;\n#else\nfinalColor.rgb+=lightmapColor;\n#endif\n#endif\n#endif\nfinalColor=max(finalColor,0.0);\n#ifdef CAMERATONEMAP\nfinalColor.rgb=toneMaps(finalColor.rgb);\n#endif\nfinalColor.rgb=toGammaSpace(finalColor.rgb);\n#include<logDepthFragment>\n#include<fogFragment>(color,finalColor)\n#ifdef CAMERACONTRAST\nfinalColor=contrasts(finalColor);\n#endif\nfinalColor.rgb=clamp(finalColor.rgb,0.,1.);\n#ifdef CAMERACOLORGRADING\nfinalColor=colorGrades(finalColor);\n#endif\n#ifdef CAMERACOLORCURVES\nfinalColor.rgb=applyColorCurves(finalColor.rgb);\n#endif\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ngl_FragColor=finalColor;\n}"):
a.i["pbr.fragment"]="#ifdef BUMP\n#extension GL_OES_standard_derivatives : enable\n#endif\n#ifdef LODBASEDMICROSFURACE\n#extension GL_EXT_shader_texture_lod : enable\n#endif\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nprecision highp float;\nuniform vec3 vEyePosition;\nuniform vec3 vAmbientColor;\nuniform vec3 vReflectionColor;\nuniform vec4 vAlbedoColor;\n\nuniform vec4 vLightingIntensity;\nuniform vec4 vCameraInfos;\n#ifdef OVERLOADEDVALUES\nuniform vec4 vOverloadedIntensity;\nuniform vec3 vOverloadedAmbient;\nuniform vec3 vOverloadedAlbedo;\nuniform vec3 vOverloadedReflectivity;\nuniform vec3 vOverloadedEmissive;\nuniform vec3 vOverloadedReflection;\nuniform vec3 vOverloadedMicroSurface;\n#endif\n#ifdef OVERLOADEDSHADOWVALUES\nuniform vec4 vOverloadedShadowIntensity;\n#endif\n#if defined(REFLECTION) || defined(REFRACTION)\nuniform vec2 vMicrosurfaceTextureLods;\n#endif\nuniform vec4 vReflectivityColor;\nuniform vec3 vEmissiveColor;\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<lightFragmentDeclaration>[0..maxSimultaneousLights]\n\n#ifdef ALBEDO\nvarying vec2 vAlbedoUV;\nuniform sampler2D albedoSampler;\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform sampler2D ambientSampler;\nuniform vec3 vAmbientInfos;\n#endif\n#ifdef OPACITY \nvarying vec2 vOpacityUV;\nuniform sampler2D opacitySampler;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform sampler2D emissiveSampler;\n#endif\n#ifdef LIGHTMAP\nvarying vec2 vLightmapUV;\nuniform vec2 vLightmapInfos;\nuniform sampler2D lightmapSampler;\n#endif\n#if defined(REFLECTIVITY) || defined(METALLICWORKFLOW) \nvarying vec2 vReflectivityUV;\nuniform vec2 vReflectivityInfos;\nuniform sampler2D reflectivitySampler;\n#endif\n\n#include<fresnelFunction>\n#ifdef OPACITYFRESNEL\nuniform vec4 opacityParts;\n#endif\n#ifdef EMISSIVEFRESNEL\nuniform vec4 emissiveLeftColor;\nuniform vec4 emissiveRightColor;\n#endif\n\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)\nuniform mat4 view;\n#endif\n\n#ifdef REFRACTION\nuniform vec4 vRefractionInfos;\n#ifdef REFRACTIONMAP_3D\nuniform samplerCube refractionCubeSampler;\n#else\nuniform sampler2D refraction2DSampler;\nuniform mat4 refractionMatrix;\n#endif\n#endif\n\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\n#ifdef REFLECTIONMAP_3D\nuniform samplerCube reflectionCubeSampler;\n#else\nuniform sampler2D reflection2DSampler;\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvarying vec3 vDirectionW;\n#endif\n#if defined(REFLECTIONMAP_PLANAR) || defined(REFLECTIONMAP_CUBIC) || defined(REFLECTIONMAP_PROJECTION)\nuniform mat4 reflectionMatrix;\n#endif\n#endif\n#include<reflectionFunction>\n#endif\n#ifdef CAMERACOLORGRADING\n#include<colorGradingDefinition>\n#endif\n#ifdef CAMERACOLORCURVES\n#include<colorCurvesDefinition>\n#endif\n\n#include<pbrShadowFunctions>\n#include<pbrFunctions>\n#ifdef CAMERACOLORGRADING\n#include<colorGrading>\n#endif\n#ifdef CAMERACOLORCURVES\n#include<colorCurves>\n#endif\n#include<harmonicsFunctions>\n#include<pbrLightFunctions>\n#include<helperFunctions>\n#include<bumpFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n\n#include<fogFragmentDeclaration>\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n#include<bumpFragment>\n\nvec4 surfaceAlbedo=vec4(1.,1.,1.,1.);\nvec3 surfaceAlbedoContribution=vAlbedoColor.rgb;\n\nfloat alpha=vAlbedoColor.a;\n#ifdef ALBEDO\nsurfaceAlbedo=texture2D(albedoSampler,vAlbedoUV+uvOffset);\nsurfaceAlbedo=vec4(toLinearSpace(surfaceAlbedo.rgb),surfaceAlbedo.a);\n#ifndef LINKREFRACTIONTOTRANSPARENCY\n#ifdef ALPHATEST\nif (surfaceAlbedo.a<0.4)\ndiscard;\n#endif\n#endif\n#ifdef ALPHAFROMALBEDO\nalpha*=surfaceAlbedo.a;\n#endif\nsurfaceAlbedo.rgb*=vAlbedoInfos.y;\n#else\n\nsurfaceAlbedo.rgb=surfaceAlbedoContribution;\nsurfaceAlbedoContribution=vec3(1.,1.,1.);\n#endif\n#ifdef VERTEXCOLOR\nsurfaceAlbedo.rgb*=vColor.rgb;\n#endif\n#ifdef OVERLOADEDVALUES\nsurfaceAlbedo.rgb=mix(surfaceAlbedo.rgb,vOverloadedAlbedo,vOverloadedIntensity.y);\n#endif\n\nvec3 ambientColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nambientColor=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb*vAmbientInfos.y;\nambientColor=vec3(1.,1.,1.)-((vec3(1.,1.,1.)-ambientColor)*vAmbientInfos.z);\n#ifdef OVERLOADEDVALUES\nambientColor.rgb=mix(ambientColor.rgb,vOverloadedAmbient,vOverloadedIntensity.x);\n#endif\n#endif\n\nfloat microSurface=vReflectivityColor.a;\nvec3 surfaceReflectivityColor=vReflectivityColor.rgb;\n#ifdef OVERLOADEDVALUES\nsurfaceReflectivityColor.rgb=mix(surfaceReflectivityColor.rgb,vOverloadedReflectivity,vOverloadedIntensity.z);\n#endif\n#ifdef REFLECTIVITY\nvec4 surfaceReflectivityColorMap=texture2D(reflectivitySampler,vReflectivityUV+uvOffset);\nsurfaceReflectivityColor=surfaceReflectivityColorMap.rgb;\nsurfaceReflectivityColor=toLinearSpace(surfaceReflectivityColor);\n#ifdef OVERLOADEDVALUES\nsurfaceReflectivityColor=mix(surfaceReflectivityColor,vOverloadedReflectivity,vOverloadedIntensity.z);\n#endif\n#ifdef MICROSURFACEFROMREFLECTIVITYMAP\nmicroSurface=surfaceReflectivityColorMap.a;\n#else\n#ifdef MICROSURFACEAUTOMATIC\nmicroSurface=computeDefaultMicroSurface(microSurface,surfaceReflectivityColor);\n#endif\n#endif\n#endif\n#ifdef METALLICWORKFLOW\nvec4 surfaceMetallicColorMap=texture2D(reflectivitySampler,vReflectivityUV+uvOffset);\n\nfloat metallic=surfaceMetallicColorMap.r; \n\nvec3 baseColor=surfaceAlbedo.rgb;\n\nsurfaceAlbedo.rgb*=(1.0-metallic);\n\n\nconst vec3 DefaultSpecularReflectanceDielectric=vec3(0.04,0.04,0.04);\n\nsurfaceReflectivityColor=mix(DefaultSpecularReflectanceDielectric,baseColor,metallic);\n#ifdef OVERLOADEDVALUES\nsurfaceReflectivityColor=mix(surfaceReflectivityColor,vOverloadedReflectivity,vOverloadedIntensity.z);\n#endif\n#ifdef METALLICROUGHNESSGSTOREINALPHA\nmicroSurface=1.0-surfaceMetallicColorMap.a;\n#else\n#ifdef METALLICROUGHNESSGSTOREINGREEN\nmicroSurface=1.0-surfaceMetallicColorMap.g;\n#endif\n#endif\n#endif\n#ifdef OVERLOADEDVALUES\nmicroSurface=mix(microSurface,vOverloadedMicroSurface.x,vOverloadedMicroSurface.y);\n#endif\n\nfloat NdotV=max(0.00000000001,dot(normalW,viewDirectionW));\n\nmicroSurface=clamp(microSurface,0.,1.)*0.98;\n\nfloat roughness=clamp(1.-microSurface,0.000001,1.0);\n\nvec3 lightDiffuseContribution=vec3(0.,0.,0.);\n#ifdef OVERLOADEDSHADOWVALUES\nvec3 shadowedOnlyLightDiffuseContribution=vec3(1.,1.,1.);\n#endif\n#ifdef SPECULARTERM\nvec3 lightSpecularContribution=vec3(0.,0.,0.);\n#endif\nfloat notShadowLevel=1.; \n#ifdef LIGHTMAP\nvec3 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset).rgb*vLightmapInfos.y;\n#endif\nfloat NdotL=-1.;\nlightingInfo info;\n\nfloat reflectance=max(max(surfaceReflectivityColor.r,surfaceReflectivityColor.g),surfaceReflectivityColor.b);\n\n\nfloat reflectance90=clamp(reflectance*25.0,0.0,1.0);\nvec3 specularEnvironmentR0=surfaceReflectivityColor.rgb;\nvec3 specularEnvironmentR90=vec3(1.0,1.0,1.0)*reflectance90;\n#include<pbrLightFunctionsCall>[0..maxSimultaneousLights]\n#ifdef SPECULARTERM\nlightSpecularContribution*=vLightingIntensity.w;\n#endif\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);\n#ifdef OPACITYRGB\nopacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);\nalpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;\n#else\nalpha*=opacityMap.a*vOpacityInfos.y;\n#endif\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#ifdef OPACITYFRESNEL\nfloat opacityFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,opacityParts.z,opacityParts.w);\nalpha+=opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*opacityParts.y;\n#endif\n\nvec3 surfaceRefractionColor=vec3(0.,0.,0.);\n\n#ifdef LODBASEDMICROSFURACE\nfloat alphaG=convertRoughnessToAverageSlope(roughness);\n#endif\n#ifdef REFRACTION\nvec3 refractionVector=refract(-viewDirectionW,normalW,vRefractionInfos.y);\n#ifdef LODBASEDMICROSFURACE\n#ifdef USEPMREMREFRACTION\nfloat lodRefraction=getMipMapIndexFromAverageSlopeWithPMREM(vMicrosurfaceTextureLods.y,alphaG);\n#else\nfloat lodRefraction=getMipMapIndexFromAverageSlope(vMicrosurfaceTextureLods.y,alphaG);\n#endif\n#else\nfloat biasRefraction=(vMicrosurfaceTextureLods.y+2.)*(1.0-microSurface);\n#endif\n#ifdef REFRACTIONMAP_3D\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;\nif (dot(refractionVector,viewDirectionW)<1.0)\n{\n#ifdef LODBASEDMICROSFURACE\n#ifdef USEPMREMREFRACTION\n\nif ((vMicrosurfaceTextureLods.y-lodRefraction)>4.0)\n{\n\nfloat scaleRefraction=1.-exp2(lodRefraction)/exp2(vMicrosurfaceTextureLods.y); \nfloat maxRefraction=max(max(abs(refractionVector.x),abs(refractionVector.y)),abs(refractionVector.z));\nif (abs(refractionVector.x) != maxRefraction) refractionVector.x*=scaleRefraction;\nif (abs(refractionVector.y) != maxRefraction) refractionVector.y*=scaleRefraction;\nif (abs(refractionVector.z) != maxRefraction) refractionVector.z*=scaleRefraction;\n}\n#endif\nsurfaceRefractionColor=textureCubeLodEXT(refractionCubeSampler,refractionVector,lodRefraction).rgb*vRefractionInfos.x;\n#else\nsurfaceRefractionColor=textureCube(refractionCubeSampler,refractionVector,biasRefraction).rgb*vRefractionInfos.x;\n#endif\n}\n#ifndef REFRACTIONMAPINLINEARSPACE\nsurfaceRefractionColor=toLinearSpace(surfaceRefractionColor.rgb);\n#endif\n#else\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));\nvec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;\nrefractionCoords.y=1.0-refractionCoords.y;\n#ifdef LODBASEDMICROSFURACE\nsurfaceRefractionColor=texture2DLodEXT(refraction2DSampler,refractionCoords,lodRefraction).rgb*vRefractionInfos.x;\n#else\nsurfaceRefractionColor=texture2D(refraction2DSampler,refractionCoords,biasRefraction).rgb*vRefractionInfos.x;\n#endif \nsurfaceRefractionColor=toLinearSpace(surfaceRefractionColor.rgb);\n#endif\n#endif\n\nvec3 environmentRadiance=vReflectionColor.rgb;\nvec3 environmentIrradiance=vReflectionColor.rgb;\n#ifdef REFLECTION\nvec3 vReflectionUVW=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#ifdef LODBASEDMICROSFURACE\n#ifdef USEPMREMREFLECTION\nfloat lodReflection=getMipMapIndexFromAverageSlopeWithPMREM(vMicrosurfaceTextureLods.x,alphaG);\n#else\nfloat lodReflection=getMipMapIndexFromAverageSlope(vMicrosurfaceTextureLods.x,alphaG);\n#endif\n#else\nfloat biasReflection=(vMicrosurfaceTextureLods.x+2.)*(1.0-microSurface);\n#endif\n#ifdef REFLECTIONMAP_3D\n#ifdef LODBASEDMICROSFURACE\n#ifdef USEPMREMREFLECTION\n\nif ((vMicrosurfaceTextureLods.y-lodReflection)>4.0)\n{\n\nfloat scaleReflection=1.-exp2(lodReflection)/exp2(vMicrosurfaceTextureLods.x); \nfloat maxReflection=max(max(abs(vReflectionUVW.x),abs(vReflectionUVW.y)),abs(vReflectionUVW.z));\nif (abs(vReflectionUVW.x) != maxReflection) vReflectionUVW.x*=scaleReflection;\nif (abs(vReflectionUVW.y) != maxReflection) vReflectionUVW.y*=scaleReflection;\nif (abs(vReflectionUVW.z) != maxReflection) vReflectionUVW.z*=scaleReflection;\n}\n#endif\nenvironmentRadiance=textureCubeLodEXT(reflectionCubeSampler,vReflectionUVW,lodReflection).rgb*vReflectionInfos.x;\n#else\nenvironmentRadiance=textureCube(reflectionCubeSampler,vReflectionUVW,biasReflection).rgb*vReflectionInfos.x;\n#endif\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#ifndef REFLECTIONMAP_SKYBOX\nvec3 normalEnvironmentSpace=(reflectionMatrix*vec4(normalW,1)).xyz;\nenvironmentIrradiance=EnvironmentIrradiance(normalEnvironmentSpace);\n#endif\n#else\nenvironmentRadiance=toLinearSpace(environmentRadiance.rgb);\nenvironmentIrradiance=textureCube(reflectionCubeSampler,normalW,20.).rgb*vReflectionInfos.x;\nenvironmentIrradiance=toLinearSpace(environmentIrradiance.rgb);\nenvironmentIrradiance*=0.2; \n#endif\n#else\nvec2 coords=vReflectionUVW.xy;\n#ifdef REFLECTIONMAP_PROJECTION\ncoords/=vReflectionUVW.z;\n#endif\ncoords.y=1.0-coords.y;\n#ifdef LODBASEDMICROSFURACE\nenvironmentRadiance=texture2DLodEXT(reflection2DSampler,coords,lodReflection).rgb*vReflectionInfos.x;\n#else\nenvironmentRadiance=texture2D(reflection2DSampler,coords,biasReflection).rgb*vReflectionInfos.x;\n#endif\nenvironmentRadiance=toLinearSpace(environmentRadiance.rgb);\nenvironmentIrradiance=texture2D(reflection2DSampler,coords,20.).rgb*vReflectionInfos.x;\nenvironmentIrradiance=toLinearSpace(environmentIrradiance.rgb);\n#endif\n#endif\n#ifdef OVERLOADEDVALUES\nenvironmentIrradiance=mix(environmentIrradiance,vOverloadedReflection,vOverloadedMicroSurface.z);\nenvironmentRadiance=mix(environmentRadiance,vOverloadedReflection,vOverloadedMicroSurface.z);\n#endif\nenvironmentRadiance*=vLightingIntensity.z;\nenvironmentIrradiance*=vLightingIntensity.z;\n\nvec3 specularEnvironmentReflectance=FresnelSchlickEnvironmentGGX(clamp(NdotV,0.,1.),specularEnvironmentR0,specularEnvironmentR90,sqrt(microSurface));\n\nvec3 refractance=vec3(0.0,0.0,0.0);\n#ifdef REFRACTION\nvec3 transmission=vec3(1.0,1.0,1.0);\n#ifdef LINKREFRACTIONTOTRANSPARENCY\n\ntransmission*=(1.0-alpha);\n\n\nvec3 mixedAlbedo=surfaceAlbedoContribution.rgb*surfaceAlbedo.rgb;\nfloat maxChannel=max(max(mixedAlbedo.r,mixedAlbedo.g),mixedAlbedo.b);\nvec3 tint=clamp(maxChannel*mixedAlbedo,0.0,1.0);\n\nsurfaceAlbedoContribution*=alpha;\n\nenvironmentIrradiance*=alpha;\n\nsurfaceRefractionColor*=tint;\n\nalpha=1.0;\n#endif\n\nvec3 bounceSpecularEnvironmentReflectance=(2.0*specularEnvironmentReflectance)/(1.0+specularEnvironmentReflectance);\nspecularEnvironmentReflectance=mix(bounceSpecularEnvironmentReflectance,specularEnvironmentReflectance,alpha);\n\ntransmission*=1.0-specularEnvironmentReflectance;\n\nrefractance=surfaceRefractionColor*transmission;\n#endif\n\nsurfaceAlbedo.rgb=(1.-reflectance)*surfaceAlbedo.rgb;\nrefractance*=vLightingIntensity.z;\nenvironmentRadiance*=specularEnvironmentReflectance;\n\nvec3 surfaceEmissiveColor=vEmissiveColor;\n#ifdef EMISSIVE\nvec3 emissiveColorTex=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb;\nsurfaceEmissiveColor=toLinearSpace(emissiveColorTex.rgb)*surfaceEmissiveColor*vEmissiveInfos.y;\n#endif\n#ifdef OVERLOADEDVALUES\nsurfaceEmissiveColor=mix(surfaceEmissiveColor,vOverloadedEmissive,vOverloadedIntensity.w);\n#endif\n#ifdef EMISSIVEFRESNEL\nfloat emissiveFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,emissiveRightColor.a,emissiveLeftColor.a);\nsurfaceEmissiveColor*=emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*emissiveRightColor.rgb;\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec3 finalDiffuse=max(lightDiffuseContribution*surfaceAlbedoContribution+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#ifdef OVERLOADEDSHADOWVALUES\nshadowedOnlyLightDiffuseContribution=max(shadowedOnlyLightDiffuseContribution*surfaceAlbedoContribution+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#endif\n#else\n#ifdef LINKEMISSIVEWITHALBEDO\nvec3 finalDiffuse=max((lightDiffuseContribution+surfaceEmissiveColor)*surfaceAlbedoContribution+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#ifdef OVERLOADEDSHADOWVALUES\nshadowedOnlyLightDiffuseContribution=max((shadowedOnlyLightDiffuseContribution+surfaceEmissiveColor)*surfaceAlbedoContribution+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#endif\n#else\nvec3 finalDiffuse=max(lightDiffuseContribution*surfaceAlbedoContribution+surfaceEmissiveColor+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#ifdef OVERLOADEDSHADOWVALUES\nshadowedOnlyLightDiffuseContribution=max(shadowedOnlyLightDiffuseContribution*surfaceAlbedoContribution+surfaceEmissiveColor+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#endif\n#endif\n#endif\n#ifdef OVERLOADEDSHADOWVALUES\nfinalDiffuse=mix(finalDiffuse,shadowedOnlyLightDiffuseContribution,(1.0-vOverloadedShadowIntensity.y));\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=lightSpecularContribution*surfaceReflectivityColor;\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\n#ifdef SPECULAROVERALPHA\nalpha=clamp(alpha+getLuminance(finalSpecular),0.,1.);\n#endif\n#ifdef RADIANCEOVERALPHA\nalpha=clamp(alpha+getLuminance(environmentRadiance),0.,1.);\n#endif\n\n\n#ifdef EMISSIVEASILLUMINATION\nvec4 finalColor=vec4(finalDiffuse*ambientColor*vLightingIntensity.x+surfaceAlbedo.rgb*environmentIrradiance+finalSpecular*vLightingIntensity.x+environmentRadiance+surfaceEmissiveColor*vLightingIntensity.y+refractance,alpha);\n#else\nvec4 finalColor=vec4(finalDiffuse*ambientColor*vLightingIntensity.x+surfaceAlbedo.rgb*environmentIrradiance+finalSpecular*vLightingIntensity.x+environmentRadiance+refractance,alpha);\n#endif\n#ifdef LIGHTMAP\n#ifndef LIGHTMAPEXCLUDED\n#ifdef USELIGHTMAPASSHADOWMAP\nfinalColor.rgb*=lightmapColor;\n#else\nfinalColor.rgb+=lightmapColor;\n#endif\n#endif\n#endif\nfinalColor=max(finalColor,0.0);\n#ifdef CAMERATONEMAP\nfinalColor.rgb=toneMaps(finalColor.rgb);\n#endif\nfinalColor.rgb=toGammaSpace(finalColor.rgb);\n#include<logDepthFragment>\n#include<fogFragment>(color,finalColor)\n#ifdef CAMERACONTRAST\nfinalColor=contrasts(finalColor);\n#endif\nfinalColor.rgb=clamp(finalColor.rgb,0.,1.);\n#ifdef CAMERACOLORGRADING\nfinalColor=colorGrades(finalColor);\n#endif\n#ifdef CAMERACOLORCURVES\nfinalColor.rgb=applyColorCurves(finalColor.rgb);\n#endif\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ngl_FragColor=finalColor;\n}";
null!=t["pbr.vertex"]?a.C("pbr.vertex","precision highp float;\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef ALBEDO\nvarying vec2 vAlbedoUV;\nuniform mat4 albedoMatrix;\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform mat4 ambientMatrix;\nuniform vec3 vAmbientInfos;\n#endif\n#ifdef OPACITY\nvarying vec2 vOpacityUV;\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#ifdef LIGHTMAP\nvarying vec2 vLightmapUV;\nuniform vec2 vLightmapInfos;\nuniform mat4 lightmapMatrix;\n#endif\n#if defined(REFLECTIVITY) || defined(METALLICWORKFLOW) \nvarying vec2 vReflectivityUV;\nuniform vec2 vReflectivityInfos;\nuniform mat4 reflectivityMatrix;\n#endif\n#ifdef BUMP\nvarying vec2 vBumpUV;\nuniform vec3 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<shadowsVertexDeclaration>[0..maxSimultaneousLights]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvarying vec3 vDirectionW;\n#endif\n#include<logDepthDeclaration>\nvoid main(void) {\n#ifdef REFLECTIONMAP_SKYBOX\nvPositionUVW=position;\n#endif \n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\nvec4 worldPos=finalWorld*vec4(position,1.0);\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvDirectionW=normalize(vec3(finalWorld*vec4(position,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef ALBEDO\nif (vAlbedoInfos.x == 0.)\n{\nvAlbedoUV=vec2(albedoMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAlbedoUV=vec2(albedoMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef AMBIENT\nif (vAmbientInfos.x == 0.)\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef OPACITY\nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef EMISSIVE\nif (vEmissiveInfos.x == 0.)\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef LIGHTMAP\nif (vLightmapInfos.x == 0.)\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(REFLECTIVITY) || defined(METALLICWORKFLOW) \nif (vReflectivityInfos.x == 0.)\n{\nvReflectivityUV=vec2(reflectivityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvReflectivityUV=vec2(reflectivityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef BUMP\nif (vBumpInfos.x == 0.)\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n\n#include<logDepthVertex>\n}"):
a.i["pbr.vertex"]="precision highp float;\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef ALBEDO\nvarying vec2 vAlbedoUV;\nuniform mat4 albedoMatrix;\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform mat4 ambientMatrix;\nuniform vec3 vAmbientInfos;\n#endif\n#ifdef OPACITY\nvarying vec2 vOpacityUV;\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#ifdef LIGHTMAP\nvarying vec2 vLightmapUV;\nuniform vec2 vLightmapInfos;\nuniform mat4 lightmapMatrix;\n#endif\n#if defined(REFLECTIVITY) || defined(METALLICWORKFLOW) \nvarying vec2 vReflectivityUV;\nuniform vec2 vReflectivityInfos;\nuniform mat4 reflectivityMatrix;\n#endif\n#ifdef BUMP\nvarying vec2 vBumpUV;\nuniform vec3 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<shadowsVertexDeclaration>[0..maxSimultaneousLights]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvarying vec3 vDirectionW;\n#endif\n#include<logDepthDeclaration>\nvoid main(void) {\n#ifdef REFLECTIONMAP_SKYBOX\nvPositionUVW=position;\n#endif \n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\nvec4 worldPos=finalWorld*vec4(position,1.0);\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvDirectionW=normalize(vec3(finalWorld*vec4(position,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef ALBEDO\nif (vAlbedoInfos.x == 0.)\n{\nvAlbedoUV=vec2(albedoMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAlbedoUV=vec2(albedoMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef AMBIENT\nif (vAmbientInfos.x == 0.)\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef OPACITY\nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef EMISSIVE\nif (vEmissiveInfos.x == 0.)\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef LIGHTMAP\nif (vLightmapInfos.x == 0.)\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(REFLECTIVITY) || defined(METALLICWORKFLOW) \nif (vReflectivityInfos.x == 0.)\n{\nvReflectivityUV=vec2(reflectivityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvReflectivityUV=vec2(reflectivityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef BUMP\nif (vBumpInfos.x == 0.)\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n\n#include<logDepthVertex>\n}";
null!=t["postprocess.vertex"]?a.C("postprocess.vertex","\nattribute vec2 position;\nuniform vec2 scale;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) { \nvUV=(position*madd+madd)*scale;\ngl_Position=vec4(position,0.0,1.0);\n}"):a.i["postprocess.vertex"]="\nattribute vec2 position;\nuniform vec2 scale;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) { \nvUV=(position*madd+madd)*scale;\ngl_Position=vec4(position,0.0,1.0);\n}";null!=t["procedural.vertex"]?
a.C("procedural.vertex","\nattribute vec2 position;\n\nvarying vec2 vPosition;\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) { \nvPosition=position;\nvUV=position*madd+madd;\ngl_Position=vec4(position,0.0,1.0);\n}"):a.i["procedural.vertex"]="\nattribute vec2 position;\n\nvarying vec2 vPosition;\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) { \nvPosition=position;\nvUV=position*madd+madd;\ngl_Position=vec4(position,0.0,1.0);\n}";null!=t["refraction.fragment"]?
a.C("refraction.fragment","\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D refractionSampler;\n\nuniform vec3 baseColor;\nuniform float depth;\nuniform float colorLevel;\nvoid main() {\nfloat ref=1.0-texture2D(refractionSampler,vUV).r;\nvec2 uv=vUV-vec2(0.5);\nvec2 offset=uv*depth*ref;\nvec3 sourceColor=texture2D(textureSampler,vUV-offset).rgb;\ngl_FragColor=vec4(sourceColor+sourceColor*ref*colorLevel,1.0);\n}"):a.i["refraction.fragment"]="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D refractionSampler;\n\nuniform vec3 baseColor;\nuniform float depth;\nuniform float colorLevel;\nvoid main() {\nfloat ref=1.0-texture2D(refractionSampler,vUV).r;\nvec2 uv=vUV-vec2(0.5);\nvec2 offset=uv*depth*ref;\nvec3 sourceColor=texture2D(textureSampler,vUV-offset).rgb;\ngl_FragColor=vec4(sourceColor+sourceColor*ref*colorLevel,1.0);\n}";
null!=t["shadowMap.fragment"]?a.C("shadowMap.fragment","#ifndef FULLFLOAT\nvec4 pack(float depth)\n{\nconst vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);\nconst vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);\nvec4 res=fract(depth*bit_shift);\nres-=res.xxyz*bit_mask;\nreturn res;\n}\n\nvec2 packHalf(float depth) \n{ \nconst vec2 bitOffset=vec2(1.0/255.,0.);\nvec2 color=vec2(depth,fract(depth*255.));\nreturn color-(color.yy*bitOffset);\n}\n#endif\nvarying vec4 vPosition;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\n#ifdef CUBEMAP\nuniform vec3 lightPosition;\nuniform vec2 depthValues;\n#endif\nvoid main(void)\n{\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\n#ifdef CUBEMAP\nvec3 directionToLight=vPosition.xyz-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth-depthValues.x)/(depthValues.y-depthValues.x);\ndepth=clamp(depth,0.,1.0);\n#else\nfloat depth=vPosition.z/vPosition.w;\ndepth=depth*0.5+0.5;\n#endif\n#ifdef VSM\nfloat moment1=depth;\nfloat moment2=moment1*moment1;\n#ifndef FULLFLOAT\ngl_FragColor=vec4(packHalf(moment1),packHalf(moment2));\n#else\ngl_FragColor=vec4(moment1,moment2,1.0,1.0);\n#endif\n#else\n#ifndef FULLFLOAT\ngl_FragColor=pack(depth);\n#else\ngl_FragColor=vec4(depth,1.0,1.0,1.0);\n#endif\n#endif\n}"):
a.i["shadowMap.fragment"]="#ifndef FULLFLOAT\nvec4 pack(float depth)\n{\nconst vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);\nconst vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);\nvec4 res=fract(depth*bit_shift);\nres-=res.xxyz*bit_mask;\nreturn res;\n}\n\nvec2 packHalf(float depth) \n{ \nconst vec2 bitOffset=vec2(1.0/255.,0.);\nvec2 color=vec2(depth,fract(depth*255.));\nreturn color-(color.yy*bitOffset);\n}\n#endif\nvarying vec4 vPosition;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\n#ifdef CUBEMAP\nuniform vec3 lightPosition;\nuniform vec2 depthValues;\n#endif\nvoid main(void)\n{\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\n#ifdef CUBEMAP\nvec3 directionToLight=vPosition.xyz-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth-depthValues.x)/(depthValues.y-depthValues.x);\ndepth=clamp(depth,0.,1.0);\n#else\nfloat depth=vPosition.z/vPosition.w;\ndepth=depth*0.5+0.5;\n#endif\n#ifdef VSM\nfloat moment1=depth;\nfloat moment2=moment1*moment1;\n#ifndef FULLFLOAT\ngl_FragColor=vec4(packHalf(moment1),packHalf(moment2));\n#else\ngl_FragColor=vec4(moment1,moment2,1.0,1.0);\n#endif\n#else\n#ifndef FULLFLOAT\ngl_FragColor=pack(depth);\n#else\ngl_FragColor=vec4(depth,1.0,1.0,1.0);\n#endif\n#endif\n}";
null!=t["shadowMap.vertex"]?a.C("shadowMap.vertex","\nattribute vec3 position;\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\nvarying vec4 vPosition;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\nvoid main(void)\n{\n#include<instancesVertex>\n#include<bonesVertex>\n#ifdef CUBEMAP\nvPosition=finalWorld*vec4(position,1.0);\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\n#else\nvPosition=viewProjection*finalWorld*vec4(position,1.0);\ngl_Position=vPosition;\n#endif\n#ifdef ALPHATEST\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n}"):
a.i["shadowMap.vertex"]="\nattribute vec3 position;\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\nvarying vec4 vPosition;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\nvoid main(void)\n{\n#include<instancesVertex>\n#include<bonesVertex>\n#ifdef CUBEMAP\nvPosition=finalWorld*vec4(position,1.0);\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\n#else\nvPosition=viewProjection*finalWorld*vec4(position,1.0);\ngl_Position=vPosition;\n#endif\n#ifdef ALPHATEST\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n}";
null!=t["sprites.fragment"]?a.C("sprites.fragment","uniform bool alphaTest;\nvarying vec4 vColor;\n\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n\n#include<fogFragmentDeclaration>\nvoid main(void) {\nvec4 color=texture2D(diffuseSampler,vUV);\nif (alphaTest) \n{\nif (color.a<0.95)\ndiscard;\n}\ncolor*=vColor;\n#include<fogFragment>\ngl_FragColor=color;\n}"):a.i["sprites.fragment"]="uniform bool alphaTest;\nvarying vec4 vColor;\n\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n\n#include<fogFragmentDeclaration>\nvoid main(void) {\nvec4 color=texture2D(diffuseSampler,vUV);\nif (alphaTest) \n{\nif (color.a<0.95)\ndiscard;\n}\ncolor*=vColor;\n#include<fogFragment>\ngl_FragColor=color;\n}";
null!=t["sprites.vertex"]?a.C("sprites.vertex","\nattribute vec4 position;\nattribute vec4 options;\nattribute vec4 cellInfo;\nattribute vec4 color;\n\nuniform vec2 textureInfos;\nuniform mat4 view;\nuniform mat4 projection;\n\nvarying vec2 vUV;\nvarying vec4 vColor;\n#include<fogVertexDeclaration>\nvoid main(void) { \nvec3 viewPos=(view*vec4(position.xyz,1.0)).xyz; \nvec2 cornerPos;\nfloat angle=position.w;\nvec2 size=vec2(options.x,options.y);\nvec2 offset=options.zw;\nvec2 uvScale=textureInfos.xy;\ncornerPos=vec2(offset.x-0.5,offset.y-0.5)*size;\n\nvec3 rotatedCorner;\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\n\nviewPos+=rotatedCorner;\ngl_Position=projection*vec4(viewPos,1.0); \n\nvColor=color;\n\nvec2 uvOffset=vec2(abs(offset.x-cellInfo.x),1.0-abs(offset.y-cellInfo.y));\nvUV=(uvOffset+cellInfo.zw)*uvScale;\n\n#ifdef FOG\nfFogDistance=viewPos.z;\n#endif\n}"):
a.i["sprites.vertex"]="\nattribute vec4 position;\nattribute vec4 options;\nattribute vec4 cellInfo;\nattribute vec4 color;\n\nuniform vec2 textureInfos;\nuniform mat4 view;\nuniform mat4 projection;\n\nvarying vec2 vUV;\nvarying vec4 vColor;\n#include<fogVertexDeclaration>\nvoid main(void) { \nvec3 viewPos=(view*vec4(position.xyz,1.0)).xyz; \nvec2 cornerPos;\nfloat angle=position.w;\nvec2 size=vec2(options.x,options.y);\nvec2 offset=options.zw;\nvec2 uvScale=textureInfos.xy;\ncornerPos=vec2(offset.x-0.5,offset.y-0.5)*size;\n\nvec3 rotatedCorner;\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\n\nviewPos+=rotatedCorner;\ngl_Position=projection*vec4(viewPos,1.0); \n\nvColor=color;\n\nvec2 uvOffset=vec2(abs(offset.x-cellInfo.x),1.0-abs(offset.y-cellInfo.y));\nvUV=(uvOffset+cellInfo.zw)*uvScale;\n\n#ifdef FOG\nfFogDistance=viewPos.z;\n#endif\n}";
null!=t["ssao.fragment"]?a.C("ssao.fragment","\nuniform sampler2D textureSampler;\nvarying vec2 vUV;\n#ifdef SSAO\nuniform sampler2D randomSampler;\nuniform float randTextureTiles;\nuniform float samplesFactor;\nuniform vec3 sampleSphere[SAMPLES];\nuniform float totalStrength;\nuniform float radius;\nuniform float area;\nuniform float fallOff;\nuniform float base;\nvec3 normalFromDepth(float depth,vec2 coords)\n{\nvec2 offset1=vec2(0.0,radius);\nvec2 offset2=vec2(radius,0.0);\nfloat depth1=texture2D(textureSampler,coords+offset1).r;\nfloat depth2=texture2D(textureSampler,coords+offset2).r;\nvec3 p1=vec3(offset1,depth1-depth);\nvec3 p2=vec3(offset2,depth2-depth);\nvec3 normal=cross(p1,p2);\nnormal.z=-normal.z;\nreturn normalize(normal);\n}\nvoid main()\n{\nvec3 random=normalize(texture2D(randomSampler,vUV*randTextureTiles).rgb);\nfloat depth=texture2D(textureSampler,vUV).r;\nvec3 position=vec3(vUV,depth);\nvec3 normal=normalFromDepth(depth,vUV);\nfloat radiusDepth=radius/depth;\nfloat occlusion=0.0;\nvec3 ray;\nvec3 hemiRay;\nfloat occlusionDepth;\nfloat difference;\nfor (int i=0; i<SAMPLES; i++)\n{\nray=radiusDepth*reflect(sampleSphere[i],random);\nhemiRay=position+sign(dot(ray,normal))*ray;\nocclusionDepth=texture2D(textureSampler,clamp(hemiRay.xy,vec2(0.001,0.001),vec2(0.999,0.999))).r;\ndifference=depth-occlusionDepth;\nocclusion+=step(fallOff,difference)*(1.0-smoothstep(fallOff,area,difference));\n}\nfloat ao=1.0-totalStrength*occlusion*samplesFactor;\nfloat result=clamp(ao+base,0.0,1.0);\ngl_FragColor.r=result;\ngl_FragColor.g=result;\ngl_FragColor.b=result;\ngl_FragColor.a=1.0;\n}\n#endif\n#ifdef BILATERAL_BLUR\nuniform sampler2D depthSampler;\nuniform float outSize;\nuniform float samplerOffsets[SAMPLES];\nvoid main()\n{\nfloat texelsize=1.0/outSize;\nfloat compareDepth=texture2D(depthSampler,vUV).r;\nfloat result=0.0;\nfloat weightSum=0.0;\nfor (int i=0; i<SAMPLES; ++i)\n{\n#ifdef BILATERAL_BLUR_H\nvec2 sampleOffset=vec2(texelsize*samplerOffsets[i],0.0);\n#else\nvec2 sampleOffset=vec2(0.0,texelsize*samplerOffsets[i]);\n#endif\nvec2 samplePos=vUV+sampleOffset;\nfloat sampleDepth=texture2D(depthSampler,samplePos).r;\nfloat weight=(1.0/(0.0001+abs(compareDepth-sampleDepth)));\nresult+=texture2D(textureSampler,samplePos).r*weight;\nweightSum+=weight;\n}\nresult/=weightSum;\ngl_FragColor.rgb=vec3(result);\ngl_FragColor.a=1.0;\n}\n#endif\n"):
a.i["ssao.fragment"]="\nuniform sampler2D textureSampler;\nvarying vec2 vUV;\n#ifdef SSAO\nuniform sampler2D randomSampler;\nuniform float randTextureTiles;\nuniform float samplesFactor;\nuniform vec3 sampleSphere[SAMPLES];\nuniform float totalStrength;\nuniform float radius;\nuniform float area;\nuniform float fallOff;\nuniform float base;\nvec3 normalFromDepth(float depth,vec2 coords)\n{\nvec2 offset1=vec2(0.0,radius);\nvec2 offset2=vec2(radius,0.0);\nfloat depth1=texture2D(textureSampler,coords+offset1).r;\nfloat depth2=texture2D(textureSampler,coords+offset2).r;\nvec3 p1=vec3(offset1,depth1-depth);\nvec3 p2=vec3(offset2,depth2-depth);\nvec3 normal=cross(p1,p2);\nnormal.z=-normal.z;\nreturn normalize(normal);\n}\nvoid main()\n{\nvec3 random=normalize(texture2D(randomSampler,vUV*randTextureTiles).rgb);\nfloat depth=texture2D(textureSampler,vUV).r;\nvec3 position=vec3(vUV,depth);\nvec3 normal=normalFromDepth(depth,vUV);\nfloat radiusDepth=radius/depth;\nfloat occlusion=0.0;\nvec3 ray;\nvec3 hemiRay;\nfloat occlusionDepth;\nfloat difference;\nfor (int i=0; i<SAMPLES; i++)\n{\nray=radiusDepth*reflect(sampleSphere[i],random);\nhemiRay=position+sign(dot(ray,normal))*ray;\nocclusionDepth=texture2D(textureSampler,clamp(hemiRay.xy,vec2(0.001,0.001),vec2(0.999,0.999))).r;\ndifference=depth-occlusionDepth;\nocclusion+=step(fallOff,difference)*(1.0-smoothstep(fallOff,area,difference));\n}\nfloat ao=1.0-totalStrength*occlusion*samplesFactor;\nfloat result=clamp(ao+base,0.0,1.0);\ngl_FragColor.r=result;\ngl_FragColor.g=result;\ngl_FragColor.b=result;\ngl_FragColor.a=1.0;\n}\n#endif\n#ifdef BILATERAL_BLUR\nuniform sampler2D depthSampler;\nuniform float outSize;\nuniform float samplerOffsets[SAMPLES];\nvoid main()\n{\nfloat texelsize=1.0/outSize;\nfloat compareDepth=texture2D(depthSampler,vUV).r;\nfloat result=0.0;\nfloat weightSum=0.0;\nfor (int i=0; i<SAMPLES; ++i)\n{\n#ifdef BILATERAL_BLUR_H\nvec2 sampleOffset=vec2(texelsize*samplerOffsets[i],0.0);\n#else\nvec2 sampleOffset=vec2(0.0,texelsize*samplerOffsets[i]);\n#endif\nvec2 samplePos=vUV+sampleOffset;\nfloat sampleDepth=texture2D(depthSampler,samplePos).r;\nfloat weight=(1.0/(0.0001+abs(compareDepth-sampleDepth)));\nresult+=texture2D(textureSampler,samplePos).r*weight;\nweightSum+=weight;\n}\nresult/=weightSum;\ngl_FragColor.rgb=vec3(result);\ngl_FragColor.a=1.0;\n}\n#endif\n";
null!=t["ssaoCombine.fragment"]?a.C("ssaoCombine.fragment","uniform sampler2D textureSampler;\nuniform sampler2D originalColor;\nvarying vec2 vUV;\nvoid main(void) {\nvec4 ssaoColor=texture2D(textureSampler,vUV);\nvec4 sceneColor=texture2D(originalColor,vUV);\ngl_FragColor=sceneColor*ssaoColor;\n}\n"):a.i["ssaoCombine.fragment"]="uniform sampler2D textureSampler;\nuniform sampler2D originalColor;\nvarying vec2 vUV;\nvoid main(void) {\nvec4 ssaoColor=texture2D(textureSampler,vUV);\nvec4 sceneColor=texture2D(originalColor,vUV);\ngl_FragColor=sceneColor*ssaoColor;\n}\n";
null!=t["standard.fragment"]?a.C("standard.fragment","uniform sampler2D textureSampler;\nvarying vec2 vUV;\n#if defined(PASS_POST_PROCESS)\nvoid main(void)\n{\nvec4 color=texture2D(textureSampler,vUV);\ngl_FragColor=color;\n}\n#endif\n#if defined(DOWN_SAMPLE_X4)\nuniform vec2 dsOffsets[16];\nvoid main(void)\n{\nvec4 average=vec4(0.0,0.0,0.0,0.0);\naverage=texture2D(textureSampler,vUV+dsOffsets[0]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[1]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[2]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[3]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[4]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[5]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[6]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[7]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[8]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[9]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[10]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[11]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[12]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[13]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[14]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[15]);\naverage/=16.0;\ngl_FragColor=average;\n}\n#endif\n#if defined(BRIGHT_PASS)\nuniform vec2 dsOffsets[4];\nuniform float brightThreshold;\nvoid main(void)\n{\nvec4 average=vec4(0.0,0.0,0.0,0.0);\naverage=texture2D(textureSampler,vUV+vec2(dsOffsets[0].x,dsOffsets[0].y));\naverage+=texture2D(textureSampler,vUV+vec2(dsOffsets[1].x,dsOffsets[1].y));\naverage+=texture2D(textureSampler,vUV+vec2(dsOffsets[2].x,dsOffsets[2].y));\naverage+=texture2D(textureSampler,vUV+vec2(dsOffsets[3].x,dsOffsets[3].y));\naverage*=0.25;\nfloat luminance=length(average.rgb);\nif (luminance<brightThreshold) {\naverage=vec4(0.0,0.0,0.0,1.0);\n}\ngl_FragColor=average;\n}\n#endif\n#if defined(GAUSSIAN_BLUR_H) || defined(GAUSSIAN_BLUR_V)\nuniform float blurOffsets[9];\nuniform float blurWeights[9];\nuniform float blurWidth;\nvoid main(void)\n{\nvec4 color=vec4(0.0,0.0,0.0,0.0);\nfor (int i=0; i<9; i++) {\n#ifdef GAUSSIAN_BLUR_H\ncolor+=(texture2D(textureSampler,vUV+vec2(blurOffsets[i]*blurWidth,0.0))*blurWeights[i]);\ncolor+=(texture2D(textureSampler,vUV-vec2(blurOffsets[i]*blurWidth,0.0))*blurWeights[i]);\n#else\ncolor+=(texture2D(textureSampler,vUV+vec2(0.0,blurOffsets[i]*blurWidth))*blurWeights[i]);\ncolor+=(texture2D(textureSampler,vUV-vec2(0.0,blurOffsets[i]*blurWidth))*blurWeights[i]);\n#endif\n}\ncolor.a=1.0;\ngl_FragColor=color;\n}\n#endif\n#if defined(TEXTURE_ADDER)\nuniform sampler2D otherSampler;\nuniform sampler2D lensSampler;\nuniform float exposure;\nvoid main(void)\n{\nvec3 colour=texture2D(textureSampler,vUV).rgb;\ncolour*=exposure;\nvec3 X=max(vec3(0.0,0.0,0.0),colour-0.004);\nvec3 retColor=(X*(6.2*X+0.5))/(X*(6.2*X+1.7)+0.06);\ncolour=retColor*retColor;\ncolour+=colour*texture2D(lensSampler,vUV).rgb;\nvec4 finalColor=vec4(colour.rgb,1.0)+texture2D(otherSampler,vUV);\ngl_FragColor=finalColor;\n}\n#endif\n#if defined(LENS_FLARE)\n#define GHOSTS 3\nuniform sampler2D lensColorSampler;\nuniform float strength;\nuniform float ghostDispersal;\nuniform float haloWidth;\nuniform vec2 resolution;\nuniform float distortionStrength;\nfloat hash(vec2 p)\n{\nfloat h=dot(p,vec2(127.1,311.7));\nreturn -1.0+2.0*fract(sin(h)*43758.5453123);\n}\nfloat noise(in vec2 p)\n{\nvec2 i=floor(p);\nvec2 f=fract(p);\nvec2 u=f*f*(3.0-2.0*f);\nreturn mix(mix(hash(i+vec2(0.0,0.0)),\nhash(i+vec2(1.0,0.0)),u.x),\nmix(hash(i+vec2(0.0,1.0)),\nhash(i+vec2(1.0,1.0)),u.x),u.y);\n}\nfloat fbm(vec2 p)\n{\nfloat f=0.0;\nf+=0.5000*noise(p); p*=2.02;\nf+=0.2500*noise(p); p*=2.03;\nf+=0.1250*noise(p); p*=2.01;\nf+=0.0625*noise(p); p*=2.04;\nf/=0.9375;\nreturn f;\n}\nvec3 pattern(vec2 uv)\n{\nvec2 p=-1.0+2.0*uv;\nfloat p2=dot(p,p);\nfloat f=fbm(vec2(15.0*p2))/2.0;\nfloat r=0.2+0.6*sin(12.5*length(uv-vec2(0.5)));\nfloat g=0.2+0.6*sin(20.5*length(uv-vec2(0.5)));\nfloat b=0.2+0.6*sin(17.2*length(uv-vec2(0.5)));\nreturn (1.0-f)*vec3(r,g,b);\n}\nfloat luminance(vec3 color)\n{\nreturn dot(color.rgb,vec3(0.2126,0.7152,0.0722));\n}\nvec4 textureDistorted(sampler2D tex,vec2 texcoord,vec2 direction,vec3 distortion)\n{\nreturn vec4(\ntexture2D(tex,texcoord+direction*distortion.r).r,\ntexture2D(tex,texcoord+direction*distortion.g).g,\ntexture2D(tex,texcoord+direction*distortion.b).b,\n1.0\n);\n}\nvoid main(void)\n{\nvec2 uv=-vUV+vec2(1.0);\nvec2 ghostDir=(vec2(0.5)-uv)*ghostDispersal;\nvec2 texelSize=1.0/resolution;\nvec3 distortion=vec3(-texelSize.x*distortionStrength,0.0,texelSize.x*distortionStrength);\nvec4 result=vec4(0.0);\nfloat ghostIndice=1.0;\nfor (int i=0; i<GHOSTS; ++i)\n{\nvec2 offset=fract(uv+ghostDir*ghostIndice);\nfloat weight=length(vec2(0.5)-offset)/length(vec2(0.5));\nweight=pow(1.0-weight,10.0);\nresult+=textureDistorted(textureSampler,offset,normalize(ghostDir),distortion)*weight*strength;\nghostIndice+=1.0;\n}\nvec2 haloVec=normalize(ghostDir)*haloWidth;\nfloat weight=length(vec2(0.5)-fract(uv+haloVec))/length(vec2(0.5));\nweight=pow(1.0-weight,10.0);\nresult+=textureDistorted(textureSampler,fract(uv+haloVec),normalize(ghostDir),distortion)*weight*strength;\nresult*=texture2D(lensColorSampler,vec2(length(vec2(0.5)-uv)/length(vec2(0.5))));\ngl_FragColor=result;\n}\n#endif\n#if defined(LENS_FLARE_COMPOSE)\nuniform sampler2D otherSampler;\nuniform sampler2D lensDirtSampler;\nuniform sampler2D lensStarSampler;\nuniform mat4 lensStarMatrix;\nvoid main(void)\n{\nvec2 lensFlareCoords=(lensStarMatrix*vec4(vUV,1.0,1.0)).xy;\nvec4 lensMod=texture2D(lensDirtSampler,vUV);\nlensMod+=texture2D(lensStarSampler,vUV);\nvec4 result=texture2D(textureSampler,vUV)*lensMod;\ngl_FragColor=texture2D(otherSampler,vUV)+result;\n}\n#endif\n#if defined(DEPTH_OF_FIELD)\nuniform sampler2D otherSampler;\nuniform sampler2D depthSampler;\nuniform float distance;\nvoid main(void)\n{\nvec4 sharp=texture2D(otherSampler,vUV);\nvec4 blur=texture2D(textureSampler,vUV);\nfloat dist=clamp(texture2D(depthSampler,vUV).r*distance,0.0,1.0);\nfloat factor=0.0;\nif (dist<0.05)\nfactor=1.0;\nelse if (dist<0.1)\nfactor=20.0*(0.1-dist);\nelse if (dist<0.5)\nfactor=0.0;\nelse\nfactor=2.0*(dist-0.5);\nfactor=clamp(factor,0.0,0.90);\ngl_FragColor=mix(sharp,blur,factor);\n}\n#endif\n"):
a.i["standard.fragment"]="uniform sampler2D textureSampler;\nvarying vec2 vUV;\n#if defined(PASS_POST_PROCESS)\nvoid main(void)\n{\nvec4 color=texture2D(textureSampler,vUV);\ngl_FragColor=color;\n}\n#endif\n#if defined(DOWN_SAMPLE_X4)\nuniform vec2 dsOffsets[16];\nvoid main(void)\n{\nvec4 average=vec4(0.0,0.0,0.0,0.0);\naverage=texture2D(textureSampler,vUV+dsOffsets[0]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[1]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[2]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[3]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[4]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[5]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[6]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[7]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[8]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[9]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[10]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[11]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[12]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[13]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[14]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[15]);\naverage/=16.0;\ngl_FragColor=average;\n}\n#endif\n#if defined(BRIGHT_PASS)\nuniform vec2 dsOffsets[4];\nuniform float brightThreshold;\nvoid main(void)\n{\nvec4 average=vec4(0.0,0.0,0.0,0.0);\naverage=texture2D(textureSampler,vUV+vec2(dsOffsets[0].x,dsOffsets[0].y));\naverage+=texture2D(textureSampler,vUV+vec2(dsOffsets[1].x,dsOffsets[1].y));\naverage+=texture2D(textureSampler,vUV+vec2(dsOffsets[2].x,dsOffsets[2].y));\naverage+=texture2D(textureSampler,vUV+vec2(dsOffsets[3].x,dsOffsets[3].y));\naverage*=0.25;\nfloat luminance=length(average.rgb);\nif (luminance<brightThreshold) {\naverage=vec4(0.0,0.0,0.0,1.0);\n}\ngl_FragColor=average;\n}\n#endif\n#if defined(GAUSSIAN_BLUR_H) || defined(GAUSSIAN_BLUR_V)\nuniform float blurOffsets[9];\nuniform float blurWeights[9];\nuniform float blurWidth;\nvoid main(void)\n{\nvec4 color=vec4(0.0,0.0,0.0,0.0);\nfor (int i=0; i<9; i++) {\n#ifdef GAUSSIAN_BLUR_H\ncolor+=(texture2D(textureSampler,vUV+vec2(blurOffsets[i]*blurWidth,0.0))*blurWeights[i]);\ncolor+=(texture2D(textureSampler,vUV-vec2(blurOffsets[i]*blurWidth,0.0))*blurWeights[i]);\n#else\ncolor+=(texture2D(textureSampler,vUV+vec2(0.0,blurOffsets[i]*blurWidth))*blurWeights[i]);\ncolor+=(texture2D(textureSampler,vUV-vec2(0.0,blurOffsets[i]*blurWidth))*blurWeights[i]);\n#endif\n}\ncolor.a=1.0;\ngl_FragColor=color;\n}\n#endif\n#if defined(TEXTURE_ADDER)\nuniform sampler2D otherSampler;\nuniform sampler2D lensSampler;\nuniform float exposure;\nvoid main(void)\n{\nvec3 colour=texture2D(textureSampler,vUV).rgb;\ncolour*=exposure;\nvec3 X=max(vec3(0.0,0.0,0.0),colour-0.004);\nvec3 retColor=(X*(6.2*X+0.5))/(X*(6.2*X+1.7)+0.06);\ncolour=retColor*retColor;\ncolour+=colour*texture2D(lensSampler,vUV).rgb;\nvec4 finalColor=vec4(colour.rgb,1.0)+texture2D(otherSampler,vUV);\ngl_FragColor=finalColor;\n}\n#endif\n#if defined(LENS_FLARE)\n#define GHOSTS 3\nuniform sampler2D lensColorSampler;\nuniform float strength;\nuniform float ghostDispersal;\nuniform float haloWidth;\nuniform vec2 resolution;\nuniform float distortionStrength;\nfloat hash(vec2 p)\n{\nfloat h=dot(p,vec2(127.1,311.7));\nreturn -1.0+2.0*fract(sin(h)*43758.5453123);\n}\nfloat noise(in vec2 p)\n{\nvec2 i=floor(p);\nvec2 f=fract(p);\nvec2 u=f*f*(3.0-2.0*f);\nreturn mix(mix(hash(i+vec2(0.0,0.0)),\nhash(i+vec2(1.0,0.0)),u.x),\nmix(hash(i+vec2(0.0,1.0)),\nhash(i+vec2(1.0,1.0)),u.x),u.y);\n}\nfloat fbm(vec2 p)\n{\nfloat f=0.0;\nf+=0.5000*noise(p); p*=2.02;\nf+=0.2500*noise(p); p*=2.03;\nf+=0.1250*noise(p); p*=2.01;\nf+=0.0625*noise(p); p*=2.04;\nf/=0.9375;\nreturn f;\n}\nvec3 pattern(vec2 uv)\n{\nvec2 p=-1.0+2.0*uv;\nfloat p2=dot(p,p);\nfloat f=fbm(vec2(15.0*p2))/2.0;\nfloat r=0.2+0.6*sin(12.5*length(uv-vec2(0.5)));\nfloat g=0.2+0.6*sin(20.5*length(uv-vec2(0.5)));\nfloat b=0.2+0.6*sin(17.2*length(uv-vec2(0.5)));\nreturn (1.0-f)*vec3(r,g,b);\n}\nfloat luminance(vec3 color)\n{\nreturn dot(color.rgb,vec3(0.2126,0.7152,0.0722));\n}\nvec4 textureDistorted(sampler2D tex,vec2 texcoord,vec2 direction,vec3 distortion)\n{\nreturn vec4(\ntexture2D(tex,texcoord+direction*distortion.r).r,\ntexture2D(tex,texcoord+direction*distortion.g).g,\ntexture2D(tex,texcoord+direction*distortion.b).b,\n1.0\n);\n}\nvoid main(void)\n{\nvec2 uv=-vUV+vec2(1.0);\nvec2 ghostDir=(vec2(0.5)-uv)*ghostDispersal;\nvec2 texelSize=1.0/resolution;\nvec3 distortion=vec3(-texelSize.x*distortionStrength,0.0,texelSize.x*distortionStrength);\nvec4 result=vec4(0.0);\nfloat ghostIndice=1.0;\nfor (int i=0; i<GHOSTS; ++i)\n{\nvec2 offset=fract(uv+ghostDir*ghostIndice);\nfloat weight=length(vec2(0.5)-offset)/length(vec2(0.5));\nweight=pow(1.0-weight,10.0);\nresult+=textureDistorted(textureSampler,offset,normalize(ghostDir),distortion)*weight*strength;\nghostIndice+=1.0;\n}\nvec2 haloVec=normalize(ghostDir)*haloWidth;\nfloat weight=length(vec2(0.5)-fract(uv+haloVec))/length(vec2(0.5));\nweight=pow(1.0-weight,10.0);\nresult+=textureDistorted(textureSampler,fract(uv+haloVec),normalize(ghostDir),distortion)*weight*strength;\nresult*=texture2D(lensColorSampler,vec2(length(vec2(0.5)-uv)/length(vec2(0.5))));\ngl_FragColor=result;\n}\n#endif\n#if defined(LENS_FLARE_COMPOSE)\nuniform sampler2D otherSampler;\nuniform sampler2D lensDirtSampler;\nuniform sampler2D lensStarSampler;\nuniform mat4 lensStarMatrix;\nvoid main(void)\n{\nvec2 lensFlareCoords=(lensStarMatrix*vec4(vUV,1.0,1.0)).xy;\nvec4 lensMod=texture2D(lensDirtSampler,vUV);\nlensMod+=texture2D(lensStarSampler,vUV);\nvec4 result=texture2D(textureSampler,vUV)*lensMod;\ngl_FragColor=texture2D(otherSampler,vUV)+result;\n}\n#endif\n#if defined(DEPTH_OF_FIELD)\nuniform sampler2D otherSampler;\nuniform sampler2D depthSampler;\nuniform float distance;\nvoid main(void)\n{\nvec4 sharp=texture2D(otherSampler,vUV);\nvec4 blur=texture2D(textureSampler,vUV);\nfloat dist=clamp(texture2D(depthSampler,vUV).r*distance,0.0,1.0);\nfloat factor=0.0;\nif (dist<0.05)\nfactor=1.0;\nelse if (dist<0.1)\nfactor=20.0*(0.1-dist);\nelse if (dist<0.5)\nfactor=0.0;\nelse\nfactor=2.0*(dist-0.5);\nfactor=clamp(factor,0.0,0.90);\ngl_FragColor=mix(sharp,blur,factor);\n}\n#endif\n";
null!=t["stereoscopicInterlace.fragment"]?a.C("stereoscopicInterlace.fragment","const vec3 TWO=vec3(2.0,2.0,2.0);\nvarying vec2 vUV;\nuniform sampler2D camASampler;\nuniform sampler2D textureSampler;\nuniform vec2 stepSize;\nvoid main(void)\n{\nbool useCamB;\nvec2 texCoord1;\nvec2 texCoord2;\nvec3 frag1;\nvec3 frag2;\n#ifdef IS_STEREOSCOPIC_HORIZ\nuseCamB=vUV.x>0.5;\ntexCoord1=vec2(useCamB ? (vUV.x-0.5)*2.0 : vUV.x*2.0,vUV.y);\ntexCoord2=vec2(texCoord1.x+stepSize.x,vUV.y);\n#else\nuseCamB=vUV.y>0.5;\ntexCoord1=vec2(vUV.x,useCamB ? (vUV.y-0.5)*2.0 : vUV.y*2.0);\ntexCoord2=vec2(vUV.x,texCoord1.y+stepSize.y);\n#endif\n\nif (useCamB){\nfrag1=texture2D(textureSampler,texCoord1).rgb;\nfrag2=texture2D(textureSampler,texCoord2).rgb;\n}else{\nfrag1=texture2D(camASampler ,texCoord1).rgb;\nfrag2=texture2D(camASampler ,texCoord2).rgb;\n}\ngl_FragColor=vec4((frag1+frag2)/TWO,1.0);\n}"):
a.i["stereoscopicInterlace.fragment"]="const vec3 TWO=vec3(2.0,2.0,2.0);\nvarying vec2 vUV;\nuniform sampler2D camASampler;\nuniform sampler2D textureSampler;\nuniform vec2 stepSize;\nvoid main(void)\n{\nbool useCamB;\nvec2 texCoord1;\nvec2 texCoord2;\nvec3 frag1;\nvec3 frag2;\n#ifdef IS_STEREOSCOPIC_HORIZ\nuseCamB=vUV.x>0.5;\ntexCoord1=vec2(useCamB ? (vUV.x-0.5)*2.0 : vUV.x*2.0,vUV.y);\ntexCoord2=vec2(texCoord1.x+stepSize.x,vUV.y);\n#else\nuseCamB=vUV.y>0.5;\ntexCoord1=vec2(vUV.x,useCamB ? (vUV.y-0.5)*2.0 : vUV.y*2.0);\ntexCoord2=vec2(vUV.x,texCoord1.y+stepSize.y);\n#endif\n\nif (useCamB){\nfrag1=texture2D(textureSampler,texCoord1).rgb;\nfrag2=texture2D(textureSampler,texCoord2).rgb;\n}else{\nfrag1=texture2D(camASampler ,texCoord1).rgb;\nfrag2=texture2D(camASampler ,texCoord2).rgb;\n}\ngl_FragColor=vec4((frag1+frag2)/TWO,1.0);\n}";
null!=t["tonemap.fragment"]?a.C("tonemap.fragment","\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform float _ExposureAdjustment;\n#if defined(HABLE_TONEMAPPING)\nconst float A=0.15;\nconst float B=0.50;\nconst float C=0.10;\nconst float D=0.20;\nconst float E=0.02;\nconst float F=0.30;\nconst float W=11.2;\n#endif\nfloat Luminance(vec3 c)\n{\nreturn dot(c,vec3(0.22,0.707,0.071));\n}\nvoid main(void) \n{\nvec3 colour=texture2D(textureSampler,vUV).rgb;\n#if defined(REINHARD_TONEMAPPING)\nfloat lum=Luminance(colour.rgb); \nfloat lumTm=lum*_ExposureAdjustment;\nfloat scale=lumTm/(1.0+lumTm); \ncolour*=scale/lum;\n#elif defined(HABLE_TONEMAPPING)\ncolour*=_ExposureAdjustment;\nconst float ExposureBias=2.0;\nvec3 x=ExposureBias*colour;\nvec3 curr=((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;\nx=vec3(W,W,W);\nvec3 whiteScale=1.0/(((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F);\ncolour=curr*whiteScale;\n#elif defined(OPTIMIZED_HEJIDAWSON_TONEMAPPING)\ncolour*=_ExposureAdjustment;\nvec3 X=max(vec3(0.0,0.0,0.0),colour-0.004);\nvec3 retColor=(X*(6.2*X+0.5))/(X*(6.2*X+1.7)+0.06);\ncolour=retColor*retColor;\n#elif defined(PHOTOGRAPHIC_TONEMAPPING)\ncolour=vec3(1.0,1.0,1.0)-exp2(-_ExposureAdjustment*colour);\n#endif\ngl_FragColor=vec4(colour.rgb,1.0);\n}"):
a.i["tonemap.fragment"]="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform float _ExposureAdjustment;\n#if defined(HABLE_TONEMAPPING)\nconst float A=0.15;\nconst float B=0.50;\nconst float C=0.10;\nconst float D=0.20;\nconst float E=0.02;\nconst float F=0.30;\nconst float W=11.2;\n#endif\nfloat Luminance(vec3 c)\n{\nreturn dot(c,vec3(0.22,0.707,0.071));\n}\nvoid main(void) \n{\nvec3 colour=texture2D(textureSampler,vUV).rgb;\n#if defined(REINHARD_TONEMAPPING)\nfloat lum=Luminance(colour.rgb); \nfloat lumTm=lum*_ExposureAdjustment;\nfloat scale=lumTm/(1.0+lumTm); \ncolour*=scale/lum;\n#elif defined(HABLE_TONEMAPPING)\ncolour*=_ExposureAdjustment;\nconst float ExposureBias=2.0;\nvec3 x=ExposureBias*colour;\nvec3 curr=((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;\nx=vec3(W,W,W);\nvec3 whiteScale=1.0/(((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F);\ncolour=curr*whiteScale;\n#elif defined(OPTIMIZED_HEJIDAWSON_TONEMAPPING)\ncolour*=_ExposureAdjustment;\nvec3 X=max(vec3(0.0,0.0,0.0),colour-0.004);\nvec3 retColor=(X*(6.2*X+0.5))/(X*(6.2*X+1.7)+0.06);\ncolour=retColor*retColor;\n#elif defined(PHOTOGRAPHIC_TONEMAPPING)\ncolour=vec3(1.0,1.0,1.0)-exp2(-_ExposureAdjustment*colour);\n#endif\ngl_FragColor=vec4(colour.rgb,1.0);\n}";
null!=t["volumetricLightScattering.fragment"]?a.C("volumetricLightScattering.fragment","uniform sampler2D textureSampler;\nuniform sampler2D lightScatteringSampler;\nuniform float decay;\nuniform float exposure;\nuniform float weight;\nuniform float density;\nuniform vec2 meshPositionOnScreen;\nvarying vec2 vUV;\nvoid main(void) {\nvec2 tc=vUV;\nvec2 deltaTexCoord=(tc-meshPositionOnScreen.xy);\ndeltaTexCoord*=1.0/float(NUM_SAMPLES)*density;\nfloat illuminationDecay=1.0;\nvec4 color=texture2D(lightScatteringSampler,tc)*0.4;\nfor(int i=0; i<NUM_SAMPLES; i++) {\ntc-=deltaTexCoord;\nvec4 sample=texture2D(lightScatteringSampler,tc)*0.4;\nsample*=illuminationDecay*weight;\ncolor+=sample;\nilluminationDecay*=decay;\n}\nvec4 realColor=texture2D(textureSampler,vUV);\ngl_FragColor=((vec4((vec3(color.r,color.g,color.b)*exposure),1))+(realColor*(1.5-0.4)));\n}\n"):
a.i["volumetricLightScattering.fragment"]="uniform sampler2D textureSampler;\nuniform sampler2D lightScatteringSampler;\nuniform float decay;\nuniform float exposure;\nuniform float weight;\nuniform float density;\nuniform vec2 meshPositionOnScreen;\nvarying vec2 vUV;\nvoid main(void) {\nvec2 tc=vUV;\nvec2 deltaTexCoord=(tc-meshPositionOnScreen.xy);\ndeltaTexCoord*=1.0/float(NUM_SAMPLES)*density;\nfloat illuminationDecay=1.0;\nvec4 color=texture2D(lightScatteringSampler,tc)*0.4;\nfor(int i=0; i<NUM_SAMPLES; i++) {\ntc-=deltaTexCoord;\nvec4 sample=texture2D(lightScatteringSampler,tc)*0.4;\nsample*=illuminationDecay*weight;\ncolor+=sample;\nilluminationDecay*=decay;\n}\nvec4 realColor=texture2D(textureSampler,vUV);\ngl_FragColor=((vec4((vec3(color.r,color.g,color.b)*exposure),1))+(realColor*(1.5-0.4)));\n}\n";
null!=t["volumetricLightScatteringPass.fragment"]?a.C("volumetricLightScatteringPass.fragment","#if defined(ALPHATEST) || defined(NEED_UV)\nvarying vec2 vUV;\n#endif\n#if defined(ALPHATEST)\nuniform sampler2D diffuseSampler;\n#endif\nvoid main(void)\n{\n#if defined(ALPHATEST)\nvec4 diffuseColor=texture2D(diffuseSampler,vUV);\nif (diffuseColor.a<0.4)\ndiscard;\n#endif\ngl_FragColor=vec4(0.0,0.0,0.0,1.0);\n}\n"):a.i["volumetricLightScatteringPass.fragment"]="#if defined(ALPHATEST) || defined(NEED_UV)\nvarying vec2 vUV;\n#endif\n#if defined(ALPHATEST)\nuniform sampler2D diffuseSampler;\n#endif\nvoid main(void)\n{\n#if defined(ALPHATEST)\nvec4 diffuseColor=texture2D(diffuseSampler,vUV);\nif (diffuseColor.a<0.4)\ndiscard;\n#endif\ngl_FragColor=vec4(0.0,0.0,0.0,1.0);\n}\n";
null!=t["vrDistortionCorrection.fragment"]?a.C("vrDistortionCorrection.fragment","\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform vec2 LensCenter;\nuniform vec2 Scale;\nuniform vec2 ScaleIn;\nuniform vec4 HmdWarpParam;\nvec2 HmdWarp(vec2 in01) {\nvec2 theta=(in01-LensCenter)*ScaleIn; \nfloat rSq=theta.x*theta.x+theta.y*theta.y;\nvec2 rvector=theta*(HmdWarpParam.x+HmdWarpParam.y*rSq+HmdWarpParam.z*rSq*rSq+HmdWarpParam.w*rSq*rSq*rSq);\nreturn LensCenter+Scale*rvector;\n}\nvoid main(void)\n{\nvec2 tc=HmdWarp(vUV);\nif (tc.x <0.0 || tc.x>1.0 || tc.y<0.0 || tc.y>1.0)\ngl_FragColor=vec4(0.0,0.0,0.0,1.0);\nelse{\ngl_FragColor=vec4(texture2D(textureSampler,tc).rgb,1.0);\n}\n}"):
a.i["vrDistortionCorrection.fragment"]="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform vec2 LensCenter;\nuniform vec2 Scale;\nuniform vec2 ScaleIn;\nuniform vec4 HmdWarpParam;\nvec2 HmdWarp(vec2 in01) {\nvec2 theta=(in01-LensCenter)*ScaleIn; \nfloat rSq=theta.x*theta.x+theta.y*theta.y;\nvec2 rvector=theta*(HmdWarpParam.x+HmdWarpParam.y*rSq+HmdWarpParam.z*rSq*rSq+HmdWarpParam.w*rSq*rSq*rSq);\nreturn LensCenter+Scale*rvector;\n}\nvoid main(void)\n{\nvec2 tc=HmdWarp(vUV);\nif (tc.x <0.0 || tc.x>1.0 || tc.y<0.0 || tc.y>1.0)\ngl_FragColor=vec4(0.0,0.0,0.0,1.0);\nelse{\ngl_FragColor=vec4(texture2D(textureSampler,tc).rgb,1.0);\n}\n}";
null!=t["compose.fragment"]?a.C("compose.fragment","varying vec2 vUV; \n uniform sampler2D textureSampler; \n uniform sampler2D sceneSampler; \n uniform vec2 screenSize; \n uniform float sceneIntensity; \n uniform float glowIntensity; \n uniform float highlightIntensity; \n void main(void) \n { \n \tvec4 orig = texture2D(sceneSampler, vUV); \n vec4 blur = texture2D(textureSampler, vUV); \n vec4 final = sceneIntensity * orig + glowIntensity * blur + highlightIntensity * blur.a; \n final.a = 1.0; \n gl_FragColor = final; \n }"):
a.i["compose.fragment"]="varying vec2 vUV; \n uniform sampler2D textureSampler; \n uniform sampler2D sceneSampler; \n uniform vec2 screenSize; \n uniform float sceneIntensity; \n uniform float glowIntensity; \n uniform float highlightIntensity; \n void main(void) \n { \n \tvec4 orig = texture2D(sceneSampler, vUV); \n vec4 blur = texture2D(textureSampler, vUV); \n vec4 final = sceneIntensity * orig + glowIntensity * blur + highlightIntensity * blur.a; \n final.a = 1.0; \n gl_FragColor = final; \n }";
null!=t["downsample.fragment"]?a.C("downsample.fragment","varying vec2 vUV; \n uniform sampler2D textureSampler; \n uniform vec2 screenSize; \n uniform float highlightThreshold; \n float highlights(vec3 color) { return smoothstep(highlightThreshold, 1.0, dot(color, vec3(0.3, 0.59, 0.11))); } \n void main(void) \n { \n vec2 texelSize = vec2(1.0 / screenSize.x, 1.0 / screenSize.y); \n vec4 baseColor = texture2D(textureSampler, vUV + vec2(-1.0, -1.0) * texelSize) * 0.25; \n baseColor += texture2D(textureSampler, vUV + vec2(1.0, -1.0) * texelSize) * 0.25; \n baseColor += texture2D(textureSampler, vUV + vec2(1.0, 1.0) * texelSize) * 0.25; \n baseColor += texture2D(textureSampler, vUV + vec2(-1.0, 1.0) * texelSize) * 0.25; \n baseColor.a = highlights(baseColor.rgb); \n gl_FragColor = baseColor; \n }"):
a.i["downsample.fragment"]="varying vec2 vUV; \n uniform sampler2D textureSampler; \n uniform vec2 screenSize; \n uniform float highlightThreshold; \n float highlights(vec3 color) { return smoothstep(highlightThreshold, 1.0, dot(color, vec3(0.3, 0.59, 0.11))); } \n void main(void) \n { \n vec2 texelSize = vec2(1.0 / screenSize.x, 1.0 / screenSize.y); \n vec4 baseColor = texture2D(textureSampler, vUV + vec2(-1.0, -1.0) * texelSize) * 0.25; \n baseColor += texture2D(textureSampler, vUV + vec2(1.0, -1.0) * texelSize) * 0.25; \n baseColor += texture2D(textureSampler, vUV + vec2(1.0, 1.0) * texelSize) * 0.25; \n baseColor += texture2D(textureSampler, vUV + vec2(-1.0, 1.0) * texelSize) * 0.25; \n baseColor.a = highlights(baseColor.rgb); \n gl_FragColor = baseColor; \n }";
return a}(this);Gc.fI=new Mb("\\S+","");Db.X=new p(1,0,0);Db.Y=new p(0,1,0);Db.Z=new p(0,0,1);fa.Qj=[new Q(0,0,0),new Q(0,0,0),new Q(0,0,0)];fa.nc=[new p(0,0,0),new p(0,0,0),new p(0,0,0),new p(0,0,0),new p(0,0,0),new p(0,0,0),new p(0,0,0),new p(0,0,0),new p(0,0,0)];fa.Ra=function(){var a=new r;a.a[0]=0;a.a[1]=0;a.a[2]=0;a.a[3]=0;a.a[4]=0;a.a[5]=0;a.a[6]=0;a.a[7]=0;a.a[8]=0;a.a[9]=0;a.a[10]=0;a.a[11]=0;a.a[12]=0;a.a[13]=0;a.a[14]=0;a.a[15]=0;var b=new r;b.a[0]=0;b.a[1]=0;b.a[2]=0;b.a[3]=0;b.a[4]=0;
b.a[5]=0;b.a[6]=0;b.a[7]=0;b.a[8]=0;b.a[9]=0;b.a[10]=0;b.a[11]=0;b.a[12]=0;b.a[13]=0;b.a[14]=0;b.a[15]=0;var c=new r;c.a[0]=0;c.a[1]=0;c.a[2]=0;c.a[3]=0;c.a[4]=0;c.a[5]=0;c.a[6]=0;c.a[7]=0;c.a[8]=0;c.a[9]=0;c.a[10]=0;c.a[11]=0;c.a[12]=0;c.a[13]=0;c.a[14]=0;c.a[15]=0;var d=new r;d.a[0]=0;d.a[1]=0;d.a[2]=0;d.a[3]=0;d.a[4]=0;d.a[5]=0;d.a[6]=0;d.a[7]=0;d.a[8]=0;d.a[9]=0;d.a[10]=0;d.a[11]=0;d.a[12]=0;d.a[13]=0;d.a[14]=0;d.a[15]=0;var e=new r;e.a[0]=0;e.a[1]=0;e.a[2]=0;e.a[3]=0;e.a[4]=0;e.a[5]=0;e.a[6]=
0;e.a[7]=0;e.a[8]=0;e.a[9]=0;e.a[10]=0;e.a[11]=0;e.a[12]=0;e.a[13]=0;e.a[14]=0;e.a[15]=0;var f=new r;f.a[0]=0;f.a[1]=0;f.a[2]=0;f.a[3]=0;f.a[4]=0;f.a[5]=0;f.a[6]=0;f.a[7]=0;f.a[8]=0;f.a[9]=0;f.a[10]=0;f.a[11]=0;f.a[12]=0;f.a[13]=0;f.a[14]=0;f.a[15]=0;var g=new r;g.a[0]=0;g.a[1]=0;g.a[2]=0;g.a[3]=0;g.a[4]=0;g.a[5]=0;g.a[6]=0;g.a[7]=0;g.a[8]=0;g.a[9]=0;g.a[10]=0;g.a[11]=0;g.a[12]=0;g.a[13]=0;g.a[14]=0;g.a[15]=0;var h=new r;h.a[0]=0;h.a[1]=0;h.a[2]=0;h.a[3]=0;h.a[4]=0;h.a[5]=0;h.a[6]=0;h.a[7]=0;h.a[8]=
0;h.a[9]=0;h.a[10]=0;h.a[11]=0;h.a[12]=0;h.a[13]=0;h.a[14]=0;h.a[15]=0;return[a,b,c,d,e,f,g,h]}(this);A.hE=new p(0,0,1);A.Uw=new p(0,0,0);A.zD=new r;A.TD=new r;A.to=[];A.Di=[];A.zi=[];A.Vw=new r;A.Ww=new r;A.Zb=new O;sc.qD=0;uc.ce=1E-5;Ja.ib=0;mb.Pw=[null,null,null,null,"A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","1","2","3","4","5","6","7","8","9","0","Enter","Escape","Backspace","Tab","Space","-","=","[","]","\\","#",";","'","`",",",".",
"/","CapsLock","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12","PrintScreen","ScrollLock","Pause","Insert","Home","PageUp","Delete","End","PageDown","Right","Left","Down","Up","Numlock","Keypad /","Keypad *","Keypad -","Keypad +","Keypad Enter","Keypad 1","Keypad 2","Keypad 3","Keypad 4","Keypad 5","Keypad 6","Keypad 7","Keypad 8","Keypad 9","Keypad 0","Keypad .",null,"Application","Power","Keypad =","F13","F14","F15","F16","F17","F18","F19","F20","F21","F22","F23","F24","Execute",
"Help","Menu","Select","Stop","Again","Undo","Cut","Copy","Paste","Find","Mute","VolumeUp","VolumeDown",null,null,null,"Keypad ,","Keypad = (AS400)",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"AltErase","SysReq","Cancel","Clear","Prior","Enter","Separator","Out","Oper","Clear / Again","CrSel","ExSel",null,null,null,null,null,null,null,null,null,null,null,"Keypad 00","Keypad 000","ThousandsSeparator","DecimalSeparator","CurrencyUnit","CurrencySubUnit",
"Keypad (","Keypad )","Keypad {","Keypad }","Keypad Tab","Keypad Backspace","Keypad A","Keypad B","Keypad C","Keypad D","Keypad E","Keypad F","Keypad XOR","Keypad ^","Keypad %","Keypad <","Keypad >","Keypad &","Keypad &&","Keypad |","Keypad ||","Keypad :","Keypad #","Keypad Space","Keypad @","Keypad !","Keypad MemStore","Keypad MemRecall","Keypad MemClear","Keypad MemAdd","Keypad MemSubtract","Keypad MemMultiply","Keypad MemDivide","Keypad +/-","Keypad Clear","Keypad ClearEntry","Keypad Binary","Keypad Octal",
"Keypad Decimal","Keypad Hexadecimal",null,null,"Left Ctrl","Left Shift","Left Alt","Left Meta","Right Ctrl","Right Shift","Right Alt","Right Meta",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"ModeSwitch","AudioNext","AudioPrev","AudioStop","AudioPlay","AudioMute","MediaSelect","WWW","Mail","Calculator","Computer","AC Search","AC Home","AC Back","AC Forward","AC Stop","AC Refresh","AC Bookmarks","BrightnessDown","BrightnessUp",
"DisplaySwitch","KBDIllumToggle","KBDIllumDown","KBDIllumUp","Eject","Sleep"];ib.count=0;Bb.BYTES_PER_ELEMENT=4;tc.BYTES_PER_ELEMENT=1;da.da="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";Wc.Ib()})("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this);
